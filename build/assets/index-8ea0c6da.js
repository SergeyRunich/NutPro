var q=Object.defineProperty;var H=(m,d,s)=>d in m?q(m,d,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[d]=s;var D=(m,d,s)=>(H(m,typeof d!="symbol"?d+"":d,s),s);import{a as K,c as n,j as e,bd as z,a1 as O,a2 as I,r as U,I as $,aa as v,B as w,be as W,a3 as M,cq as Z,bg as G}from"./index-c20b5e8e.js";import{R as f,C as l}from"./row-58ed805b.js";import{S as x}from"./index-297358d3.js";import{A as J}from"./index-81521736.js";import{F as b}from"./index-a86cfb93.js";import{S as X}from"./index-06104a82.js";import{I as P}from"./index-86d1917a.js";import{c as ee}from"./deliveryTools-db414b57.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as se}from"./index-2f7554ca.js";import{D as re}from"./index-1e692111.js";import{T as ie}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{u as te,v as de}from"./order-d29e3517.js";import{k as ae}from"./customer-fbff77ee.js";import"./padStart-17be0050.js";import"./index-8e340a60.js";import"./styleChecker-a7b568e2.js";const ne=({data:m})=>{const{name:d,paymentAddress:s,phone:i,email:r,regNumber:a,vatNumber:o,zip:c}=m,{formatMessage:t}=K();return n("div",{children:[n("h3",{children:[t({id:"Orders.NewB2BOrderForCompany"})," ",e("i",{children:d})]}),e("hr",{}),n(f,{gutter:16,children:[n(l,{xl:12,md:24,children:[e("strong",{children:t({id:"Orders.Phone:SPACE"})}),i,e("br",{}),e("strong",{children:t({id:"Orders.Email:SPACE"})}),r,e("br",{}),e("strong",{children:t({id:"Orders.BillingAddress:SPACE"})}),s]}),n(l,{xl:12,md:24,children:[e("strong",{children:t({id:"Orders.IČO:SPACE"})}),a,e("br",{}),e("strong",{children:t({id:"Orders.DIČ:SPACE"})}),o,e("br",{}),e("strong",{children:t({id:"Orders.ZIPCode:SPACE"})}),c]})]}),e("br",{}),e(J,{message:t({id:"Orders.BillingInfo"}),description:t({id:"Orders.info"}),type:"info",showIcon:!0})]})};var A,S;const{Search:oe}=$;let le=(A=z(({user:m,settings:d})=>({user:m,settings:d})),O(S=A(S=class extends I.Component{constructor(s){super(s);D(this,"state",{isLoadingSearch:!1,urlAddress:""});D(this,"formRef",U.createRef());this.addressQuery=this.addressQuery.bind(this)}addressQuery(){const{onChangeField:s,address:i}=this.props,{currentBranch:r}=this.props.settings;this.setState({isLoadingSearch:!0}),r&&ee({branchId:r,address:i}).then(async a=>{if(a.ok){const o=await a.json();this.setState({urlAddress:o.result.address.url,isLoadingSearch:!1}),s(!o.result.isPointInPolygon,"isAddDeliveryFee"),s(!0,"isAddressChecked")}else s("Invalid","isAddDeliveryFee"),this.setState({isLoadingSearch:!1})})}render(){const{onChangeField:s,onChangeDeliveryTime:i,intl:{formatMessage:r}}=this.props,{address:a,deliveryDescription:o,deliveryTime:c,isAddDeliveryFee:t,isAddressChecked:h,customPrice:p}=this.props,{isLoadingSearch:g,urlAddress:C}=this.state;return e("div",{children:e(b,{ref:this.formRef,layout:"horizontal",children:n(f,{gutter:16,children:[e(l,{xl:4,md:24,children:e(b.Item,{label:r({id:"Orders.Price"}),children:e(P,{value:p,min:0,placeholder:r({id:"Orders.PleaseEnterPrice"}),onChange:y=>s(y,"customPrice"),style:{width:"100%"}})})}),e(l,{xl:20,md:24,children:e(b.Item,{label:r({id:"Orders.DeliveryCount"}),children:e($,{value:o,rows:4,placeholder:r({id:"Orders.PleaseEnterComment"}),onChange:y=>s(y,"deliveryDescription"),style:{width:"100%"}})})}),e(l,{xl:12,md:24,children:e(b.Item,{label:r({id:"window.address"}),children:n("span",{children:[e(oe,{value:a,id:"checkout-address",placeholder:r({id:"window.address"}),className:"mb-3",onChange:y=>s(y,"address"),loading:g,enterButton:r({id:"Orders.CheckButton"}),onSearch:this.addressQuery}),h&&n("span",{children:[t!=="Invalid"&&n("span",{style:{color:t?"#fb434a":"#46be8a",marginRight:"10px",fontSize:"10px"},children:[r(t?{id:"Orders.TheAddressIsNotIncludedInDeliveryArea"}:{id:"Orders.TheAddressIsIncludedInDeliveryArea"}),t==="Invalid"?r({id:"Orders.InvalidAddress"}):""]}),t==="Invalid"&&e("span",{style:{color:"#fb434a",marginRight:"10px",fontSize:"10px"},children:r({id:"Orders.InvalidAddress"})}),e("span",{children:Boolean(C)&&t!=="Invalid"&&e("a",{href:C,target:"_blank",children:r({id:"Orders.OpenStreetMap"})})})]})]})})}),e(l,{xl:12,md:24,children:e(b.Item,{label:r({id:"Orders.DeliveryTime"}),children:e(X,{range:!0,max:22,min:17,formatter:y=>`${y}:00`,defaultValue:c,onChange:i})})})]})})})}})||S)||S);var N,Y;let he=(N=z(({user:m})=>({user:m})),O(Y=N(Y=class extends I.Component{render(){const{onChangeB2BMenu:d,addDish:s,removeOrder:i,removeDish:r}=this.props,{order:a,index:o,length:c,intl:{formatMessage:t}}=this.props;return n("div",{children:[e(f,{gutter:16,children:e(l,{xl:24,md:24,children:n("center",{children:[e("h5",{children:v(a.timestamp,"DD.MM.YYYY").format("dddd")}),e(se,{style:{width:"100%",marginTop:10},format:"DD.MM.YYYY",placeholder:t({id:"window.date"}),value:v(a.timestamp,"DD.MM.YYYY"),onChange:h=>d(h,o,"timestamp")}),e("hr",{})]})})}),n(f,{gutter:16,children:[n(l,{md:10,sm:24,children:[e("center",{children:e("h5",{children:t({id:"Orders.Code"})})}),a.dishes.map((h,p)=>e(P,{max:20,min:1,size:"small",defaultValue:h.dishCode,onChange:g=>d(g,o,"dishes",p,"dishCode"),style:{width:"100%",marginTop:"5px"}},Math.random()))]}),n(l,{md:10,sm:24,children:[e("center",{children:e("h5",{children:t({id:"Orders.Count"})})}),a.dishes.map((h,p)=>e(P,{max:20,min:1,size:"small",defaultValue:h.count,onChange:g=>d(g,o,"dishes",p,"count"),style:{width:"100%",marginTop:"5px"}},Math.random()))]}),n(l,{md:4,sm:24,children:[e("center",{children:e("h5",{children:t({id:"Orders.x"})})}),a.dishes.map((h,p)=>e(w,{type:"danger",size:"small",onClick:()=>r(o,p),style:{width:"100%",marginTop:"5px"},disabled:p===0&&a.dishes.length===1,children:t({id:"Orders.x"})},Math.random()))]})]}),e("hr",{}),n(f,{gutter:16,children:[e(l,{md:24,sm:24,children:e(w,{type:"primary",size:"small",onClick:()=>s(o),style:{width:"100%"},children:t({id:"Orders.AddDish"})})}),e(l,{md:24,sm:24,className:"mt-3",children:e(w,{type:"danger",size:"small",onClick:()=>i(o),style:{width:"100%"},disabled:o===0&&c===1,children:t({id:"Orders.RemoveDay"})})})]})]})}})||Y)||Y);var T;let ce=O(T=class extends I.Component{render(){const{order:d,intl:{formatMessage:s}}=this.props,i=[{title:s({id:"Orders.Dish"}),dataIndex:"title",key:"title",render:r=>e("span",{children:`${r}`})},{title:s({id:"Orders.Weight"}),dataIndex:"weight",key:"weight",render:r=>e("span",{children:`${r}`})},{title:s({id:"Orders.Count"}),dataIndex:"count",key:"count",render:r=>e("span",{children:`${r}`})}];return n("div",{children:[e("h3",{children:d.date}),e(ie,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:i,dataSource:d.dishes,pagination:{position:"bottom",total:d.dishes.length,showTotal:(r,a)=>`${a[0]}-${a[1]} of ${r} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:d.dishes.length<10},rowKey:()=>Math.random()})]})}})||T;var F;let me=O(F=class extends I.Component{constructor(d){super(d),this.closeDrawer=this.closeDrawer.bind(this)}closeDrawer(){const{onClose:d}=this.props;d()}render(){const{visible:d,orders:s,intl:{formatMessage:i}}=this.props;return s||this.closeDrawer(),e("div",{children:e(re,{title:i({id:"Orders.PreviewB2BOrder"}),width:"100%",onClose:this.closeDrawer,open:d,bodyStyle:{paddingBottom:80},children:e(f,{gutter:16,children:s.map(r=>e(l,{md:8,sm:24,style:{marginBottom:"20px"},children:e(ce,{order:r})},Math.random()))})})})}})||F;var B;v.updateLocale("en",{week:{dow:1}});let $e=O(B=W(B=class extends I.Component{constructor(s){super(s);D(this,"state",{name:"",email:"",phone:"",address:"",userId:"",orderId:"",customPrice:0,deliveryTime:[17,22],deliveryDescription:"",isAddDeliveryFee:!1,isAddressChecked:!1,sendEmail:!0,previewVisible:!1,orders:[{dishes:[{dishCode:"",count:1}],timestamp:v().add(1,"weeks").startOf("week").format("DD.MM.YYYY")},{dishes:[{dishCode:"",count:1}],timestamp:v().add(1,"weeks").startOf("week").add(1,"days").format("DD.MM.YYYY")},{dishes:[{dishCode:"",count:1}],timestamp:v().add(1,"weeks").startOf("week").add(2,"days").format("DD.MM.YYYY")},{dishes:[{dishCode:"",count:1}],timestamp:v().add(1,"weeks").startOf("week").add(3,"days").format("DD.MM.YYYY")},{dishes:[{dishCode:"",count:1}],timestamp:v().add(1,"weeks").startOf("week").add(4,"days").format("DD.MM.YYYY")},{dishes:[{dishCode:"",count:1}],timestamp:v().add(1,"weeks").startOf("week").add(5,"days").format("DD.MM.YYYY")}],paymentAddress:"",isCompany:"",zip:"",regNumber:"",vatNumber:"",ordersInfo:[]});D(this,"showPreview",()=>{this.setState({previewVisible:!0})});D(this,"onClosePreview",()=>{this.setState({previewVisible:!1})});this.onChangeField=this.onChangeField.bind(this),this.onChangeDeliveryTime=this.onChangeDeliveryTime.bind(this),this.onChangeB2BMenu=this.onChangeB2BMenu.bind(this),this.onChangeCustomPrice=this.onChangeCustomPrice.bind(this),this.addDish=this.addDish.bind(this),this.addOrder=this.addOrder.bind(this),this.removeOrder=this.removeOrder.bind(this),this.removeDish=this.removeDish.bind(this),this.getPreview=this.getPreview.bind(this),this.onClosePreview=this.onClosePreview.bind(this)}componentDidMount(){const{props:s}=this;ae(s.match.params.id).then(async i=>{const r=await i.json();this.setState({userId:r.id,name:r.name,email:r.email,phone:r.phone,address:r.address,paymentAddress:r.paymentData.address,isCompany:r.paymentData.isCompany,zip:r.paymentData.zip,regNumber:r.paymentData.regNumber,vatNumber:r.paymentData.vatNumber})})}onChangeB2BMenu(s,i=0,r,a=0,o){const{orders:c}=this.state;r==="timestamp"?c[i][r]=s.format("DD.MM.YYYY"):s!==null&&s.target?s.target.type==="checkbox"?c[i][r][a][o]=s.target.checked:c[i][r][a][o]=s.target.value:c[i][r][a][o]=s,this.setState({orders:c})}onChangeField(s,i){if(s!==null){let r=s;s.target&&(s.target.type==="checkbox"?r=s.target.checked:r=s.target.value),this.setState({[i]:r})}}onChangeCustomPrice(s){s!==null&&this.setState({customPrice:s})}onChangeDeliveryTime(s){this.setState({deliveryTime:s})}async onSend(){const{intl:{formatMessage:s}}=this.props;try{const{userId:i,address:r,deliveryDescription:a,sendEmail:o,customPrice:c,deliveryTime:t,orders:h}=this.state,p={userId:i,address:r,sendEmail:o,orders:h,customPrice:c,deliveryDescription:a,deliveryTime:t};if(!r||!h||!c){M.error({message:s({id:"Orders.Requiredfieldscannotbeempty"}),description:s({id:"Orders.Fillinallrequiredfields!"}),placement:"topRight"});return}const g=await te(p);if(g.ok){const C=await g.json();M.success({message:s({id:"Orders.Created"}),description:s({id:"Orders.B2BOrdersuccessfullycreated!"})}),this.setState({orderId:C.orderId})}else M.error({message:s({id:"window.error"}),description:g.statusText,placement:"topLeft"})}catch(i){console.log("Failed:",i)}}async getPreview(){const{intl:{formatMessage:s}}=this.props;try{const{orders:i}=this.state,r=await de({orders:i}),a=await r.json();r.status===200?(this.setState({ordersInfo:a.result}),this.showPreview()):M.error({message:s({id:"window.error"}),description:r.statusText,placement:"topLeft"})}catch(i){console.log("Failed:",i)}}addOrder(){const{orders:s}=this.state;s.push({dishes:[{dishCode:"",count:1}],timestamp:v().add(2+s.length,"days").format("DD.MM.YYYY")}),this.setState({orders:s})}removeOrder(s){const{orders:i}=this.state;i.splice(s,1),this.setState({orders:i})}addDish(s){const{orders:i}=this.state;i[s].dishes.push({dishCode:"",count:1}),this.setState({orders:i})}removeDish(s,i){const{orders:r}=this.state;r[s].dishes.splice(i,1),this.setState({orders:r})}render(){const{name:s,phone:i,email:r,orderId:a,deliveryDescription:o,deliveryTime:c,address:t,orders:h,customPrice:p,paymentAddress:g,isCompany:C,regNumber:y,vatNumber:R,zip:j,isAddDeliveryFee:E,isAddressChecked:L,previewVisible:_,ordersInfo:V}=this.state,{intl:{formatMessage:u}}=this.props;return n("div",{children:[a!==""&&e(Z,{to:`/orders/${a}`}),e(G,{title:"B2B order"}),n("div",{children:[n("div",{className:"row",children:[e("div",{className:"col-md-6 col-xs-12",children:e("div",{className:"card card--fullHeight",children:e("div",{className:"card-body",style:{padding:"10px 20px"},children:e(ne,{data:{name:s,phone:i,email:r,paymentAddress:g,isCompany:C,regNumber:y,vatNumber:R,zip:j}})})})}),e("div",{className:"col-md-6 col-xs-12",children:e("div",{className:"card",children:e("div",{className:"card-body",style:{padding:"10px 20px"},children:e(le,{deliveryTime:c,onChangeField:this.onChangeField,onChangeDeliveryTime:this.onChangeDeliveryTime,address:t,deliveryDescription:o,isAddDeliveryFee:E,isAddressChecked:L,customPrice:p})})})})]}),e("div",{className:"row",children:e("div",{className:"col-md-12 col-xs-12",children:e("div",{className:"card card--fullHeight",children:n("div",{className:"card-body",style:{padding:"10px 20px"},children:[e(w,{type:"primary",onClick:this.addOrder,disabled:h.length>=6,style:{marginRight:"15px"},children:u({id:"Orders.AddDay"})}),e(w,{type:"primary",onClick:()=>this.getPreview(),children:u({id:"Orders.Preview"})}),e("hr",{}),e("div",{className:"row",children:h.map((Q,k)=>e("div",{className:`col-md-2 col-xs-12 pb-3 border border-gray border-left-0 ${k<6?"border-top-0":""} border-bottom-0 ${(k+1)%6===0?"border-right-0":""}`,children:e(he,{order:Q,index:k,addDish:this.addDish,length:h.length,onChangeB2BMenu:this.onChangeB2BMenu,removeOrder:this.removeOrder,removeDish:this.removeDish})},Math.random()))})]})})})}),e("div",{className:"row",children:e("div",{className:"col-md-12 col-xs-12",children:e("div",{className:"card",style:{border:"1px solid"},children:n("div",{className:"card-body",children:[n(f,{gutter:16,children:[e(l,{sm:6,children:n("p",{children:[e("strong",{children:u({id:"Orders.DeliveryAddress"})}),e("br",{}),t]})}),e(l,{sm:4,children:n("p",{children:[e("strong",{children:u({id:"Orders.DeliveryTime"})}),e("br",{}),c[0],":00-",c[1],":00"]})}),e(l,{sm:8,children:n("p",{children:[e("strong",{children:u({id:"Orders.DeliveryComment"})}),e("br",{}),o||"-"]})})]}),e("hr",{}),n(f,{gutter:16,children:[e(l,{sm:24,lg:3,children:e(x,{title:u({id:"Orders.Days"}),value:h.length})}),e(l,{sm:24,lg:4,children:e(x,{title:u({id:"Orders.FirstDay"}),value:h[0].timestamp})}),e(l,{sm:24,lg:4,children:e(x,{title:u({id:"Orders.LastDay"}),value:h[h.length-1].timestamp})}),e(l,{sm:24,lg:4,children:e(x,{title:u({id:"Orders.Price"}),value:p,suffix:"Kč"})}),e(l,{sm:24,lg:9,children:e(w,{style:{float:"right",marginLeft:10,marginTop:"10px"},type:"primary",size:"large",onClick:async()=>this.onSend(),children:u({id:"window.create"})})})]})]})})})})]}),e(me,{visible:_,orders:V,onClose:this.onClosePreview})]})}})||B)||B;export{$e as default};
