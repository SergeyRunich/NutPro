var E=Object.defineProperty;var B=(d,o,t)=>o in d?E(d,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[o]=t;var p=(d,o,t)=>(B(d,typeof o!="symbol"?o+"":o,t),t);import{a1 as k,a2 as v,c as h,j as e,a5 as f,a6 as L,B as y,aY as j,r as q,a3 as C,bl as g,bd as $,be as z,bg as N,b4 as x}from"./index-c20b5e8e.js";import{T as O}from"./index-83b0f9b6.js";import{g as A}from"./techcard-66c5dea0.js";import{g as H,d as P,u as Y,e as G}from"./testSettings-9d6c3207.js";import{F as K}from"./index-a86cfb93.js";import{R as F,C as c}from"./row-58ed805b.js";import{L as b}from"./index-26b6fa13.js";import"./Pagination-e2a53e90.js";import{I as w}from"./index-86d1917a.js";var D;const{Option:S}=f;let J=k(D=class extends v.Component{constructor(){super(...arguments);p(this,"state",{})}render(){const{items:t,onChangeItem:s,deleteItem:i,intl:{formatMessage:n}}=this.props;return h("div",{children:[t.length!==0&&e("div",{children:e(b,{bordered:!0,size:"small",dataSource:t,renderItem:(a,r)=>e(b.Item,{children:h(F,{style:{width:"100%",display:"flex",alignItems:"center"},gutter:16,children:[e(c,{md:10,sm:18,children:h(f,{value:t[r].meal,placeholder:n({id:"Setts.Meal..."}),style:{width:"100%"},onChange:l=>s(l,"meal",r),children:[e(S,{value:0,children:n({id:"Setts.Breakfast"})},0),e(S,{value:1,children:n({id:"Setts.Snack 1"})},1),e(S,{value:2,children:n({id:"Setts.Lunch"})},2),e(S,{value:3,children:n({id:"Setts.Snack 2"})},3),e(S,{value:4,children:n({id:"Setts.Dinner"})},4)]})}),h(c,{md:3,sm:4,children:[n({id:"Setts.Optional "}),e(L,{style:{marginLeft:"5px"},checked:a.optional,onChange:l=>s(l,"optional",r)})]}),e(c,{md:4,sm:10,children:e(w,{value:a.min,style:{width:"100%"},onChange:l=>s(l,"min",r)})}),e(c,{md:4,sm:10,children:e(w,{value:a.max,style:{width:"100%"},onChange:l=>s(l,"max",r)})}),e(c,{md:2,sm:3,children:e(y,{type:"primary",danger:!0,onClick:()=>i(r),children:n({id:"window.remove"})})})]})})})}),t.length===0&&e(j,{description:!1})]})}})||D;var T;let Q=k(T=class extends v.Component{constructor(t){super(t);p(this,"state",{items:[]});p(this,"formRef",q.createRef());this.onFinish=this.onFinish.bind(this),this.deleteItem=this.deleteItem.bind(this),this.addItem=this.addItem.bind(this),this.onChangeItem=this.onChangeItem.bind(this)}componentDidMount(){this.setData()}onChangeField(t,s){t.target?t.target.type==="checkbox"?this.setState({[s]:t.target.checked}):this.setState({[s]:t.target.value}):this.setState({[s]:t})}onChangeItem(t,s,i){const{items:n}=this.state;let a=t;t.target&&(t.target.type==="checkbox"?a=t.target.checked:a=t.target.value),n[i][s]=a,this.setState({items:n})}async onFinish(){const{intl:{formatMessage:t}}=this.props;try{const{post:s}=this.props;await this.formRef.current.validateFields();const{items:i}=this.state,n={dayKcal:i.map(r=>({meal:r.meal,optional:r.optional,min:{kcal:r.min},max:{kcal:r.max}}))},a=await s(n);a.status===201?C.success({message:t({id:"Setts.Succes"}),description:t({id:"Setts.Data updated!"})}):C.error({message:t({id:"window.error"}),description:a.statusText,placement:"topLeft"})}catch(s){console.log("Failed:",s)}}setData(){const{data:t}=this.props;t&&this.setState({items:t.map(s=>({meal:s.meal,optional:s.optional,min:s.min.kcal,max:s.max.kcal}))})}addItem(){const{items:t}=this.state;t.push({meal:null,optional:!1,min:0,max:0}),this.setState({items:t})}deleteItem(t){const{items:s}=this.state;s.splice(t,1),this.setState({items:s})}render(){const{items:t}=this.state;return e("div",{children:e(K,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:e(F,{gutter:16,children:h(c,{md:18,sm:24,children:[e(y,{type:"dashed",onClick:this.addItem,style:{marginBottom:"10px",marginRight:"10px"},children:e(g,{id:"main.add"})}),e(y,{type:"primary",htmlType:"submit",style:{marginBottom:"10px"},children:e(g,{id:"main.save"})}),e(J,{items:t,deleteItem:this.deleteItem,onChangeItem:this.onChangeItem})]})})})})}})||T;var R;const{Option:u}=f;let U=k(R=class extends v.Component{constructor(){super(...arguments);p(this,"state",{})}render(){const{items:t,onChangeItem:s,deleteItem:i,tags:n,intl:{formatMessage:a}}=this.props;return h("div",{children:[t.length!==0&&e("div",{children:e(b,{bordered:!0,size:"small",dataSource:t,renderItem:(r,l)=>e(b.Item,{children:h(F,{style:{width:"100%"},gutter:16,children:[e(c,{md:8,sm:18,children:h(f,{value:t[l].meal,placeholder:a({id:"Setts.Meal..."}),style:{width:"100%"},onChange:m=>s(m,"meal",l),children:[e(u,{value:0,children:a({id:"Setts.Breakfast"})},0),e(u,{value:1,children:a({id:"Setts.Snack 1"})},1),e(u,{value:2,children:a({id:"Setts.Lunch"})},2),e(u,{value:3,children:a({id:"Setts.Snack 2"})},3),e(u,{value:4,children:a({id:"Setts.Dinner"})},4)]})}),e(c,{md:8,sm:18,children:e(f,{value:t[l].tag,placeholder:a({id:"Setts.Tag..."}),style:{width:"100%"},onChange:m=>s(m,"tag",l),children:n.map(m=>e(u,{value:m.id,children:m.cz},m.id))})}),e(c,{md:4,sm:10,children:e(w,{value:r.amount,style:{width:"100%"},onChange:m=>s(m,"amount",l)})}),e(c,{md:4,sm:3,children:e(y,{type:"primary",danger:!0,onClick:()=>i(l),children:a({id:"window.remove"})})})]})})})}),t.length===0&&e(j,{description:!1})]})}})||R;var M;let V=k(M=class extends v.Component{constructor(t){super(t);p(this,"state",{items:[]});p(this,"formRef",q.createRef());this.onFinish=this.onFinish.bind(this),this.deleteItem=this.deleteItem.bind(this),this.addItem=this.addItem.bind(this),this.onChangeItem=this.onChangeItem.bind(this)}componentDidMount(){this.setData()}onChangeField(t,s){t.target?t.target.type==="checkbox"?this.setState({[s]:t.target.checked}):this.setState({[s]:t.target.value}):this.setState({[s]:t})}onChangeItem(t,s,i){const{items:n}=this.state;let a=t;t.target&&(t.target.type==="checkbox"?a=t.target.checked:a=t.target.value),n[i][s]=a,this.setState({items:n})}async onFinish(){const{intl:{formatMessage:t}}=this.props;try{const{post:s}=this.props;await this.formRef.current.validateFields();const{items:i}=this.state,n={ingredientFrequency:i.map(r=>({meal:r.meal,tag:r.tag,amount:r.amount}))},a=await s(n);a.status===201?C.success({message:t({id:"Setts.Succes"}),description:t({id:"Setts.Data updated!"})}):C.error({message:t({id:"window.error"}),description:a.statusText,placement:"topLeft"})}catch(s){console.log("Failed:",s)}}setData(){const{data:t}=this.props;t&&this.setState({items:t.map(s=>({meal:s.meal,tag:s.tag,amount:s.amount}))})}addItem(){const{items:t}=this.state;t.push({meal:null,tag:null,amount:0}),this.setState({items:t})}deleteItem(t){const{items:s}=this.state;s.splice(t,1),this.setState({items:s})}render(){const{items:t}=this.state,{tags:s}=this.props;return e("div",{children:e(K,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:e(F,{gutter:16,children:h(c,{md:20,sm:24,children:[e(y,{type:"dashed",onClick:this.addItem,style:{marginBottom:"10px",marginRight:"10px"},children:e(g,{id:"main.add"})}),e(y,{type:"primary",htmlType:"submit",style:{marginBottom:"10px"},children:e(g,{id:"main.save"})}),e(U,{items:t,deleteItem:this.deleteItem,onChangeItem:this.onChangeItem,tags:s})]})})})})}})||M;var _,I;let ht=(_=$(({user:d})=>({user:d})),z(I=_(I=class extends v.Component{constructor(t){super(t);p(this,"state",{loading:[!0,!0],dayKcal:[],ingredientFrequency:[],allTags:[]});this.updateSettings=this.updateSettings.bind(this)}componentDidMount(){A().then(async t=>{if(t.status===200){const s=await t.json();this.setState({allTags:s})}}),this.updateSettings("dayKcal")}onChangeField(t,s){t.target?t.target.type==="checkbox"?this.setState({[s]:t.target.checked}):this.setState({[s]:t.target.value}):this.setState({[s]:t})}updateSettings(){H().then(async t=>{if(t.status===401){const{dispatch:i}=this.props;i({type:"user/SET_STATE",payload:{authorized:!1}});return}const s=await t.json();this.setState(i=>({dayKcal:s.result,loading:[!1,i.loading[1]]}))}),P().then(async t=>{if(t.status===401){const{dispatch:i}=this.props;i({type:"user/SET_STATE",payload:{authorized:!1}});return}const s=await t.json();this.setState(i=>({ingredientFrequency:s.result,loading:[i.loading[0],!1]}))})}render(){const{dayKcal:t,allTags:s,loading:i,ingredientFrequency:n}=this.state;return h("div",{children:[e(N,{title:e(g,{id:"erp.ERP Settings"})}),h("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:e(g,{id:"erp.title.settings.test"})})})}),e("div",{className:"card-body",children:e(O,{defaultActiveKey:"1",items:[{label:e(g,{id:"erp.meal"}),key:"1",children:e(x,{spinning:i[0],children:!i[0]&&e(Q,{data:t,post:Y})})},{label:e(g,{id:"erp.ingredients"}),key:"2",children:e(x,{spinning:i[1],children:!i[1]&&e(V,{data:n,post:G,tags:s})})}]})})]})]})}})||I)||I);export{ht as default};
