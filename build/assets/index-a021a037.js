var Te=Object.defineProperty;var Ce=(T,w,t)=>w in T?Te(T,w,{enumerable:!0,configurable:!0,writable:!0,value:t}):T[w]=t;var f=(T,w,t)=>(Ce(T,typeof w!="symbol"?w+"":w,t),t);import{bd as Q,a1 as j,be as ye,a2 as V,j as e,c as s,bl as h,a8 as B,B as A,aY as se,a3 as R,a6 as W,a5 as $,r as fe,I as U,bL as ne,bp as re,aa as O,bg as ke}from"./index-c20b5e8e.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as xe}from"./index-2f7554ca.js";import{a as Se,m as we,g as Me,b as de}from"./weekTemplate-f1345fa1.js";import{R as F,C as m}from"./row-58ed805b.js";import{b as J,g as De,f as ve}from"./techcard-66c5dea0.js";import{g as Ie,m as Fe,e as Ee}from"./template-0cdd19f6.js";import{T as te}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{D as X}from"./index-1e692111.js";import{T as ie}from"./index-8e340a60.js";import{s as Ae}from"./testSettings-9d6c3207.js";import{F as S}from"./index-a86cfb93.js";import{D as H}from"./index-98f1088d.js";import{I as z}from"./index-86d1917a.js";import{D as Re,C as Le,P as $e}from"./react-beautiful-dnd.esm-d864c540.js";import{I as We,S as ze}from"./index-b3a5ab18.js";import{g as Oe}from"./ingredient-16e26155.js";import{E as je}from"./EditOutlined-c424161b.js";import{F as le}from"./FileDoneOutlined-856575ff.js";import{S as Ve}from"./StarOutlined-01cf381d.js";import"./styleChecker-a7b568e2.js";import"./index-26b6fa13.js";var oe,Y;let be=(oe=Q(({user:T})=>({user:T})),j(Y=ye(Y=oe(Y=class extends V.Component{constructor(){super(...arguments);f(this,"state",{})}render(){const{techcard:t,visible:i,onClose:a,edit:d,intl:{formatMessage:r}}=this.props,p=[{title:e("strong",{children:e(h,{id:"erp.ingredient"})}),dataIndex:"name",key:"name",render:c=>e("span",{children:e("strong",{children:` ${c}`})})},{title:e("strong",{children:e(h,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:c=>e("span",{children:`${c}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:c=>e("span",{children:`${c||"-"}`})},{title:e("strong",{children:e(h,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(c,x,D)=>e("span",{children:`${t.ingredientsAmount[D]/((100-x.percent)/100)}`})},{title:e("strong",{children:e(h,{id:"erp.netto"})}),dataIndex:"ingredientsAmount",key:"netto",render:(c,x,D)=>e("span",{children:`${t.ingredientsAmount[D]}`})}],o=[{title:e("strong",{children:e(h,{id:"erp.semiproduct"})}),dataIndex:"title",key:"title",render:c=>e("span",{children:e("strong",{children:` ${c}`})})},{title:e("strong",{children:e(h,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:c=>e("span",{children:`${c?"ks":"kilogram"}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:c=>e("span",{children:`${c||"-"}`})},{title:e("strong",{children:e(h,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(c,x,D)=>e("span",{children:`${t.subTechcardsAmount[D]/((100-x.percent)/100)}`})},{title:e("strong",{children:e(h,{id:"erp.netto"})}),dataIndex:"subTechcardsAmount",key:"netto",render:(c,x,D)=>e("span",{children:`${t.subTechcardsAmount[D]}`})}],g={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},b={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return e(X,{title:`Techcard: ${t.title}`,width:"100%",height:"100%",onClose:()=>a(),open:i,bodyStyle:{paddingBottom:80},children:s("div",{children:[t.id&&s(F,{gutter:16,children:[s(m,{sm:24,md:14,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(h,{id:"erp.ingredients"})})}),e(te,{columns:p,dataSource:t?t.ingredients:[],pagination:!1,rowKey:()=>Math.random(),bordered:!0}),e("div",{style:{paddingLeft:"10px",marginTop:"10px"},children:e("h4",{children:e(h,{id:"erp.semiproducts"})})}),e(te,{columns:o,dataSource:t?t.subTechcards:[],pagination:!1,rowKey:()=>Math.random(),bordered:!0}),s("div",{style:{float:"right",fontSize:18,marginTop:"10px"},children:[e("b",{children:r({id:"TChDetail.Total:SPACE"})})," ",t.amount*1e3," ",r({id:"TChDetail.gram"})]})]}),s(m,{sm:24,md:10,children:[s("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.title})}),e(B,{roles:["root","admin"],children:e("div",{style:{marginTop:"10px"},children:e(A,{type:"primary",onClick:()=>d(t),style:{margin:"0 5px 5px 0"},children:e(h,{id:"window.edit"})})})}),e("table",{style:b,children:s("tbody",{children:[s("tr",{children:[e("th",{style:g,children:"kCal"}),e("th",{style:g,children:e(h,{id:"erp.prot"})}),e("th",{style:g,children:e(h,{id:"erp.fat"})}),e("th",{style:g,children:e(h,{id:"erp.carb"})})]}),s("tr",{children:[e("td",{style:g,children:Math.round(t.nutrients.energy)}),e("td",{style:g,children:Math.round(t.nutrients.prot)}),e("td",{style:g,children:Math.round(t.nutrients.fat)}),e("td",{style:g,children:Math.round(t.nutrients.carb)})]},"kbzhu")]})}),s("div",{style:{marginTop:"10px"},children:[t.isSubTechcard&&e(ie,{color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:e(h,{id:"erp.semiproduct"})})},Math.random()),t.tags.map(c=>e(ie,{color:"blue",children:e("span",{style:{fontSize:"14px"},children:c.cz})},Math.random()))]})]}),e("center",{children:e("div",{style:{marginTop:"10px"},children:e("h4",{children:e(h,{id:"erp.technologyĞ¡ooking"})})})}),e("div",{className:"card",style:{border:"1px solid #e8e8e8"},children:e("div",{className:"card-body",children:t.description})})]})]}),!t.id&&e(se,{description:!1})]})})}})||Y)||Y)||Y);var ce,G;let qe=(ce=Q(({user:T})=>({user:T})),j(G=ce(G=class extends V.Component{constructor(){super(...arguments);f(this,"state",{testData:[],testVisible:!1,selectedTechcard:"",techcardVisible:!1,range:{min:0,max:0}});f(this,"showTechcard",t=>{J(t).then(async i=>{if(i.status===200){const a=await i.json();this.setState({selectedTechcard:a,techcardVisible:!0})}})});f(this,"onCloseTechcard",()=>{this.setState({techcardVisible:!1,selectedTechcard:""})})}UNSAFE_componentWillReceiveProps(){this.setState({testData:[],testVisible:!1})}async startTest(t){const{intl:{formatMessage:i}}=this.props;try{const d=await Ae({dayTemplate:t});if(d.status===200){const r=await d.json();R.success({message:i({id:"window.success"}),description:i({id:"TemplateDetail.TestFinished"})}),this.setState({testData:r.dishes,range:r.range,testVisible:!0})}else R.error({message:i({id:"window.error"}),description:d.statusText,placement:"topLeft"})}catch(a){console.log("Failed:",a)}}render(){const{template:t,edit:i,user:a,visible:d,onClose:r,intl:{formatMessage:p}}=this.props,{testVisible:o,testData:g,range:b,selectedTechcard:c,techcardVisible:x}=this.state,D=["Breakfast","1 Snack","Lunch","2 Snack","Dinner"],M=[{title:e("strong",{children:"#"}),key:"dfdfdfdf",render:(l,v,I)=>e("span",{children:e("strong",{children:` ${I+1}`})})},{title:e("strong",{children:e(h,{id:"erp.dish"})}),dataIndex:"techcard",key:"name",render:(l,v)=>e("span",{children:e("strong",{children:e(A,{type:"link",onClick:()=>this.showTechcard(v.techcard.id),children:` ${l.title}`})})})},{title:e("strong",{children:e(h,{id:"erp.coefficient"})}),dataIndex:"amount",key:"amount",render:l=>e("span",{children:`${l}`}),sorter:(l,v)=>l.amount-v.amount},{title:e("strong",{children:e(h,{id:"erp.weightG"})}),dataIndex:"amount",key:"amountfdfdf",render:(l,v)=>{const I=Math.floor(l*v.techcard.amount*100)*10;return e("span",{children:`${I}`})}},{title:e("strong",{children:"kCal"}),dataIndex:"kcal",key:"kcal",render:l=>e("span",{children:`${l}`})},{title:e("strong",{children:"P"}),dataIndex:"prot",key:"prot",render:l=>e("span",{children:`${l}`})},{title:e("strong",{children:"F"}),dataIndex:"fat",key:"fat",render:l=>e("span",{children:`${l}`})},{title:e("strong",{children:"C"}),dataIndex:"carb",key:"carb",render:l=>e("span",{children:`${l}`})},{title:e("strong",{children:e(h,{id:"erp.meal"})}),dataIndex:"meal",key:"meal",render:l=>e("span",{children:`${D[l]}`}),sorter:(l,v)=>l.meal-v.meal},{title:e("strong",{children:e(h,{id:"erp.group"})}),dataIndex:"group",key:"group",render:l=>e("span",{children:`${l}`}),sorter:(l,v)=>l.group-v.group}],k={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},u={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",backgroundColor:"red"},L={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",backgroundColor:"green"},C={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return e(X,{title:`Day template: ${t.name}`,width:"100%",height:"100%",onClose:()=>r(),open:d,bodyStyle:{paddingBottom:80},children:s("div",{children:[t.id&&s(F,{gutter:16,children:[s(m,{sm:24,md:14,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(h,{id:"erp.positions"})})}),e(te,{columns:M,dataSource:t?t.dishes:[],pagination:!1,rowKey:Math.random(),bordered:!0})]}),e(m,{sm:24,md:10,children:s("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.name})}),a.name!=="david"&&e("div",{style:{marginTop:"10px"},children:e(A,{type:"primary",onClick:()=>i(t),style:{margin:"0 5px 5px 0"},children:e(h,{id:"window.edit"})})}),e("div",{style:{marginTop:"10px"},children:e(ie,{color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:t.class})},Math.random())}),s("div",{style:{marginTop:"10px"},children:[e(A,{type:"primary",onClick:()=>this.startTest(t.id),style:{margin:"0 5px 5px 0"},children:p({id:"TemplateDetail.kCalTest"})}),e("br",{}),o&&e("table",{style:C,children:s("tbody",{children:[s("tr",{children:[e("th",{style:k,children:e(h,{id:"erp.meal"})}),e("th",{style:k,children:p({id:"TemplateDetail.Option"})}),e("th",{style:k,children:p({id:"TemplateDetail.Min"})}),e("th",{style:k,children:p({id:"TemplateDetail.Max"})})]}),g.map(l=>s("tr",{children:[e("td",{style:k,children:D[l.meal]}),e("td",{style:k,children:e(W,{checked:l.optional,disabled:!0})}),e("td",{style:l.min.total>=l.min.shouldBe&&l.min.total!==1e4?L:u,children:l.min.total!==1e4?l.min.total:"-"}),e("td",{style:l.max.total<=l.max.shouldBe&&l.max.total!==0?L:u,children:l.max.total!==0?l.max.total:"-"})]},Math.random()))]})}),o&&s("p",{style:{fontSize:"30px"},children:[e("br",{})," ",p({id:"TemplateDetail.kCalRange"}),e("br",{})," ",b.min," - ",b.max," "]})]})]})})]}),!t.id&&e(se,{description:!1}),e(be,{visible:x,techcard:c,onClose:this.onCloseTechcard,edit:i})]})})}})||G)||G);var he;const{Option:P}=$;let Ye=j(he=class extends V.Component{constructor(){super(...arguments);f(this,"state",{})}render(){const{dishes:t,techcards:i,onChangeDish:a,deleteDish:d,getItemStyle:r,getListStyle:p,onChangeAlways:o,onDragEnd:g,always:b,intl:{formatMessage:c}}=this.props;return s("div",{children:[t&&t.length!==0&&e("div",{children:e(Re,{onDragEnd:g,children:e(F,{gutter:16,children:e(m,{md:24,sm:24,children:e(Le,{droppableId:"droppable",children:(x,D)=>s("div",{...x.droppableProps,ref:x.innerRef,style:p(D.isDraggingOver),children:[t.map((M,k)=>e($e,{draggableId:M.key,index:k,children:(u,L)=>e("div",{ref:u.innerRef,...u.draggableProps,...u.dragHandleProps,style:r(L.isDragging,u.draggableProps.style),children:s(F,{style:{width:"100%"},gutter:16,children:[e(m,{md:8,sm:24,children:e($,{showSearch:!0,value:t[k].techcard||void 0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:c({id:"DishList.SelectTechcard..."}),filterOption:(C,l)=>l.props.children.toLowerCase().indexOf(C.toLowerCase())>=0,style:{width:"100%"},onChange:C=>a(C,"techcard",k),children:i&&i.map(C=>e(P,{value:C.id,children:C.title},C.id))})}),e(m,{md:4,sm:24,children:e(z,{placeholder:"Coeff",value:M.amount,style:{width:"100%"},onChange:C=>a(C,"amount",k)})}),e(m,{md:4,sm:24,children:s($,{value:M.meal,placeholder:c({id:"DishList.Meal"}),style:{width:"100%"},onChange:C=>a(C,"meal",k),children:[e(P,{value:0,children:c({id:"DishList.Breakfast"})},0),e(P,{value:1,children:c({id:"DishList.1Snack"})},1),e(P,{value:2,children:c({id:"DishList.Lunch"})},2),e(P,{value:3,children:c({id:"DishList.2Snack"})},3),e(P,{value:4,children:c({id:"DishList.Dinner"})},4)]})}),e(m,{md:4,sm:24,children:e(z,{placeholder:c({id:"DishList.Group"}),value:M.group,style:{width:"100%"},onChange:C=>a(C,"group",k)})}),e(m,{md:2,sm:24,children:e(W,{disabled:b.length>=2&&b.indexOf(M.group)===-1,value:b.indexOf(M.group)!==-1,checked:b.indexOf(M.group)!==-1,onChange:C=>o(C,M.group,k),children:c({id:"DishList.Always"})})}),e(m,{md:2,sm:24,children:e(A,{type:"primary",danger:!0,onClick:()=>d(k),children:c({id:"window.remove"})})})]})})},M.key)),x.placeholder]})})})})})}),t&&t.length===0&&e(se,{description:!1})]})}})||he;var pe;const Pe=(T,w,t)=>{const i=Array.from(T),[a]=i.splice(w,1);return i.splice(t,0,a),i},ae=8,_e=(T,w)=>({userSelect:"none",padding:ae,margin:`0 0 ${ae}px 0`,borderRadius:"5px",background:T?"lightgreen":"",...w}),Be=()=>({padding:ae,borderRadius:"5px"});let Ue=j(pe=class extends V.Component{constructor(t){super(t);f(this,"state",{name:"",always:[],isEdit:!1,dishes:[{techcard:null,amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}]});f(this,"formRef",fe.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.deleteDish=this.deleteDish.bind(this),this.addDish=this.addDish.bind(this),this.onChangeDish=this.onChangeDish.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onChangeAlways=this.onChangeAlways.bind(this)}componentDidMount(){J().then(async t=>{if(t.status===200){const i=await t.json();this.setState({techcards:i})}})}onDragEnd(t){if(!t.destination)return;const{dishes:i}=this.state,a=Pe(i,t.source.index,t.destination.index);this.setState({dishes:a})}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}onChangeDish(t,i,a){const{dishes:d}=this.state;let r=t;t.target&&(t.target.type==="checkbox"?r=t.target.checked:r=t.target.value),d[a][i]=r,this.setState({dishes:d})}onChangeAlways(t,i){const{always:a}=this.state;let d=t;t.target&&(t.target.type==="checkbox"?d=t.target.checked:d=t.target.value);const r=a.indexOf(i);d?a.push(i):!d&&r!==-1&&a.splice(r,1),this.setState({always:a})}async onFinish(){try{const{create:t,edit:i,forEdit:a,update:d,intl:{formatMessage:r}}=this.props;await this.formRef.current.validateFields();const{name:p,always:o,dishes:g}=this.state;o.length<2&&o.push(o[0]);const b={name:p,always:o,dishes:g};if(a.id){const c=await i(a.id,b);c.status===200?(this.closeDrawer(),R.success({message:r({id:"CreateTemplateForm.Saved"}),description:r({id:"CreateTemplateForm.TemplateSuccessfullySaved"})})):R.error({message:r({id:"window.error"}),description:c.statusText,placement:"topLeft"})}else{const c=await t(b);c.status===201?(this.closeDrawer(),R.success({message:r({id:"CreateTemplateForm.Created"}),description:r({id:"CreateTemplateForm.TemplateSuccessfullyCreated"})}),d()):R.error({message:r({id:"window.error"}),description:c.statusText,placement:"topLeft"})}}catch(t){console.log("Failed:",t)}}setEdit(){const{forEdit:t}=this.props;t&&this.setState({name:t.name,always:t.always,dishes:t&&t.dishes&&t.dishes.map(i=>({techcard:i.techcard.id,amount:i.amount,meal:i.meal,group:i.group,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)})),isEdit:!0})}componentDidUpdate(t){var a;const{forEdit:i}=this.props;i&&t.forEdit!==i&&((a=this.formRef.current)==null||a.setFieldsValue({name:i.name,always:i.always}))}addDish(){const{dishes:t}=this.state;t.push({techcard:"",amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}),this.setState({dishes:t})}deleteDish(t){const{dishes:i}=this.state;i.splice(t,1),this.setState({dishes:i})}closeDrawer(){const{onClose:t}=this.props;t(),this.setState({name:"",always:[],dishes:[{techcard:"",amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}],isEdit:!1}),this.formRef.current.resetFields()}render(){const{visible:t,forEdit:i,intl:{formatMessage:a}}=this.props,{name:d,isEdit:r,techcards:p,dishes:o,always:g}=this.state;return i.id&&!r&&this.setEdit(),e("div",{children:e(X,{title:a(r?{id:"CreateTemplateForm.EDITTEMPLATE"}:{id:"CreateTemplateForm.CREATENEWTEMPLATE"}),width:"100%",height:"100%",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:s(S,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[s(F,{gutter:16,children:[e(m,{md:16,sm:24,children:e(S.Item,{label:"Name",name:"name",rules:[{required:!0}],children:e(U,{onChange:b=>this.onChangeField(b,"name")})})}),e(m,{md:4,sm:24,children:e(S.Item,{label:"Always portions",name:"always",rules:[{required:!0}],children:e(U,{disabled:!0,onChange:b=>this.onChangeField(b,"always")})})}),e(m,{md:4,sm:24,children:e(S.Item,{children:e(A,{size:"large",htmlType:"submit",children:a({id:"window.save"})})})})]}),e(F,{gutter:16,children:s(m,{md:24,sm:24,children:[s(H,{orientation:"left",children:["Positions"," ",e(A,{type:"primary",size:"small",onClick:this.addDish,children:a({id:"CreateTemplateForm.Add"})})]}),e(Ye,{techcards:p,addDish:this.addDish,deleteDish:this.deleteDish,onChangeDish:this.onChangeDish,onChangeAlways:this.onChangeAlways,onDragEnd:this.onDragEnd,getItemStyle:_e,getListStyle:Be,dishes:o,always:g})]})})]})})})}})||pe;var me;const{Option:ee}=$;let Ne=j(me=class extends V.Component{constructor(t){super(t);f(this,"state",{title:"",marketingTitle:"",amount:0,unit:0,description:"",percent:0,isEdit:!1,customNutrients:!1,isSubTechcard:!1,ingredients:[],subTechcards:[],energy:0,prot:0,fat:0,carb:0,allIngredients:[],tags:[],allTags:[]});f(this,"formRef",fe.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.deleteIngredient=this.deleteIngredient.bind(this),this.addIngredient=this.addIngredient.bind(this),this.onChangeIngredient=this.onChangeIngredient.bind(this),this.deleteSubTechcard=this.deleteSubTechcard.bind(this),this.addSubTechcard=this.addSubTechcard.bind(this),this.onChangeSubTechcard=this.onChangeSubTechcard.bind(this)}componentDidMount(){Oe().then(async t=>{if(t.status===200){const i=await t.json();this.setState({allIngredients:i})}}),De().then(async t=>{if(t.status===200){const i=await t.json();this.setState({allTags:i})}})}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}onChangeIngredient(t,i,a){const{ingredients:d}=this.state;let r=t;t.target&&(t.target.type==="checkbox"?r=t.target.checked:r=t.target.value),d[a][i]=r,this.setState({ingredients:d})}onChangeSubTechcard(t,i,a){const{subTechcards:d}=this.state;let r=t;t.target&&(t.target.type==="checkbox"?r=t.target.checked:r=t.target.value),d[a][i]=r,this.setState({subTechcards:d})}async onFinish(){try{const{create:t,edit:i,forEdit:a,update:d,showTechcard:r,intl:{formatMessage:p}}=this.props;await this.formRef.current.validateFields();const{title:o,amount:g,unit:b,description:c,percent:x,isSubTechcard:D,customNutrients:M,energy:k,prot:u,fat:L,carb:C,ingredients:l,subTechcards:v,tags:I,marketingTitle:q}=this.state,y={title:o,marketingTitle:q,amount:g,unit:b,description:c,isSubTechcard:D,customNutrients:M,percent:x,nutrients:{energy:k,prot:u,fat:L,carb:C},ingredients:l.map(n=>n.id),ingredientsAmount:l.map(n=>n.amount),subTechcards:v.map(n=>n.id),subTechcardsAmount:v.map(n=>n.amount),tags:I};if(a.id){const n=await i(a.id,y);n.status===200?(await d(),this.closeDrawer(),r(a.id),R.success({message:p({id:"TemplateManege.Saved"}),description:p({id:"TemplateManege.TechcardSuccessfullySaved"})})):R.error({message:p({id:"window.error"}),description:n.statusText,placement:"topLeft"})}else{const n=await t(y);n.status===201?(await d(),this.closeDrawer(),R.success({message:p({id:"TemplateManege.Created"}),description:p({id:"TemplateManege.TechcardSuccessfullyCreated"})})):R.error({message:p({id:"window.error"}),description:n.statusText,placement:"topLeft"})}}catch(t){console.log("Failed:",t)}}setEdit(){const{forEdit:t}=this.props;t&&this.setState({title:t.title,marketingTitle:t.marketingTitle,unit:t.unit,amount:t.amount,description:t.description,percent:t.percent,energy:t.nutrients.energy,prot:t.nutrients.prot,fat:t.nutrients.fat,carb:t.nutrients.carb,isSubTechcard:t.isSubTechcard,ingredients:t.ingredients.map((i,a)=>({id:i.id,amount:t.ingredientsAmount[a]})),subTechcards:t.subTechcards.map((i,a)=>({id:i._id,amount:t.subTechcardsAmount[a]})),isEdit:!0,tags:t.tags.map(i=>i.id)})}componentDidUpdate(t){var a,d,r,p,o;const{forEdit:i}=this.props;i&&t.forEdit!==i&&((o=this.formRef.current)==null||o.setFieldsValue({title:i.title,marketingTitle:i.marketingTitle,amount:i.amount,description:i.description,percent:i.percent,energy:(a=i.nutrients)==null?void 0:a.energy,prot:(d=i.nutrients)==null?void 0:d.prot,fat:(r=i.nutrients)==null?void 0:r.fat,carb:(p=i.nutrients)==null?void 0:p.carb}))}addIngredient(){const{ingredients:t}=this.state;t.push({id:null,amount:0}),this.setState({ingredients:t})}deleteIngredient(t){const{ingredients:i}=this.state;i.splice(t,1),this.setState({ingredients:i})}addSubTechcard(){const{subTechcards:t}=this.state;t.push({id:null,amount:0}),this.setState({subTechcards:t})}deleteSubTechcard(t){const{subTechcards:i}=this.state;i.splice(t,1),this.setState({subTechcards:i})}closeDrawer(){const{onClose:t}=this.props;this.setState({title:"",marketingTitle:"",amount:0,unit:0,description:"",percent:0,isEdit:!1,isSubTechcard:!1,customNutrients:!1,ingredients:[],subTechcards:[],energy:0,prot:0,fat:0,carb:0,tags:[]}),this.formRef.current.resetFields(),t()}render(){const{visible:t,forEdit:i,data:a,intl:{formatMessage:d}}=this.props,{title:r,unit:p,description:o,percent:g,energy:b,prot:c,fat:x,carb:D,isEdit:M,amount:k,customNutrients:u,isSubTechcard:L,ingredients:C,subTechcards:l,allIngredients:v,tags:I,allTags:q,marketingTitle:y}=this.state;return i.id&&!M&&this.setEdit(),e("div",{children:e(X,{title:M?e(h,{id:"erp.title.editingTechcard"}):e(h,{id:"erp.title.createTechcard"}),width:"100%",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:e(S,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:s(F,{gutter:16,children:[s(m,{md:12,sm:24,children:[e(F,{gutter:16,children:e(m,{md:24,sm:24,children:e(S.Item,{label:e(h,{id:"erp.name"}),name:"title",rules:[{required:!0}],children:e(U,{onChange:n=>this.onChangeField(n,"title")})})})}),e(F,{gutter:16,children:e(m,{md:24,sm:24,children:e(S.Item,{label:e(h,{id:"erp.marketingTitle"}),name:"marketingTitle",rules:[{required:!0}],children:e(U,{onChange:n=>this.onChangeField(n,"marketingTitle")})})})}),e(F,{gutter:16,children:e(m,{md:24,sm:24,children:e(S.Item,{label:e(h,{id:"erp.technologyĞ¡ooking"}),name:"description",rules:[{required:!0}],children:e(U.TextArea,{rows:5,onChange:n=>this.onChangeField(n,"description")})})})}),e(F,{gutter:16,children:e(m,{md:24,sm:24,children:e(S.Item,{label:"Tags",children:e($,{placeholder:"Tags",mode:"tags",value:I,onChange:n=>this.onChangeField(n,"tags"),children:q.map(n=>e(ee,{value:n.id,children:n.cz},n.id))})})})}),s(F,{gutter:16,children:[e(m,{md:8,sm:24,children:e(S.Item,{name:"unit",label:e(h,{id:"erp.unit"}),children:s($,{value:p,onChange:n=>this.onChangeField(n,"unit"),children:[e(ee,{value:0,children:d({id:"TemplateManage.Kilogram"})},0),e(ee,{value:1,children:d({id:"TemplateManage.Pieces"})},1)]})})}),e(m,{md:8,sm:24,children:e(S.Item,{label:d({id:"TemplateManage.Amount"}),name:"amount",rules:[{required:!0}],children:e(z,{style:{width:"100%"},onChange:n=>this.onChangeField(n,"amount")})})}),e(m,{md:8,sm:24,children:e(S.Item,{label:"%",name:"percent",rules:[{required:!0}],children:e(z,{style:{width:"100%"},onChange:n=>this.onChangeField(n,"percent")})})})]}),s(F,{gutter:16,children:[e(m,{md:12,sm:24,children:e(S.Item,{name:"cstm",children:e(W,{checked:u,onChange:n=>this.onChangeField(n,"customNutrients"),children:d({id:"TemplateManage.CustomNutritions"})})})}),e(m,{md:12,sm:24,children:e(S.Item,{name:"smprdct",children:e(W,{checked:L,onChange:n=>this.onChangeField(n,"isSubTechcard"),children:e(h,{id:"erp.semiproduct"})})})})]}),s(F,{gutter:16,children:[e(m,{md:6,sm:24,children:e(S.Item,{label:"kCal",name:"energy",rules:[{required:!0}],children:e(z,{disabled:!u,style:{width:"100%"},onChange:n=>this.onChangeField(n,"energy")})})}),e(m,{md:6,sm:24,children:e(S.Item,{label:e(h,{id:"erp.prot"}),name:"prot",rules:[{required:!0}],children:e(z,{disabled:!u,style:{width:"100%"},onChange:n=>this.onChangeField(n,"prot")})})}),e(m,{md:6,sm:24,children:e(S.Item,{label:e(h,{id:"erp.fat"}),name:"fat",rules:[{required:!0}],children:e(z,{disabled:!u,style:{width:"100%"},onChange:n=>this.onChangeField(n,"fat")})})}),e(m,{md:6,sm:24,children:e(S.Item,{label:e(h,{id:"erp.carb"}),name:"carb",rules:[{required:!0}],children:e(z,{disabled:!u,style:{width:"100%"},onChange:n=>this.onChangeField(n,"carb")})})})]}),e(H,{}),e(F,{gutter:16,children:e(m,{md:12,sm:24,children:e(S.Item,{children:e(A,{size:"large",htmlType:"submit",children:e(h,{id:"main.save"})})})})})]}),s(m,{md:12,sm:24,children:[s(H,{orientation:"left",children:[e(h,{id:"erp.ingredients"})," ",e(A,{type:"primary",size:"small",onClick:this.addIngredient,children:e(h,{id:"main.add"})})]}),e(We,{ingredients:C,allIngredients:v,addIngredient:this.addIngredient,deleteIngredient:this.deleteIngredient,onChangeIngredient:this.onChangeIngredient}),s(H,{orientation:"left",children:[e(h,{id:"erp.semiproducts"})," ",e(A,{type:"primary",size:"small",onClick:this.addSubTechcard,children:e(h,{id:"main.add"})})]}),e(ze,{subTechcards:l,allSubTechcards:a,deleteSubTechcard:this.deleteSubTechcard,onChangeSubTechcard:this.onChangeSubTechcard})]})]})})})})}})||me;var ge,K;const{Option:Ge}=$,Ke=["monday","tuesday","wednesday","thursday","friday","saturday"];let He=(ge=Q(({user:T})=>({user:T})),j(K=ge(K=class extends V.Component{constructor(){super(...arguments);f(this,"state",{selectedTechcard:"",selectedDay:-1,techcardVisible:!1,templateVisible:!1,editTemplateFormVisible:!1,createTechcardFormVisible:!1,forEdit:{},isEditMode:[!1,!1,!1,!1,!1,!1],dayTemplates:[],newDayId:"",techcards:[]});f(this,"showTechcard",t=>{J(t).then(async i=>{if(i.status===200){const a=await i.json();this.setState({selectedTechcard:a,techcardVisible:!0})}})});f(this,"onCloseTechcard",()=>{this.setState({techcardVisible:!1,selectedTechcard:""})});f(this,"showTemplate",t=>{this.setState({selectedDay:t,templateVisible:!0})});f(this,"onCloseTemplate",()=>{this.setState({templateVisible:!1,selectedDay:-1})});f(this,"editTemplateModal",t=>{this.setState({forEdit:t,editTemplateFormVisible:!0})});f(this,"onCloseEditTemplateForm",()=>{this.setState({editTemplateFormVisible:!1,forEdit:{}}),this.weekUpdate()});f(this,"editTechcardModal",t=>{this.setState({forEdit:t,createTechcardFormVisible:!0})});f(this,"onCloseCreateTechcardForm",()=>{this.setState({createTechcardFormVisible:!1,forEdit:{}})});f(this,"onEdit",async t=>{const{isEditMode:i,newDayId:a}=this.state,{week:d,update:r}=this.props;i[t]=!i[t],i[t]||(await Se({weekId:d.id,weekday:Ke[t],dayId:a})).ok&&await r(d.id),this.setState({isEditMode:i})});f(this,"weekUpdate",async()=>{const{week:t,update:i}=this.props;await i(t.id)});f(this,"markWeekAsCompleted",async()=>{const{week:t}=this.props;(await we(t.id)).ok&&await this.weekUpdate()});f(this,"markDayAsCompleted",async t=>{(await Fe(t)).ok&&await this.weekUpdate()})}componentDidMount(){Ie().then(async t=>{if(t.status===200){const i=await t.json();this.setState({dayTemplates:i})}}),J().then(async t=>{if(t.status===401){const{dispatch:i}=this.props;i({type:"user/SET_STATE",payload:{authorized:!1}});return}if(t.status===200){const i=await t.json();this.setState({techcards:i})}})}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}render(){var q;const{week:t,settings:i,intl:{formatMessage:a}}=this.props,{selectedTechcard:d,selectedDay:r,techcardVisible:p,templateVisible:o,editTemplateFormVisible:g,createTechcardFormVisible:b,forEdit:c,isEditMode:x,dayTemplates:D,techcards:M}=this.state,k=["Breakfast","1 Snack","Lunch","2 Snack","Dinner"],u={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},L={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",background:"linear-gradient(90deg, rgba(251,0,0,0.23573179271708689) 0%, rgba(255,0,0,0.5018382352941176) 50%, rgba(255,0,0,0.24) 100%)"},C={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",background:"linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(232,255,0,0.3113620448179272) 50%, rgba(255,255,255,1) 100%)"},l={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",background:"linear-gradient(90deg, rgba(22,251,0,0.23573179271708689) 0%, rgba(0,255,12,0.41780462184873945) 50%, rgba(22,251,0,0.24) 100%)"},v={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"},I=t.range;return s("div",{children:[Boolean(t.id)&&s("div",{style:{minWidth:"100%",maxWidth:"100%"},children:[e("br",{}),s(F,{span:16,children:[e(m,{md:18,sm:24,children:s("h3",{children:[t.isCompleted?a({id:"Weeks.[COMPLETED]"}):"","Â ",t.title]})}),e(m,{md:6,sm:24,children:e(A,{type:"default",onClick:this.markWeekAsCompleted,size:"small",style:{margin:"0 5px 5px 0",float:"right"},children:t.isCompleted?a({id:"Weeks.UnmarkAsCompleted"}):a({id:"Weeks.MarkAsCompleted"})})})]}),e("center",{children:e("table",{style:v,width:"100%",children:s("tbody",{children:[s("tr",{children:[e("th",{style:u,children:e(h,{id:"erp.meal"})}),[0,1,2,3,4,5].map(y=>x[y]?s("th",{style:u,children:[e($,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(h,{id:"erp.selectTemplate"}),filterOption:(n,E)=>E.props.children.toLowerCase().indexOf(n.toLowerCase())>=0,style:{width:"100%"},size:"small",defaultValue:t.days[y].template.id,onChange:n=>this.onChangeField(n,"newDayId"),children:D.map(n=>e(Ge,{value:n.id,children:n.name},n.id))}),e("br",{}),e("br",{}),e(A,{type:"default",onClick:()=>this.onEdit(y),size:"small",style:{margin:"0 5px 5px 0"},children:x[y]?e(h,{id:"main.save"}):e(h,{id:"window.edit"})})]},Math.random()):s("th",{style:u,children:[e(B,{roles:["root","admin"],children:s(ne,{to:"#",onClick:n=>{this.showTemplate(y),n.preventDefault()},style:{textDecoration:"underline"},children:[t.days[y].template.isCompleted?e(le,{}):"",` ${t.days[y].template.name}`]})}),s(B,{roles:["finance"],children:[t.days[y].template.isCompleted?e(le,{}):"",` ${t.days[y].template.name}`]}),!Math.max(...x)&&i.tools&&s(B,{roles:["root","admin"],children:["Â  Â ",e(A,{type:"default",onClick:()=>this.onEdit(y),size:"small",children:x[y]?e(h,{id:"window.save"}):e(je,{})}),e(A,{type:"default",onClick:()=>this.markDayAsCompleted(t.days[y].template.id),size:"small",style:{margin:"0 5px 5px 5px"},children:t.days[y].template.isCompleted?a({id:"Weeks.Unmark"}):a({id:"Weeks.Mark"})})]})]},Math.random().toString()))]}),[0,1,2,3,4].map(y=>s("tr",{children:[e("td",{style:u,children:k[y]}),[0,1,2,3,4,5].map(n=>{const E=t.days[n].dishes.find(Z=>Z.meal===y);let N=E!==void 0&&E.score>=4.2?l:C;return E!==void 0&&E.score<3.7&&(N=L),(E===void 0||Number(E.score)===0)&&(N=u),i.coloredRating||(N=u),e("td",{style:N,children:E!==void 0?s("span",{children:[e(ne,{to:"#",onClick:Z=>{this.showTechcard(E.id),Z.preventDefault()},children:E.title}),Number(E.score)!==0&&" ",Number(E.score)!==0&&e(Ve,{}),Number(E.score)!==0&&E.score]}):"-"},Math.random())})]},y)),(i.showMinMaxDay||i.showMinMaxWeek)&&e("tr",{style:{border:0},children:e("td",{colSpan:"7",style:{border:0,height:"15px"}})}),i.showMinMaxDay&&s(re,{children:[s("tr",{children:[e("td",{style:u,children:"5 meals"}),[0,1,2,3,4,5].map(y=>{const n=t.days[y].range.five;return e("td",{style:u,children:e("center",{children:s("b",{children:[n.min," - ",n.max," kCal"]})})},y)})]},"min-max-five"),s("tr",{children:[e("td",{style:u,children:a({id:"Weeks.3Meals"})}),[0,1,2,3,4,5].map(y=>{const n=t.days[y].range.three;return e("td",{style:u,children:e("center",{children:s("b",{children:[n.min," - ",n.max," kCal"]})})},y)})]},"min-max-three")]}),i.showMinMaxWeek&&s(re,{children:[s("tr",{children:[e("td",{style:u,children:a({id:"Weeks.MinMaxWeek"})}),s("td",{colSpan:"6",children:[s("center",{children:[a({id:"Weeks.5Meals:SPACE"})," ",e("b",{children:I.five.min})," - ",s("b",{children:[I.five.max," kCal"]})]}),s("center",{children:[a({id:"Weeks.3Meals:SPACE"})," ",e("b",{children:I.three.min})," - ",s("b",{children:[I.three.max," kCal"]})]})]})]},"min-max-week"),s("tr",{children:[e("td",{style:u,children:a({id:"Weeks.Jump"})}),s("td",{colSpan:"6",children:[s("center",{children:[a({id:"Weeks.5Meals:byMin-"})," ",s("b",{children:[I.five.jumpByMin," kCal"]})," |"," ",a({id:"Weeks.byMax-SPACE"}),s("b",{children:[I.five.jumpByMax," kCal"]})]}),s("center",{children:[a({id:"Weeks.3Meals:byMin-"})," ",s("b",{children:[I.three.jumpByMin," kCal"]})," |"," ",a({id:"Weeks.byMax-SPACE"}),s("b",{children:[I.three.jumpByMax," kCal"]})]})]})]},"jumpn")]})]})})})]}),e(be,{visible:p,techcard:d,onClose:this.onCloseTechcard,edit:this.editTechcardModal}),e(qe,{template:r>-1?(q=t==null?void 0:t.days[r])==null?void 0:q.template:{},visible:o,onClose:this.onCloseTemplate,edit:this.editTemplateModal,removeTemplate:this.removeTemplate}),e(Ue,{visible:g,onClose:this.onCloseEditTemplateForm,forEdit:g?c:{},edit:Ee,update:this.props.update}),e(Ne,{visible:b,onClose:this.onCloseCreateTechcardForm,data:M,forEdit:b?c:{},edit:ve,update:this.weekUpdate,showTechcard:this.showTechcard})]})}})||K)||K);var ue,_;O.updateLocale("en",{week:{dow:1}});const{Option:Je}=$,{RangePicker:Qe}=xe;let Ft=(ue=Q(({user:T})=>({user:T})),j(_=ye(_=ue(_=class extends V.Component{constructor(t){super(t);f(this,"state",{data:[],selected:{id:""},weeks:[],settings:{coloredRating:!0,saladOnDinner:!1,showMinMaxDay:!0,showMinMaxWeek:!1,tools:!1},ratingStart:"",ratingEnd:""});f(this,"handleChangeRatingDates",t=>{!t||t.length===0||t===void 0||t===null?this.setState({ratingStart:0,ratingEnd:0}):this.setState({ratingStart:t[0].format("DD-MM-YYYY"),ratingEnd:t[1].format("DD-MM-YYYY")})});f(this,"selectTemplate",t=>{const{data:i}=this.state,a=i.find(d=>d.id===t);a&&this.setState({selected:a})});f(this,"update",async t=>{const{weeks:i,settings:a}=this.state,d=await de(t,a.saladOnDinner);if(d.status===401){const{dispatch:r}=this.props;r({type:"user/SET_STATE",payload:{authorized:!1}});return}if(d.status===200){const r=i.findIndex(o=>o.id===t),p=await d.json();r!==-1&&(i[r]=p,this.setState({weeks:i}))}});this.update=this.update.bind(this)}UNSAFE_componentWillMount(){Me().then(async t=>{if(t.status===401){const{dispatch:i}=this.props;i({type:"user/SET_STATE",payload:{authorized:!1}});return}if(t.status===200){const i=await t.json(),a=i.length?i:[i];this.setState({data:a})}})}async onDownloadMenu(){const{selected:t,weeks:i,settings:a,ratingStart:d,ratingEnd:r}=this.state,{intl:{formatMessage:p}}=this.props,o=await de(t.id,a.saladOnDinner,d,r);if(o.status===401){const{dispatch:g}=this.props;g({type:"user/SET_STATE",payload:{authorized:!1}});return}if(o.status===200){const g=await o.json(),b=i.findIndex(c=>c.id===g.id);b!==-1?(i[b]=g,this.setState({weeks:i})):(i.push(g),this.setState({weeks:i}))}o.status===404&&R.warning({message:p({id:"TemplateMenu.TheCalendarIsNotFilledIn"}),description:p({id:"TemplateMenu.TheCalendarForTheSelectedWeeksIsNotFilledIn"})})}turnSetting(t,i){const{settings:a}=this.state;t.target?t.target.type==="checkbox"?a[i]=t.target.checked:a[i]=t.target.value:a[i]=t,this.setState({settings:a})}render(){const{data:t,weeks:i,settings:a,ratingStart:d,ratingEnd:r}=this.state,{intl:{formatMessage:p}}=this.props;return s(B,{roles:["root","admin","finance","sales"],denied:["Dave"],redirect:!0,to:"/main",children:[e(ke,{title:"Managing templates"}),s("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:p({id:"TemplateMenu.ManagingTemplates"})})})}),s("div",{className:"card-body",children:[e($,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:p({id:"TemplateMenu.Search..."}),filterOption:(o,g)=>g.props.children.toLowerCase().indexOf(o.toLowerCase())>=0,style:{width:"350px",marginBottom:"15px"},onChange:this.selectTemplate,children:t.map(o=>e(Je,{value:o.id,children:o.name},o.id))}),"Â Â Â ",e(W,{checked:a.saladOnDinner,onChange:o=>this.turnSetting(o,"saladOnDinner")}),"Â Â ",e("small",{children:p({id:"TemplateMenu.Salad"})}),e(A,{type:"primary",style:{marginLeft:"15px"},onClick:async()=>this.onDownloadMenu(),children:p({id:"TemplateMenu.Load"})}),"Â Â Â ",e(W,{checked:a.coloredRating,onChange:o=>this.turnSetting(o,"coloredRating")}),"Â Â ",e("small",{children:p({id:"TemplateMenu.ColoredRating"})}),"Â Â Â ",e(W,{checked:a.showMinMaxDay,onChange:o=>this.turnSetting(o,"showMinMaxDay")}),"Â Â ",e("small",{children:p({id:"TemplateMenu.ShowMin-MaxInDay"})}),"Â Â Â ",e(W,{checked:a.showMinMaxWeek,onChange:o=>this.turnSetting(o,"showMinMaxWeek")}),"Â Â ",e("small",{children:p({id:"TemplateMenu.ShowMin-MaxInWeek"})}),"Â Â Â ",s(B,{roles:["root","admin"],children:[e(W,{checked:a.tools,onChange:o=>this.turnSetting(o,"tools")}),"Â Â ",e("small",{children:p({id:"TemplateMenu.ShowTools"})})]}),e("br",{}),e("small",{children:p({id:"TemplateMenu.SelectADateRangeToDisplayTheRating(optional)"})}),e("br",{}),e(Qe,{ranges:{"Previous Month":[O().subtract(1,"month").startOf("month"),O().subtract(1,"month").endOf("month")],"This Month":[O().startOf("month"),O().endOf("month")]},value:d&&r?[O(d,"DD-MM-YYYY"),O(r,"DD-MM-YYYY")]:[],format:"DD.MM.YYYY",onChange:this.handleChangeRatingDates}),e("hr",{}),i.map((o,g)=>e(He,{week:i[g],update:this.update,settings:{coloredRating:a.coloredRating,showMinMaxDay:a.showMinMaxDay,showMinMaxWeek:a.showMinMaxWeek,tools:a.tools}},()=>Math.random()))]})]})]})}})||_)||_)||_);export{Ft as default};
