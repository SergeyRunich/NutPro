import"./PickerPanel-72c5d64a.js";import{a as b,r as c,j as t,aa as s,bk as E,B as w,bF as O,b as S,a8 as k,c as p,a5 as P,a3 as N}from"./index-c20b5e8e.js";/* empty css              */import{D as v}from"./index-2f7554ca.js";import{T as C}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{T as L}from"./index-8e340a60.js";import{g as R}from"./payments-f194e0fa.js";import"./styleChecker-a7b568e2.js";const H=({payments:o,status:l,type:d,isLoading:y})=>{const{formatMessage:r}=b(),u=e=>e.map(n=>{if(n.parent_payment){const i=e==null?void 0:e.find(m=>m.id===(n==null?void 0:n.parent_payment));n.parent_payment_id=i==null?void 0:i.payment_id}if(n.status==="PAID"&&n.gw==="GoPay"){const i=e==null?void 0:e.find(m=>(m==null?void 0:m.parent_payment)===n.id);n.payment_number=i==null?void 0:i.payment_number,n.gw_url=i==null?void 0:i.gw_url}return n}),h=c.useMemo(()=>{if(l==="All"&&d==="All")return u(o);if(l==="All"&&d!=="All")return u(o).filter(e=>e.gw===d);if(l!=="All"&&d==="All")return u(o).filter(e=>e.status===l);if(l!=="All"&&d!=="All")return u(o).filter(e=>e.status===l&&e.gw===d)},[o,l,d]),f=[{title:r({id:"Payments.Created"}),align:"center",dataIndex:"created",key:"created",render:(e,n)=>{if(n.updated!==""){const i=t("div",{children:t("p",{children:s(n.updated).format("DD.MM.YYYY HH:mm")})});return t(E,{content:i,title:"Date of update",children:t("span",{children:s(n.created).format("DD.MM.YYYY HH:mm")})})}return t("span",{children:s(n.created).format("DD.MM.YYYY HH:mm")})}},{title:r({id:"Payments.PaymentID"}),align:"center",dataIndex:"payment_id",key:"payment_id",render:e=>t("span",{children:e})},{title:r({id:"Payments.PaymentID"}),align:"center",dataIndex:"payment_number",key:"payment_number",render:(e,n)=>t("a",{href:n.gw_url,target:"_blank",rel:"noopener noreferrer",children:e})},{title:r({id:"Payments.Duplicate Fakturoid Invoice"}),align:"center",dataIndex:"parent_payment",key:"parent_payment",render:(e,n)=>t("span",{children:n.parent_payment_id||"-"})},{title:r({id:"Payments.Amount"}),align:"center",dataIndex:"amount",key:"amount",render:e=>t("span",{children:e})},{title:r({id:"Payments.Currency"}),align:"center",dataIndex:"currency",key:"currency",render:e=>t("span",{children:e})},{title:r({id:"Payments.Status"}),align:"center",dataIndex:"status",key:"status",render:e=>t("span",{children:e})},{title:r({id:"Payments.gateway"}),align:"center",dataIndex:"gw",key:"gw",render:e=>t("span",{children:e})},{title:r({id:"Payments.PaymentMethod"}),align:"center",dataIndex:"payment_instrument",key:"payment_instrument",render:(e,n)=>n.parent_payment_id?t(L,{color:"blue",children:r({id:"Payments.Paid by GoPay"})}):e},{title:r({id:"Payments.Order"}),align:"center",dataIndex:"order",key:"order",render:e=>t(w,{type:"primary",size:"default",children:t(O,{target:"_blank",to:`/orders/${e}`,children:r({id:"Payments.openOrder"})})})}];return t("div",{children:t(C,{className:"utils__scrollTable",tableLayout:"auto",columns:f,dataSource:h,size:"small",pagination:{position:"bottom",total:h.length,showTotal:(e,n)=>`${n[0]}-${n[1]} of ${e} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:h.length<10},loading:y,rowKey:()=>Math.random().toString()})})},{RangePicker:j}=v,{Option:_}=P,x={All:"All",TIMEOUTED:"Timeouted",PAID:"Paid",CREATED:"Created",CANCELED:"Canceled",PAYMENT_METHOD_CHOSEN:"Payment method chosen",AUTHORIZED:"Authorized",REFUNDED:"Refunded",PARTIALLY_REFUNDED:"Partially refunded",FAILED:"Failed"},A={All:"All",Fakturoid:"Fakturoid",GoPay:"GoPay",Null:"None"},q=()=>{const[o,l]=c.useState(!1),[d,y]=c.useState([]),[r,u]=c.useState(s().startOf("month").unix()),[h,f]=c.useState(s().endOf("month").unix()),[e,n]=c.useState("All"),[i,m]=c.useState("All"),Y=S(),{formatMessage:D}=b(),T=async a=>{const[g,I]=a;u(g.unix()),f(I.unix())},M=async()=>{try{l(!0);const a=await R(s.unix(r).format("DD-MM-YYYY"),s.unix(h).format("DD-MM-YYYY"));if(a.status===401){Y({type:"user/SET_STATE",payload:{authorized:!1}});return}if(a.status===200){const g=await a.json();y(g.result)}}catch(a){N.error({message:a.status,description:a.statusText})}finally{l(!1)}};return c.useEffect(()=>{document.title="List of payments"},[]),t(k,{roles:["finance","root","salesDirector"],redirect:!0,to:"/main",children:t("div",{className:"row",children:t("div",{className:"col-lg-12",children:p("div",{className:"card",children:[p("div",{className:"card-header d-flex justify-content-between align-items-center",children:[t("div",{className:"utils__title d-flex",children:t("strong",{children:D({id:"Payments.ListOfPayments"})})}),p("div",{className:"d-flex align-items-center",style:{marginRight:"20px"},children:[t(P,{placeholder:"Status",defaultValue:i,style:{width:190,marginRight:"20px"},onChange:a=>m(a),children:Object.keys(x).map(a=>t(_,{value:a,children:x[a]},a))}),t(P,{placeholder:"Gateway",defaultValue:e,style:{width:100,marginRight:"20px"},onChange:a=>n(a),children:Object.keys(A).map(a=>t(_,{value:a,children:A[a]},a))}),t(j,{ranges:{"Previous Month":[s().subtract(1,"month").startOf("month"),s().subtract(1,"month").endOf("month")],"This Month":[s().startOf("month"),s().endOf("month")]},defaultValue:[s(r*1e3),s(h*1e3)],format:"DD.MM.YYYY",onChange:T}),t(w,{loading:o,style:{marginLeft:"20px"},type:"primary",onClick:M,children:D({id:"window.show"})})]})]}),t("div",{className:"card-body",children:t(H,{payments:d,type:e,status:i,isLoading:o})})]})})})})};export{q as default};
