var ge=Object.defineProperty;var ye=(t,r,a)=>r in t?ge(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var y=(t,r,a)=>(ye(t,typeof r!="symbol"?r+"":r,a),a);import{r as s,dw as q,i as F,l as v,h as C,C as pe,S as Ce,z as xe,a7 as _,aa as p,a1 as ke,a2 as Se,a3 as E,c as f,a8 as Ne,j as n,bg as we,a5 as T,B as De}from"./index-c20b5e8e.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{R as Ye,C as Q}from"./row-58ed805b.js";import{L as U}from"./index-26b6fa13.js";import"./Pagination-e2a53e90.js";import{a as Ee,S as j}from"./index-297358d3.js";import{T as Oe}from"./index-83b0f9b6.js";import{R as W}from"./index-f06d8a3b.js";import{D as Pe}from"./index-98f1088d.js";import{D as ee}from"./index-2f7554ca.js";import{g as Me}from"./kitchen-60ac824b.js";import"./padStart-17be0050.js";import"./index-8e340a60.js";var je=function(t,r){var a={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(a[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,e=Object.getOwnPropertySymbols(t);i<e.length;i++)r.indexOf(e[i])<0&&Object.prototype.propertyIsEnumerable.call(t,e[i])&&(a[e[i]]=t[e[i]]);return a},Te=function(r){var a=r.prefixCls,e=r.className,i=r.hoverable,m=i===void 0?!0:i,l=je(r,["prefixCls","className","hoverable"]);return s.createElement(q,null,function(c){var o=c.getPrefixCls,h=o("card",a),u=F("".concat(h,"-grid"),e,v({},"".concat(h,"-grid-hoverable"),m));return s.createElement("div",C({},l,{className:u}))})};const te=Te;var Fe=function(t,r){var a={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(a[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,e=Object.getOwnPropertySymbols(t);i<e.length;i++)r.indexOf(e[i])<0&&Object.prototype.propertyIsEnumerable.call(t,e[i])&&(a[e[i]]=t[e[i]]);return a};function _e(t){var r=t.map(function(a,e){return s.createElement("li",{style:{width:"".concat(100/t.length,"%")},key:"action-".concat(e)},s.createElement("span",null,a))});return r}var $e=s.forwardRef(function(t,r){var a,e,i=s.useContext(pe),m=i.getPrefixCls,l=i.direction,c=s.useContext(Ce),o=function(b){var g;(g=t.onTabChange)===null||g===void 0||g.call(t,b)},h=function(){var b;return s.Children.forEach(t.children,function(g){g&&g.type&&g.type===te&&(b=!0)}),b},u=t.prefixCls,O=t.className,x=t.extra,k=t.headStyle,D=k===void 0?{}:k,Y=t.bodyStyle,ae=Y===void 0?{}:Y,P=t.title,A=t.loading,z=t.bordered,ne=z===void 0?!0:z,re=t.size,K=t.type,R=t.cover,M=t.actions,S=t.tabList,G=t.children,L=t.activeTabKey,ie=t.defaultActiveTabKey,se=t.tabBarExtraContent,le=t.hoverable,H=t.tabProps,ce=H===void 0?{}:H,oe=Fe(t,["prefixCls","className","extra","headStyle","bodyStyle","title","loading","bordered","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps"]),d=m("card",u),de=s.createElement(Ee,{loading:!0,active:!0,paragraph:{rows:4},title:!1},G),I=L!==void 0,he=C(C({},ce),(a={},v(a,I?"activeKey":"defaultActiveKey",I?L:ie),v(a,"tabBarExtraContent",se),a)),B,V=S&&S.length?s.createElement(Oe,C({size:"large"},he,{className:"".concat(d,"-head-tabs"),onChange:o,items:S.map(function(N){var b;return{label:N.tab,key:N.key,disabled:(b=N.disabled)!==null&&b!==void 0?b:!1}})})):null;(P||x||V)&&(B=s.createElement("div",{className:"".concat(d,"-head"),style:D},s.createElement("div",{className:"".concat(d,"-head-wrapper")},P&&s.createElement("div",{className:"".concat(d,"-head-title")},P),x&&s.createElement("div",{className:"".concat(d,"-extra")},x)),V));var me=R?s.createElement("div",{className:"".concat(d,"-cover")},R):null,ve=s.createElement("div",{className:"".concat(d,"-body"),style:ae},A?de:G),fe=M&&M.length?s.createElement("ul",{className:"".concat(d,"-actions")},_e(M)):null,ue=xe(oe,["onTabChange"]),J=re||c,be=F(d,(e={},v(e,"".concat(d,"-loading"),A),v(e,"".concat(d,"-bordered"),ne),v(e,"".concat(d,"-hoverable"),le),v(e,"".concat(d,"-contain-grid"),h()),v(e,"".concat(d,"-contain-tabs"),S&&S.length),v(e,"".concat(d,"-").concat(J),J),v(e,"".concat(d,"-type-").concat(K),!!K),v(e,"".concat(d,"-rtl"),l==="rtl"),e),O);return s.createElement("div",C({ref:r},ue,{className:be}),B,me,ve,fe)});const Ae=$e;var ze=function(t,r){var a={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(a[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,e=Object.getOwnPropertySymbols(t);i<e.length;i++)r.indexOf(e[i])<0&&Object.prototype.propertyIsEnumerable.call(t,e[i])&&(a[e[i]]=t[e[i]]);return a},Ke=function(r){return s.createElement(q,null,function(a){var e=a.getPrefixCls,i=r.prefixCls,m=r.className,l=r.avatar,c=r.title,o=r.description,h=ze(r,["prefixCls","className","avatar","title","description"]),u=e("card",i),O=F("".concat(u,"-meta"),m),x=l?s.createElement("div",{className:"".concat(u,"-meta-avatar")},l):null,k=c?s.createElement("div",{className:"".concat(u,"-meta-title")},c):null,D=o?s.createElement("div",{className:"".concat(u,"-meta-description")},o):null,Y=k||D?s.createElement("div",{className:"".concat(u,"-meta-detail")},k,D):null;return s.createElement("div",C({},h,{className:O}),x,Y)})};const Re=Ke;var $=Ae;$.Grid=te;$.Meta=Re;const Ge=$,X=async(t="all")=>{const r={method:"GET",endpoint:`/admin/feedback?type=all&kitchen=${t}`};return _(r).fetch()},Le=async(t,r,a="all")=>{const e={method:"GET",endpoint:`/admin/feedback?type=period&start=${t}&end=${r}&kitchen=${a}`};return _(e).fetch()},He=async(t,r="all")=>{const a={method:"GET",endpoint:`/admin/feedback?type=day&day=${t}&kitchen=${r}`};return _(a).fetch()};var Z;p.updateLocale("en",{week:{dow:1}});const{Option:w}=T,{RangePicker:Ie}=ee;let st=ke(Z=class extends Se.Component{constructor(a){super(a);y(this,"state",{period:0,dates:["",""],feedbacks:[],loading:!0,kitchens:[],kitchen:"all",statistics:{}});y(this,"handleChangeCustomPeriod",async a=>{const e=[a[0].format("DD-MM-YYYY"),a[1].format("DD-MM-YYYY")];this.setState({dates:e})});y(this,"handleChangeCustomDay",async a=>{const e=[a.format("DD-MM-YYYY"),a.format("DD-MM-YYYY")];this.setState({dates:e})});y(this,"handleChangeCalendar",async a=>{const e=a[1]?a[1].format("DD-MM-YYYY"):"";this.setState({dates:[a[0].format("DD-MM-YYYY"),e]})});y(this,"handleChangePeriod",async a=>{this.setState({period:a.key})});this.onCheck=this.onCheck.bind(this),this.onChangeKitchen=this.onChangeKitchen.bind(this)}componentDidMount(){Me().then(async a=>{const e=await a.json();this.setState({kitchens:e})}),X().then(async a=>{if(a.status===200){const e=await a.json();this.setState({feedbacks:e.result,loading:!1,statistics:e.statistics})}else E.error({message:"Error",description:a.statusText})})}onChangeKitchen(a){try{this.setState({kitchen:a})}catch(e){console.log(e)}}onCheck(){const{intl:{formatMessage:a}}=this.props,{period:e,dates:i,kitchen:m}=this.state;this.setState({loading:!0}),Number(e)===1?He(i[0],m).then(async l=>{if(l.status===200){const c=await l.json();this.setState({feedbacks:c.result,loading:!1,statistics:c.statistics})}else E.error({message:a({id:"window.error"}),description:l.statusText})}):Number(e)===2?Le(i[0],i[1],m).then(async l=>{if(l.status===200){const c=await l.json();this.setState({feedbacks:c.result,loading:!1,statistics:c.statistics})}else E.error({message:a({id:"window.error"}),description:l.statusText})}):X(m).then(async l=>{if(l.status===200){const c=await l.json();this.setState({feedbacks:c.result,loading:!1,statistics:c.statistics})}else E.error({message:a({id:"window.error"}),description:l.statusText})})}render(){const{feedbacks:a,period:e,loading:i,kitchens:m,kitchen:l,statistics:c}=this.state,{intl:{formatMessage:o}}=this.props;return f(Ne,{roles:["admin","root","production","finance","salesDirector","readonlySearch"],denied:["Alexandra","Kseniia"],redirect:!0,to:"/main",children:[n(we,{title:o({id:"Feedback.Feedbacks"})}),n("div",{className:"row",children:n("div",{className:"col-xl-12",children:n("div",{className:"utils__title mb-3",children:n("strong",{className:"text-uppercase font-size-16",children:o({id:"Feedback.Feedbacks"})})})})}),n("div",{className:"row",children:n("div",{className:"col-lg-12",children:n("div",{className:"card card--fullHeight",children:n("div",{className:"card-body",children:f("div",{style:{width:"100%",display:"flex",justifyContent:"space-around",alignItems:"center"},children:[n("div",{children:n(j,{style:{textAlign:"center"},title:o({id:"Feedback.Total"}),value:c.total})}),n("div",{children:n(j,{style:{textAlign:"center"},title:o({id:"Feedback.DeliveryScoreAvg"}),value:c.avgDeliveryScore})}),n("div",{children:n(j,{style:{textAlign:"center"},title:o({id:"Feedback.FoodScoreAvg"}),value:c.avgFoodScore})})]})})})})}),n("div",{className:"row",children:n("div",{className:"col-lg-12",children:n("div",{className:"card card--fullHeight",children:f("div",{className:"card-body",children:[n("div",{className:"row",children:f("div",{className:"col-lg-12",children:[f(T,{labelInValue:!0,defaultValue:{key:"0"},style:{marginRight:"10px",width:150},onChange:this.handleChangePeriod,children:[n(w,{value:"0",children:o({id:"Feedback.AllTime"})}),n(w,{value:"1",children:o({id:"Feedback.SelectedDay"})}),n(w,{value:"2",children:o({id:"Feedback.SelectedRange"})})]}),Number(e)===1&&n("span",{children:n(ee,{format:"DD.MM.YYYY",style:{marginRight:"10px"},onChange:this.handleChangeCustomDay,onCalendarChange:this.handleChangeCalendar})}),Number(e)===2&&n("span",{children:n(Ie,{ranges:{"Previous Month":[p().subtract(1,"month").startOf("month"),p().subtract(1,"month").endOf("month")],"This Month":[p().startOf("month"),p().endOf("month")]},format:"DD.MM.YYYY",style:{marginRight:"10px"},onChange:this.handleChangeCustomPeriod,onCalendarChange:this.handleChangeCalendar})}),f(T,{value:l,style:{width:"115px",marginRight:"10px"},onChange:this.onChangeKitchen,children:[n(w,{value:"all",children:o({id:"Feedback.All"})}),m.map(h=>n(w,{value:h.id,children:h.name},h.id))]}),n(De,{onClick:this.onCheck,type:"primary",size:"default",style:{marginRight:"10px"},children:o({id:"Feedback.View"})}),n(Pe,{})]})}),n(U,{grid:{gutter:16,xs:1,sm:2,md:2,lg:2,xl:3,xxl:4},pagination:{pageSize:12},itemLayout:"vertical",dataSource:a,loading:i,renderItem:h=>n(U.Item,{style:{minHeight:"350px"},children:f(Ge,{style:{minHeight:"300px"},hoverable:!0,size:"small",title:n("b",{children:h.user.name}),extra:n("i",{children:p(h.date).format("DD.MM.YYYY HH:mm")}),children:[f(Ye,{children:[n(Q,{md:24,lg:12,children:f("span",{children:[n("small",{children:o({id:"Feedback.DeliveryScore"})}),n("br",{}),n(W,{value:Number(h.deliveryScore),style:{color:"#2fa037"},allowHalf:!0,disabled:!0})]})}),n(Q,{md:24,lg:12,children:f("span",{children:[n("small",{children:o({id:"Feedback.FoodScore"})}),n("br",{}),n(W,{value:Number(h.foodScore),style:{color:"#2fa037"},allowHalf:!0,disabled:!0})]})})]}),n("hr",{}),h.text]})})})]})})})})]})}})||Z;export{st as default};
