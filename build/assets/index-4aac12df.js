var x=Object.defineProperty;var T=(o,h,e)=>h in o?x(o,h,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[h]=e;var l=(o,h,e)=>(T(o,typeof h!="symbol"?h+"":h,e),e);import{a7 as D,a1 as v,a2 as I,r as R,a3 as C,j as s,c as d,I as y,a5 as b,B as U,bd as _,be as N,aW as j,aa as V,a8 as E,bg as M}from"./index-c20b5e8e.js";import{T as P}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{D as $}from"./index-1e692111.js";import{F as u}from"./index-a86cfb93.js";import{R as S,C as g}from"./row-58ed805b.js";import{g as A}from"./kitchen-60ac824b.js";import"./styleChecker-a7b568e2.js";const O=async o=>D({method:"POST",endpoint:"/kitchen/sign_up",body:o}).fetch(),K=async()=>D({method:"GET",endpoint:"/admin/kitchen/user"}).fetch();var k;const{Option:w}=b;let W=v(k=class extends I.Component{constructor(e){super(e);l(this,"state",{username:"",role:"",password:"",kitchen:"",kitchens:[{id:"",name:"-"}]});l(this,"formRef",R.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this)}componentDidMount(){A().then(async e=>{if(e.status!==401){const t=await e.json();this.setState({kitchens:t,kitchen:t[0].id})}})}onChangeField(e,t){e.target?e.target.type==="checkbox"?this.setState({[t]:e.target.checked}):this.setState({[t]:e.target.value}):this.setState({[t]:e})}async onFinish(){try{const{create:e,update:t,intl:{formatMessage:a}}=this.props;await this.formRef.current.validateFields();const{username:c,role:p,password:n,kitchen:r}=this.state,m=await e({username:c,role:p,password:n,kitchen:r});m.status===200?(this.closeDrawer(),C.success({message:a({id:"KitchenUser.Created"}),description:a({id:"KitchenUser.User successfully created!"})}),t()):m.status===409?C.error({message:a({id:"KitchenUser.Error name"}),description:a({id:"KitchenUser.User with current name already exist!"}),placement:"topLeft"}):C.error({message:a({id:"window.error"}),description:m.statusText,placement:"topLeft"})}catch(e){console.log("Failed:",e)}}closeDrawer(){const{onClose:e}=this.props,{kitchens:t}=this.state;this.setState({username:"",role:"",password:"",kitchen:t[0].id}),this.formRef.current.resetFields(),e()}render(){const{visible:e,intl:{formatMessage:t}}=this.props,{role:a,kitchen:c,kitchens:p}=this.state;let n=1080;return typeof window.innerWidth<"u"&&(n=window.innerWidth),s($,{title:t({id:"KitchenUser.Create a new kitchen account"}),width:n<768?"100%":"auto",onClose:this.closeDrawer,open:e,bodyStyle:{paddingBottom:80},children:d(u,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[d(S,{gutter:16,children:[s(g,{md:12,sm:24,children:s(u.Item,{label:t({id:"KitchenUser.Username"}),name:"username",rules:[{required:!0}],children:s(y,{placeholder:t({id:"KitchenUser.Please enter user name"}),onChange:r=>this.onChangeField(r,"username")})})}),s(g,{md:12,sm:24,children:s(u.Item,{name:"role",label:t({id:"KitchenUser.Role"}),rules:[{required:!0}],children:d(b,{value:a,onChange:r=>this.onChangeField(r,"role"),children:[s(w,{value:"cheef",children:t({id:"KitchenUser.cheef"})},"cheef"),s(w,{value:"cook",children:t({id:"KitchenUser.cook"})},"cook"),s(w,{value:"admin",children:t({id:"KitchenUser.admin"})},"admin")]})})})]}),d(S,{gutter:16,children:[s(g,{md:12,sm:24,children:s(u.Item,{label:t({id:"KitchenUser.Password"}),name:"password",rules:[{required:!0}],children:s(y,{type:"password",placeholder:t({id:"KitchenUser.Please enter password"}),onChange:r=>this.onChangeField(r,"password")})})}),s(g,{md:12,sm:24,children:s(u.Item,{name:"kitchen",label:t({id:"KitchenUser.Kitchen"}),rules:[{required:!0,message:t({id:"KitchenUser.Please choose the kitchen"})}],children:s(b,{placeholder:t({id:"KitchenUser.Please choose the kitchen"}),value:c,onChange:r=>this.onChangeField(r,"kitchen"),style:{width:"100%"},children:p.map(r=>s(w,{value:r.id,children:r.name},r.id))})})})]}),s(u.Item,{children:d("div",{className:"form-actions",children:[s(U,{style:{width:150},type:"primary",htmlType:"submit",className:"mr-3",children:t({id:"window.create"})}),s(U,{onClick:this.closeDrawer,children:"Cancel"})]})})]})})}})||k;var F,f;let Z=(F=_(({user:o})=>({user:o})),v(f=N(f=F(f=class extends I.Component{constructor(e){super(e);l(this,"state",{tableData:[],data:[],filterDropdownVisible:!1,searchText:"",filtered:!1,loading:!0,createUserFormVisible:!1});l(this,"onInputChange",e=>{this.setState({searchText:e.target.value})});l(this,"showDrawerCreateUserForm",()=>{this.setState({createUserFormVisible:!0})});l(this,"onCloseCreateUserForm",()=>{this.setState({createUserFormVisible:!1})});l(this,"onSearch",()=>{const{searchText:e,tableData:t}=this.state,a=new RegExp(e,"gi");this.setState({filterDropdownVisible:!1,filtered:!!e,data:t.map(c=>c.name.match(a)?{...c,name:c.name}:null).filter(c=>!!c)}),e===""&&this.setState({filtered:!1})});l(this,"refSearchInput",e=>{this.searchInput=e});this.updateUsers=this.updateUsers.bind(this)}UNSAFE_componentWillMount(){K().then(async e=>{if(e.status===401){const{dispatch:a}=this.props;a({type:"user/SET_STATE",payload:{authorized:!1}});return}const t=await e.json();this.setState({tableData:t,data:t,loading:!1})})}updateUsers(){K().then(async e=>{const t=await e.json();this.setState({tableData:t,data:t,loading:!1})})}render(){const{data:e,searchText:t,filterDropdownVisible:a,filtered:c,createUserFormVisible:p}=this.state,{intl:{formatMessage:n}}=this.props,r=[{title:n({id:"KitchenUser.Username"}),dataIndex:"username",key:"username",sorter:(i,m)=>i.name.length-m.name.length,render:i=>s("span",{children:` ${i}`}),filterDropdown:d("div",{className:"custom-filter-dropdown",children:[s(y,{ref:this.refSearchInput,placeholder:n({id:"KitchenUser.Search name"}),value:t,onChange:this.onInputChange,onPressEnter:this.onSearch}),s(U,{type:"primary",onClick:this.onSearch,children:n({id:"KitchenUser.Search"})})]}),filterIcon:s(j,{style:{color:c?"#108ee9":"#aaa"}}),filterDropdownVisible:a,onFilterDropdownVisibleChange:i=>{this.setState({filterDropdownVisible:i},()=>this.searchInput&&this.searchInput.focus())}},{title:n({id:"KitchenUser.Created date"}),dataIndex:"id",key:"createdDate",render:i=>s("span",{children:`${V.unix(parseInt(i.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`})},{title:n({id:"KitchenUser.Kitchen"}),dataIndex:"kitchen",key:"kitchen",render:i=>s("span",{children:`${i.name||"-"}`})},{title:n({id:"KitchenUser.Role"}),dataIndex:"role",key:"role",render:i=>s("span",{children:`${i||"-"}`})}];return d(E,{roles:["root"],redirect:!0,to:"/main",children:[s(M,{title:"Users"}),d("div",{className:"card",children:[s("div",{className:"card-header",children:s("div",{className:"utils__title",children:s("strong",{children:n({id:"KitchenUser.Kitchen users"})})})}),d("div",{className:"card-body",children:[s(U,{style:{marginBottom:"20px"},type:"primary",onClick:this.showDrawerCreateUserForm,children:n({id:"KitchenUser.New kitchen user"})}),s(P,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:r,dataSource:e,pagination:{position:"bottom",total:e.length,showTotal:(i,m)=>`${m[0]}-${m[1]} of ${i} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:e.length<10},loading:this.state.loading,rowKey:()=>Math.random()})]})]}),s(W,{visible:p,onClose:this.onCloseCreateUserForm,create:O,update:this.updateUsers})]})}})||f)||f)||f);export{Z as default};
