import{a as M,c as n,aZ as y,j as t,r as d,u as te,bF as k,bp as ae,a8 as f,I as ie,B as N,aW as re,aa as $,aX as ne,a3 as b,b0 as c,a5 as C,a6 as x}from"./index-c20b5e8e.js";import{T as se}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as W,w as le}from"./order-d29e3517.js";import{g as de}from"./kitchen-60ac824b.js";import"./styleChecker-a7b568e2.js";const ce=({statusOrder:s,id:u,onChangeStatusOrder:m,onRegenerateOrder:l,onSendInvoiceEmail:S})=>{const{formatMessage:p}=M();return n(y,{className:"p-0",children:[s==="new"&&t(y.Item,{onClick:()=>m(u,"accepted"),style:{backgroundColor:"LimeGreen",color:"AliceBlue",fontWeight:"bolder"},children:p({id:"window.accept"})},"accept"),s==="new"&&t(y.Item,{onClick:()=>m(u,"rejected"),style:{backgroundColor:"LightCoral",color:"AliceBlue",fontWeight:"bolder"},children:p({id:"window.reject"})},"reject"),s==="accepted"&&t(y.Item,{onClick:()=>l(u),children:p({id:"Orders.Regenerate"})},"regenerate"),s==="accepted"&&t(y.Item,{onClick:()=>S(u),children:p({id:"Orders.ResendInvoiceEmail"})},"sendInvoiceEmail")]})},{Option:o}=C,D={accepted:"success",rejected:"danger",new:"primary",waitingPayment:"info",fromWeb:"info",incomplete:"warning"},oe={stage:"active",status:"all",sales:"all",filter:"all",type:"normal",kitchen:"all",activeOrders:"all",isOnlyVIP:!1,isOnlyUnpaid:!1,isOnlyWithoutInvoice:!1},ye=()=>{const[s,u]=d.useState([]),[m,l]=d.useState([]),[S,p]=d.useState(!1),[O,V]=d.useState(""),[L,P]=d.useState(!1),[R,w]=d.useState(!1),[T,Y]=d.useState([]),[j,E]=d.useState([]),[r,h]=d.useState({...oe}),{formatMessage:i}=M(),{currentBranch:I}=te(e=>e.settings),F=d.useRef(null),g=async e=>{try{w(!0);const a=await W({...e,branchId:I});if(a.status===200){const v=await a.json();u(v),l(v)}}catch{b.error({message:i({id:"window.error"}),description:"Failed to get orders"})}finally{w(!1)}},z=e=>{V(e.target.value)},B=()=>{const e=new RegExp(O,"gi");p(!1),P(!!O),l(m.map(a=>{const v=a.user.name.match(e);return v?{...a,name:t("span",{children:a.user.name.split(e).map((A,ee)=>ee>0?[t("span",{className:"highlight",children:v[0]},Math.random()),A]:A)},Math.random())}:null}).filter(a=>!!a)),O===""&&P(!1)},K=async e=>{h({...r,stage:e.target.value}),await g({...r,stage:e.target.value})},U=async e=>{h({...r,filter:e.target.value}),await g({...r,filter:e.target.value})},G=async e=>{h({...r,status:e}),await g({...r,status:e})},H=async e=>{h({...r,sales:e}),await g({...r,sales:e})},_=async e=>{h({...r,type:e.target.value}),await g({...r,type:e.target.value})},X=e=>{h({...r,kitchen:e}),l(e==="all"?s:s.filter(a=>a.kitchen&&a.kitchen.last.name===e))},Z=e=>{h({...r,isOnlyVIP:e.target.checked}),e.target.checked?l(s.filter(a=>a.user.tag==="VIP")):l(s)},q=e=>{h({...r,isOnlyUnpaid:e.target.checked}),e.target.checked?l(s.filter(a=>a.isInvoicePaid===!1&&a.status==="accepted"&&a.invoice!==""&&a.invoice!==null)):l(s)},J=e=>{h({...r,isOnlyWithoutInvoice:e.target.checked}),e.target.checked?l(s.filter(a=>a.invoice===null||a.invoice==="")):l(s)},Q=[{title:i({id:"Orders.ID"}),dataIndex:"user",key:"id",render:(e,a)=>t(k,{to:`/users/${a.user.id}`,children:`${e.inBodyId}`}),sorter:(e,a)=>e.user.inBodyId-a.user.inBodyId},{title:i({id:"window.name"}),dataIndex:"user",key:"name",sorter:(e,a)=>e.user.name.length-a.user.name.length,render:(e,a)=>n(ae,{children:[t(f,{roles:["root","sales","salesDirector"],children:t(k,{to:`/users/${a.user.id}`,children:e.name})}),t(f,{roles:["admin","finance"],children:e.name})]}),filterDropdown:n("div",{className:"custom-filter-dropdown",children:[t(ie,{ref:F,placeholder:i({id:"Orders.SearchName"}),value:O,onChange:z,onPressEnter:B}),t(N,{type:"primary",onClick:B,children:i({id:"Orders.Search"})})]}),filterIcon:t(re,{style:{color:L?"#108ee9":"#aaa"}}),isFilterDropdownVisible:S,onFilterDropdownVisibleChange:e=>{p(e),e&&F.current.focus()}},{title:i({id:"Orders.CreatedDate"}),dataIndex:"id",key:"createdDate",render:e=>t("span",{children:`${$.unix(parseInt(e.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`}),sorter:(e,a)=>parseInt(e.id.substring(0,8),16)-parseInt(a.id.substring(0,8),16)},{title:i({id:"Orders.Start"}),dataIndex:"timestamp",key:"startDate",render:e=>t("span",{children:$.unix(e).format("DD.MM.YYYY")}),sorter:(e,a)=>e.timestamp-a.timestamp},{title:i({id:"Orders.Diet"}),dataIndex:"diet",key:"diet",render:e=>t("span",{children:e}),sorter:(e,a)=>e.diet.length-a.diet.length},{title:i({id:"Orders.Meals"}),dataIndex:"mealsPerDay",key:"mealsPerDay",render:e=>t("span",{children:e}),sorter:(e,a)=>e.mealsPerDay-a.mealsPerDay},{title:i({id:"Orders.Price"}),dataIndex:"price",key:"price",render:e=>t("span",{children:e}),sorter:(e,a)=>e.price-a.price},{title:i({id:"Orders.Invoice"}),dataIndex:"isInvoicePaid",key:"isInvoicePaid",render:(e,a)=>t("span",{className:`font-size-12 badge badge-${e?D.accepted:a.status!=="accepted"||!a.invoice?"default":D.rejected}`,children:e?t("a",{className:"text-white",href:a.invoice,children:i({id:"Orders.Paid"})}):t("span",{children:a.status!=="accepted"&&a.status!=="waitingPayment"||!a.invoice?i({id:"Orders.None"}):i({id:"Orders.Unpaid"})})})},{title:i({id:"window.email"}),dataIndex:"email",key:"email",render:e=>t("a",{href:`mailto:${e}`,target:"blank",children:`${e||"-"}`})},{title:i({id:"window.phone"}),dataIndex:"phone",key:"phone",render:e=>t("span",{children:`${e||"-"}`})},{title:i({id:"Orders.Status"}),dataIndex:"status",key:"status",render:e=>t("span",{className:`font-size-12 badge badge-${D[e]}`,children:e==="Active"?t("a",{className:"text-white",href:`/#/orders/${e.id}`,children:e.status}):e})},{title:i({id:"Orders.Action"}),dataIndex:"id",key:"action",render:(e,a)=>n("span",{children:[t(f,{roles:["root","sales","salesDirector"],children:t(ne.Button,{overlay:ce(a.status),children:t(k,{to:`/orders/${e}`,children:i({id:"Orders.View"})})})}),t(f,{roles:["admin","finance"],children:t(N,{children:t(k,{to:`/orders/${e}`,children:i({id:"Orders.View"})})})})]})}];return d.useEffect(()=>{document.title="Orders",I&&(w(!0),W({stage:"active",status:"all",sales:"all",filter:"all",type:"normal",branchId:I}).then(async e=>{if(e.status===200){const a=await e.json();u(a),l(a)}}).catch(()=>b.error({message:i({id:"window.error"}),description:"Failed to get orders"})).finally(()=>{w(!1)}))},[I,i]),d.useEffect(()=>{de().then(async e=>{if(e.status===200){const a=await e.json();Y(a)}}).catch(()=>{b.error({message:i({id:"window.error"}),description:"Failed to get kitchens"})}),le().then(async e=>{if(e.status!==401){const a=await e.json();E(a.result)}}).catch(()=>{b.error({message:i({id:"window.error"}),description:"Failed to get sales list"})})},[i]),n(f,{roles:["root","admin","sales","salesDirector","finance"],denied:["Dany","Vitaly"],redirect:!0,to:"/main",children:[t("div",{className:"card",children:n("div",{className:"card-body",children:[n("div",{style:{display:"flex",justifyContent:"space-between"},children:[n("div",{children:[t("h4",{children:i({id:"Orders.Stage"})}),n(c.Group,{value:r.stage,onChange:K,children:[t(c.Button,{value:"active",children:i({id:"Orders.Active"})}),t(c.Button,{value:"all",children:i({id:"Orders.All"})})]})]}),n("div",{children:[t("h4",{children:i({id:"Orders.FilterOfActiveOrders"})}),n(c.Group,{value:r.filter,onChange:U,disabled:r.stage!=="active",children:[t(c.Button,{value:"all",children:i({id:"Orders.All"})}),t(c.Button,{value:"active",children:i({id:"Orders.Active"})}),t(c.Button,{value:"waiting",children:i({id:"Orders.Waiting"})}),t(c.Button,{value:"pause",children:i({id:"Orders.Pause"})})]})]}),n("div",{children:[t("h4",{children:"Status"}),n(C,{value:r.status,onChange:G,style:{width:"150px"},children:[t(o,{value:"all",children:i({id:"Orders.All"})}),t(o,{value:"accepted",children:i({id:"Orders.Accepted"})}),t(o,{value:"new",children:i({id:"Orders.New"})}),t(o,{value:"rejected",children:i({id:"Orders.Rejected"})}),t(o,{value:"fromWeb",children:i({id:"Orders.FromWeb"})}),t(o,{value:"waitingPayment",children:i({id:"Orders.FromWeb(WaitingForPayment)"})}),t(o,{value:"incomplete",children:i({id:"Orders.Incomplete"})})]})]}),n("div",{children:[t("h4",{children:i({id:"Orders.Sales"})}),n(C,{value:r.sales,style:{width:120},onChange:H,children:[t(o,{value:"all",children:i({id:"Orders.All"})}),j&&j.map(e=>t(o,{value:e.id,children:e.name},e.id))]})]}),n("div",{children:[t("h4",{children:i({id:"Orders.Kitchen"})}),n(C,{value:r.kitchen,style:{width:"115px"},onChange:X,children:[t(o,{value:"all",children:i({id:"Orders.All"})}),T.map(e=>t(o,{value:e.name,children:e.name},e.name+Math.random()))]})]}),n("div",{children:[t("h4",{children:i({id:"Orders.Type"})}),n(c.Group,{value:r.type,onChange:_,children:[t(c.Button,{value:"normal",children:i({id:"Orders.Normal"})}),t(c.Button,{value:"b2b",children:i({id:"Orders.B2B"})})]})]})]}),t("hr",{}),n("div",{style:{display:"flex",justifyContent:"flex-start"},children:[t("div",{style:{marginRight:"20px"},children:t(x,{checked:r.isOnlyVIP,onClick:e=>Z(e),children:i({id:"Orders.OnlyVip"})})}),t("div",{style:{marginRight:"20px"},children:t(x,{checked:r.isOnlyUnpaid,onClick:e=>q(e),children:i({id:"Orders.OnlyUnpaid"})})}),t("div",{style:{marginRight:"20px"},children:t(x,{checked:r.isOnlyWithoutInvoice,onClick:e=>J(e),children:i({id:"Orders.OnlyWithoutInvoice"})})})]})]})}),n("div",{className:"card",children:[t("div",{className:"card-header",children:t("div",{className:"utils__title",children:t("strong",{children:i({id:"Orders.Orders"})})})}),t("div",{className:"card-body",children:t(se,{tableLayout:"auto",scroll:{x:"100%"},columns:Q,dataSource:m,pagination:{position:"bottom",total:m.length,showTotal:(e,a)=>`${a[0]}-${a[1]} of ${e} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:m.length<10},loading:R,rowKey:()=>Math.random().toString()})})]})]})};export{ye as default};
