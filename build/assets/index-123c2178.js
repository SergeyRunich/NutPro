var X=Object.defineProperty;var Y=(h,l,a)=>l in h?X(h,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[l]=a;var p=(h,l,a)=>(Y(h,typeof l!="symbol"?l+"":l,a),a);import{a1 as F,a2 as x,r as H,a3 as u,j as e,bl as o,c,I as z,a5 as M,B as T,bd as $,aW as Z,aX as Q,aZ as R,be as _,bF as ee,aY as te,a8 as ae,bg as se,b4 as B}from"./index-c20b5e8e.js";import{T as re}from"./index-83b0f9b6.js";import{g as j,d as ie,c as de,e as ne}from"./weekTemplate-f1345fa1.js";import{F as w}from"./index-a86cfb93.js";import{R as O,C as y}from"./row-58ed805b.js";import{D as W}from"./index-1e692111.js";import{g as oe}from"./template-0cdd19f6.js";import{T as L}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as J}from"./index-67f4e7c4.js";import{S}from"./index-297358d3.js";import{a as le,b as ce,l as he,c as me}from"./testSettings-9d6c3207.js";/* empty css              */import{T as C}from"./index-8e340a60.js";import"./styleChecker-a7b568e2.js";import"./padStart-17be0050.js";var q;const{Option:k}=M;let pe=F(q=class extends x.Component{constructor(a){super(a);p(this,"state",{name:"",isEdit:!1,monday:"",tuesday:"",wednesday:"",thursday:"",friday:"",saturday:"",templates:[]});p(this,"formRef",H.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this)}componentDidMount(){oe().then(async a=>{if(a.status===200){const r=await a.json();this.setState({templates:r})}})}onChangeField(a,r){a.target?a.target.type==="checkbox"?this.setState({[r]:a.target.checked}):this.setState({[r]:a.target.value}):this.setState({[r]:a})}async onFinish(){try{const{create:a,edit:r,forEdit:i,update:d,intl:{formatMessage:s}}=this.props;await this.formRef.current.validateFields();const{name:t,monday:n,tuesday:f,wednesday:b,thursday:m,friday:g,saturday:G}=this.state,V={name:t,monday:n,tuesday:f,wednesday:b,thursday:m,friday:g,saturday:G};if(i.id){const D=await r(i.id,V);D.status===200?(this.closeDrawer(),u.success({message:s({id:"CreateTemplate.Saved"}),description:s({id:"CreateTemplate.TemplateSuccessfullySaved!"})}),d()):u.error({message:s({id:"window.error"}),description:D.statusText,placement:"topLeft"})}else{const D=await a(V);D.status===201?(this.closeDrawer(),u.success({message:s({id:"CreateTemplate.Created"}),description:s({id:"CreateTemplate.TemplateSuccessfullyCreated!"})}),d()):u.error({message:s({id:"CreateTemplate.Error!"}),description:D.statusText,placement:"topLeft"})}}catch(a){console.log("Failed:",a)}}setEdit(){const{forEdit:a}=this.props;a&&this.setState({name:a.name,monday:a.monday.id,tuesday:a.tuesday.id,wednesday:a.wednesday.id,thursday:a.thursday.id,friday:a.friday.id,saturday:a.saturday.id,isEdit:!0})}componentDidUpdate(a){var i,d,s,t,n,f,b;const{forEdit:r}=this.props;r&&a.forEdit!==r&&((b=this.formRef.current)==null||b.setFieldsValue({name:r.name,monday:(i=r.monday)==null?void 0:i.id,tuesday:(d=r.tuesday)==null?void 0:d.id,wednesday:(s=r.wednesday)==null?void 0:s.id,thursday:(t=r.thursday)==null?void 0:t.id,friday:(n=r.friday)==null?void 0:n.id,saturday:(f=r.saturday)==null?void 0:f.id}))}closeDrawer(){const{onClose:a}=this.props;a(),this.setState({name:"",monday:"",tuesday:"",wednesday:"",thursday:"",friday:"",saturday:"",isEdit:!1}),this.formRef.current.resetFields()}render(){const{visible:a,forEdit:r}=this.props,{isEdit:i,templates:d}=this.state;return r.id&&!i&&this.setEdit(),e("div",{children:e(W,{title:i?e(o,{id:"erp.title.editingWeekTemplate"}):e(o,{id:"erp.title.createWeekTemplate"}),width:"100%",height:"100%",onClose:this.closeDrawer,open:a,bodyStyle:{paddingBottom:80},children:e(w,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:e(O,{gutter:16,children:e(y,{md:12,sm:24,children:c(O,{gutter:16,children:[e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"erp.name"}),name:"name",rules:[{required:!0}],children:e(z,{onChange:s=>this.onChangeField(s,"name")})})}),e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"main.monday"}),name:"monday",rules:[{required:!0}],children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(o,{id:"erp.selectTemplate"}),filterOption:(s,t)=>t.props.children.toLowerCase().indexOf(s.toLowerCase())>=0,style:{width:"100%"},onChange:s=>this.onChangeField(s,"monday"),children:d.map(s=>e(k,{value:s.id,children:s.name},s.id))})})}),e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"main.tuesday"}),name:"tuesday",rules:[{required:!0}],children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(o,{id:"erp.selectTemplate"}),filterOption:(s,t)=>t.props.children.toLowerCase().indexOf(s.toLowerCase())>=0,style:{width:"100%"},onChange:s=>this.onChangeField(s,"tuesday"),children:d.map(s=>e(k,{value:s.id,children:s.name},s.id))})})}),e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"main.wednesday"}),name:"wednesday",rules:[{required:!0}],children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(o,{id:"erp.selectTemplate"}),filterOption:(s,t)=>t.props.children.toLowerCase().indexOf(s.toLowerCase())>=0,style:{width:"100%"},onChange:s=>this.onChangeField(s,"wednesday"),children:d.map(s=>e(k,{value:s.id,children:s.name},s.id))})})}),e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"main.thursday"}),name:"thursday",rules:[{required:!0}],children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(o,{id:"erp.selectTemplate"}),filterOption:(s,t)=>t.props.children.toLowerCase().indexOf(s.toLowerCase())>=0,style:{width:"100%"},onChange:s=>this.onChangeField(s,"thursday"),children:d.map(s=>e(k,{value:s.id,children:s.name},s.id))})})}),e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"main.friday"}),name:"friday",rules:[{required:!0}],children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(o,{id:"erp.selectTemplate"}),filterOption:(s,t)=>t.props.children.toLowerCase().indexOf(s.toLowerCase())>=0,style:{width:"100%"},onChange:s=>this.onChangeField(s,"friday"),children:d.map(s=>e(k,{value:s.id,children:s.name},s.id))})})}),e(y,{md:24,sm:24,children:e(w.Item,{label:e(o,{id:"main.saturday"}),name:"saturday",rules:[{required:!0}],children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:e(o,{id:"erp.selectTemplate"}),filterOption:(s,t)=>t.props.children.toLowerCase().indexOf(s.toLowerCase())>=0,style:{width:"100%"},onChange:s=>this.onChangeField(s,"saturday"),children:d.map(s=>e(k,{value:s.id,children:s.name},s.id))})})}),e(y,{md:4,sm:24,children:e(w.Item,{children:e(T,{size:"large",htmlType:"submit",children:e(o,{id:"main.save"})})})})]})})})})})})}})||q;var N,P;let ue=(N=$(({user:h})=>({user:h})),N(P=class extends x.Component{constructor(a){super(a);p(this,"state",{tableData:[],data:[],filterDropdownVisible:!1,searchText:"",filtered:!1,loading:!0});p(this,"onInputChange",a=>{this.setState({searchText:a.target.value})});p(this,"onSearch",()=>{const{searchText:a,tableData:r}=this.state,i=new RegExp(a,"gi");this.setState({filterDropdownVisible:!1,filtered:!!a,data:r.map(d=>d.id.match(i)?{...d,id:d.id}:null).filter(d=>!!d)}),a===""&&this.setState({filtered:!1})});p(this,"refSearchInput",a=>{this.searchInput=a});this.update=this.update.bind(this)}UNSAFE_componentWillMount(){this.update()}update(){const{data:a}=this.props;this.setState({tableData:a,data:a,loading:!1})}render(){const{data:a,searchText:r,filterDropdownVisible:i,filtered:d}=this.state,{edit:s,removeTemplate:t,user:n}=this.props,f=m=>e(R,{style:{padding:"0px"},children:e(R.Item,{children:c(J,{title:"Are you sure delete this template?",onConfirm:async()=>t(m),okText:e(o,{id:"window.yes"}),cancelText:e(o,{id:"window.no"}),children:[e(o,{id:"window.remove"}),"!"]})},"remove")}),b=[{title:e(o,{id:"erp.template"}),dataIndex:"name",key:"name",sorter:(m,g)=>m.name.length-g.name.length,render:m=>e("span",{children:e("strong",{children:` ${m}`})}),filterDropdown:c("div",{className:"custom-filter-dropdown",style:{padding:"5px"},children:[e(z,{ref:this.refSearchInput,placeholder:"Search name",value:r,onChange:this.onInputChange,onPressEnter:this.onSearch}),e(T,{type:"primary",onClick:this.onSearch,style:{marginTop:"5px"},children:"Search"})]}),filterIcon:e(Z,{style:{color:d?"#108ee9":"#aaa"}}),filterDropdownVisible:i,onFilterDropdownVisibleChange:m=>{this.setState({filterDropdownVisible:m},()=>this.searchInput&&this.searchInput.focus())}},{title:"---",dataIndex:"id",key:"action",render:(m,g)=>e("span",{children:n.name!=="david"&&e(Q.Button,{overlay:f(m),onClick:()=>s(g),children:e(o,{id:"window.edit"})})})}];return e(L,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:b,dataSource:a,pagination:{position:"bottom",total:a.length,showTotal:(m,g)=>`${g[0]}-${g[1]} of ${m} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:a.length<10},loading:this.state.loading,rowKey:()=>Math.random()})}})||P);var I;let ye=F(I=_(I=class extends x.Component{constructor(l){super(l),this.closeDrawer=this.closeDrawer.bind(this)}closeDrawer(){const{onClose:l}=this.props;l()}render(){const{visible:l,data:a,summary:r,intl:{formatMessage:i}}=this.props,d=[{title:i({id:"MainTest.cKalError"}),dataIndex:"error",key:"kcal",render:t=>e("span",{children:`${t}`})},{title:i({id:"MainTest.Monday"}),dataIndex:"day1",key:"day1",render:t=>`${t.count} (${t.total})`},{title:i({id:"MainTest.Tuesday"}),dataIndex:"day2",key:"day2",render:t=>`${t.count} (${t.total})`},{title:i({id:"MainTest.Wednesday"}),dataIndex:"day3",key:"day3",render:t=>`${t.count} (${t.total})`},{title:i({id:"MainTest.Thursday"}),dataIndex:"day4",key:"day4",render:t=>`${t.count} (${t.total})`},{title:i({id:"MainTest.Friday"}),dataIndex:"day5",key:"day5",render:t=>`${t.count} (${t.total})`},{title:i({id:"MainTest.Saturday"}),dataIndex:"day6",key:"day6",render:t=>`${t.count} (${t.total})`}],s=[{title:i({id:"MainTest.kCal"}),dataIndex:"kcal",key:"kcal",render:t=>e("span",{children:`${t}`}),sorter:(t,n)=>t.kcal-n.kcal},{title:i({id:"MainTest.Monday"}),dataIndex:"day1",key:"day1",render:t=>{const n=Math.abs(t.error)<=10?"green":Math.abs(t.error)<=20?"orange":"red";return c(C,{color:n,children:[Math.round(t.kcal)," (",t.error>0?"+":"",Math.round(t.error),"%)"]})},sorter:(t,n)=>Math.abs(t.day1.error)-Math.abs(n.day1.error)},{title:i({id:"MainTest.Tuesday"}),dataIndex:"day2",key:"day2",render:t=>{const n=Math.abs(t.error)<=10?"green":Math.abs(t.error)<=20?"orange":"red";return c(C,{color:n,children:[Math.round(t.kcal)," (",t.error>0?"+":"",Math.round(t.error),"%)"]})},sorter:(t,n)=>Math.abs(t.day2.error)-Math.abs(n.day2.error)},{title:i({id:"MainTest.Wednesday"}),dataIndex:"day3",key:"day3",render:t=>{const n=Math.abs(t.error)<=10?"green":Math.abs(t.error)<=20?"orange":"red";return c(C,{color:n,children:[Math.round(t.kcal)," (",t.error>0?"+":"",Math.round(t.error),"%)"]})},sorter:(t,n)=>Math.abs(t.day3.error)-Math.abs(n.day3.error)},{title:i({id:"MainTest.Thursday"}),dataIndex:"day4",key:"day4",render:t=>{const n=Math.abs(t.error)<=10?"green":Math.abs(t.error)<=20?"orange":"red";return c(C,{color:n,children:[Math.round(t.kcal)," (",t.error>0?"+":"",Math.round(t.error),"%)"]})},sorter:(t,n)=>Math.abs(t.day4.error)-Math.abs(n.day4.error)},{title:i({id:"MainTest.Friday"}),dataIndex:"day5",key:"day5",render:t=>{const n=Math.abs(t.error)<=10?"green":Math.abs(t.error)<=20?"orange":"red";return c(C,{color:n,children:[Math.round(t.kcal)," (",t.error>0?"+":"",Math.round(t.error),"%)"]})},sorter:(t,n)=>Math.abs(t.day5.error)-Math.abs(n.day5.error)},{title:i({id:"MainTest.Saturday"}),dataIndex:"day6",key:"day6",render:t=>{const n=Math.abs(t.error)<=10?"green":Math.abs(t.error)<=20?"orange":"red";return c(C,{color:n,children:[Math.round(t.kcal)," (",t.error>0?"+":"",Math.round(t.error),"%)"]})},sorter:(t,n)=>Math.abs(t.day6.error)-Math.abs(n.day6.error)},{title:i({id:"MainTest.MAXJump"}),dataIndex:"maxJump",key:"maxJump",render:t=>{const n=Math.abs(t)<=100?"green":Math.abs(t)<=50?"orange":"red";return e(C,{color:n,children:Math.round(t)})},sorter:(t,n)=>t.maxJump-n.maxJump}];return a.length&&a[0].order&&(s.unshift({title:i({id:"MainTest.Order"}),dataIndex:"order",key:"order",render:t=>e(ee,{to:`/orders/${t.id}`,target:"_blank",children:t.name})}),s.push({title:i({id:"MainTest.MealsPerDay"}),dataIndex:"order",key:"mealsPerdAy",render:t=>t.mealsPerDay,sorter:(t,n)=>t.order.mealsPerDay-n.order.mealsPerDay})),e("div",{children:c(W,{title:i({id:"MainTest.cKalWeekTest"}),width:"100%",onClose:this.closeDrawer,open:l,bodyStyle:{paddingBottom:80},children:[Boolean(a.length)&&Boolean(a[0].order)&&c("div",{children:[e("h4",{children:i({id:"MainTest.SummaryStats"})}),e(L,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:d,dataSource:r,pagination:!1,rowKey:()=>Math.random()}),e("br",{}),e("h4",{children:i({id:"MainTest.ResultsByRealOrders"})})]}),e(L,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:s,dataSource:a,pagination:!1,rowKey:()=>Math.random()})]})})}})||I)||I;var A;let Te=F(A=_(A=class extends x.Component{constructor(l){super(l),this.closeDrawer=this.closeDrawer.bind(this)}closeDrawer(){const{onClose:l}=this.props;l()}render(){const{visible:l,data:a,intl:{formatMessage:r}}=this.props,i=["Завтрак","1 Перекус","Обед","2 Перекус","Ужин"],d=[{title:r({id:"TagTest.Meal"}),dataIndex:"meal",key:"meal",render:s=>e("span",{children:`${i[s]}`}),sorter:(s,t)=>s.meal-t.meal},{title:r({id:"TagTest.Tag"}),dataIndex:"tag",key:"tag",render:s=>s.ru,sorter:(s,t)=>s.tag.id-t.tag.id},{title:r({id:"TagTest.Tuesday"}),dataIndex:"amount",key:"day2",render:(s,t)=>{const n=s===t.count?"green":"red";return e(C,{color:n,children:`${t.count}/${s}`})}}];return e("div",{children:e(W,{title:r({id:"TagTest.TagWeekTest"}),width:"100%",onClose:this.closeDrawer,open:l,bodyStyle:{paddingBottom:80},children:e(L,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:d,dataSource:a,pagination:!1,rowKey:()=>Math.random()})})})}})||A)||A;var U,E;let fe=(U=$(({user:h})=>({user:h})),F(E=U(E=class extends x.Component{constructor(a){super(a);p(this,"state",{loading:!1,mainTestVisible:!1,tagTestVisible:!1,data:[],summary:[],tagTestData:[]});this.onCloseTest=this.onCloseTest.bind(this)}onCloseTest(){this.setState({mainTestVisible:!1,tagTestVisible:!1})}async startTest(a,r=5,i=!1){const{intl:{formatMessage:d}}=this.props;try{this.setState({loading:!0});const t=await le({weekTemplate:a,mealsPerDay:r,oneMealOneDish:i});if(t.status===200){const n=await t.json();u.success({message:d({id:"window.success"}),description:d({id:"TemplateDetail.TestFinished!"})}),this.setState({data:n.result,loading:!1,mainTestVisible:!0})}else u.error({message:d({id:"window.error"}),description:t.statusText,placement:"topLeft"}),this.setState({loading:!1})}catch(s){console.log("Failed:",s)}}async startUserTest(a,r=!1){const{intl:{formatMessage:i}}=this.props;try{this.setState({loading:!0}),ce({weekTemplate:a,oneMealOneDish:r}),u.success({message:i({id:"window.success"}),description:i({id:"TemplateDetail.TestRunning..."})}),this.setState({loading:!1})}catch(d){console.log("Failed:",d)}}async loadUserTest(a){const{intl:{formatMessage:r}}=this.props;try{this.setState({loading:!0});const i=await he(a);if(i.status===200){const d=await i.json();u.success({message:r({id:"window.success"}),description:r({id:"TemplateDetail.LoadFinished!"})}),this.setState({data:d.result,summary:d.summary,loading:!1,mainTestVisible:!0})}else u.error({message:r({id:"window.error"}),description:i.statusText,placement:"topLeft"}),this.setState({loading:!1})}catch(i){console.log("Failed:",i)}}async startTagTest(a){const{intl:{formatMessage:r}}=this.props;try{this.setState({loading:!0});const d=await me({weekTemplate:a});if(d.status===200){const s=await d.json();u.success({message:r({id:"window.success"}),description:r({id:"TemplateDetail.TestFinished!"})}),this.setState({tagTestData:s,loading:!1,tagTestVisible:!0})}else u.error({message:r({id:"window.error"}),description:d.statusText,placement:"topLeft"}),this.setState({loading:!1})}catch(i){console.log("Failed:",i)}}render(){const{template:a,edit:r,removeTemplate:i,user:d,intl:{formatMessage:s}}=this.props,{loading:t,mainTestVisible:n,data:f,tagTestData:b,tagTestVisible:m,summary:g}=this.state;return c("div",{children:[a.id&&c(O,{gutter:16,children:[c(y,{sm:24,md:14,children:[e("div",{style:{paddingBottom:"10px"},children:e(S,{title:e(o,{id:"main.monday"}),value:a.monday.name})}),e("div",{style:{paddingBottom:"10px"},children:e(S,{title:e(o,{id:"main.tuesday"}),value:a.tuesday.name})}),e("div",{style:{paddingBottom:"10px"},children:e(S,{title:e(o,{id:"main.wednesday"}),value:a.wednesday.name})}),e("div",{style:{paddingBottom:"10px"},children:e(S,{title:e(o,{id:"main.thursday"}),value:a.thursday.name})}),e("div",{style:{paddingBottom:"10px"},children:e(S,{title:e(o,{id:"main.friday"}),value:a.friday.name})}),e("div",{style:{paddingBottom:"10px"},children:e(S,{title:e(o,{id:"main.saturday"}),value:a.saturday.name})})]}),e(y,{sm:24,md:10,children:c("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:a.name})}),d.name!=="david"&&c("div",{style:{marginTop:"10px"},children:[e(T,{type:"primary",onClick:()=>r(a),style:{margin:"0 5px 5px 0"},children:e(o,{id:"window.edit"})}),e(J,{title:s({id:"TemplateDetail.AreYouSureDeleteThisTemplate?"}),onConfirm:async()=>i(a.id),okText:s({id:"window.yes"}),cancelText:s({id:"window.no"}),children:e(T,{type:"primary",danger:!0,children:e(o,{id:"window.delete"})})})]}),c("div",{style:{marginTop:"10px"},children:[e(T,{loading:t,type:"primary",onClick:async()=>{await this.startTest(a.id,5,!1)},style:{margin:"0 5px 5px 0"},children:s({id:"TemplateDetail.kCalTest(5Meals)"})}),e(T,{loading:t,type:"primary",onClick:async()=>{await this.startTest(a.id,3,!1)},style:{margin:"0 5px 5px 0"},children:s({id:"TemplateDetail.kCalTest(3Meals)"})}),e(T,{loading:t,type:"primary",onClick:async()=>{await this.startTest(a.id,2,!1)},style:{margin:"0 5px 5px 0"},children:s({id:"TemplateDetail.kCalTest(2Meals)"})}),e(T,{loading:t,type:"primary",onClick:async()=>{await this.startTagTest(a.id)},style:{margin:"0 5px 5px 0"},children:s({id:"TemplateDetail.TagTest"})}),e("br",{}),e(T,{loading:t,type:"primary",onClick:()=>{this.startUserTest(a.id)},style:{margin:"0 5px 5px 0"},children:s({id:"TemplateDetail.STARTREALTEST"})}),e(T,{loading:t,type:"primary",onClick:()=>{this.loadUserTest(a.id)},style:{margin:"0 5px 5px 0"},children:s({id:"TemplateDetail.LOADLASTREALTEST"})})]})]})})]}),!a.id&&e(te,{description:!1}),e(ye,{visible:n,data:f,onClose:this.onCloseTest,summary:g}),e(Te,{visible:m,data:b,onClose:this.onCloseTest})]})}})||E)||E);var K,v;const{Option:ge}=M;let qe=(K=$(({user:h})=>({user:h})),F(v=_(v=K(v=class extends x.Component{constructor(a){super(a);p(this,"state",{data:[],createTemplateFormVisible:!1,forEdit:{},selected:{id:""}});p(this,"showDrawerCreateTemplateForm",()=>{this.setState({createTemplateFormVisible:!0})});p(this,"editTemplateModal",a=>{this.setState({forEdit:a,createTemplateFormVisible:!0})});p(this,"selectTemplate",a=>{const{data:r}=this.state,i=r.find(d=>d.id===a);i&&this.setState({selected:i})});p(this,"onCloseCreateTemplateForm",()=>{this.setState({createTemplateFormVisible:!1,forEdit:{}})});this.updateTemplates=this.updateTemplates.bind(this),this.removeTemplate=this.removeTemplate.bind(this)}UNSAFE_componentWillMount(){j().then(async a=>{if(a.status===401){const{dispatch:r}=this.props;r({type:"user/SET_STATE",payload:{authorized:!1}});return}if(a.status===200){const r=await a.json(),i=r.length?r:[r];this.setState({data:i})}})}updateTemplates(){j().then(async a=>{if(a.status===401){const{dispatch:r}=this.props;r({type:"user/SET_STATE",payload:{authorized:!1}});return}if(a.status===200){const r=await a.json(),i=r.length?r:[r];let{selected:d}=this.state;if(!r.length)d=r;else if(d.id){const s=r.find(t=>t.id===d.id);d&&(d=s)}else d={};this.setState({data:i,forEdit:{},selected:d})}})}async removeTemplate(a){const{intl:{formatMessage:r}}=this.props,i=await ie(a);i.status===204?(u.success({message:r({id:"WeekTemplateMenu.Deleted"}),description:r({id:"WeekTemplateMenu.TemplateSuccessfullyDeleted"}),placement:"topRight"}),this.updateTemplates(),this.setState({selected:{}})):u.error({message:r({id:"window.error"}),description:i.statusText,placement:"topRight"})}render(){const{data:a,createTemplateFormVisible:r,forEdit:i,selected:d}=this.state,{user:s,intl:{formatMessage:t}}=this.props;return c(ae,{roles:["root","admin"],redirect:!0,to:"/main",children:[e(se,{title:t({id:"WeekTemplateMenu.WeekTemplatesMenu"})}),c("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:e(o,{id:"erp.weekTemplates"})})})}),c("div",{className:"card-body",children:[s.name!=="david"&&e(T,{type:"primary",onClick:this.showDrawerCreateTemplateForm,style:{marginBottom:"15px"},children:e(o,{id:"erp.newTemplate"})}),e(re,{defaultActiveKey:"1",type:"card",items:[{label:e(o,{id:"erp.searchView"}),key:"1",children:c(B,{spinning:!1,children:[e("center",{children:e(M,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:"Search...",filterOption:(n,f)=>f.props.children.toLowerCase().indexOf(n.toLowerCase())>=0,style:{width:"500px",marginBottom:"15px"},onChange:this.selectTemplate,children:a.map(n=>e(ge,{value:n.id,children:n.name},n.id))})}),e(fe,{template:d,edit:this.editTemplateModal,removeTemplate:this.removeTemplate})]})},{label:e(o,{id:"erp.allTemplates"}),key:"2",children:e(B,{spinning:!1,children:e(ue,{data:a,edit:this.editTemplateModal,removeTemplate:this.removeTemplate})})}]})]})]}),e(pe,{visible:r,onClose:this.onCloseCreateTemplateForm,data:a,forEdit:i,create:de,edit:ne,update:this.updateTemplates})]})}})||v)||v)||v);export{qe as default};
