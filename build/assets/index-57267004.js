var R=Object.defineProperty;var _=(o,c,t)=>c in o?R(o,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[c]=t;var u=(o,c,t)=>(_(o,typeof c!="symbol"?c+"":c,t),t);import{a1 as A,a2 as q,r as j,a3 as g,c_ as E,j as a,c as l,I as b,a5 as T,B as y,bd as M,be as N,c$ as S,c2 as P,d0 as Y,bf as x,aa as v,aJ as z,a8 as V,bg as $,d1 as O}from"./index-c20b5e8e.js";import{T as W}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as L}from"./index-67f4e7c4.js";/* empty css              */import{D as U}from"./index-1e692111.js";import{F as h}from"./index-a86cfb93.js";import{R as C,C as p}from"./row-58ed805b.js";import"./styleChecker-a7b568e2.js";var k;const{Option:H}=T;let J=A(k=class extends q.Component{constructor(t){super(t);u(this,"state",{name:"",countryIsoCode:"",email:"",phone:"",address:"",code:"",website:""});u(this,"formRef",j.createRef());u(this,"handleSave",()=>{const{intl:{formatMessage:t},currentBranch:r,update:e}=this.props,{name:m,address:i,email:n,countryIsoCode:s,phone:d,code:B,website:F}=this.state,I={name:m,address:i,email:n,phone:d,countryIsoCode:s,code:B,website:F};E(r.id,I).then(async w=>{w.status===200&&(this.closeDrawer(),g.success({message:t({id:"branch.Saved"}),description:t({id:"branch.Branch info successfully updated!"})}),e())})});this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this)}componentDidUpdate(t){const{editForm:r,currentBranch:e}=this.props;r&&t.editForm!==r&&this.formRef.current&&(this.formRef.current.setFieldsValue({name:e.name,countryIsoCode:e.countryIsoCode,email:e.email,phone:e.phone,address:e.address,code:e.code,website:e.website}),this.setState({name:e.name,countryIsoCode:e.countryIsoCode,email:e.email,phone:e.phone,address:e.address,code:e.code,website:e.website}))}onChangeField(t,r){t.target?t.target.type==="checkbox"?this.setState({[r]:t.target.checked}):this.setState({[r]:t.target.value}):this.setState({[r]:t})}async onFinish(){try{const{create:t,update:r,intl:{formatMessage:e}}=this.props;await this.formRef.current.validateFields();const{name:m,email:i,phone:n,address:s,countryIsoCode:d,code:B,website:F}=this.state,w=await t({name:m,email:i,phone:n,countryIsoCode:d,address:s,code:B,website:F});w.status===201?(this.closeDrawer(),g.success({message:e({id:"branch.Created"}),description:e({id:"branch.Branch successfully created!"})}),r()):w.status===409?g.error({message:e({id:"branch.Error name"}),description:e({id:"branch.Branch with current name already exist!"}),placement:"topLeft"}):g.error({message:e({id:"window.error"}),description:w.statusText,placement:"topLeft"})}catch(t){console.log("Failed:",t)}}closeDrawer(){const{onClose:t}=this.props;this.setState({name:"",address:"",countryIsoCode:"",email:"",phone:"",code:"",website:""}),this.formRef.current.resetFields(),t()}render(){var i;const{visible:t,editForm:r,intl:{formatMessage:e}}=this.props;let m=1080;return typeof window.innerWidth<"u"&&(m=window.innerWidth),a(U,{title:e(r?{id:"branch.Edit branch"}:{id:"branch.Create branch"}),width:m<768?"100%":"auto",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:l(h,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[l(C,{gutter:16,children:[a(p,{md:12,sm:24,children:a(h.Item,{label:e({id:"branch.name"}),name:"name",required:!0,rules:[{required:!0}],children:a(b,{placeholder:r?"":e({id:"branch.Please enter branch name"}),onChange:n=>this.onChangeField(n,"name")})})}),a(p,{md:12,sm:24,children:a(h.Item,{label:e({id:"branch.country"}),name:"countryIsoCode",required:!0,rules:[{required:!0}],children:a(T,{placeholder:r?"":e({id:"branch.Please select branch countryIsoCode"}),onChange:n=>this.onChangeField(n,"countryIsoCode"),children:(i=this.props.countries)==null?void 0:i.map(n=>a(H,{value:n.code,children:n.name},n.code))})})})]}),l(C,{gutter:16,children:[a(p,{md:12,sm:24,children:a(h.Item,{label:e({id:"branch.phone"}),name:"phone",required:!0,rules:[{required:!0}],children:a(b,{placeholder:r?"":e({id:"branch.Please enter branch phone"}),onChange:n=>this.onChangeField(n,"phone")})})}),a(p,{md:12,sm:24,children:a(h.Item,{label:e({id:"branch.email"}),name:"email",required:!0,rules:[{required:!0},{type:"email"}],children:a(b,{placeholder:r?"":e({id:"branch.Please enter branch email"}),onChange:n=>this.onChangeField(n,"email")})})})]}),a(C,{children:a(p,{md:24,sm:24,children:a(h.Item,{label:e({id:"branch.address"}),name:"address",required:!0,rules:[{required:!0}],children:a(b,{placeholder:r?"":e({id:"branch.Please enter branch address"}),onChange:n=>this.onChangeField(n,"address")})})})}),l(C,{gutter:16,children:[a(p,{md:12,sm:24,children:a(h.Item,{label:e({id:"branch.website"}),name:"website",required:!0,rules:[{required:!0}],children:a(b,{placeholder:r?"":e({id:"branch.Please enter branch website"}),onChange:n=>this.onChangeField(n,"website")})})}),a(p,{md:12,sm:24,children:a(h.Item,{label:e({id:"branch.code"}),name:"code",required:!0,rules:[{required:!0}],children:a(b,{placeholder:r?"":e({id:"branch.Please enter branch code"}),onChange:n=>this.onChangeField(n,"code")})})})]}),a("div",{className:"form-actions",children:l(h.Item,{children:[r?a(y,{style:{width:150},type:"primary",onClick:()=>this.handleSave(),className:"mr-3",children:e({id:"window.save"})}):a(y,{style:{width:150},type:"primary",htmlType:"submit",className:"mr-3",children:e({id:"window.create"})}),a(y,{onClick:this.closeDrawer,children:e({id:"window.cancel"})})]})})]})})}})||k;var D,f;let ie=(D=M(({user:o})=>({user:o})),A(f=N(f=D(f=class extends q.Component{constructor(t){super(t);u(this,"state",{branches:[],countries:[],loading:!0,createBranchFormVisible:!1,editForm:!1,currentBranch:{}});u(this,"showDrawerCreateBranchForm",()=>{this.setState({createBranchFormVisible:!0,editForm:!1})});u(this,"onCloseCreateBranchForm",()=>{this.setState({createBranchFormVisible:!1,editForm:!1})});u(this,"updateBranchInfo",t=>{this.setState({createBranchFormVisible:!0,editForm:!0,currentBranch:t})});this.deleteBranch=this.deleteBranch.bind(this),this.updateBranches=this.updateBranches.bind(this),this.updateBranchInfo=this.updateBranchInfo.bind(this)}UNSAFE_componentWillMount(){S().then(async t=>{if(t.status===401){const{dispatch:e}=this.props;e({type:"user/SET_STATE",payload:{authorized:!1}});return}const r=await t.json();this.setState({branches:r.result,loading:!1})}),P().then(async t=>{if(t.status===401){const{dispatch:e}=this.props;e({type:"user/SET_STATE",payload:{authorized:!1}});return}const r=await t.json();this.setState({countries:r.result,loading:!1})})}onChangeField(t,r){t.target?t.target.type==="checkbox"?this.setState({[r]:t.target.checked}):this.setState({[r]:t.target.value}):this.setState({[r]:t})}updateBranches(){this.setState({loading:!0}),S().then(async t=>{const r=await t.json();this.setState({branches:r.result})}).finally(()=>this.setState({loading:!1}))}async deleteBranch(t){const r=await Y(t);r.status===200?(x.success("User deleted!"),this.updateBranches()):x.error("Error: ",r.statusText)}render(){const{createBranchFormVisible:t,currentBranch:r,branches:e,countries:m}=this.state,{intl:{formatMessage:i}}=this.props,n=[{title:i({id:"window.name"}),dataIndex:"name",key:"name",render:s=>a("span",{children:` ${s}`})},{title:i({id:"window.id"}),dataIndex:"id",key:"id",render:s=>a("span",{children:s})},{title:i({id:"branch.code"}),dataIndex:"code",key:"code",render:s=>a("span",{children:s})},{title:i({id:"branch.country"}),dataIndex:"countryIsoCode",key:"countryIsoCode",render:s=>a("span",{children:s})},{title:i({id:"window.email"}),dataIndex:"email",key:"email",render:s=>a("span",{children:s||"-"})},{title:i({id:"window.phone"}),dataIndex:"phone",key:"phone",render:s=>a("span",{children:s||"-"})},{title:i({id:"window.address"}),dataIndex:"address",key:"address",render:s=>a("span",{children:s||"-"})},{title:i({id:"branch.Created date"}),dataIndex:"createdAt",key:"createdAt",render:s=>a("span",{children:v(s).format("DD-MM-YYYY, h:mm")})},{title:i({id:"branch.updatedAt"}),dataIndex:"updatedAt",key:"updatedAt",render:(s,d)=>a("span",{children:s!=null&&s.updatedAt&&(s!=null&&s.createdAt)&&s.updatedAt!==s.createdAt?v(d).format("DD-MM-YYYY, h:mm"):"-"})},{title:"Action",dataIndex:"id",key:"action",render:(s,d)=>l("span",{children:[a(y,{style:{marginRight:"15px"},onClick:()=>this.updateBranchInfo(d),size:"small",children:"Edit"}),a(L,{title:"Are you sure delete this user?",onConfirm:()=>this.deleteBranch(s),okText:"Yes",cancelText:"No",children:a(y,{type:"primary",danger:!0,icon:a(z,{}),size:"small",children:"Remove"})})]})}];return l(V,{roles:["root"],redirect:!0,to:"/main",children:[a($,{title:"Branches"}),l("div",{className:"card",children:[a("div",{className:"card-header",children:a("div",{className:"utils__title",children:a("strong",{children:i({id:"branch.Branches"})})})}),l("div",{className:"card-body",children:[a(y,{style:{marginBottom:"20px"},type:"primary",onClick:this.showDrawerCreateBranchForm,children:i({id:"branch.new branch"})}),a(W,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:n,dataSource:e,pagination:{position:"bottom",total:e.length,showTotal:(s,d)=>`${d[0]}-${d[1]} of ${s} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:e.length<10},loading:this.state.loading,rowKey:()=>Math.random()})]})]}),a(J,{visible:t,onClose:this.onCloseCreateBranchForm,create:O,update:this.updateBranches,editForm:this.state.editForm,currentBranch:r,countries:m})]})}})||f)||f)||f);export{ie as default};
