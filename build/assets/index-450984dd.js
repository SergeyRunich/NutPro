var ht=Object.defineProperty;var mt=(m,t,s)=>t in m?ht(m,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):m[t]=s;var ve=(m,t,s)=>(mt(m,typeof t!="symbol"?t+"":t,s),s);import{r as g,A as Ae,_ as ce,bd as ut,a1 as we,a2 as Fe,aa as b,a3 as y,c as r,j as e,a5 as re,I as te,B as N,a6 as Z,a8 as Ie,a4 as be,b0 as me,bl as u,aJ as pt,a as Ce,bo as Xe,aZ as ne,bp as he,bk as Ke,aX as qe,b2 as gt,cO as yt,u as He,bF as Me,T as ft,bQ as Ot,b as vt,cq as bt}from"./index-c20b5e8e.js";import{R as We}from"./index-48cd5627.js";import{T as et}from"./index-83b0f9b6.js";import{D as j}from"./index-98f1088d.js";import{C as De}from"./index-9edbcc8e.js";import{D as tt}from"./index-1e692111.js";import{F as x}from"./index-a86cfb93.js";import{R as D,C as c}from"./row-58ed805b.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{I as pe}from"./index-86d1917a.js";import{S as Ct}from"./index-06104a82.js";import{D as Se}from"./index-2f7554ca.js";import{i as Dt,g as wt,a as st}from"./order-d39acf71.js";import{g as Pt,a as xt}from"./pickupPoint-b7474fa9.js";import{w as kt,x as It,y as Mt,z as St,A as At,B as Tt,C as Nt,D as Et,E as Yt,F as Rt,G as Ft,H as Lt,i as _t,I as zt,k as $t,d as Bt,J as Vt,K as Kt,n as qt,L as jt,M as Ge,N as Ht,O as Wt}from"./order-d29e3517.js";import{S as Y}from"./index-297358d3.js";import{T as ge}from"./index-372ade24.js";import{T as Te}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as le}from"./index-67f4e7c4.js";import{E as Gt}from"./EditOutlined-c424161b.js";import{A as Ut}from"./index-81521736.js";import{g as Qt}from"./ingredientTags-97eb43e3.js";import{c as Jt,a as Zt}from"./payments-f194e0fa.js";import{a as Xt}from"./orderLog-3d88f3dc.js";import{T as ie}from"./Timeline-b7d37d0b.js";import{T as k}from"./index-8e340a60.js";import{c as es}from"./deliveryTools-db414b57.js";import{c as ts}from"./extraDays-07d16e13.js";import"./index-f21ef7a8.js";import"./padStart-17be0050.js";import"./_defineProperty-df2abab4.js";import"./styleChecker-a7b568e2.js";var ss={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};const rs=ss;var rt=function(t,s){return g.createElement(Ae,ce(ce({},t),{},{ref:s,icon:rs}))};rt.displayName="CreditCardOutlined";const as=g.forwardRef(rt);var is={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"};const ns=is;var at=function(t,s){return g.createElement(Ae,ce(ce({},t),{},{ref:s,icon:ns}))};at.displayName="MailOutlined";const Ve=g.forwardRef(at);var ds={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M788 705.9V192c0-8.8-7.2-16-16-16H602v-68.8c0-6-7-9.4-11.7-5.7L462.7 202.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V240h114v465.9c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c.1-49.2-31.7-91-75.9-106.1zM752 860a48.01 48.01 0 010-96 48.01 48.01 0 010 96zM384 212c0-61.8-50.2-112-112-112s-112 50.2-112 112c0 49.2 31.8 91 76 106.1V706c-44.2 15-76 56.9-76 106.1 0 61.8 50.2 112 112 112s112-50.2 112-112c0-49.2-31.8-91-76-106.1V318.1c44.2-15.1 76-56.9 76-106.1zm-160 0a48.01 48.01 0 0196 0 48.01 48.01 0 01-96 0zm96 600a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0z"}}]},name:"pull-request",theme:"outlined"};const ls=ds;var it=function(t,s){return g.createElement(Ae,ce(ce({},t),{},{ref:s,icon:ls}))};it.displayName="PullRequestOutlined";const cs=g.forwardRef(it);var os={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M468 128H160c-17.7 0-32 14.3-32 32v308c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V136c0-4.4-3.6-8-8-8zm-56 284H192V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210H136c-4.4 0-8 3.6-8 8v308c0 17.7 14.3 32 32 32h308c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zm-56 284H192V612h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm590-630H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V160c0-17.7-14.3-32-32-32zm-32 284H612V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210h-48c-4.4 0-8 3.6-8 8v134h-78V556c0-4.4-3.6-8-8-8H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h78v102c0 4.4 3.6 8 8 8h190c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zM746 832h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm142 0h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"qrcode",theme:"outlined"};const hs=os;var nt=function(t,s){return g.createElement(Ae,ce(ce({},t),{},{ref:s,icon:hs}))};nt.displayName="QrcodeOutlined";const ms=g.forwardRef(nt);var us={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M300 328a60 60 0 10120 0 60 60 0 10-120 0zM852 64H172c-17.7 0-32 14.3-32 32v660c0 17.7 14.3 32 32 32h680c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-32 660H204V128h616v596zM604 328a60 60 0 10120 0 60 60 0 10-120 0zm250.2 556H169.8c-16.5 0-29.8 14.3-29.8 32v36c0 4.4 3.3 8 7.4 8h729.1c4.1 0 7.4-3.6 7.4-8v-36c.1-17.7-13.2-32-29.7-32zM664 508H360c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"robot",theme:"outlined"};const ps=us;var dt=function(t,s){return g.createElement(Ae,ce(ce({},t),{},{ref:s,icon:ps}))};dt.displayName="RobotOutlined";const gs=g.forwardRef(dt);var Ue,Ye;const{Option:V}=re;let ys=(Ue=ut(({settings:m})=>({settings:m})),we(Ye=Ue(Ye=class extends Fe.Component{constructor(s){super(s);ve(this,"state",{status:"",diet:"",PAL:"",timestamp:0,size:"",length:0,promoCode:"",promoCode2:"",invoice:"",ignoredMealTypes:[],mealsPerDay:"",kitchenDescription:"",deliveryDescription:"",email:"",phone:"",address:"",kcal:0,prot:0,fat:0,carb:0,isAddDeliveryFee:!1,sales:"",customMenu:{meals:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],cf:[1,1,1,1,1,1,1,1,1,1,1],count:[1,1,1,1,1,1,1,1,1,1,1],isActive:!1},saladOnDinner:!1,customInvoiceName:"",acceptedTimestamp:0,pickupPoint:"",pickupPoints:[],deliveryRange:[17,22],modalVisible:!1,isPaid:void 0,orderChanges:{},refund:"none",moneybackDescription:"",salesList:[],exeptions:[],checkingIsAvailable:!1,isApprovalSent:!1,classMenu:"Normal"});ve(this,"formRef",g.createRef());ve(this,"checkIsAvailable",async()=>{this.setState({checkingIsAvailable:!0});const{endTimestamp:s,pickupPoints:n}=this.state,d=b().format("YYYY-MM-DD"),a=b(s).format("YYYY-MM-DD");for await(const h of n)xt(h.id,d,a).then(async o=>{if(o.status===200){const w=(await o.json()).result.map(I=>I.orders.length);h.currentValue=Math.max(...w),this.setState({pickupPoints:n})}});this.setState({checkingIsAvailable:!1})});ve(this,"handleChangeRefund",s=>{this.setState({refund:s.target.value})});this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.handleOk=this.handleOk.bind(this),this.handleCancel=this.handleCancel.bind(this)}componentDidMount(){var a;const{order:s}=this.props,{customMenu:n}=this.state,{currentBranch:d}=this.props.settings;s.customMenu.data.forEach(h=>{n.meals[h.meal]=!0,n.cf[h.meal]=h.coefficient,n.count[h.meal]=h.count,n.isActive=s.customMenu.isActive}),this.setState({status:s.status,diet:s.diet,PAL:s.PAL,timestamp:s.timestamp,size:s.size,length:s.length,promoCode:s.promoCode.active?s.promoCode.code:"",promoCode2:s.promoCode2.active?s.promoCode2.code:"",invoice:s.invoice||"",ignoredMealTypes:s.ignoredMealTypes,mealsPerDay:s.mealsPerDay,exeptions:s.exeptions,kitchenDescription:s.kitchenDescription,deliveryDescription:s.deliveryDescription,deliveryRange:s.deliveryRange,email:s.user.email,phone:s.user.phone,address:s.user.address,kcal:s.customParams.kcal,prot:s.customParams.prot,fat:s.customParams.fat,carb:s.customParams.carb,isAddDeliveryFee:s.isAddDeliveryFee,sales:s.sales.id,customMenu:n,saladOnDinner:s.saladOnDinner,customInvoiceName:s.customInvoiceName,acceptedTimestamp:s.acceptedTimestamp,pickupPoint:s.pickupPoint.id,classMenu:s.classMenu}),d&&Pt({branchId:d}).then(async h=>{if(h.status!==401){const o=await h.json();this.setState({pickupPoints:o.result})}}),kt().then(async h=>{var o,f,w;if(h.status!==401){const I=await h.json();this.setState({salesList:I.result}),(w=this.formRef.current)==null||w.setFieldsValue({sales:(f=(o=I.result)==null?void 0:o.find(S=>S.id===s.sales.id))==null?void 0:f.name})}}),(a=this.formRef.current)==null||a.setFieldsValue({status:s.status,diet:s.diet,size:s.size,length:s.length,mealsPerDay:s.mealsPerDay,PAL:s.PAL,timestamp:b.unix(s.timestamp),deliveryRange:s.deliveryRange,promoCode:s.promoCode.active?s.promoCode.code:"",promoCode2:s.promoCode2.active?s.promoCode2.code:"",invoice:s.invoice||"",acceptedTimestamp:b.unix(s.acceptedTimestamp),customInvoiceName:s.customInvoiceName,email:s.user.email,phone:s.user.phone,address:s.user.address,kitchenDescription:s.kitchenDescription,deliveryDescription:s.deliveryDescription,kcal:s.customParams.kcal,prot:s.customParams.prot,fat:s.customParams.fat,carb:s.customParams.carb,classMenu:s.classMenu})}onChangeField(s,n){n==="mealsPerDay"&&this.setState({ignoredMealTypes:[]}),s!==null&&s.target?s.target.type==="checkbox"?this.setState({[n]:s.target.checked}):this.setState({[n]:s.target.value}):this.setState({[n]:s})}onChangeCustomMenu(s,n,d=0){const{customMenu:a}=this.state;n==="isActive"?a[n]=s.target.checked:s!==null&&s.target?s.target.type==="checkbox"?a[n][d]=s.target.checked:a[n][d]=s.target.value:a[n][d]=s,this.setState({customMenu:a})}onChangeDate(s){s!==null&&this.setState({timestamp:s.utc().unix()})}onChangeAcceptedTimestamp(s){s!==null&&this.setState({acceptedTimestamp:s.utc().unix()})}async onFinish(){const{onCreate:s,update:n,order:d,intl:{formatMessage:a}}=this.props,{diet:h,status:o,PAL:f,size:w,length:I,promoCode:S,promoCode2:L,invoice:A,ignoredMealTypes:R,kcal:F,prot:M,fat:C,carb:_,mealsPerDay:p,timestamp:O,deliveryDescription:q,kitchenDescription:G,email:J,phone:X,address:H,isAddDeliveryFee:ae,sales:P,customMenu:$,saladOnDinner:E,customInvoiceName:l,acceptedTimestamp:i,pickupPoint:W,deliveryRange:U,exeptions:oe,classMenu:ue}=this.state;if(!$.isActive||$.isActive&&($.meals[0]||$.meals[1]||$.meals[2]||$.meals[3]||$.meals[4]))try{await this.formRef.current.validateFields();const K=d.promoCode.active?S!==d.promoCode.code:S.length>0,de=d.promoCode2.active?L!==d.promoCode2.code:L.length>0,fe=I!==d.length,B=R!==d.ignoredMealTypes,z=p!==d.mealsPerDay,se=F!==d.customParams.kcal,Le=M!==d.customParams.prot,_e=C!==d.customParams.fat,Pe=_!==d.customParams.carb,ze=K||de||fe||B||z||se||Le||_e||Pe,Ne={diet:h,status:o,PAL:f,size:w,length:I,promoCode:S,promoCode2:L,invoice:A,ignoredMealTypes:R,mealsPerDay:Number(p),timestamp:O,kcal:F,prot:M,fat:C,carb:_,deliveryDescription:q,kitchenDescription:G,email:J,phone:X,address:H,isAddDeliveryFee:ae,sales:P,customMenu:$,saladOnDinner:E,customInvoiceName:l,acceptedTimestamp:i,pickupPoint:W,deliveryRange:U,exeptions:oe,classMenu:ue},$e={promoCode:S,promoCode2:L,length:I,ignoredMealTypes:R,mealsPerDay:Number(p),kcal:F,prot:M,fat:C,carb:_};if((o==="accepted"||o==="waitingPayment")&&ze){const ee=await(await It({id:d.id,...$e})).json();if(this.setState({orderChanges:ee}),ee.isChangedPrice){this.setState({modalVisible:!0}),ee.isPaid?this.setState({isPaid:!0}):this.setState({isPaid:!1});return}}const xe=await s({id:d.id,...Ne});xe.status===202?(y.success({message:a({id:"Orders.Changed"}),description:a({id:"Orders.OrderSuccessfullyChanged!"})}),this.closeDrawer(),n()):y.error({message:a({id:"window.error"}),description:xe.statusText,placement:"topLeft"})}catch(K){console.log("Failed:",K)}else y.error({message:a({id:"Orders.CustomMenu"}),description:a({id:"Orders.WhenCustomMenu,need at last one custom meal selected!"}),placement:"topRight"})}async handleOk(){if(!this.state.isApprovalSent)try{this.setState({modalVisible:!1,isApprovalSent:!0});const{onCreate:s,update:n,order:d,intl:{formatMessage:a}}=this.props,{isPaid:h,orderChanges:o,refund:f,moneybackDescription:w,diet:I,status:S,PAL:L,size:A,length:R,promoCode:F,promoCode2:M,invoice:C,ignoredMealTypes:_,kcal:p,prot:O,fat:q,carb:G,mealsPerDay:J,timestamp:X,deliveryDescription:H,kitchenDescription:ae,email:P,phone:$,address:E,isAddDeliveryFee:l,sales:i,customMenu:W,saladOnDinner:U,customInvoiceName:oe,acceptedTimestamp:ue,pickupPoint:ye,deliveryRange:K,exeptions:de,classMenu:fe}=this.state,B={diet:I,status:S,PAL:L,size:A,length:R,promoCode:F,promoCode2:M,invoice:C,ignoredMealTypes:_,mealsPerDay:Number(J),timestamp:X,kcal:p,prot:O,fat:q,carb:G,deliveryDescription:H,kitchenDescription:ae,email:P,phone:$,address:E,isAddDeliveryFee:l,sales:i,customMenu:W,saladOnDinner:U,customInvoiceName:oe,acceptedTimestamp:ue,pickupPoint:ye,deliveryRange:K,exeptions:de,classMenu:fe};if(h&&o.data&&o.data.before.price>o.data.after.price&&f==="moneyback"){const z=await s({id:d.id,...B,refund:f,moneybackDescription:w});z.status===202?(y.success({message:a({id:"window.success"}),description:a({id:"Orders.OrderSuccessfullySentForApproval!"})}),this.closeDrawer(),n()):y.error({message:a({id:"window.error"}),description:z.statusText,placement:"topLeft"})}else if(h&&o.data&&o.data.before.price>o.data.after.price&&f==="credit"){const z=await s({id:d.id,...B,refund:f});z.status===202?(y.success({message:a({id:"Orders.Changed"}),description:a({id:"Orders.OrderSuccessfullySentForApproval!"})}),this.closeDrawer(),n()):y.error({message:a({id:"window.error"}),description:z.statusText,placement:"topLeft"})}else{const z=await s({id:d.id,...B});z.status===202?(y.success({message:a({id:"Orders.Changed"}),description:a({id:"Orders.OrderSuccessfullySentForApproval!"})}),this.closeDrawer(),n()):y.error({message:a({id:"window.error"}),description:z.statusText,placement:"topLeft"})}}catch(s){console.log("Failed:",s)}finally{this.setState({isApprovalSent:!1})}}handleCancel(){this.setState({modalVisible:!1})}closeDrawer(){const{onClose:s}=this.props;this.formRef.current.resetFields(),s()}render(){const{visible:s,order:n,tags:d,intl:{formatMessage:a}}=this.props,{diet:h,status:o,size:f,length:w,ignoredMealTypes:I,mealsPerDay:S,timestamp:L,isAddDeliveryFee:A,sales:R,customMenu:F,saladOnDinner:M,pickupPoint:C,pickupPoints:_,deliveryRange:p,orderChanges:O,refund:q,isPaid:G,moneybackDescription:J,salesList:X,exeptions:H,checkingIsAvailable:ae,isApprovalSent:P,classMenu:$}=this.state;let E=1080;typeof window.innerWidth<"u"&&(E=window.innerWidth);const l=()=>r("div",{children:[O.data.before.length!==O.data.after.length&&r("p",{style:{fontSize:"24px",textAlign:"center"},children:[e(j,{children:a({id:"Orders.Days"})}),`${O.data.before.length} → ${O.data.after.length}`]}),O.data.before.mealsPerDay!==O.data.after.mealsPerDay&&r("p",{style:{fontSize:"24px",textAlign:"center"},children:[e(j,{children:a({id:"Orders.Meals"})}),`${O.data.before.mealsPerDay} → ${O.data.after.mealsPerDay}`]}),O.data.before.params.energy!==O.data.after.params.energy&&r("p",{style:{fontSize:"24px",textAlign:"center"},children:[e(j,{children:a({id:"Orders.kcal"})}),`${O.data.before.params.energy} → ${O.data.after.params.energy}`]}),O.data.before.price!==O.data.after.price&&r("p",{style:{fontSize:"24px",textAlign:"center"},children:[e(j,{children:a({id:"Orders.Price"})}),`${O.data.before.price} Kč → ${O.data.after.price} Kč`]})]});return r("div",{children:[e(tt,{title:a({id:"Orders.EditOrder"}),width:E<768?"100%":"auto",onClose:this.closeDrawer,open:s,bodyStyle:{paddingBottom:80},children:r(x,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[r(D,{gutter:16,children:[e(c,{md:12,sm:24,children:e(x.Item,{name:"status",label:a({id:"Orders.Status"}),rules:[{required:!0,message:a({id:"Orders.PleaseChooseStatus"})}],children:e(re,{placeholder:"Diet",value:o,disabled:o!=="incomplete",onChange:i=>this.onChangeField(i,"status"),children:e(V,{value:"new",children:a({id:"Orders.New"})},"new")})})}),e(c,{md:12,sm:24,children:e(x.Item,{name:"diet",label:a({id:"Orders.Diet"}),rules:[{required:!0,message:"Please choose diet"}],children:r(re,{placeholder:a({id:"Orders.Diet"}),value:h,onChange:i=>this.onChangeField(i,"diet"),children:[e(V,{value:"loose",children:a({id:"Orders.Loose"})},"loose"),e(V,{value:"gain",children:a({id:"Orders.Gain"})},"gain"),e(V,{value:"keep",children:a({id:"Orders.Keep"})},"keep")]})})})]}),r(D,{gutter:16,children:[e(c,{md:12,sm:24,children:e(x.Item,{label:a({id:"Orders.Length"}),name:"length",rules:[{required:!0,type:"number"}],children:e(pe,{style:{width:"100%"},min:n.status==="accepted"&&n.minLength-1||1,max:365,placeholder:a({id:"Orders.Length"}),disabled:n.status==="rejected"||n.status==="canceled",onChange:i=>this.onChangeField(i,"length")})})}),e(c,{md:12,sm:24,children:e(x.Item,{name:"size",label:a({id:"Orders.Size"}),rules:[{required:!0,message:a({id:"Orders.PleaseChooseSize"})}],children:r(re,{placeholder:a({id:"Orders.Diet"}),value:f,onChange:i=>this.onChangeField(i,"size"),children:[e(V,{value:"short",children:a({id:"Orders.5Days"})},"short"),e(V,{value:"long",children:a({id:"Orders.6Days"})},"long")]})})})]}),r(D,{gutter:16,children:[e(c,{md:12,sm:24,children:e(x.Item,{label:a({id:"Orders.PAL"}),name:"PAL",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.PAL"}),onChange:i=>this.onChangeField(i,"PAL")})})}),e(c,{md:12,sm:24,children:e(x.Item,{name:"mealsPerDay",label:a({id:"Orders.MealPerDay"}),rules:[{required:!0,message:"Please select meals per day"}],children:r(re,{placeholder:a({id:"Orders.MealPerDay"}),value:S,onChange:i=>this.onChangeField(i,"mealsPerDay"),children:[e(V,{value:2,children:"2"},"2"),e(V,{value:3,children:"3"},"3"),e(V,{value:5,children:"5"},"5")]})})})]}),r(D,{gutter:16,children:[e(c,{md:8,sm:24,children:e(x.Item,{label:a({id:"Orders.Exceptions"}),children:e(re,{placeholder:a({id:"Orders.Exception tag"}),defaultValue:n.exeptions,mode:"multiple",value:H,onChange:i=>this.onChangeField(i,"exeptions"),children:d.map(i=>e(V,{disabled:H.length!==0&&H[0]!==i.id,value:i.id,children:i.title},i.id))})})}),e(c,{md:8,sm:24,children:e(x.Item,{label:"Menu type",children:r(re,{value:$,onChange:i=>this.onChangeField(i,"classMenu"),children:[e(V,{value:"Normal",children:"Default"},"Normal"),e(V,{value:"Vegetarian",children:"VEGE"},"Vegetarian")]})})})]}),r(D,{gutter:16,children:[e(c,{md:8,sm:24,children:e(x.Item,{label:a({id:"Orders.FirstDeliveryDate"}),name:"timestamp",rules:[{required:!0}],children:e(Se,{style:{width:"100%"},format:"DD.MM.YYYY",placeholder:a({id:"window.date"}),disabledDate:i=>i<b()||i.day()===0,disabled:!Dt(L)&&o!=="new"&&n.source!=="web",onChange:i=>this.onChangeDate(i)})})}),e(c,{md:8,sm:24,children:e(x.Item,{label:a({id:"Orders.LastDeliveryDate"}),children:e(Se,{style:{width:"100%"},format:"DD.MM.YYYY",placeholder:a({id:"window.date"}),disabled:!0,value:L&&w&&f?b.unix(wt(L,Number(w),f,n.pauses,n.additionalDays,n.removedDays)):0})})}),e(c,{md:8,sm:24,children:r(x.Item,{label:a({id:"Orders.DeliveryTime"}),name:"deliveryRange",children:[e(Ct,{range:!0,max:22,min:17,formatter:i=>`${i}:00`,defaultValue:p,onChange:i=>this.onChangeField(i,"deliveryRange")}),r("span",{children:[a({id:"Orders.Time:SPACE"})," ",p[0],":00-",p[1],":00"]})]})})]}),e(D,{gutter:16,children:r(c,{md:24,sm:24,children:[e(x.Item,{label:a({id:"Orders.Promocode"}),name:"promoCode",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.Promocode"}),onChange:i=>this.onChangeField(i,"promoCode")})}),e(x.Item,{label:a({id:"Orders.Promocode"}),name:"promoCode2",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.Promocode"}),onChange:i=>this.onChangeField(i,"promoCode2")})})]})}),e(D,{gutter:16,children:e(c,{md:24,sm:24,children:e(x.Item,{label:a({id:"Orders.Invoice"}),name:"invoice",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.Invoice"}),onChange:i=>this.onChangeField(i,"invoice")})})})}),r(D,{gutter:16,children:[e(c,{md:12,sm:24,children:e(x.Item,{label:a({id:"Orders.DateOfAcceptance"}),name:"acceptedTimestamp",children:e(Se,{style:{width:"100%"},format:"DD.MM.YYYY",placeholder:a({id:"window.date"}),disabled:o==="new"||o==="canceled",onChange:i=>this.onChangeAcceptedTimestamp(i)})})}),e(c,{md:12,sm:24,children:e(x.Item,{label:a({id:"Orders.CustomInvoiceName(s.r.o)"}),name:"customInvoiceName",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.CustomInvoiceName"}),onChange:i=>this.onChangeField(i,"customInvoiceName")})})})]}),e(D,{gutter:16,children:e(c,{md:24,sm:24,children:e(x.Item,{label:a({id:"Orders.IgnoredMeals"}),children:r(re,{placeholder:a({id:"Orders.SkippedMeals"}),mode:"tags",disabled:S!==5,value:I,onChange:i=>this.onChangeField(i,"ignoredMealTypes"),children:[e(V,{disabled:I.length!==0&&I[0]!=="Breakfast",value:"Breakfast",children:a({id:"Orders.Breakfast"})},"Breakfast"),e(V,{disabled:I.length!==0&&I[0]!=="1. Lunch",value:"1. Lunch",children:a({id:"Orders.1.Lunch"})},"1. Lunch"),e(V,{disabled:I.length!==0&&I[0]!=="Dinner",value:"Dinner",children:a({id:"Orders.Dinner"})},"Dinner"),e(V,{disabled:I.length!==0&&I[0]!=="2. Lunch",value:"2. Lunch",children:a({id:"Orders.2.Lunch"})},"2. Lunch"),e(V,{disabled:I.length!==0&&I[0]!=="Supper",value:"Supper",children:a({id:"Orders.Supper"})},"Supper")]})})})}),r(D,{gutter:16,children:[e(c,{md:12,sm:24,children:e(x.Item,{label:a({id:"window.email"}),name:"email",rules:[{required:!0,type:"email",message:a({id:"Orders.PleaseEnterEmail!"})}],children:e(te,{style:{width:"100%"},placeholder:a({id:"window.email"}),onChange:i=>this.onChangeField(i,"email")})})}),e(c,{md:12,sm:24,children:e(x.Item,{label:a({id:"window.phone"}),name:"phone",children:e(te,{style:{width:"100%"},placeholder:a({id:"window.phone"}),onChange:i=>this.onChangeField(i,"phone")})})})]}),e(D,{gutter:16,children:e(c,{md:16,sm:16,children:e(x.Item,{label:a({id:"window.address"}),name:"address",children:e(te,{style:{width:"100%"},placeholder:a({id:"window.address"}),onChange:i=>this.onChangeField(i,"address")})})})}),e(D,{gutter:24,children:e(c,{md:24,sm:24,children:r(x.Item,{label:a({id:"Orders.Pick-upPoint"}),children:[r(re,{style:{width:"50%"},placeholder:a({id:"Orders.Point"}),value:C,onChange:i=>this.onChangeField(i,"pickupPoint"),children:[e(V,{value:"",children:a({id:"Orders.None"})},Math.random()),_.map(i=>r(V,{value:i.id,disabled:i.currentValue!==void 0?i.currentValue>=i.orderCapacity:!1,children:[`${i.name}`," ",`${i.currentValue!==void 0?i.currentValue:"-"} / ${i.orderCapacity}`]},Math.random()))]}),e("span",{children:e(N,{loading:ae,style:{marginLeft:"15px"},onClick:this.checkIsAvailable,type:"primary",children:a({id:"Orders.check"})})})]})})}),e(D,{gutter:16,children:e(c,{md:24,sm:24,children:e(x.Item,{label:a({id:"Orders.KitchenComment"}),name:"kitchenDescription",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.KitchenComment"}),onChange:i=>this.onChangeField(i,"kitchenDescription")})})})}),e(D,{gutter:16,children:e(c,{md:24,sm:24,children:e(x.Item,{label:a({id:"Orders.DeliveryComment"}),name:"deliveryDescription",children:e(te,{style:{width:"100%"},placeholder:a({id:"Orders.DeliveryComment"}),onChange:i=>this.onChangeField(i,"deliveryDescription")})})})}),r(D,{gutter:16,children:[e(c,{md:6,sm:24,children:e(x.Item,{label:a({id:"Orders.kCal"}),name:"kcal",children:e(pe,{style:{width:"100%"},min:500,placeholder:a({id:"Orders.kCal"}),onChange:i=>this.onChangeField(i,"kcal")})})}),e(c,{md:6,sm:24,children:e(x.Item,{label:a({id:"Orders.Prot"}),name:"prot",children:e(pe,{style:{width:"100%"},min:15,placeholder:a({id:"Orders.Prot"}),onChange:i=>this.onChangeField(i,"prot")})})}),e(c,{md:6,sm:24,children:e(x.Item,{label:a({id:"Orders.Fat"}),name:"fat",children:e(pe,{style:{width:"100%"},min:15,placeholder:a({id:"Orders.Fat"}),onChange:i=>this.onChangeField(i,"fat")})})}),e(c,{md:6,sm:24,children:e(x.Item,{label:a({id:"Orders.Carb"}),name:"carb",children:e(pe,{style:{width:"100%"},min:15,placeholder:a({id:"Orders.Carb"}),onChange:i=>this.onChangeField(i,"carb")})})})]}),r(D,{gutter:16,children:[e(c,{md:6,sm:24,children:e(x.Item,{name:"addd",children:e(Z,{checked:A,onChange:i=>this.onChangeField(i,"isAddDeliveryFee"),disabled:n.onApproveDeliveryFee||n.status!=="new"&&n.status!=="fromWeb",children:a({id:"Orders.DeliveryFee"})})})}),e(c,{md:6,sm:24,children:e(x.Item,{name:"addd2",children:e(Z,{checked:M,onChange:i=>this.onChangeField(i,"saladOnDinner"),children:a({id:"Orders.SaladOnDinner"})})})}),e(c,{md:12,sm:24,children:e(x.Item,{name:"sales",label:a({id:"Orders.Sales"}),children:e(re,{placeholder:a({id:"Orders.Sales"}),value:R,onChange:i=>this.onChangeField(i,"sales"),children:X&&X.map(i=>e(V,{value:i.id,children:i.name},i.id))})})})]}),e("hr",{}),e(Ie,{roles:["root"],children:e(D,{gutter:16,children:e(c,{md:24,sm:24,children:e(x.Item,{children:e(Z,{checked:F.isActive,onChange:i=>this.onChangeCustomMenu(i,"isActive",0),children:a({id:"Orders.CustomMenuIsActive"})})})})})}),r(D,{gutter:16,children:[e(c,{md:4,sm:24,children:e(x.Item,{children:e(Z,{checked:F.meals[0],onChange:i=>this.onChangeCustomMenu(i,"meals",0),children:a({id:"Orders.Breakfast"})})})}),e(c,{md:4,sm:24,children:e(x.Item,{children:e(Z,{checked:F.meals[1],onChange:i=>this.onChangeCustomMenu(i,"meals",1),children:a({id:"Orders.1Snack"})})})}),e(c,{md:4,sm:24,children:e(x.Item,{children:e(Z,{checked:F.meals[2],onChange:i=>this.onChangeCustomMenu(i,"meals",2),children:a({id:"Orders.Lunch"})})})}),e(c,{md:4,sm:24,children:e(x.Item,{children:e(Z,{checked:F.meals[3],onChange:i=>this.onChangeCustomMenu(i,"meals",3),children:a({id:"Orders.2Snack"})})})}),e(c,{md:4,sm:24,children:e(x.Item,{children:e(Z,{checked:F.meals[4],disabled:F.meals[10],onChange:i=>this.onChangeCustomMenu(i,"meals",4),children:a({id:"Orders.Dinner"})})})}),e(c,{md:4,sm:24,children:e(x.Item,{children:e(Z,{checked:F.meals[10],disabled:F.meals[4],onChange:i=>this.onChangeCustomMenu(i,"meals",10),children:a({id:"Orders.Salad"})})})})]}),e(D,{gutter:16,children:[0,1,2,3,4,10].map(i=>e(c,{md:4,sm:24,children:e(x.Item,{children:r(re,{placeholder:a({id:"Orders.Cf"}),disabled:!F.meals[i],value:F.cf[i],onChange:W=>this.onChangeCustomMenu(W,"cf",i),children:[e(V,{value:0,children:a({id:"Orders.Auto"})},Math.random()),e(V,{value:1,children:"1"},Math.random()),e(V,{value:1.5,children:"1.5"},Math.random()),i!==1&&i!==3&&e(V,{value:2,children:"2"},Math.random())]})})},i))}),e(D,{gutter:16,children:[0,1,2,3,4,10].map(i=>e(c,{md:4,sm:24,children:e(x.Item,{children:e(pe,{min:1,max:100,disabled:!F.meals[i],placeholder:"Count",value:F.count[i],onChange:W=>this.onChangeCustomMenu(W,"count",i)})})},i))}),e(x.Item,{children:r("div",{className:"form-actions",children:[e(N,{style:{width:150},type:"primary",htmlType:"submit",className:"mr-3",children:a({id:"window.save"})}),e(N,{onClick:this.closeDrawer,children:"Cancel"})]})})]})}),r(be,{title:a({id:"Orders.PriceWasChanged!"}),open:this.state.modalVisible,onOk:this.handleOk,okText:a({id:"Orders.SubmitForApproval"}),onCancel:this.handleCancel,okButtonProps:{disabled:G&&O.data&&O.data.before.price>O.data.after.price&&q!=="credit"&&q!=="moneyback"||q==="moneyback"&&!J},loading:P,children:[G&&O.data&&O.data.before.price<O.data.after.price?r("div",{children:[l(),e(j,{children:a({id:"Orders.Description"})}),r("p",{children:["The new price is ",e("b",{children:"greater"})," than the old price. The existing invoice has been"," ",e("b",{children:"paid"}),". An additional invoice will be issued for the amount of:"," ",O.data.after.price-O.data.before.price," Kč"]})]}):"",G&&O.data&&O.data.before.price>O.data.after.price?r("div",{children:[l(),e(j,{children:a({id:"Orders.Description"})}),r("p",{children:["The new price is less than the old price. The existing invoice already paid.",e("br",{}),"Тhe difference in price is"," ",r("b",{children:[O.data.before.price-O.data.after.price," Kč"]}),".",e("br",{}),e("br",{}),e("center",{children:e("b",{children:"Specify the method of refund"})})]}),r("center",{children:[r(me.Group,{value:q,onChange:this.handleChangeRefund,size:"default",children:[e(me.Button,{value:"credit",children:"Deposit to credit balance"}),e(me.Button,{value:"moneyback",children:"Request a refund"})]},"refund"),q==="credit"?r("span",{children:[e("br",{}),e("br",{}),e("b",{style:{fontSize:"14px"},children:"The difference in cost will be transferred to customer credit balance!"})]}):"",q==="moneyback"?r("span",{children:[e("br",{}),e("br",{}),e("b",{children:"Please enter account number for refund"}),e("br",{}),e(te,{style:{width:"100%"},placeholder:"account number",onChange:i=>this.onChangeField(i,"moneybackDescription")})]}):""]})]}):"",!this.state.isPaid&&this.state.orderChanges.data&&r("div",{children:[l(),r("span",{children:["The new price is",this.state.orderChanges.data.before.price<this.state.orderChanges.data.after.price?" more ":" less ","than the old price. The existing invoice has ",e("b",{children:"NOT been paid yet"}),". The current invoice for the amount ",this.state.orderChanges.data.before.price," Kč will be canceled. A new invoice will be created for the amount"," ",this.state.orderChanges.data.after.price," Kč"]})]})]})]})}})||Ye)||Ye);const fs=({pauses:m,onDelete:t,editMode:s})=>{const n=[{title:e(u,{id:"window.date"}),dataIndex:"timestamp",key:Math.random(),render:(d,a)=>e("span",{children:`${b.unix(parseInt(a.id.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`})},{title:e(u,{id:"Orders.StartDate"}),dataIndex:"start",key:Math.random(),render:d=>e("span",{children:` ${b.unix(d).format("DD.MM.YYYY")}`})},{title:e(u,{id:"Orders.EndDate"}),dataIndex:"end",key:Math.random(),render:d=>e("span",{children:` ${b.unix(d).format("DD.MM.YYYY")}`})},{title:"-----",dataIndex:"id",key:Math.random(),render:(d,a)=>r("span",{children:[e(N,{style:{marginRight:"10px"},onClick:()=>s(a),icon:e(Gt,{}),size:"small",type:"primary",disabled:b.utc()>b.unix(a.end).subtract(2,"days"),children:e(u,{id:"window.edit"})}),e(le,{title:e(u,{id:"Orders.AreYouSureDeleteThisPause?"}),onConfirm:()=>t(d),okText:e(u,{id:"window.yes"}),cancelText:e(u,{id:"window.no"}),disabled:b.utc()>b.unix(a.start).subtract(1,"days")||m[m.length-1].id!==d,children:e(N,{icon:e(pt,{}),size:"small",danger:!0,disabled:b.utc()>b.unix(a.start).subtract(1,"days")||m[m.length-1].id!==d,children:e(u,{id:"window.remove"})})})]})}];return e("div",{children:e(Te,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:n,dataSource:m,rowKey:()=>Math.random()})})},Os=we(fs),vs=({visible:m,onSave:t,onCancel:s,editData:n})=>{const[d,a]=g.useState(null),h=Ce(),o=f=>{a(f.utc().startOf("day").unix())};return e(be,{open:m,title:"Update pause (only end date)",okText:"Save",width:300,cancelText:"Cancel",onCancel:()=>{s(),a(null)},onOk:()=>{t(n.id,d),a(null)},children:e(D,{gutter:16,children:r(c,{sm:24,lg:24,children:[e("small",{children:h.formatMessage({id:"Orders.NewEndDate"})}),e(Se,{style:{width:"100%"},format:"DD.MM.YYYY",placeholder:"Date",value:d?b.unix(d):null,disabledDate:f=>f&&f<b().add(1,"days")||f&&!n.isLast&&f>=b.unix(n.end)||f.day()!==1&&f.day()!==3&&f.day()!==5,onChange:o})]})})})};b.updateLocale("en",{week:{dow:1}});const bs=({visible:m,orderDays:t,order:s,update:n,onClose:d})=>{const[a,h]=g.useState(null),[o,f]=g.useState(null),[w,I]=g.useState(!1),[S,L]=g.useState(1),[A,R]=g.useState(!1),[F,M]=g.useState({id:"",currentEndTimestamp:0,isLast:!1}),{formatMessage:C}=Ce();let _=null;a!==null&&o!==null&&(_=Math.abs(b(a).diff(o,"days")));const p=P=>a&&o?P&&P!==a&&P!==o:P&&P<b().add(1,"days")||P.day()!==1&&P.day()!==3&&P.day()!==5,O=async()=>{try{const P=await Mt({id:s.id,start:a.unix(),end:o.unix(),isSendEmail:w});P.status===202?(y.success({message:C({id:"window.success"}),description:C({id:"Orders.PauseSuccessfullyCreated!"})}),H(),n()):y.error({message:C({id:"window.error"}),description:P.statusText})}catch(P){y.error({message:C({id:"window.error"}),description:P,placement:"topLeft"})}},q=async(P,$)=>{if(P)try{const E=await St({id:P,end:$});E.status===202?(y.success({message:C({id:"window.success"}),description:C({id:"Orders.PauseSuccessfullyUpdated!"})}),H(),n(),J({})):y.error({message:C({id:"window.error"}),description:E.statusText})}catch(E){y.error({message:C({id:"window.error"}),description:E,placement:"topLeft"})}},G=async P=>{try{const $=await At(P);$.status===204?(y.success({message:C({id:"window.success"}),description:C({id:"Orders.PauseSuccessfullyRemoved!"})}),n()):y.error({message:C({id:"window.error"}),description:$.statusText})}catch($){y.error({message:C({id:"window.error"}),description:$,placement:"topLeft"})}},J=P=>{if(m){const $=s.pauses.length===1||s.pauses.findIndex(E=>E.id===P.id)===s.pauses.length-1;M({id:P.id,end:P.end,isLast:$}),R(!0)}else M({id:"",end:0,isLast:!1}),R(!1)},X=P=>{if(S===1)h(P.utc().startOf("day")),f(null),L(2);else{if(P<=a-2)return;f(P.utc().startOf("day")),L(1)}},H=()=>{h(null),f(null),L(1)},ae=()=>{H(),d()};return r(tt,{title:`Pauses | User: ${s.user?s.user.name:"-"}, Order: ${s.id}`,width:"100%",onClose:ae,open:m,bodyStyle:{paddingBottom:80},children:[r(D,{gutter:16,children:[r(c,{xl:12,children:[e(ge.Title,{level:3,style:{textAlign:"center"},children:C({id:"Orders.CurrentPauses"})}),r(D,{gutter:16,className:"mb-4",children:[e(c,{sm:24,lg:14,children:e(De,{highlightedDays:t})}),e(c,{sm:24,lg:10,children:e("div",{className:"card",children:r("div",{className:"card-body",children:[e(Y,{title:C({id:"Orders.FirstDeliveryDate"}),value:b.unix(s.orderDays[0]).format("ddd DD.MM.YYYY")}),e(Y,{title:C({id:"Orders.LastDeliveryDate"}),value:b.unix(s.orderDays.slice(-1)[0]).format("ddd DD.MM.YYYY")}),e(Y,{title:C({id:"Orders.Size"}),value:s.size==="short"?"5 days a week":"6 days a week"}),e(Y,{title:C({id:"Orders.Length"}),value:s.length,suffix:"days"})]})})})]}),e(ge.Title,{level:4,style:{textAlign:"center"},children:C({id:"Orders.PausesList"})}),e(Os,{pauses:s.pauses,onDelete:G,editMode:J})]}),r(c,{xl:12,children:[e(ge.Title,{level:3,style:{textAlign:"center"},children:C({id:"Orders.SetPause"})}),r(D,{gutter:16,className:"mb-4",children:[e(c,{sm:24,lg:14,children:e(De,{onSelectChange:X,onDisableDate:p,startPause:a,endPause:o,isActive:!0})}),r(c,{sm:24,lg:10,children:[e("div",{className:"card",children:e("div",{className:"card-body",children:e(Y,{title:C({id:"Orders.StartPause"}),value:a?a.format("ddd DD.MM.YYYY"):"---"})})}),e("div",{className:"card",children:r("div",{className:"card-body",children:[e(Y,{title:C({id:"Orders.EndPause"}),value:o?o.format("ddd DD.MM.YYYY"):"---"}),e("span",{className:"mb-1",children:e("small",{className:"text-muted",children:`Pause days: ${_||"---"}`})})]})})]})]}),e("div",{className:"card",children:r("div",{className:"card-body",style:{textAlign:"center"},children:[e("small",{children:C({id:"Orders.NotifyCustomer"})})," ",e(Xe,{checked:w,onChange:P=>I(P),style:{marginRight:"10px"}}),e(N,{style:{width:150},size:"large",onClick:O,type:"primary",disabled:!o||!a||a===o,className:"mr-3",children:C({id:"Orders.SetPause"})}),e(N,{style:{width:150},size:"large",onClick:H,type:"default",className:"mr-3",children:C({id:"Orders.Clear"})}),e(N,{onClick:ae,size:"large",type:"default",children:C({id:"Orders.Exit"})})]})})]})]}),e(vs,{visible:A,editData:F,onCancel:()=>R(!1),onSave:q})]})};b.updateLocale("en",{week:{dow:1}});const Cs=({order:m,update:t,visible:s,onClose:n})=>{const[d,a]=g.useState(""),[h,o]=g.useState(0),[f,w]=g.useState("LastDay"),[I,S]=g.useState(!1),L=async p=>{if(p){const O=p.clone(),q=m.orderDays.findIndex(G=>G===O.utc().startOf("day").unix())+1;a(p.format("DD-MM-YYYY")),o(q)}else a(""),o(0)},A=p=>{const O=p.clone(),q=O.utc().startOf("day").unix()<=m.timestamp,G=!m.orderDays.includes(O.utc().startOf("day").unix()),J=p<=b(),X=p.day()!==2&&p.day()!==4&&p.day()!==5&&p.day()!==6;return q||X||J||G},R=async()=>{try{const p=await Tt(m.id,{newLength:h,isSendEmail:I});p.status===202?(y.success({message:"Success",description:"Order was successfully shorted!"}),F(),t(),M()):y.error({message:"Error",description:p.statusText})}catch(p){y.error({message:"Error",description:p,placement:"topLeft"})}},F=()=>{a(null),o(null)},M=()=>{F(),n()},_=st(m.timestamp,h,m.size,m.pauses,m.additionalDays,m.removedDays).map(p=>b.unix(p).format("DD-MM-YYYY"));return e("div",{children:r(be,{open:s,title:`Length editing | User: ${m.user?m.user.name:"-"}, Order: ${m.id}`,okButtonProps:{hidden:!0},cancelButtonProps:{hidden:!0},width:"720px",onCancel:M,children:[r(D,{gutter:16,children:[r(c,{sm:24,lg:10,children:[e(ge.Title,{level:4,style:{textAlign:"center"},children:e(u,{id:"Orders.CurrentDays"})}),e("div",{className:"card card--fullHeight",children:r("div",{className:"card-body",children:[e(Y,{title:"Last day",value:b.unix(m.orderDays[m.orderDays.length-1]).format("DD-MM-YYYY")}),e(Y,{title:"Current length",value:m.length,suffix:"days"})]})})]}),r(c,{sm:24,lg:14,children:[e(ge.Title,{level:4,style:{textAlign:"center"},children:e(u,{id:"Orders.Change"})}),e("div",{className:"card card--fullHeight",children:r("div",{className:"card-body",children:[r(D,{gutter:16,children:[e(c,{sm:24,lg:12,children:r(me.Group,{value:f,onChange:p=>w(p),children:[e(me.Button,{value:"lastDay",children:e(u,{id:"Orders.LastDay"})}),e(me.Button,{value:"length",children:e(u,{id:"Orders.Length"})})]})}),r(c,{sm:24,lg:12,children:[f==="lastDay"&&e(Se,{format:"DD-MM-YYYY",disabledDate:A,onChange:L}),f==="length"&&e(pe,{value:h,onChange:p=>o(p.target.value),min:b.unix(m.timestamp).diff(b().utc().startOf("day"),"days")})]})]}),e("br",{}),e(Y,{title:"Last day",value:d||_.length>0?_[_.length-1].format("DD-MM-YYYY"):"---"}),e(Y,{title:"New length",value:h||"---",suffix:"days"})]})})]})]}),r(D,{gutter:16,children:[r(c,{sm:24,lg:12,children:[e(ge.Title,{level:3,style:{textAlign:"center"},children:e(u,{id:"Orders.CurrentOrder"})}),e(De,{})]}),r(c,{sm:24,lg:12,children:[e(ge.Title,{level:3,style:{textAlign:"center"},children:e(u,{id:"Orders.OrderAfterChange"})}),e(De,{highlightedDays:_})]})]}),e("div",{className:"card",children:r("div",{className:"card-body",style:{textAlign:"center"},children:[h&&d&&r("p",{children:[e("b",{children:e(u,{id:"Orders.ATTENTION:"})})," ",e(u,{id:"Orders.TheOrderLengthWillBeChangedFrom"})," ",m.length," ",e(u,{id:"Orders.DaysTo"})," ",h," ",e(u,{id:"Orders.days"})," ",e(u,{id:"Orders.The"})," ",e("b",{children:e(u,{id:"Orders.INVOICE"})})," ",e(u,{id:"Orders.willAlsoBe"})," ",e("b",{children:e(u,{id:"Orders.CHANGED"})}),"!!!"]}),e("small",{children:e(u,{id:"Orders.NotifyCustomer"})})," ",e(Xe,{checked:I,onChange:p=>S(p.target.checked),style:{marginRight:"10px"}}),e(le,{title:e(u,{id:"Orders.EditLength?"}),onConfirm:R,okText:e(u,{id:"Orders.Change"}),disabled:!h&&!d,cancelText:e(u,{id:"window.cancel"}),children:e(N,{style:{width:150},size:"large",type:"primary",disabled:!h&&!d,className:"mr-3",children:e(u,{id:"Orders.ChangeLength"})})}),e(N,{onClick:M,size:"large",type:"default",children:e(u,{id:"Orders.Exit"})})]})})]})})},Ds=we(Cs);var Qe;b.updateLocale("en",{week:{dow:1}});let ws=we(Qe=class extends Fe.Component{constructor(s){super(s);ve(this,"state",{description:"Catering",unit:"ks"});this.closeDrawer=this.closeDrawer.bind(this),this.clear=this.clear.bind(this)}onChangeField(s,n){s!==null&&s.target?s.target.type==="checkbox"?this.setState({[n]:s.target.checked}):this.setState({[n]:s.target.value}):this.setState({[n]:s})}clear(){this.setState({description:"",unit:""})}closeDrawer(){const{onClose:s}=this.props;this.clear(),s()}render(){const{visible:s,order:n,accept:d,intl:{formatMessage:a}}=this.props,{description:h,unit:o}=this.state;return e("div",{children:e(be,{open:s,title:`'Accept order for company' ${n.user?n.user.name:"-"}`,okButtonProps:{hidden:!0},cancelButtonProps:{hidden:!0},footer:!1,width:"720px",onCancel:this.closeDrawer,children:r(D,{gutter:16,children:[e(c,{sm:24,lg:12,children:e("div",{className:"card",style:{margin:"10px"},children:r("div",{className:"card-body",style:{padding:"7px"},children:[e(ge.Title,{level:4,style:{textAlign:"center"},children:a({id:"Orders.InvoiceInformation"})}),e("b",{children:a({id:"Orders.Name:"})})," ",n.user?n.user.paymentData.companyName:"-"," ",e("br",{}),e("b",{children:a({id:"Orders.PaymentAddress:"})})," ",n.user?n.user.paymentData.address:"-"," ",e("br",{}),e("b",{children:a({id:"Orders.ZIP:"})})," ",n.user?n.user.paymentData.zip:"-"," ",e("br",{}),e("b",{children:a({id:"Orders.IČO:"})})," ",n.user?n.user.paymentData.regNumber:"-"," ",e("br",{}),e("b",{children:a({id:"Orders.DIČ:"})})," ",n.user?n.user.paymentData.vatNumber:"-"," ",e("br",{}),r("p",{style:{textAlign:"center",borderTop:"2px dotted",borderBottom:"2px dotted",padding:"7px"},children:[e("span",{style:{marginRight:"15px"},children:"1"}),e("span",{style:{marginRight:"15px"},children:o}),e("span",{children:h})]}),r("div",{style:{textAlign:"center"},children:[n.isAddDeliveryFee&&r(D,{gutter:16,style:{marginBottom:"15px"},children:[e(c,{sm:24,lg:12,children:e(Y,{title:a({id:"Orders.OrderPrice"}),suffix:"Kč",value:n.price})}),e(c,{sm:24,lg:12,children:e(Y,{title:a({id:"Orders.DeliveryFee"}),suffix:"Kč",value:n.isAddDeliveryFee?n.length*50:0})})]}),e(Y,{title:a({id:"Orders.TotalWithVAT"}),suffix:"Kč",value:n.price+(n.isAddDeliveryFee?n.length*50:0)})]})]})})}),r(c,{sm:24,lg:12,children:[e("small",{children:a({id:"Orders.Unit"})}),e(te,{value:o,onChange:f=>this.onChangeField(f,"unit")}),e("small",{children:a({id:"Orders.CustomDescription"})}),e(te,{value:h,onChange:f=>this.onChangeField(f,"description")}),e(Ut,{message:a({id:"Orders.BillingInfo"}),description:a({id:"Orders.The invoice will be issued to the name and address specified in this window. If the customers name is specified, and not the companys name, it must be changed."}),type:"info",showIcon:!0,style:{marginTop:"20px"}}),r("div",{style:{textAlign:"center",marginTop:"20px"},children:[e(le,{title:a({id:"Orders.AcceptOrderForCompany?"}),onConfirm:()=>d(o,h),okText:a({id:"window.accept"}),disabled:!1,cancelText:a({id:"window.cancel"}),children:e(N,{style:{width:150},size:"large",type:"primary",disabled:!1,className:"mr-3",children:a({id:"Orders.AcceptOrder"})})}),e(N,{onClick:this.closeDrawer,size:"large",type:"default",children:a({id:"window.cancel"})})]})]})]})})})}})||Qe;const Ps="_header_1hd8d_1",xs="_socialInfo_1hd8d_5",ks="_socialCounts_1hd8d_12",Is="_actions_1hd8d_19",Ms="_contentWrapper_1hd8d_37",Ss="_card_1hd8d_41",As="_wallItem_1hd8d_54",Ts="_wallAvatar_1hd8d_61",Ns="_wallContent_1hd8d_65",Es="_wallInnerContent_1hd8d_69",Ys="_wallComments_1hd8d_73",Rs="_messageImg_1hd8d_77",Fs="_descr_1hd8d_89",Ls="_price_1hd8d_93",_s="_priceBefore_1hd8d_99",zs="_sku_1hd8d_110",$s="_rating_1hd8d_117",Bs="_controls_1hd8d_123",Vs="_btn_1hd8d_123",Ks="_orderTag_1hd8d_132",qs="_extraDayBtn_1hd8d_136",T={header:Ps,socialInfo:xs,socialCounts:ks,actions:Is,contentWrapper:Ms,card:Ss,wallItem:As,wallAvatar:Ts,wallContent:Ns,wallInnerContent:Es,wallComments:Ys,messageImg:Rs,descr:Fs,price:Ls,priceBefore:_s,sku:zs,rating:$s,controls:Bs,btn:Vs,"btn-link":"_btn-link_1hd8d_127",orderTag:Ks,extraDayBtn:qs},js=({id:m,order:t})=>{console.log(t);const{formatMessage:s}=Ce(),n=t.currentPrice||{},d=t.acceptedPrice||{},a=[t.promoCode.active?t.promoCode:null,t.promoCode2.active?t.promoCode2:null].filter(Boolean),h=r(ie,{children:[r(ie.Item,{children:[s({id:"Orders.Original price per day: "}),`${n.perDay} Kč`]}),r(ie.Item,{children:[s({id:"Orders.Discount on skipped meals - "}),`${n.discountForSkipped} Kč`]}),r(ie.Item,{children:[s({id:"Orders.Promo code discount - "}),`${n.perDay-Math.round(n.total/t.length)-n.discountForSkipped} Kč`]}),r(ie.Item,{children:[s({id:"Orders.Delivery - "}),`${t.isAddDeliveryFee?50:0} Kč`]}),r(ie.Item,{color:"green",children:[s({id:"Orders.Total - "}),`${n.totalPerDay+(t.isAddDeliveryFee?50:0)} Kč`]})]}),o=r(ie,{children:[r(ie.Item,{children:[s({id:"Orders.Original price: "}),`${n.original} Kč`]}),r(ie.Item,{children:[s({id:"Orders.Discount on skipped meals - "}),`${n.discountForSkipped*t.length} Kč`]}),r(ie.Item,{children:[s({id:"Orders.Promo code discount - "}),`${n.discount} Kč`]}),r(ie.Item,{children:[s({id:"Orders.Delivery - "}),`${t.isAddDeliveryFee?t.length*50:0} Kč`]}),r(ie.Item,{color:"green",children:[s({id:"Orders.Total - "}),`${n.total+(t.isAddDeliveryFee?t.length*50:0)} Kč`]})]});async function f(){const S=await Nt(m);S.status===204?y.success({message:"Success",description:"Invoice successfully send!"}):y.error({message:"Error",description:S.statusText})}async function w(){const S=await Et(m);S.status===204?y.success({message:"Success",description:"Additional info about order successfully send!"}):y.error({message:"Error",description:S.statusText})}const I=r(ne,{children:[r(ne.Item,{onClick:f,children:[e(Ve,{})," ",s({id:"Orders.ResendInvoiceEmail"})]},"sendInvoiceEmailKey"),r(ne.Item,{onClick:w,children:[e(Ve,{})," ",s({id:"Orders.ResendAdditionalInfoEmail"})]},"sendAdditionalInfoEmailKey")]});return e(et,{defaultActiveKey:"1",items:[{label:s({id:"Orders.CURRENT"}),key:"1",children:r(he,{children:[r(D,{gutter:16,children:[e(c,{span:12,children:e(Y,{title:s({id:"Orders.PricePerDay"}),value:t.originalPrice/t.length,suffix:"Kč"})}),e(c,{span:12,children:e(Y,{title:s({id:"Orders.OriginalPrice"}),value:t.originalPrice,suffix:"Kč"})})]}),e(j,{}),r(D,{gutter:16,children:[e(c,{span:12,children:e(Ke,{content:h,title:s({id:"Orders.MoreDetailed"}),children:e("a",{children:e(Y,{title:s({id:"Orders.TotalForTheDay"}),value:n.totalPerDay+(t.isAddDeliveryFee?50:0),suffix:"Kč"})})})}),e(c,{span:12,children:e(Ke,{content:o,title:s({id:"Orders.MoreDetailed"}),children:e("a",{children:e(Y,{title:s({id:"Orders.TotalPrice"}),value:n.total+(t.isAddDeliveryFee?t.length*50:0),suffix:"Kč"})})})})]}),t.customPrice.status&&r("div",{children:[e(j,{}),e(D,{gutter:16,children:e(c,{span:12,children:e(Y,{title:s({id:"Orders.CustomPrice"}),value:t.customPrice.value,suffix:"Kč"})})})]})," ",a.length>0&&r("div",{children:[e(j,{}),a.map(S=>r(D,{gutter:16,children:[e(c,{span:12,children:e(Y,{title:s({id:"Orders.Promocode"}),value:S.code})}),e(c,{span:12,children:e(Y,{title:s({id:"Orders.Amount"}),value:S.amount,suffix:S.type==="fixedAmount"?"Kč":"%"})})]},S.id))]}),t.useCredit>0&&r("div",{children:[e(j,{}),e(D,{gutter:16,children:e(c,{span:12,children:e(Y,{title:s({id:"Orders.PaidFromCreditBalance"}),value:t.useCredit,suffix:"Kč"})})})]})]})},{label:s({id:"Orders.ACCEPTED"}),key:"2",children:r(he,{children:[r(D,{gutter:16,children:[e(c,{span:12,children:e(Y,{title:s({id:"Orders.PricePerDay"}),value:d.perDay,suffix:"Kč"})}),e(c,{span:12,children:e(Y,{title:s({id:"Orders.OriginalPrice"}),value:d.original,suffix:"Kč"})})]}),e(j,{}),r(D,{gutter:16,children:[e(c,{span:12,children:e("a",{children:e(Y,{title:s({id:"Orders.TotalForTheDay"}),value:d.totalPerDay+(d.isAddDeliveryFee?50:0)||0,suffix:"Kč"})})}),e(c,{span:12,children:e("a",{children:e(Y,{title:s({id:"Orders.TotalPrice"}),value:d.total+(d.isAddDeliveryFee?t.length*50:0)||0,suffix:"Kč"})})})]}),t.customPrice.status&&r("div",{children:[e(j,{}),e(D,{gutter:16,children:e(c,{span:24,children:e(Y,{title:s({id:"Orders.CustomPrice"}),value:t.customPrice.value,suffix:"Kč"})})})]}),t.customInvoiceName&&r("div",{children:[e(j,{}),e(D,{gutter:16,children:e(c,{span:24,children:e(Y,{title:s({id:"Orders.CustomInvoiceName"}),value:t.customInvoiceName})})})]}),t.invoice&&e(Ie,{roles:["root","admin","sales","salesDirector","finance","trainer"],children:r("div",{className:T.controls,children:[e(j,{}),r(N,{type:"primary",size:"large",href:t.invoice,target:"blank",children:[e(ms,{}),s({id:"Orders.Invoice"})]}),e(qe,{overlay:I,children:r(N,{size:"large",style:{float:"right"},children:[e(Ve,{}),"Emails",e(gt,{})]})})]})})]})}]})},Hs=({id:m,order:t})=>r("div",{className:`card card-body mb-4 ${T.socialInfo}`,children:[r("div",{children:[r("div",{children:[e(k,{color:"green",className:T.orderTag,children:t.kitchen.current},Math.random()),t.kitchen.current!==t.kitchen.last.name&&r(k,{color:"orange",className:T.orderTag,children:[t.kitchen.last.name," from ",t.kitchen.last.date]},Math.random()),t.user.language==="en"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.English"})},Math.random()),t.user.language==="de"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.German"})},Math.random())]}),r("h2",{children:[e("span",{className:"text-black mr-2",children:e("strong",{children:t.user.name})}),e("small",{className:"text-muted",children:t.user.inBodyId})]}),e("span",{className:"mb-1",children:r("small",{className:"text-muted",children:[e(u,{id:"Orders.Order ID: "}),`${m}`]})}),t.affiliateId&&e("p",{className:"mb-1",children:r("small",{className:"text-muted",children:[e(u,{id:"Orders.Affiliate ID: "}),`${t.affiliateId}`]})}),e("p",{className:"mb-1",children:r("small",{className:"text-muted",children:[e(u,{id:"Orders.Source: "}),`${t.source}`]})}),e("p",{className:"mb-1",children:r("small",{className:"text-muted",children:[e(u,{id:"Orders.PaymentProvider: "}),`${t.paymentProvider}`]})}),e("p",{className:"mb-1",children:r("small",{className:"text-muted",children:[e(u,{id:"Orders.Created: "}),`${b.unix(parseInt(m.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`]})}),r("div",{children:[t.status==="accepted"&&e(k,{color:"green",className:T.orderTag,children:e(u,{id:"Orders.ACCEPTED"})},Math.random()),t.status==="offer"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.OFFER"})},Math.random()),t.status==="new"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.NEW"})},Math.random()),t.status==="fromWeb"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.FROM WEB"})},Math.random()),t.status==="waitingPayment"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.WAITING FOR PAYMENT (FROM WEB)"})},Math.random()),t.status==="verification"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.VERIFICATION"})},Math.random()),t.onApproveDeliveryFee&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.VERIFICATION (delivery fee)"})},Math.random()),t.extraDays===-1&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.VERIFICATION (extra days)"})},Math.random()),t.status==="rejected"&&e(k,{color:"red",className:T.orderTag,children:e(u,{id:"Orders.REJECTED"})},Math.random()),t.status==="canceled"&&e(k,{color:"red",className:T.orderTag,children:e(u,{id:"Orders.CANCELED"})},Math.random()),t.status==="incomplete"&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.INCOMPLETE"})},Math.random()),t.isSplitPayment&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.SplitPayment"})},Math.random()),t.customMenu.isActive&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.CUSTOM MENU"})},Math.random()),t.invoiceStatus==="paid"&&t.paymentProvider!=="GoPay"&&e(k,{color:"green",className:T.orderTag,children:e(u,{id:"Orders.INVOICE PAID"})},Math.random()),t.invoiceStatus==="pending"&&t.paymentProvider!=="GoPay"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.PENDING"})},Math.random()),t.invoiceStatus==="open"&&t.paymentProvider!=="GoPay"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.INVOICE OPEN"})},Math.random()),t.invoiceStatus==="sent"&&t.paymentProvider!=="GoPay"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.INVOICE SENT"})},Math.random()),Boolean(!t.invoice)&&t.status==="accepted"&&t.paymentProvider!=="GoPay"&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.WITHOUT INVOICE"})},Math.random()),t.invoiceStatus==="accepted"&&t.paymentProvider==="GoPay"&&e(k,{color:"green",className:T.orderTag,children:e(u,{id:"Orders.INVOICE PAID"})},Math.random()),t.invoiceStatus==="pending"&&t.paymentProvider==="GoPay"&&e(k,{color:"red",className:T.orderTag,children:e(u,{id:"Orders.INVOICE UNPAID"})},Math.random()),t.invoiceStatus==="overdue"&&t.paymentProvider!=="GoPay"&&e(k,{color:"red",className:T.orderTag,children:e(u,{id:"Orders.INVOICE OVERDUE"})},Math.random()),t.invoiceStatus==="open"&&t.isModifiedPrice&&!t.isOnApprovalOfRecalculatedPrice&&e(k,{color:"red",className:T.orderTag,children:e(u,{id:"Orders.PRICE RECALCULATED"})},Math.random()),t.isOnApprovalOfRecalculatedPrice&&e(k,{color:"blue",className:T.orderTag,children:e(u,{id:"Orders.RECALCULATED PRICE ON APPROVAL"})},Math.random()),t.isOnApprovalWithoutInvoice&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.ON APPROVAL (WITHOUT INVOICE)"})},Math.random()),t.stage.code!==0&&e(k,{color:"green",className:T.orderTag,children:String(t.stage.text).toUpperCase()},Math.random()),t.b2bOrder.isActive&&e(k,{color:"orange",className:T.orderTag,children:e(u,{id:"Orders.B2B"})},Math.random())]})]}),r("div",{className:T.socialCounts,children:[r("div",{className:"text-center mr-3",children:[e("h2",{children:t.nutrients?Math.round(t.nutrients.kcal):"-"}),e("p",{className:"mb-0",children:e(u,{id:"Orders.kCal"})})]}),r("div",{className:"text-center mr-3",children:[e("h2",{children:t.nutrients?Math.round(t.nutrients.prot):"-"}),e("p",{className:"mb-0",children:e(u,{id:"Orders.Prot"})})]}),r("div",{className:"text-center mr-3",children:[e("h2",{children:t.nutrients?Math.round(t.nutrients.fat):"-"}),e("p",{className:"mb-0",children:e(u,{id:"Orders.Fat"})})]}),r("div",{className:"text-center",children:[e("h2",{children:t.nutrients?Math.round(t.nutrients.carb):"-"}),e("p",{className:"mb-0",children:e(u,{id:"Orders.Carb"})})]}),e("br",{}),e("div",{style:{marginLeft:"10px"},children:e(k,{color:"green",style:{fontSize:"32px",padding:"15px"},className:T.orderTag,children:t.sales.name||"-"},Math.random())})]})]});b.updateLocale("en",{week:{dow:1}});const Ws=({visible:m,isPaid:t,order:s,update:n,onClose:d})=>{const[a,h]=g.useState("none"),[o,f]=g.useState(""),{formatMessage:w}=Ce(),I=async()=>{try{const R=await Yt(s.id,{refund:a,moneyBackDescription:o});R.status===202?(y.success({message:w({id:"window.success"}),description:w({id:"Orders.RequestSuccessfullySent!"})}),S(),n(),L()):y.error({message:w({id:"window.error"}),description:R.statusText})}catch(R){y.error({message:w({id:"window.error"}),description:R,placement:"topLeft"})}},S=()=>{h(""),f("")},L=()=>{S(),d()},A=["fromWeb","new","incomplete"].includes(s.status)?"cancel":"approval";return e("div",{children:r(be,{open:m,title:w({id:"Orders.CompleteCancellationOfTheOrder"}),onOk:()=>I(),okText:w(A==="cancel"?{id:"Orders.Ok"}:{id:"Orders.SubmitForApproval"}),okButtonProps:{disabled:t&&a!=="credit"&&a!=="moneyback"||a==="moneyback"&&!o},width:"350px",onCancel:L,children:[t&&A==="approval"&&r("div",{children:[e("h3",{children:w({id:"Orders.InvoicePaid"})}),r("p",{children:[" ",w({id:"Orders.The order has not started yet. Invoice already paid. A refund will be made."})]}),e("br",{}),e("p",{children:e("center",{children:e("b",{children:w({id:"Orders.Specify the method of refund."})})})}),r("center",{children:[r(me.Group,{value:a,onChange:R=>h(R),size:"small",children:[e(me.Button,{value:"credit",children:w({id:"Orders.Deposit to credit balance"})}),e(me.Button,{value:"moneyback",children:w({id:"Orders.Request a refund"})})]},"refund"),a==="credit"?r("span",{children:[e("br",{}),e("br",{}),e("b",{style:{fontSize:"14px"},children:w({id:"Orders.Amount will be transferred to customer credit balance!"})})]}):"",a==="moneyback"?r("span",{children:[e("br",{}),e("br",{}),e("b",{children:w({id:"Orders.Please enter account number for refund"})}),e("br",{}),e(te,{style:{width:"100%"},placeholder:"Account number",value:o,onChange:R=>f(R.target.value)})]}):""]})]}),!t&&A==="approval"&&e("div",{children:r("span",{children:[e("h3",{children:w({id:"Orders.InvoiceUnpaid"})}),e("p",{children:w({id:"Orders.The order has not started yet. Invoice has not been paid. The current invoice will be cancelled."})})]})}),A==="cancel"&&e("div",{children:r("span",{children:[e("h3",{children:w({id:"Orders.NotAccepted"})}),e("p",{children:w({id:"Orders.The order is not accepted. The order will be marked as cancelled without approval."})})]})})]})})},Gs=({id:m,update:t})=>{const[s,n]=g.useState(!1),[d,a]=g.useState([]),[h,o]=g.useState(!1),f=async()=>{Rt(m).then(async A=>{A.status===200&&(t(),y.success({message:"Success",description:"The approval request was sent successfully!"}))}).catch(()=>{y.error({message:"Error",description:"The approval request was not sent!"})})},w=()=>{o(!1),Ft(m).then(async A=>{A.status===202&&(o(!0),t(),n(!1),y.success({message:"Success"}))}).catch(()=>{y.error({message:"Error"})})},I=()=>{Lt(m).then(async A=>{if(A.status===200){const{result:R}=await A.json();a(R),o(!0),y.success({message:"Success"})}}).catch(()=>{y.error({message:"Error"})})},S=()=>{o(!1),a([]),n(!1)},L=[{title:"Month",dataIndex:"month",key:"month",render:A=>e("span",{children:A})},{title:"Days",dataIndex:"days",key:"days",render:A=>e("span",{children:A})},{title:"Due",dataIndex:"due",key:"due",render:A=>r("span",{children:[A," days (",b().add(A,"days").format("DD.MM.YYYY"),")"]})},{title:"Amount",dataIndex:"amount",key:"amount",render:A=>r("span",{children:[A," Kč"]})}];return r(he,{children:[r(ne,{style:{padding:"0px"},children:[e(ne.Item,{onClick:f,children:"Without creating an invoice"},"without_invoice"),e(ne.Item,{onClick:()=>n(!0),children:"Split invoice"},"split_payments")]}),r(be,{open:s,title:"Select duration",okText:"Accept",onOk:w,onCancel:S,okButtonProps:{disabled:!h},children:[e(N,{type:"primary",onClick:I,children:"Calculate payments"}),e(j,{}),e(Te,{tableLayout:"auto",size:"small",columns:L,dataSource:d,rowKey:()=>Math.random()})]})]})},{Option:Re}=re,Us=({id:m,order:t,customMenu:s,showPauseDrawer:n,showAcceptCompanyModal:d,showDrawerEditOrder:a,update:h,getOrderPayments:o,isRequestApproval:f,tags:w,classMenu:I})=>{var xe;const[S,L]=g.useState(!1),[A,R]=g.useState(!1),[F,M]=g.useState(!1),[C,_]=g.useState([]),[p,O]=g.useState(!1),[q,G]=g.useState(!1),[,J]=g.useState(!1),[X,H]=g.useState(!1),[ae,P]=g.useState(!1),[$,E]=g.useState(""),{formatMessage:l}=Ce(),i=yt(),{currentBranch:W}=He(v=>v.settings),U=async()=>{L(!1),(await ts({orderId:t.id,days:C.length})).status===201&&(await h(),y.success({message:"Extra days added",description:"Extra days added"}))},oe=async()=>{H(!0);const v=await _t(m);v.status===202?(y.success({message:l({id:"window.success"}),description:"Regeneration successfully started!"}),H(!1)):(y.error({message:l({id:"window.error"}),description:v.statusText}),H(!1))},ue=async()=>{const v=await es({address:t.user.address,branchId:W});v.ok?(await v.json()).result.isPointInPolygon?y.success({message:"Included",description:"The address is included in the delivery area!"}):y.info({message:"Not included",description:"The address is not included in the delivery area"}):y.error({message:l({id:"window.error"}),description:v.statusText,placement:"topLeft"})},ye=async()=>{zt(m).then(async v=>{v.ok?(h(),y.success({message:l({id:"window.success"}),description:"Order status successfully changed!"})):v.status===402?(h(),y.info({message:"Payment required",description:"Order not paid!!"})):(O(!1),y.error({message:l({id:"window.error"}),description:v.statusText}))})},K=async(v,ee=!0)=>{O(!1);const Oe=await $t(v,m,ee);Oe.status===202?(h(),O(!1),v==="accepted"?y.success({message:l({id:"window.success"}),description:"Order successfully accepted!"}):v==="rejected"?y.success({message:l({id:"window.success"}),description:"Order successfully rejected!"}):y.success({message:l({id:"window.success"}),description:"Order status successfully changed!"})):(O(!1),y.error({message:l({id:"window.error"}),description:Oe.statusText}))},de=v=>{const Oe=[...t.orderDays.map(ot=>b.unix(ot))].pop(),Q=b(Oe).day(),ke=t.size==="long",Be=()=>{if(ke){if(Q<=5)return 1;if(Q===6)return 2;if(Q===7)return 1}else{if(Q<=4)return 1;if(Q===5)return 3;if(Q===6)return 2;if(Q===7)return 1}},lt=()=>{if(ke){if(Q<=4)return 2;if(Q===5||Q===6)return 3;if(Q===7)return 2}else{if(Q<=3)return 2;if(Q===4||Q===5)return 4;if(Q===6)return 3;if(Q===7)return 2}},je=b(Oe).add(Be(),"days"),ct=b(Oe).add(lt(),"days");let Ee;v===1?Ee=[je]:v===2?Ee=[je,ct]:Ee=[],_(Ee)},fe=async()=>{P(!1),Bt(m).then(async v=>{v.status===204?(J(!0),y.success({message:"Success",description:"Order was successfully deleted!"}),i.push("/orders")):y.error({message:"Error",description:"Order was not deleted!"})})},B=async()=>{G(!0),Vt({orderId:m}).then(async ee=>{if(ee.status===201){y.success({message:l({id:"window.success"}),description:"Order successfully prolonged!"});const Q=(await ee.json()).result.id,ke=window.location.href.split("/");ke.pop();const Be=`${ke.join("/")}/${Q}`;window.open(Be,"_blank")}else y.error({message:l({id:"window.error"}),description:"Failed to quick prolong"})}).finally(()=>G(!1))},z=async()=>{const v=await Kt(m);if(v.ok){const ee=await v.json();M(ee.isPaid),R(!0)}},se=(t==null?void 0:t.isOnApprovalOfRecalculatedPrice)||t.status==="canceled",Le=()=>{se||a()},_e=()=>{P(!1);const v=t.id;if(!v)throw new Error("Order ID doesn't exist");Jt(v).then(async ee=>{ee.status===201?(y.success({message:l({id:"window.success"}),description:l({id:"Payment.CreateSuccess"})}),o()):y.error({message:l({id:"window.error"}),description:l({id:"Payment.CreateError"})})})},{role:Pe}=He(v=>v.user),ze=()=>r(ne,{style:{padding:"0px"},disabled:se,children:[Pe!=="admin"&&e(ne.Item,{children:r(Me,{to:`/users/${t.user.id}`,children:[e("i",{className:"icmn-user mr-1"}),l({id:"Orders.ViewCustomer"})]})},"viewCustomerKey"),["root","sales","salesDirector","admin"].includes(Pe)&&e(ne.Item,{children:r(Me,{to:`/menu/${t.user.id}/${t.id}`,children:[e("i",{className:"icmn-list mr-1"}),l({id:"Orders.ViewMenu"})]})},"viewMenuKey"),Pe!=="admin"&&r(ne.Item,{onClick:()=>{P(!0),E("create")},children:[e(as,{})," ",l({id:"Payment.Create"})]},"createOrderPaymentKey"),(t.timestamp>b().unix()&&t.status!=="canceled"||t.status==="waitingPayment")&&r(ne.Item,{onClick:()=>z(),children:[e("i",{className:"icmn-blocked mr-1"}),l({id:"Orders.CancelOrder"})]},"cancelOrderKey"),(t.status==="new"||t.status==="fromWeb")&&r(ne.Item,{onClick:()=>{P(!0),E("remove")},children:[e("i",{className:"icmn-bin mr-1"}),l({id:"Orders.Remove"})]},"removeOrderKey")]});let Ne=t.extraDays>0?`${t.length} (+${t.extraDays})`:t.length;t.extraDays===-1&&(Ne=`${t.length} (+${t.orderDays.length-t.length})`);const $e=st(t.timestamp,t.length,t.size).map(v=>b.unix(Number(v)).format("DD-MM-YYYY"));return r("div",{className:"card",children:[e("div",{className:"card-body",children:r("div",{children:[e("div",{className:"row",children:r("div",{className:"col-xl-12",children:[r(D,{gutter:16,children:[e(c,{md:7,xs:12,children:e(Y,{title:l({id:"Orders.Start"}),value:b.unix(t.timestamp).format("DD.MM.YYYY")})}),e(c,{md:7,xs:12,children:e(Y,{title:l({id:"Orders.End"}),value:b.unix(t.orderDays.slice(-1)[0]).format("DD.MM.YYYY")})}),e(c,{md:5,xs:12,children:e(Y,{title:l({id:"Orders.Days"}),value:Ne})}),e(c,{md:5,xs:12,children:e(Y,{title:l({id:"Orders.Week"}),value:t.size})})]}),e(j,{}),r(D,{gutter:16,children:[r(c,{md:12,xs:24,children:[r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.Diet:SPACE"})}),e(k,{color:"blue",children:t.diet||"-"},Math.random())]}),r("p",{className:"mb-1",children:[e("b",{children:"Menu type: "}),e(k,{color:t.classMenu==="Normal"?"blue":"green",children:t.classMenu==="Normal"?"Default":"VEGE"},Math.random())]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.MealsPerDay:SPACE"})})," ",e(k,{color:"blue",children:t.mealsPerDay},Math.random()),t.saladOnDinner&&e(k,{color:"green",children:l({id:"Orders.SaladOnDinner"})},Math.random())]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.PAL:SPACE"})}),t.PAL||"-"]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.IgnoredMeals:SPACE"})}),t.ignoredMealTypes.map(v=>e(k,{color:"cyan",children:v},Math.random()))]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.KitchenDescription:SPACE"})}),t.kitchenDescription||"-"]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.Exceptions:SPACE"})}),((xe=t==null?void 0:t.exeptions)==null?void 0:xe.length)>0?w.filter(v=>t.exeptions.includes(v.id)).map(v=>e(k,{color:"orange",children:v.title},v.id)):"-"]})]}),r(c,{md:12,xs:24,children:[r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.Phone:SPACE"})}),t.user.phone]}),t.user.address&&!t.pickupPoint.id&&r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.Address:SPACE"})}),t.user.address,e(N,{style:{marginLeft:"20px"},onClick:ue,children:l({id:"Orders.CheckAddress:SPACE"})})]}),t.pickupPoint.id&&r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.Pick-upPoint:SPACE"})}),t.pickupPoint.name," - ",t.pickupPoint.address]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.Email:SPACE"})}),t.user.email]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.DeliveryDescription:SPACE"})}),t.deliveryDescription||"-"]}),r("p",{className:"mb-1",children:[e("b",{children:l({id:"Orders.DeliveryTime:SPACE"})}),t.deliveryRange?`${t.deliveryRange[0]}:00-${t.deliveryRange[1]}:00`:"-"]})]})]}),t.customMenu.isActive&&r(he,{children:[e(j,{children:l({id:"Orders.CustomMenu"})}),r(D,{gutter:16,className:"mt-3",children:[e(c,{md:4,sm:24,children:e(Z,{checked:s.meals[0],disabled:!0,children:l({id:"Orders.Breakfast"})})}),e(c,{md:4,sm:24,children:e(Z,{checked:s.meals[1],disabled:!0,children:l({id:"Orders.1Snack"})})}),e(c,{md:4,sm:24,children:e(Z,{checked:s.meals[2],disabled:!0,children:l({id:"Orders.Lunch"})})}),e(c,{md:4,sm:24,children:e(Z,{checked:s.meals[3],disabled:!0,children:l({id:"Orders.2Snack"})})}),e(c,{md:4,sm:24,children:e(Z,{checked:s.meals[4],disabled:!0,children:l({id:"Orders.Dinner"})})}),e(c,{md:4,sm:24,children:e(Z,{checked:s.meals[10],disabled:!0,children:l({id:"Orders.Salad"})})})]}),e(D,{gutter:16,className:"mt-3",children:[0,1,2,3,4,10].map(v=>e(c,{md:4,sm:24,children:r(re,{placeholder:"Cf",disabled:!0,value:s.cf[v],children:[e(Re,{value:0,children:l({id:"Orders.Auto"})},"0"),e(Re,{value:1,children:"1"},"c1"),e(Re,{value:1.5,children:"1.5"},"c2"),e(Re,{value:2,children:"2"},"c3")]})},v))}),e(D,{gutter:16,className:"mt-3",children:[0,1,2,3,4,10].map(v=>e(c,{md:4,sm:24,children:e(pe,{min:0,disabled:!0,placeholder:"Count",value:s.count[v]})},v))})]}),e(j,{})]})}),e("div",{className:"row",children:r("div",{className:"d-flex col-xl-12 justify-content-between",children:[e("div",{className:"d-flex align-items-center",children:t.status==="accepted"&&r(he,{children:[e(Ie,{roles:["root","admin","sales","salesDirector","finance","trainer"],children:r(N,{loading:X,type:"primary",size:"large",onClick:()=>oe(),children:[e(gs,{}),l({id:"Orders.Regenerate"})]})}),r(Ie,{roles:["root","sales","salesDirector"],children:[e(Me,{to:`/orders/create/${t.user.id}/${t.id}`,className:"btn btn-link",children:e(N,{type:"primary",size:"large",children:l({id:"Orders.Prolong"})})}),e(N,{style:{marginRight:"1.23rem"},loading:q,type:"primary",onClick:()=>B(t.id),size:"large",children:l({id:"Orders.QuickProlong"})}),t.extraDays!==-1&&e(N,{style:{marginRight:"1.23rem"},type:"primary",onClick:()=>L(!0),size:"large",children:l({id:"Orders.AddExtraDay"})}),e(be,{open:S,onOk:()=>U(),okText:l({id:"Orders.SubmitToApproval"}),onCancel:()=>{L(!1),de(0)},okButtonProps:{disabled:C.length===0},children:r(D,{gutter:16,style:{display:"flex"},children:[e(c,{md:15,xs:24,children:e(De,{highlightedDays:$e})}),e(c,{md:9,xs:24,children:r("div",{className:T.extraDayBtn,children:[e(N,{type:C.length===1?"primary":"default",disabled:C.length===1,onClick:()=>de(1),size:"large",children:l({id:"Orders.Add1ExtraDay"})}),e(N,{type:C.length===2?"primary":"default",disabled:C.length===2,onClick:()=>de(2),size:"large",children:l({id:"Orders.Add2ExtraDay"})}),C.length!==0&&r("p",{children:[C.length," ",l({id:"Orders.ExtraDaysWillBeAdded"})]})]})})]})}),e(N,{type:"dashed",onClick:n,size:"large",children:l({id:"Orders.Pause"})})]})]})}),e("div",{className:"d-flex align-items-center justify-content-between",children:r(Ie,{roles:["root","sales","salesDirector","admin"],children:[t.status==="new"&&!t.isOnApprovalWithoutInvoice&&!t.onApproveDeliveryFee&&!t.user.paymentData.isCompany&&r(he,{children:[e(le,{title:l({id:"Orders.AreYouSureAcceptThisOrder?"}),onConfirm:()=>K("accepted"),okText:l({id:"Orders.Accept"}),cancelText:l({id:"Orders.Cancel"}),children:e(qe.Button,{type:"primary",size:"large",loading:p,overlay:e(Gs,{update:h,id:m}),style:{marginRight:"10px"},children:l({id:"Orders.Accept"})})}),e(le,{title:l({id:"Orders.AreYouSureRejectThisOrder?"}),onConfirm:()=>K("rejected"),okText:"Accept",cancelText:"Cancel",children:e(N,{type:"danger",style:{marginRight:"10px"},size:"large",children:l({id:"Orders.Reject"})})})]}),t.status==="new"&&!t.isOnApprovalWithoutInvoice&&!t.onApproveDeliveryFee&&t.user.paymentData.isCompany&&r(he,{children:[e(N,{type:"primary",size:"large",onClick:d,style:{marginRight:"10px",marginBottom:"10px"},children:l({id:"Orders.Accept as Company (s.r.o.)"})}),e(le,{title:l({id:"Orders.AreYouSureRejectThisOrder?"}),onConfirm:()=>K("rejected"),okText:l({id:"Orders.Accept"}),cancelText:l({id:"Orders.Cancel"}),children:e(N,{type:"danger",style:{marginRight:"10px",marginBottom:"10px"},size:"large",children:l({id:"Orders.Reject"})})})]}),t.status==="fromWeb"&&r(he,{children:[e(le,{title:l({id:"Orders.AreYouSureAcceptThisOrder?"}),onConfirm:()=>K("waitingPayment"),okText:"Yes",cancelText:"Cancel",children:e(N,{type:"primary",size:"large",style:{marginRight:"10px",marginBottom:"10px"},children:l({id:"Orders.GenerateInvoice"})})}),e(le,{title:l({id:"Orders.AreYouSureRejectThisOrder?"}),onConfirm:()=>K("rejected"),okText:l({id:"Orders.Accept"}),cancelText:l({id:"Orders.Cancel"}),children:e(N,{type:"danger",style:{marginRight:"10px",marginBottom:"10px"},size:"large",children:l({id:"Orders.Reject"})})})]}),t.status==="waitingPayment"&&e(he,{children:e(le,{title:l({id:"Orders.AreYouSureAcceptThisOrder?"}),onConfirm:()=>ye(),okText:l({id:"Orders.Yes"}),cancelText:l({id:"Orders.Cancel"}),children:e(N,{type:"primary",size:"large",style:{marginRight:"10px",marginBottom:"10px"},children:l({id:"Orders.AcceptFromWeb"})})})}),e(ft,{title:f?"Check Approval Request!":null,mouseEnterDelay:0,mouseLeaveDelay:0,children:e(le,{placement:"top",title:l($==="remove"?{id:"Orders.AreYouSureDeleteThisOrder?"}:{id:"Orders.Create payment?"}),onConfirm:$==="remove"?fe:_e,okText:l({id:"Orders.Yes"}),cancelText:l({id:"Orders.No"}),onCancel:()=>P(!1),open:ae,children:r(qe.Button,{onClick:Le,overlay:ze(),size:"large",disabled:f,children:[e("i",{className:"icmn-pencil mr-1"}),e("span",{style:{color:t.isOnApprovalOfRecalculatedPrice||t.status==="canceled"?"#ccc":"default"},children:l({id:"window.edit"})})]})})})]})})]})})]})}),e(Ws,{visible:A,order:t,onClose:()=>R(!1),isPaid:F,update:h})]})},Qs=({data:m})=>{const{formatMessage:t}=Ce(),s=[{title:t({id:"Orders.IDinFakturoid"}),dataIndex:"invoiceId",key:"invoiceId",render:n=>e("span",{children:n})},{title:t({id:"Orders.URL"}),dataIndex:"invoice",key:"invoice",render:n=>e("a",{href:n,rel:"noopener noreferrer",target:"_blank",children:"Open invoice"})},{title:t({id:"Orders.InvoiceNumber"}),dataIndex:"number",key:"number",render:n=>e("span",{children:n})},{title:t({id:"Orders.Correction"}),dataIndex:"isCorrection",key:"isCorrection",render:n=>e("span",{children:n?"Yes":"No"})}];return e(Te,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:s,dataSource:m,pagination:{position:"bottom",total:m.length,showTotal:(n,d)=>`${d[0]}-${d[1]} of ${n} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:m.length<10},rowKey:()=>Math.random()})};var Je;let Js=we(Je=class extends Fe.Component{render(){const{data:t,intl:{formatMessage:s}}=this.props,n=[{title:s({id:"window.date"}),dataIndex:"date",key:"date",render:d=>e("span",{children:b(d).format("DD-MM-YYYY")})},{title:s({id:"Orders.Employee"}),dataIndex:"systemUser",key:"systemUser",render:d=>e("span",{children:d})},{title:s({id:"Orders.Action"}),dataIndex:"action",key:"action",render:d=>e("span",{style:{color:"rgb(8, 135, 201)"},children:d})},{title:s({id:"Orders.Changes"}),dataIndex:"changes",key:"changes",render:d=>e("span",{children:d.length})}];return e("div",{children:e(Te,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:n,dataSource:t,pagination:{position:"bottom",total:t.length,showTotal:(d,a)=>`${a[0]}-${a[1]} of ${d} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:t.length<10},rowKey:()=>Math.random()})})}})||Je;var Ze;let Zs=we(Ze=class extends Fe.Component{constructor(){super(...arguments);ve(this,"transformTableData",s=>s.map(n=>{if(n.parent_payment){const d=s==null?void 0:s.find(a=>a.id===(n==null?void 0:n.parent_payment));n.parent_payment_id=d==null?void 0:d.payment_id}if(n.status==="PAID"&&n.gw==="GoPay"){const d=s==null?void 0:s.find(a=>a.parent_payment===n.id);n.payment_number=d==null?void 0:d.payment_number,n.gw_url=d==null?void 0:d.gw_url}return n}))}render(){const{data:s,intl:{formatMessage:n}}=this.props,d=this.transformTableData(s);console.log(d);const a=[{title:n({id:"Payments.Created"}),align:"center",dataIndex:"createdAt",key:"createdAt",render:(h,o)=>{if(o.updatedAt!==""){const f=e("div",{children:e("p",{children:b(o.updatedAt).format("DD.MM.YYYY HH:mm")})});return e(Ke,{content:f,title:"Date of update",children:e("span",{children:b(o.createdAt).format("DD.MM.YYYY HH:mm")})})}return e("span",{children:b(o.createdAt||o.payment_created_at).format("DD.MM.YYYY HH:mm")})}},{title:n({id:"Payments.PaymentID"}),align:"center",dataIndex:"payment_id",key:"payment_id",render:h=>e("span",{children:h})},{title:n({id:"Payments.PaymentLink"}),align:"center",dataIndex:"payment_number",key:"payment_number",render:(h,o)=>{let f="";return h?f=h:o.gw_url&&(f="GoPay Link"),e("a",{href:o.gw_url,target:"_blank",rel:"noopener noreferrer",children:f})}},{title:n({id:"Payments.Duplicate Fakturoid Invoice"}),align:"center",dataIndex:"parent_payment",key:"parent_payment",render:(h,o)=>e("span",{children:o.parent_payment_id||"-"})},{title:n({id:"Payments.Amount"}),align:"center",dataIndex:"amount",key:"amount",render:h=>e("span",{children:h})},{title:n({id:"Payments.Currency"}),align:"center",dataIndex:"currency",key:"currency",render:h=>e("span",{children:h})},{title:n({id:"Payments.Status"}),align:"center",dataIndex:"status",key:"status",render:h=>e("span",{children:h})},{title:n({id:"Payments.gateway"}),align:"center",dataIndex:"gw",key:"gw",render:h=>e("span",{children:h})},{title:n({id:"Payments.PaymentMethod"}),align:"center",dataIndex:"payment_instrument",key:"payment_instrument",render:(h,o)=>o.parent_payment_id?e(k,{color:"blue",children:n({id:"Payments.Paid by GoPay"})}):h}];return e(Te,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:a,dataSource:d,pagination:{position:"bottom",total:s.length,showTotal:(h,o)=>`${o[0]}-${o[1]} of ${h} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:s.length<10},rowKey:()=>Math.random()})}})||Ze;b.updateLocale("en",{week:{dow:1}});const _r=()=>{const[m,t]=g.useState(!0),[s,n]=g.useState(!1),[d,a]=g.useState(404),[h,o]=g.useState([]),[f,w]=g.useState([]),[I,S]=g.useState(!1),[L,A]=g.useState(!1),[R,F]=g.useState(!1),[M,C]=g.useState({}),[_]=g.useState({meals:[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],cf:[0,0,0,0,0,0,0,0,0,0,0],count:[0,0,0,0,0,0,0,0,0,0,0],isActive:!1}),[p,O]=g.useState({}),[q,G]=g.useState([]),[J,X]=g.useState(!1),[H,ae]=g.useState([]),[P,$]=g.useState([]),{id:E}=Ot(),l=vt(),{formatMessage:i}=Ce(),W=M.currentPrice||{},U=M.acceptedPrice||{},oe=g.useCallback(async()=>{t(!0);const B=await Zt(E),{result:z}=await B.json();G(z),t(!1)},[E]),ue=g.useCallback(async()=>{const B=await Qt(!0);if(B.status===401){l({type:"user/SET_STATE",payload:{authorized:!1}});return}if(B.status===200){const z=await B.json();ae(z.result)}},[l]),ye=g.useCallback(async()=>{try{const z=await(await Xt(E)).json();w(z.result)}catch{y.error({message:i({id:"window.error"}),description:"Failed to get logs"})}finally{t(!1)}},[i,E]),K=g.useCallback(async()=>{t(!0);try{const z=await(await qt(E)).json();z.result.customMenu.data.forEach(se=>{_.meals[se.meal]=!0,_.cf[se.meal]=se.coefficient,_.count[se.meal]=se.count,_.isActive=z.result.customMenu.isActive}),C(z.result),a(z.status),F(!1),o(z.result.invoices),O(z.result.requestApprovalPrice),t(!1),await oe(),await ue(),await ye()}catch{y.error({message:i({id:"window.error"}),description:"Failed to get order"})}},[_.cf,_.count,_.isActive,_.meals,i,oe,E,ue,ye]),de=async(B,z)=>{t(!0);const se=await Ht(E,{description:z,unit:B});se.status===202?(await K(),y.success({message:i({id:"window.success"}),description:i({id:"Orders.OrderSuccessfullyAccepted!"})})):(t(!1),y.error({message:i({id:"window.error"}),description:se.statusText}))},fe=async()=>{(await Wt(E)).status===200&&await K()};return g.useEffect(()=>{document.title=`Order ${E}`,K().finally(()=>t(!1))},[K,E]),g.useEffect(()=>{M.orderDays&&$(M.orderDays.map(B=>b.unix(Number(B)).format("DD-MM-YYYY")))},[M]),r("div",{children:[s&&e(bt,{to:"/orders"}),E&&!m&&d===200&&r("div",{className:"row",children:[r("div",{className:"col-xl-8",children:[e(Hs,{id:E,order:M}),!M.customMenu.isActive&&M.customMenu.data.length!==0&&e("div",{className:"card card-body mb-4",children:e("div",{children:e("h2",{children:e("span",{className:"text-black mr-2",children:r("center",{children:[e("strong",{style:{color:"#fb434a"},children:i({id:"Orders.ORDER HAS A CUSTOM MENU!"})}),e("br",{}),i({id:"Orders.Request for approval was sent automatically"}),e("br",{}),e("small",{children:i({id:"Orders.Please contact the CEO"})})]})})})})}),M.isModifiedPrice&&M.invoiceStatus==="open"&&e("div",{className:"card card-body mb-4",children:r("div",{children:[e("h2",{children:e("span",{className:"text-black mr-2",children:r("center",{children:[e("strong",{style:{color:"#fb434a"},children:i({id:"Orders.PRICE WAS RECALCULATED!"})}),e("br",{}),!M.isOnApprovalOfRecalculatedPrice&&r(N,{type:"primary",size:"default",onClick:fe,style:{backgroundColor:"#46be8a",border:0},children:[e(cs,{}),i({id:"Orders.Request for approval"})]})]})})}),e(j,{children:i({id:"Orders.PRICE PER DAY"})}),r("div",{style:{fontSize:48,textAlign:"center"},children:[e("span",{children:U.totalPerDay}),e("span",{style:{fontSize:30},children:"Kč"}),e("span",{style:{fontSize:52,margin:"0 25px 0 25px"},children:e("i",{className:"fa fa-long-arrow-right",color:"green"})}),e("span",{children:W.totalPerDay}),e("span",{style:{fontSize:30},children:"Kč"}),e("span",{style:{marginLeft:"10px",color:U.totalPerDay>W.totalPerDay?"#46be8a":"#fb434a"},children:e("i",{className:`fa fa-sort-${U.totalPerDay>W.totalPerDay?"down":"up"}`,color:"green"})}),r("span",{style:{marginLeft:"10px",color:U.totalPerDay>W.totalPerDay?"#46be8a":"#fb434a"},children:[U.totalPerDay<W.totalPerDay&&e("span",{children:"+"}),W.totalPerDay-U.totalPerDay]}),e("span",{style:{fontSize:30},children:"Kč"})]}),e(j,{children:i({id:"Orders.TOTAL PRICE"})}),r("div",{style:{fontSize:48,textAlign:"center"},children:[e("span",{children:U.total}),e("span",{style:{fontSize:30},children:"Kč"}),e("span",{style:{fontSize:52,margin:"0 25px 0 25px"},children:e("i",{className:"fa fa-long-arrow-right",color:"green"})}),e("span",{children:W.total}),e("span",{style:{fontSize:30},children:"Kč"}),e("span",{style:{marginLeft:"10px",color:U.total>M.price?"#46be8a":"#fb434a"},children:e("i",{className:`fa fa-sort-${U.total>M.price?"down":"up"}`,color:"green"})}),r("span",{style:{marginLeft:"10px",color:U.total>M.price?"#46be8a":"#fb434a"},children:[W.total>U.total&&e("span",{children:"+"}),W.total-U.total]}),e("span",{style:{fontSize:30},children:"Kč"})]})]})}),Object.keys(p).length!==0&&typeof p=="object"?e("div",{className:"card card-body mb-4",children:e("h2",{children:e("span",{className:"text-black mr-2",children:r("center",{children:[e("strong",{style:{color:"#fb434a"},children:i({id:"Orders.PRICE WAS RECALCULATED AND WAITING FOR APPROVAL!"})}),e("br",{}),e("br",{}),r("div",{children:[p.before.length!==p.after.length&&e("p",{children:`${p.before.length} days → ${p.after.length} days`}),p.before.mealsPerDay!==p.after.mealsPerDay&&e("p",{children:`${p.before.mealsPerDay} meals → ${p.after.mealsPerDay} meals`}),p.before.params.energy!==p.after.params.energy&&e("p",{children:`${p.before.params.energy} kcal → ${p.after.params.energy} kcal`}),p.before.price!==p.after.price&&e("p",{children:`${p.before.price} Kč → ${p.after.price} Kč`})]}),e("br",{}),e(N,{type:"danger",onClick:async()=>{await jt(p.id),await K()},children:i({id:"Orders.RemoveRequest"})})]})})})}):"",e(Us,{id:E,order:M,customMenu:_,showPauseDrawer:()=>S(!0),showAcceptCompanyModal:()=>F(!0),showDrawerEditOrder:()=>A(!0),updateOrder:Ge,update:K,setLoading:B=>t(B),setDeleted:B=>n(B),getOrderPayments:oe,isRequestApproval:Object.keys(p).length!==0,tags:H,paymentData:q}),e("div",{className:"card card-body mb-4",children:e(et,{defaultActiveKey:"1",items:[h.length>0&&{label:r("span",{children:[e("i",{className:"icmn-history"}),i({id:"Orders.Invoices"})]}),key:"1",children:e(Qs,{data:h})},{label:r("span",{children:[e("i",{className:"icmn-history"}),i({id:"Orders.Payments"})]}),key:"2",children:e(Zs,{data:q})},{label:r("span",{children:[e("i",{className:"icmn-history"}),i({id:"Orders.OrderLogs"})]}),key:"3",children:e(Js,{data:f})}]})})]}),r("div",{className:"col-xl-4",children:[e("div",{className:"card",children:r("div",{className:"card-body",children:[e("h5",{className:"mb-3 text-black",children:e("strong",{children:i({id:"Orders.PRICE"})})}),e(js,{id:E,order:M})]})}),e("div",{className:"card",children:e("div",{className:"card-body",children:e(De,{highlightedDays:P})})})]})]}),L&&e(ys,{visible:L,onClose:()=>A(!1),onCreate:Ge,update:K,order:M,tags:H}),I&&e(bs,{visible:I,orderDays:P,onClose:()=>S(!1),update:K,order:M}),J&&e(Ds,{visible:J,onClose:()=>X(!1),update:K,order:M}),R&&e(ws,{visible:R,onClose:()=>F(!1),update:K,createInvoice:de,accept:de,order:M}),d===404&&!m&&e(We,{status:"404",title:"404",subTitle:"Sorry, the page you visited does not exist.",extra:e(Me,{to:"/orders",children:e(N,{type:"primary",children:i({id:"Orders.BackOrders"})})})}),d===500&&!m&&e(We,{status:"500",title:"500",subTitle:"Sorry, the server is wrong.",extra:e(Me,{to:"/orders",children:e(N,{type:"primary",children:i({id:"Orders.BackOrders"})})})})]})};export{_r as default};
