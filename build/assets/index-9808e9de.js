var j=Object.defineProperty;var E=(g,f,t)=>f in g?j(g,f,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[f]=t;var c=(g,f,t)=>(E(g,typeof f!="symbol"?f+"":f,t),t);import{a1 as P,a2 as R,r as _,a3 as F,cU as z,j as e,c as o,I,a5 as v,bp as M,bo as D,B as y,bd as B,be as Y,cV as L,cW as O,c2 as V,cX as W,cY as q,bf as N,aa as $,aJ as H,a8 as G,bg as J,a4 as K,cZ as X}from"./index-c20b5e8e.js";import{T as Z}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as Q}from"./index-67f4e7c4.js";/* empty css              */import{D as ee}from"./index-1e692111.js";import{F as p}from"./index-a86cfb93.js";import{R as S,C as U}from"./row-58ed805b.js";import"./styleChecker-a7b568e2.js";var A;const{Option:h}=v,k={cs:"Czech",en:"English",de:"German"};let se=P(A=class extends R.Component{constructor(t){super(t);c(this,"state",{username:"",role:"sales",password:"",email:"",isActive:!0,isNextLogout:!1,branches:[],language:"cs"});c(this,"formRef",_.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this)}componentDidUpdate(t){const{editForm:a,currentUser:s}=this.props;a&&t.editForm!==a&&this.formRef.current&&(this.setState({username:s.username,role:s.role,email:s.email,isActive:s.isActive,isNextLogout:s.isNextLogout,branches:s.branches,language:s.language}),this.formRef.current.setFieldsValue({username:s.username,role:s.role,email:s.email,isActive:s.isActive,isNextLogout:s.isNextLogout,branches:s.branches,language:s.language}))}onChangeField(t,a){t.target?t.target.type==="checkbox"?this.setState({[a]:t.target.checked}):this.setState({[a]:t.target.value}):this.setState({[a]:t})}async onFinish(){try{const{create:t,update:a,intl:{formatMessage:s}}=this.props;await this.formRef.current.validateFields();const{username:n,role:m,password:l,email:u,isActive:r,isNextLogout:i,branches:d,language:w}=this.state,x=await t({username:n,password:l,role:m,email:u,isActive:r,isNextLogout:i,branches:d,language:w});x.status===201?(this.closeDrawer(),F.success({message:s({id:"User.Created"}),description:s({id:"User.User successfully created!"})}),a()):x.status===409?F.error({message:s({id:"User.Error name"}),description:s({id:"User.User with current name already exist!"}),placement:"topLeft"}):F.error({message:s({id:"window.error"}),description:x.statusText,placement:"topLeft"})}catch(t){console.log("Failed:",t)}}async handleSave(){const{intl:{formatMessage:t},currentUser:a,update:s}=this.props,{username:n,role:m,email:l,isActive:u,isNextLogout:r,branches:i,language:d}=this.state;await this.formRef.current.validateFields();const w={username:n,role:m,email:l,isActive:u,isNextLogout:r,branches:i,language:d};z(a.id,w).then(async C=>{C.status===200&&(this.closeDrawer(),F.success({message:t({id:"User.Saved"}),description:t({id:"User.User info successfully updated!"})}),s())})}closeDrawer(){const{onClose:t}=this.props;this.setState({username:"",role:"",password:"",email:"",isActive:!1,isNextLogout:!1,branches:[]}),this.formRef.current.resetFields(),t()}render(){const{visible:t,editForm:a,intl:{formatMessage:s},branchesList:n,languagesList:m}=this.props,{role:l}=this.state;let u=1080;return typeof window.innerWidth<"u"&&(u=window.innerWidth),e(ee,{title:s(a?{id:"User.Edit user account"}:{id:"User.Create a new user account"}),width:u<768?"100%":"auto",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:o(p,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[o(S,{gutter:16,children:[e(U,{md:12,sm:24,children:e(p.Item,{label:s({id:"User.Username"}),name:"username",rules:[{required:!0}],children:e(I,{placeholder:a?"":s({id:"User.Please enter user name"}),onChange:r=>this.onChangeField(r,"username")})})}),e(U,{md:12,sm:24,children:e(p.Item,{name:"role",label:s({id:"User.Role"}),rules:[{required:!0}],children:o(v,{value:l,onChange:r=>this.onChangeField(r,"role"),children:[e(h,{value:"sales",children:s({id:"User.sales"})},"sales"),e(h,{value:"trainer",children:s({id:"User.trainer"})},"trainer"),e(h,{value:"admin",children:s({id:"User.admin"})},"admin"),e(h,{value:"root",children:s({id:"User.root"})},"root"),e(h,{value:"finance",children:s({id:"User.finance"})},"finance"),e(h,{value:"salesDirector",children:s({id:"User.salesDirector"})},"salesDirector"),e(h,{value:"readonlySearch",children:s({id:"User.readonlySearch"})},"readonlySearch")]})})})]}),o(S,{gutter:16,children:[o(U,{md:12,sm:24,children:[!a&&e(p.Item,{label:s({id:"User.Password"}),name:"password",rules:[{required:!0}],children:e(I,{type:"password",placeholder:s({id:"User.Please enter password"}),onChange:r=>this.onChangeField(r,"password")})}),a&&e(p.Item,{label:s({id:"User.Branches"}),name:"branches",children:e(v,{mode:"multiple",type:"branches",placeholder:s({id:"User.Please choose branches"}),onChange:r=>this.onChangeField(r,"branches"),children:n.map(r=>e(h,{value:r.id,children:r.name},r.id))})})]}),e(U,{md:12,sm:24,children:e(p.Item,{label:s({id:"window.email"}),name:"email",rules:[{required:!0}],children:e(I,{placeholder:s({id:"User.Please enter email"}),onChange:r=>this.onChangeField(r,"email")})})})]}),o(S,{gutter:16,children:[!a&&o(M,{children:[e(U,{md:12,sm:24,children:e(p.Item,{label:s({id:"User.Branches"}),name:"branches",children:e(v,{mode:"multiple",type:"branches",placeholder:s({id:"User.Please choose branches"}),onChange:r=>this.onChangeField(r,"branches"),children:n.map(r=>e(h,{value:r.id,children:r.name},r.id))})})}),e(U,{md:12,sm:24,children:e(p.Item,{label:s({id:"User.Language"}),name:"language",children:e(v,{onChange:r=>this.onChangeField(r,"language"),children:m.map(r=>e(h,{value:r,children:k[r]},r))})})})]}),a&&e(U,{md:12,sm:24,children:e(p.Item,{label:s({id:"User.Language"}),name:"language",children:e(v,{onChange:r=>this.onChangeField(r,"language"),children:m.map(r=>e(h,{value:r,children:k[r]},r))})})})]}),a&&o(S,{children:[e(U,{md:12,sm:24,children:e("div",{style:{minWidth:"145px"},children:o("span",{children:["Is Active",e(D,{style:{marginLeft:"15px"},onChange:r=>this.onChangeField(r,"isActive")})]})})}),e(U,{md:12,sm:24,children:e("div",{style:{minWidth:"145px"},children:o("span",{children:["Is Next Logout",e(D,{style:{marginLeft:"15px"},onChange:r=>this.onChangeField(r,"IsNextLogout")})]})})})]}),e(p.Item,{children:o("div",{className:"form-actions",children:[!a&&e(y,{style:{width:150},type:"primary",htmlType:"submit",className:"mr-3",children:s({id:"window.create"})}),a&&e(y,{style:{width:150},type:"primary",onClick:()=>this.handleSave(),className:"mr-3",children:s({id:"window.save"})}),e(y,{onClick:this.closeDrawer,children:s({id:"window.cancel"})})]})})]})})}})||A;var T,b;let ue=(T=B(({user:g})=>({user:g})),P(b=Y(b=T(b=class extends R.Component{constructor(t){super(t);c(this,"state",{users:[],branches:[],languages:[],loading:!0,createUserFormVisible:!1,editForm:!1,currentUser:{},showModal:!1,newPassword:"",user:"",showInactive:!1});c(this,"showDrawerCreateUserForm",()=>{this.setState({createUserFormVisible:!0,editForm:!1})});c(this,"onCloseCreateUserForm",()=>{this.setState({createUserFormVisible:!1,editForm:!1})});c(this,"editUserInfo",t=>{this.setState({createUserFormVisible:!0,editForm:!0,currentUser:t})});c(this,"handleChangePassword",t=>{this.setState({showModal:!0,user:t.id})});c(this,"handleCancel",()=>{this.setState({showModal:!1,newPassword:""})});c(this,"handleOk",()=>{const{intl:{formatMessage:t}}=this.props,{user:a,newPassword:s}=this.state;this.setState({showModal:!1}),W(a,{password:s}).then(async n=>{const m=await n.json();n.status===200?(this.setState({user:m.result,loading:!1}),F.success({message:t({id:"User.Updated"}),description:t({id:"User.User password successfully updated!"})})):F.error({message:t({id:"window.error"}),description:n.statusText,placement:"topRight"})})});c(this,"filterData",()=>{const{users:t,showInactive:a}=this.state;return t.filter(n=>!((n==null?void 0:n.isActive)===!1&&!a))});this.deactivateUser=this.deactivateUser.bind(this),this.updateUsers=this.updateUsers.bind(this),this.editUserInfo=this.editUserInfo.bind(this),this.filterData=this.filterData.bind(this)}UNSAFE_componentWillMount(){L().then(async t=>{if(t.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}const a=await t.json();this.setState({users:a.result,loading:!1})}),O().then(async t=>{if(t.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}const a=await t.json();this.setState({branches:a.result})}),V().then(async t=>{if(t.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}const a=await t.json();this.setState({languages:a.result.map(({primaryLanguage:s})=>s)})})}onChangeField(t,a){t.target?t.target.type==="checkbox"?this.setState({[a]:t.target.checked}):this.setState({[a]:t.target.value}):this.setState({[a]:t})}updateUsers(){L().then(async t=>{const a=await t.json();this.setState({users:a.result,loading:!1})})}async deactivateUser(t){const a=await q(t);a.status===200?(N.success("User deleted!"),this.updateUsers()):N.error("Error: ",a.statusText)}render(){const{createUserFormVisible:t,currentUser:a,showModal:s,branches:n,languages:m}=this.state,{intl:{formatMessage:l}}=this.props,u=this.filterData(),r=[{title:l({id:"User.Username"}),dataIndex:"username",key:"username",render:i=>e("span",{children:` ${i}`})},{title:l({id:"window.email"}),dataIndex:"email",key:"email",render:i=>e("span",{children:i})},{title:l({id:"User.Role"}),dataIndex:"role",key:"role",render:i=>e("span",{children:i})},{title:l({id:"User.Branches"}),dataIndex:"branches",key:"branches",render:(i,d)=>d.branches.map(w=>{const C=n.find(x=>x.id===w);return o(M,{children:[e("span",{children:(C==null?void 0:C.name)||w},w),e("br",{})]})})},{title:l({id:"User.Created date"}),dataIndex:"id",key:"createdDate",render:i=>e("span",{children:`${$.unix(parseInt(i.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`})},{title:l({id:"User.Is Active"}),dataIndex:"isActive",key:"isActive",render:i=>e("span",{children:i?"Yes":"No"})},{title:l({id:"User.Is Next Logout"}),dataIndex:"isNextLogout",key:"isNextLogout",render:i=>e("span",{children:i?"Yes":"No"})},{title:"Action",dataIndex:"id",key:"action",render:(i,d)=>o("span",{children:[e(y,{style:{marginRight:"15px"},onClick:()=>this.editUserInfo(d),size:"small",children:"Edit"}),e(y,{style:{marginRight:"15px"},onClick:()=>this.handleChangePassword(d),size:"small",children:"Change Password"}),e(Q,{title:"Are you sure to delete this user?",onConfirm:()=>this.deactivateUser(i),okText:"Yes",cancelText:"No",children:e(y,{type:"primary",danger:!0,icon:e(H,{}),size:"small",children:"Remove"})})]})}];return o(G,{roles:["root"],redirect:!0,to:"/main",children:[e(J,{title:"Users"}),o("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:l({id:"User.Users"})})})}),o("div",{className:"card-body",children:[e(y,{style:{marginBottom:"20px"},type:"primary",onClick:this.showDrawerCreateUserForm,children:l({id:"User.New user"})}),e("span",{style:{marginLeft:"20px"},children:"Show inactive users"}),e(D,{style:{marginLeft:"15px"},onChange:i=>this.onChangeField(i,"showInactive")}),e(Z,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:r,dataSource:u,pagination:{position:"bottom",total:u.length,showTotal:(i,d)=>`${d[0]}-${d[1]} of ${i} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:u.length<10},loading:this.state.loading,rowKey:i=>i.id})]})]}),e(K,{title:"Change user password",open:s,onOk:this.handleOk,onCancel:this.handleCancel,children:e(I,{type:"password",placeholder:l({id:"User.Please enter new password"}),onChange:i=>this.onChangeField(i,"newPassword")})}),e(se,{visible:t,onClose:this.onCloseCreateUserForm,create:X,update:this.updateUsers,editForm:this.state.editForm,currentUser:a,branchesList:n,languagesList:m})]})}})||b)||b)||b);export{ue as default};
