var E=Object.defineProperty;var B=(u,o,a)=>o in u?E(u,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[o]=a;var x=(u,o,a)=>(B(u,typeof o!="symbol"?o+"":o,a),a);import{a1 as D,be as K,a2 as $,j as t,c as l,bF as b,a3 as A,bk as C,a8 as _,bg as j,B as N}from"./index-c20b5e8e.js";import{T as f}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";/* empty css              */import{T as v}from"./index-8e340a60.js";import{g as U,a as L}from"./users-d1e7edcf.js";import{D as O}from"./index-1e692111.js";import"./styleChecker-a7b568e2.js";var y;let R=D(y=K(y=class extends $.Component{constructor(o){super(o),this.closeDrawer=this.closeDrawer.bind(this)}closeDrawer(){const{onClose:o}=this.props;o()}render(){const{visible:o,data:a,summary:n,days:r,intl:{formatMessage:h}}=this.props,k=[{title:h({id:"AdvancedTest.kCalError"}),dataIndex:"error",key:"kcal",render:e=>t("span",{children:`${e}`})},{title:r?r[0]:"-",dataIndex:"day1",key:"day1",render:e=>`${e.count} (${e.total})`},{title:r?r[1]:"-",dataIndex:"day2",key:"day2",render:e=>`${e.count} (${e.total})`},{title:r?r[2]:"-",dataIndex:"day3",key:"day3",render:e=>`${e.count} (${e.total})`},{title:r?r[3]:"-",dataIndex:"day4",key:"day4",render:e=>`${e.count} (${e.total})`},{title:r?r[4]:"-",dataIndex:"day5",key:"day5",render:e=>`${e.count} (${e.total})`},{title:r?r[5]:"-",dataIndex:"day6",key:"day6",render:e=>`${e.count} (${e.total})`}],m=[{title:h({id:"AdvancedTest.kCal"}),dataIndex:"kcal",key:"kcal",render:e=>t("span",{children:`${e}`}),sorter:(e,d)=>e.kcal-d.kcal}];for(let e=0;e<6;e+=1)m.push({title:r?r[e]:"-",dataIndex:"days",key:`day${e}`,render:d=>{if(d[e].kcal===0)return"-";const s=Math.abs(d[e].error)<=10?"green":Math.abs(d[e].error)<=20?"orange":"red";return l(v,{color:s,children:[Math.round(d[e].kcal)," (",d[e].error>0?"+":"",Math.round(d[e].error),"%)"]})},sorter:(d,s)=>Math.abs(d.days[e].error)-Math.abs(s.days[e].error)});return m.push({title:h({id:"AdvancedTest.MAXJump"}),dataIndex:"maxJump",key:"maxJump",render:e=>{const d=Math.abs(e)<=100?"green":Math.abs(e)<=50?"orange":"red";return t(v,{color:d,children:Math.round(e)})},sorter:(e,d)=>e.maxJump-d.maxJump}),a.length&&a[0].order&&(m.unshift({title:h({id:"AdvancedTest.Order"}),dataIndex:"order",key:"order",render:e=>t(b,{to:`/orders/${e.id}`,target:"_blank",children:e.name})}),m.push({title:h({id:"AdvancedTest.MealsPerDay"}),dataIndex:"order",key:"mealsPerdAy",render:e=>e.mealsPerDay,sorter:(e,d)=>e.order.mealsPerDay-d.order.mealsPerDay})),t("div",{children:l(O,{title:h({id:"AdvancedTest.kCalAdvancedTest"}),width:"100%",onClose:this.closeDrawer,open:o,bodyStyle:{paddingBottom:80},children:[Boolean(a.length)&&Boolean(a[0].order)&&l("div",{children:[t("h4",{children:h({id:"AdvancedTest.SummaryStats"})}),t(f,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:k,dataSource:n,pagination:!1,rowKey:()=>Math.random()}),t("br",{}),t("h4",{children:h({id:"AdvancedTest.ResultsByProductionData"})})]}),t(f,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:m,dataSource:a,pagination:!1,rowKey:()=>Math.random()})]})})}})||y)||y;var g;let Z=D(g=K(g=class extends $.Component{constructor(a){super(a);x(this,"state",{users:[],days:[],loading:!0,loadingAdvanced:!1,advancedDays:[],advancedData:[],advancedSummary:[],advancedTestVisible:!1});this.update=this.update.bind(this),this.onCloseTest=this.onCloseTest.bind(this)}componentDidMount(){this.update()}onCloseTest(){this.setState({advancedTestVisible:!1})}onChangeField(a,n){a!==null&&a.target?a.target.type==="checkbox"?this.setState({[n]:a.target.checked}):this.setState({[n]:a.target.value}):this.setState({[n]:a})}update(){const{intl:{formatMessage:a}}=this.props;this.setState({loading:!0}),U().then(async n=>{if(n.status===200){const r=await n.json();this.setState({users:r.result,days:r.days,loading:!1})}else this.setState({loading:!1}),A.error({message:a({id:"window.error"}),description:n.statusText})})}async loadAdvancedTest(){const{intl:{formatMessage:a}}=this.props;try{this.setState({loadingAdvanced:!0});const n=await L();if(n.status===200){const r=await n.json();this.setState({advancedData:r.result,advancedSummary:r.summary,advancedDays:r.days,loadingAdvanced:!1,advancedTestVisible:!0})}else A.error({message:a({id:"window.error"}),description:n.statusText,placement:"topLeft"}),this.setState({loadingAdvanced:!1})}catch(n){console.log("Failed:",n)}}render(){const{users:a,loading:n,days:r,advancedData:h,advancedDays:k,advancedSummary:m,advancedTestVisible:e,loadingAdvanced:d}=this.state,{intl:{formatMessage:s}}=this.props,S=[{title:s({id:"TestKcal.USER"}),dataIndex:"user",key:"user",render:i=>t(b,{to:`/users/${i.id}`,children:i.name})},{title:s({id:"TestKcal.SOULDBE"}),dataIndex:"shouldBe",key:"shouldBe",render:i=>{const c=l("div",{children:[l("p",{children:[t("b",{children:s({id:"TestKcal.ValueInOrder:SPACE"})})," ",Math.round(i.energy)," kCal"]}),l("p",{children:[t("b",{children:s({id:"TestKcal.MealSkipped:SPACE"})})," ",Math.round(i.kcal)-Math.round(i.energy)," kCal"]}),l("p",{children:[t("b",{children:s({id:"TestKcal.ShouldBe:SPACE"})})," ",Math.round(i.kcal)," kCal"]})]});return t(C,{content:c,title:"Ditails",children:t("div",{children:l(v,{color:"blue",children:[i.kcal," ",s({id:"TestKcal.SPACE100%"})]})})})}}];return r.forEach(i=>{S.push({title:i.date,dataIndex:i.index,key:i.date,render:(c,p)=>{if(c){const w=(Math.round(c.kcal)/Math.round(p.shouldBe.kcal)*100).toFixed(1),T=(100-Math.round(c.kcal)/Math.round(p.shouldBe.kcal)*100).toFixed(1),M=Math.round(c.kcal)-Math.round(p.shouldBe.kcal),P=Math.abs(T)<=10?"green":Math.abs(T)<=20?"orange":"red",I=l("div",{children:[l("p",{children:[t("b",{children:s({id:"TestKcal.ShouldBe:SPACE"})})," ",Math.round(p.shouldBe.kcal)," kCal"]}),l("p",{children:[t("b",{children:s({id:"TestKcal.Generated:SPACE"})})," ",Math.round(c.kcal)," ","kCal"]}),l("p",{children:[t("b",{children:s({id:"TestKcal.Difference:SPACE"})})," ",M>0?"+":"",M," kCal"]}),l("p",{children:[t("b",{children:s({id:"TestKcal.Error:SPACE"})})," ",T,"%"]}),l("p",{children:[t("b",{children:s({id:"TestKcal.ORDER:SPACE"})})," ",t(b,{to:`/orders/${p.order}`,children:p.order})]})]});return t(C,{content:I,title:s({id:"TestKcal.Details"}),children:t("div",{children:l(v,{color:P,children:[Math.round(c.kcal)," (",w,"%)"]})})})}return t("div",{children:"-"})}})}),l(_,{roles:["root","admin","sales","salesDirector"],children:[t(j,{title:s({id:"TestKcal.UserKcalTest"})}),t("div",{className:"utils__title utils__title--flat mb-3",children:t("strong",{className:"text-uppercase font-size-16",children:s({id:"TestKcal.UserKcalTest"})})}),t("div",{className:"card card--fullHeight",children:l("div",{className:"card-body",children:[t(N,{style:{marginBottom:"30px"},onClick:async()=>this.loadAdvancedTest(),loading:d,children:s({id:"TestKcal.AdvancedTest"})}),t("div",{className:"row",children:t("div",{className:"col-lg-12",children:t(f,{tableLayout:"auto",scroll:{x:"100%"},columns:S,dataSource:a,pagination:{position:"bottom",total:a.length,showTotal:(i,c)=>`${c[0]}-${c[1]} of ${i} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:a.length<10},loading:n,rowKey:()=>Math.random()})})})]})}),t(R,{visible:e,data:h,days:k,onClose:this.onCloseTest,summary:m})]})}})||g)||g;export{Z as default};
