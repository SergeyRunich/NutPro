var me=Object.defineProperty;var pe=(g,r,i)=>r in g?me(g,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):g[r]=i;var P=(g,r,i)=>(pe(g,typeof r!="symbol"?r+"":r,i),i);import{a1 as ue,a2 as he,j as a,c as u,aY as fe,aa as x,r as o,b as ge,a as ye,a3 as f,a8 as we,b0 as b,bo as Me,b4 as ke,a5 as N,B as S}from"./index-c20b5e8e.js";import{R as q,C as W}from"./row-58ed805b.js";import{P as Ce}from"./index-67f4e7c4.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as De}from"./index-2f7554ca.js";import{a as F,e as Se,c as xe,s as Te,d as ve}from"./calendar-94c10bb8.js";import{g as Ye}from"./template-0cdd19f6.js";import{g as be}from"./weekTemplate-f1345fa1.js";import{T as We}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{C as Be}from"./index-9edbcc8e.js";import"./index-8e340a60.js";import"./styleChecker-a7b568e2.js";import"./index-f21ef7a8.js";import"./padStart-17be0050.js";import"./index-372ade24.js";import"./EditOutlined-c424161b.js";var V;let je=ue(V=class extends he.Component{constructor(){super(...arguments);P(this,"state",{})}render(){const{day:i,intl:{formatMessage:d}}=this.props,y=["Breakfast","1 Snack","Lunch","2 Snack","Dinner","2 Dinner","","","","","Salad"],k=[{title:a("strong",{children:"#"}),key:"id",render:(t,l,m)=>a("span",{children:a("strong",{children:` ${m+1}`})})},{title:a("strong",{children:d({id:"TemplateDetail.Dish"})}),dataIndex:"techcard",key:"dish",render:t=>a("span",{children:a("strong",{children:` ${t.title}`})})},{title:a("strong",{children:d({id:"TemplateDetail.Kf"})}),dataIndex:"amount",key:"kf",render:t=>a("span",{children:`${t}`}),sorter:(t,l)=>t.amount-l.amount},{title:a("strong",{children:d({id:"TemplateDetail.Weight(g)"})}),dataIndex:"amount",key:"weight",render:(t,l)=>{const m=Math.floor(t*l.techcard.amount*100)*10;return a("span",{children:`${m}`})}},{title:a("strong",{children:d({id:"TemplateDetail.kcal"})}),dataIndex:"kcal",key:"kcal",render:t=>a("span",{children:`${t}`})},{title:a("strong",{children:d({id:"TemplateDetail.Prot"})}),dataIndex:"prot",key:"prot",render:t=>a("span",{children:`${t}`})},{title:a("strong",{children:d({id:"TemplateDetail.Fat"})}),dataIndex:"fat",key:"fat",render:t=>a("span",{children:`${t}`})},{title:a("strong",{children:d({id:"TemplateDetail.C"})}),dataIndex:"fat",key:"c",render:t=>a("span",{children:`${t}`})},{title:a("strong",{children:d({id:"TemplateDetail.Meal"})}),dataIndex:"meal",key:"meal",render:t=>a("span",{children:`${y[t]}`}),sorter:(t,l)=>t.meal-l.meal},{title:a("strong",{children:d({id:"TemplateDetail.Group"})}),dataIndex:"group",key:"group",render:t=>a("span",{children:`${t}`}),sorter:(t,l)=>t.group-l.group}];return u("div",{children:[i.id&&u("div",{children:[a("div",{style:{marginTop:"10px"},children:a("center",{children:a("h3",{children:i.template.name})})}),a(We,{columns:k,dataSource:i?i.template.dishes:[],pagination:!1,rowKey:()=>String(Math.random()),bordered:!0})]}),!i.id&&a(fe,{description:!1})]})}})||V;x.updateLocale("en",{week:{dow:1}});const{Option:_}=N,{WeekPicker:Ie}=De,Ze=()=>{const[g,r]=o.useState(!0),[i,d]=o.useState("Normal"),[y,k]=o.useState([]),[t,l]=o.useState(0),[m,h]=o.useState(!1),[T,c]=o.useState(""),[p,w]=o.useState(""),[z,G]=o.useState([]),[B,C]=o.useState(0),[j,D]=o.useState(""),[K,H]=o.useState([]),[I,R]=o.useState(!1),$=ge(),n=ye(),A=o.useCallback(async()=>{try{r(!0);const s=await(await Ye()).json();G(s)}catch{f.error({message:n.formatMessage({id:"window.error"}),description:"Template Menu not found",placement:"topRight"})}},[n]),E=o.useCallback(async()=>{try{r(!0);const s=await(await be()).json();H(s.length?s:[s])}catch{f.error({message:n.formatMessage({id:"window.error"}),description:"Week Template not found",placement:"topRight"})}},[n]),J=async e=>{l(x.utc(e.format("DD.MM.YYYY"),"DD.MM.YYYY").unix())},Q=async()=>{if(m)(await Se(p.id,{timestamp:t,template:T,class:i})).status===200&&(f.success({message:n.formatMessage({id:"CalendarMenu.Saved"}),description:n.formatMessage({id:"CalendarMenu.DaySuccessfullySaved!"})}),await v(p.id));else{const e=await xe({timestamp:t,template:T,class:i});if(e.status===201){f.success({message:n.formatMessage({id:"CalendarMenu.Saved"}),description:n.formatMessage({id:"CalendarMenu.DaySuccessfullySaved!"})});const s=await e.json();await v(s.id)}}await M(i),h(!1),c("")},U=async()=>{(await Te({timestamp:B,template:j,class:i})).status===201&&(f.success({message:n.formatMessage({id:"CalendarMenu.Saved"}),description:n.formatMessage({id:"CalendarMenu.templateSuccessfullySaved!"})}),await M(),h(!1),c(""),C(0),D(""))},X=e=>{R(e),c(""),h(!1),w(""),l(0),e||(C(0),D(""))},Z=e=>{c(e)},ee=e=>{D(e)},ae=e=>{if(e){const s=x.utc(e.startOf("isoWeek").format("DD.MM.YYYY"),"DD.MM.YYYY").unix();C(s),c(""),h(!1),w(""),l(0)}},te=async e=>{try{r(!0),k([]),c(""),h(!1),w(""),l(0),d(e.target.value),await M(e.target.value)}catch{f.error({message:n.formatMessage({id:"window.error"}),description:"Class not found",placement:"topRight"})}finally{r(!1)}},v=o.useCallback(async e=>{const Y=await(await F(i,e)).json();Y&&(w(Y),c(Y.template.id),C(0),D(""),R(!1))},[i]),O=o.useCallback(async()=>{const e=y.find(s=>s.timestamp===t);e?(r(!0),await v(e.id)):(w(""),h(!1),c(""),C(0),D(""),R(!1))},[y,v,t]),se=async()=>{const e=await ve(p.id);e.status===204?(f.success({message:n.formatMessage({id:"CalendarMenu.Removed"}),description:n.formatMessage({id:"CalendarMenu.DaySuccessfullyRemoved!"}),placement:"topRight"}),await M(),l(0),h(!1),c(""),w("")):f.error({message:n.formatMessage({id:"window.error"}),description:e.statusText,placement:"topRight"})},ne=()=>{h(!1),c("")},re=async()=>{h(!0),l(p.timestamp),c(p.template.id)},M=o.useCallback(async e=>{try{r(!0),k([]);const s=await F(e||i);if(s.status===401){$({type:"user/SET_STATE",payload:{authorized:!1}}),r(!1);return}const ce=(await s.json()).map(L=>({timestamp:L.timestamp,id:L.id}));k(ce)}catch{r(!1),f.error({message:n.formatMessage({id:"window.error"}),description:"Calendar not found",placement:"topRight"})}},[$,n]),ie=e=>e&&e.weekday()===6,oe=y.map(e=>x.unix(e.timestamp).format("DD-MM-YYYY")),le=e=>{const s={};return oe.indexOf(e.format("DD-MM-YYYY"))!==-1&&(s.border="1px solid #1890ff",s.borderRadius="50%"),a("div",{className:"ant-picker-cell-inner",style:s,children:e.date()})},de=y.map(e=>x.unix(e.timestamp).format("DD-MM-YYYY"));return o.useEffect(()=>{document.title="Calendar menu",A().finally(()=>r(!1)),E().finally(()=>r(!1)),M().finally(()=>r(!1))},[A,E,M]),o.useEffect(()=>{O().finally(()=>r(!1))},[O]),a(we,{roles:["root","admin"],redirect:!0,to:"/main",children:a("div",{children:u("div",{className:"card",children:[a("div",{className:"card-header",children:a("div",{className:"utils__title",children:a("strong",{children:n.formatMessage({id:"erp.menuCalendar"})})})}),a("div",{className:"card-body",children:u(q,{gutter:16,children:[u(W,{md:12,sm:24,children:[u("center",{children:[u(b.Group,{value:i,style:{marginBottom:16},onChange:te,children:[a(b.Button,{value:"Normal",children:"Normal"}),a(b.Button,{value:"Vegetarian",children:"Vegetarian"}),a(b.Button,{value:"B2B",children:"B2B"})]}),a(Me,{onChange:X,checked:I,style:{margin:"0 5px"}}),n.formatMessage({id:"CalendarMenu.WeekMode"})]}),u(q,{gutter:16,children:[a(W,{md:24,sm:24,className:"mb-4",children:a(ke,{spinning:g,children:a(Be,{highlightedDays:de,onSelectChange:J,onDisableDate:ie,isActive:!0})})}),u(W,{md:24,sm:24,children:[a("center",{children:I&&a(Ie,{format:"w \\w\\e\\e\\k - YYYY",dateRender:le,onChange:ae})}),B!==0&&I&&a(N,{showSearch:!0,value:j||void 0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:"Search...",filterOption:(e,s)=>s.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:"100%",margin:"15px 0 15px 0"},onChange:ee,children:K.map(e=>a(_,{value:e.id,children:e.name},e.id))}),a("center",{children:B!==0&&a(S,{type:"primary",onClick:U,style:{margin:"0 5px 5px 0"},disabled:!j,children:n.formatMessage({id:"window.save"})})}),(t!==0&&Boolean(!p)||m)&&a(N,{showSearch:!0,value:T||void 0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:"Search...",filterOption:(e,s)=>s.props.children.toLowerCase().indexOf(e.toLowerCase())>=0,style:{width:"100%",margin:"0 0 15px 0"},onChange:Z,children:z.map(e=>{if(!(i==="B2B"&&!e.isB2B))return a(_,{value:e.id,children:e.name},e.id)})}),u("div",{style:{marginTop:"10px",textAlign:"center"},children:[p&&!m&&a(S,{type:"primary",onClick:re,style:{margin:"0 5px 5px 0"},children:n.formatMessage({id:"window.edit"})}),(t!==0&&Boolean(!p)||m)&&a(S,{type:"primary",onClick:Q,style:{margin:"0 5px 5px 0"},disabled:!T,children:n.formatMessage({id:"window.save"})}),m&&a(S,{type:"default",onClick:ne,style:{margin:"0 5px 5px 0"},children:n.formatMessage({id:"window.cancel"})}),p&&!m&&a(Ce,{title:"Are you sure delete this day?",onConfirm:se,okText:"Yes",cancelText:"No",children:a(S,{type:"primary",danger:!0,children:n.formatMessage({id:"window.remove"})})})]})]})]})]}),a(W,{md:12,sm:24,children:a(je,{day:p})})]})})]})})})};export{Ze as default};
