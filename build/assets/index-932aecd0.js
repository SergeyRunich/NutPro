var he=Object.defineProperty;var pe=(p,f,t)=>f in p?he(p,f,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[f]=t;var x=(p,f,t)=>(pe(p,typeof f!="symbol"?f+"":f,t),t);import{a1 as z,a2 as A,c as o,j as e,bw as O,a5 as $,T as me,I as V,a6 as Y,B as k,aY as G,r as ue,a3 as v,bd as K,aW as H,aX as ge,aZ as X,be as re,bl as m,bp as ye,a8 as fe,bg as Te,b4 as Z}from"./index-c20b5e8e.js";import{T as be}from"./index-83b0f9b6.js";import{g as q,d as xe,c as we,a as Se,e as Ce}from"./template-0cdd19f6.js";import{F as R}from"./index-a86cfb93.js";import{R as E,C as w}from"./row-58ed805b.js";import{D as ne}from"./index-1e692111.js";import{D as De}from"./index-98f1088d.js";import{I as J}from"./index-86d1917a.js";import{D as ke,C as ve,P as Me}from"./react-beautiful-dnd.esm-d864c540.js";import{b as le}from"./techcard-66c5dea0.js";import{g as Ie,s as Ee}from"./testSettings-9d6c3207.js";import{T as _}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as de}from"./index-67f4e7c4.js";/* empty css              */import{T as W}from"./index-8e340a60.js";import"./styleChecker-a7b568e2.js";var Q;const{Option:C}=$;let Fe=z(Q=class extends A.Component{constructor(){super(...arguments);x(this,"state",{})}render(){const{dishes:t,techcards:a,onChangeDish:i,deleteDish:s,getItemStyle:h,getListStyle:l,onChangeAlways:u,onDragEnd:n,always:g,isB2B:y,kcalSettings:c,intl:{formatMessage:r}}=this.props;return o("div",{children:[t.length!==0&&e("div",{children:e(ke,{onDragEnd:n,children:e(E,{gutter:16,children:e(w,{md:24,sm:24,children:e(ve,{droppableId:"droppable",children:(L,M)=>o("div",{...L.droppableProps,ref:L.innerRef,style:l(M.isDraggingOver),children:[t.map((T,D)=>{const B=Math.round(T.basicKcal*T.amount),d=T.meal===10?4:T.meal,S=O(c,{meal:d});return e(Me,{draggableId:T.key,index:D,children:(I,oe)=>e("div",{ref:I.innerRef,...I.draggableProps,...I.dragHandleProps,style:h(oe.isDragging,I.draggableProps.style),children:o(E,{style:{width:"100%"},gutter:16,children:[e(w,{md:8,sm:24,children:e($,{showSearch:!0,value:t[D].techcard||void 0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:"Select techcard...",filterOption:(b,ce)=>ce.props.children.toLowerCase().indexOf(b.toLowerCase())>=0,style:{width:"100%"},onChange:b=>i(b,"techcard",D),children:a.map(b=>e(C,{value:b.id,children:b.title},b.id))})}),e(w,{md:2,sm:24,children:e(J,{placeholder:r({id:"DishList.Coeff"}),value:T.amount,style:{width:"100%"},onChange:b=>i(b,"amount",D)})}),e(w,{md:2,sm:24,children:e(me,{title:`${S.min.kcal}kcal - ${S.max.kcal}kcal`,children:e(V,{placeholder:"kcal",value:`${B} kcal`,style:{width:"100%",background:`${B<S.min.kcal||B>S.max.kcal?"#eb4949":"#FFF"}`,color:"#000"},contentEditable:!1})})}),e(w,{md:4,sm:24,children:o($,{value:T.meal,placeholder:"Meal",style:{width:"100%"},onChange:b=>i(b,"meal",D),children:[e(C,{value:0,children:r({id:"DishList.Breakfast"})},0),e(C,{value:1,children:r({id:"DishList.1Snack"})},1),e(C,{value:2,children:r({id:"DishList.Lunch"})},2),e(C,{value:3,children:r({id:"DishList.2Snack"})},3),e(C,{value:4,children:r({id:"DishList.Dinner"})},4),e(C,{value:5,children:r({id:"DishList.2Dinner"})},5),e(C,{value:10,children:r({id:"DishList.Salad"})},10)]})}),o(w,{md:4,sm:24,children:[T.meal<10&&e(J,{placeholder:r({id:"DishList.Group"}),value:T.group,style:{width:"100%"},onChange:b=>i(b,"group",D)}),T.meal>=10&&o($,{value:T.group,placeholder:r({id:"DishList.Meal"}),style:{width:"100%"},onChange:b=>i(b,"group",D),children:[e(C,{value:0,children:r({id:"DishList.Breakfast"})},0),e(C,{value:1,children:r({id:"DishList.1Snack"})},1),e(C,{value:2,children:r({id:"DishList.Lunch"})},2),e(C,{value:3,children:r({id:"DishList.2Snack"})},3),e(C,{value:4,children:r({id:"DishList.Dinner"})},4)]})]}),!y&&e(w,{md:2,sm:24,children:e(Y,{disabled:g.length>=2&&g.indexOf(T.group)===-1,value:g.indexOf(T.group)!==-1,checked:g.indexOf(T.group)!==-1,onChange:b=>u(b,T.group,D),children:r({id:"DishList.Always"})})}),e(w,{md:2,sm:24,children:e(k,{type:"primary",danger:!0,onClick:()=>s(D),children:r({id:"window.remove"})})})]})})},T.key)}),L.placeholder]})})})})})}),t.length===0&&e(G,{description:!1})]})}})||Q;var ee;const $e=(p,f,t)=>{const a=Array.from(p),[i]=a.splice(f,1);return a.splice(t,0,i),a},U=8,Ae=(p,f)=>({userSelect:"none",padding:U,margin:`0 0 ${U}px 0`,borderRadius:"5px",background:p?"lightgreen":"",...f}),Le=(p=[],f=[])=>{if(p.length===0)return!0;for(const t of f){const a=Math.round(t.basicKcal*t.amount),i=t.meal===10?4:t.meal,s=O(p,{meal:i});if(a<s.min.kcal||a>s.max.kcal)return!1}return!0},Be=()=>({padding:U,borderRadius:"5px"});let Re=z(ee=class extends A.Component{constructor(t){super(t);x(this,"state",{name:"",always:[],isEdit:!1,techcards:[],dishes:[{techcard:null,amount:1,meal:0,basicKcal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}],kcalSettings:[],isB2B:!1});x(this,"formRef",ue.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.deleteDish=this.deleteDish.bind(this),this.addDish=this.addDish.bind(this),this.onChangeDish=this.onChangeDish.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onChangeAlways=this.onChangeAlways.bind(this)}componentDidMount(){le().then(async t=>{if(t.status===200){const a=await t.json();this.setState({techcards:a})}}),Ie().then(async t=>{if(t.status===200){const a=await t.json();this.setState({kcalSettings:a.result})}})}onDragEnd(t){if(!t.destination)return;const{dishes:a}=this.state,i=$e(a,t.source.index,t.destination.index);this.setState({dishes:i})}onChangeField(t,a){t.target?t.target.type==="checkbox"?this.setState({[a]:t.target.checked}):this.setState({[a]:t.target.value}):this.setState({[a]:t})}onChangeDish(t,a,i){const{dishes:s,techcards:h}=this.state;let l=t;if(t.target&&(t.target.type==="checkbox"?l=t.target.checked:l=t.target.value),s[i][a]=l,a==="techcard"){const u=O(h,{id:l});s[i].basicKcal=u.nutrients.energy}this.setState({dishes:s})}onChangeAlways(t,a){const{always:i}=this.state;let s=t;t.target&&(t.target.type==="checkbox"?s=t.target.checked:s=t.target.value);const h=i.indexOf(a);s?i.push(a):!s&&h!==-1&&i.splice(h,1),this.setState({always:i})}async onFinish(){const{intl:{formatMessage:t}}=this.props;try{const{create:a,edit:i,forEdit:s,update:h}=this.props;await this.formRef.current.validateFields();const{name:l,always:u,dishes:n,isB2B:g,kcalSettings:y}=this.state;!g&&u.length<2&&u.push(u[0]),Le(y,n)||v.warning({message:t({id:"CreateTemplate.MenuRegulations"}),description:t({id:"CreateTemplate.kCalIsNotIncludedInkCalRange"}),placement:"topRight"});const c={name:l,always:u,dishes:n,isB2B:g};if(s.id){const r=await i(s.id,c);r.status===200?(this.closeDrawer(),v.success({message:t({id:"window.success"}),description:t({id:"CreateTemplate.TemplateSuccessfullySaved!"})}),h()):v.error({message:t({id:"window.error"}),description:r.statusText,placement:"topLeft"})}else{const r=await a(c);r.status===201?(this.closeDrawer(),v.success({message:t({id:"CreateTemplate.Created"}),description:t({id:"CreateTemplate.TemplateSuccessfullyCreated!"})}),h()):v.error({message:t({id:"window.error"}),description:r.statusText,placement:"topLeft"})}}catch(a){console.log("Failed:",a)}}setEdit(){const{forEdit:t}=this.props;t&&this.setState({name:t.name,always:t.always,dishes:t.dishes.map(a=>({techcard:a.techcard.id,amount:a.amount,meal:a.meal,basicKcal:Math.round(a.kcal/a.amount),group:a.group,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)})),isB2B:t.isB2B,isEdit:!0})}componentDidUpdate(t){var i;const{forEdit:a}=this.props;a&&t.forEdit!==a&&((i=this.formRef.current)==null||i.setFieldsValue({name:a.name,always:a.always,isB2B:a.isB2B}))}addDish(){const{dishes:t}=this.state;t.push({techcard:"",amount:1,meal:0,basicKcal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}),this.setState({dishes:t})}deleteDish(t){const{dishes:a}=this.state;a.splice(t,1),this.setState({dishes:a})}closeDrawer(){const{onClose:t}=this.props;t(),this.setState({name:"",always:[],dishes:[{techcard:"",amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}],isB2B:!1,isEdit:!1}),this.formRef.current.resetFields()}render(){const{visible:t,forEdit:a,intl:{formatMessage:i}}=this.props,{isEdit:s,techcards:h,dishes:l,always:u,isB2B:n,kcalSettings:g}=this.state;return a.id&&!s&&this.setEdit(),e("div",{children:e(ne,{title:i(s?{id:"CreateTemplate.EDITTEMPLATE"}:{id:"CreateTemplate.CREATENEWTEMPLATE"}),width:"100%",height:"100%",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:o(R,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[o(E,{gutter:16,children:[e(w,{md:15,sm:24,children:e(R.Item,{label:i({id:"window.name"}),name:"name",rules:[{required:!0}],children:e(V,{onChange:y=>this.onChangeField(y,"name")})})}),e(w,{md:n?5:2,sm:24,children:o(R.Item,{label:i({id:"CreateTemplate.B2BTemplate"}),name:"isB2B",children:[e(Y,{onChange:y=>this.onChangeField(y,"isB2B")})," ",n?"Yes":"No"]})}),!n&&e(w,{md:3,sm:24,children:e(R.Item,{label:i({id:"CreateTemplate.AlwaysPortions"}),name:"always",children:e(V,{disabled:!0,onChange:y=>this.onChangeField(y,"always")})})}),e(w,{md:4,sm:24,style:{marginTop:"16px",alignContent:"right"},children:e(R.Item,{children:e(k,{size:"large",htmlType:"submit",type:"primary",children:i({id:"window.save"})})})})]}),e(E,{gutter:16,children:o(w,{md:24,sm:24,children:[o(De,{orientation:"left",children:[i({id:"CreateTemplate.PositionsSPACE"}),e(k,{type:"primary",size:"small",onClick:this.addDish,children:i({id:"CreateTemplate.Add"})})]}),e(Fe,{techcards:h,kcalSettings:g,addDish:this.addDish,deleteDish:this.deleteDish,onChangeDish:this.onChangeDish,onChangeAlways:this.onChangeAlways,onDragEnd:this.onDragEnd,getItemStyle:Ae,getListStyle:Be,dishes:l,always:u,isB2B:n})]})})]})})})}})||ee;var te,j;let Ve=(te=K(({user:p})=>({user:p})),z(j=te(j=class extends A.Component{constructor(t){super(t);x(this,"state",{tableData:[],data:[],filterDropdownVisible:!1,searchText:"",filtered:!1,loading:!0});x(this,"onInputChange",t=>{this.setState({searchText:t.target.value})});x(this,"onSearch",()=>{const{searchText:t,tableData:a}=this.state,i=new RegExp(t,"gi");this.setState({filterDropdownVisible:!1,filtered:!!t,data:a.map(s=>s.id.match(i)?{...s,id:s.id}:null).filter(s=>!!s)}),t===""&&this.setState({filtered:!1})});x(this,"refSearchInput",t=>{this.searchInput=t});this.update=this.update.bind(this)}UNSAFE_componentWillMount(){this.update()}update(){const{data:t}=this.props;this.setState({tableData:t,data:t,loading:!1})}render(){const{data:t,searchText:a,filterDropdownVisible:i,filtered:s}=this.state,{edit:h,removeTemplate:l,dublicateTemplate:u,intl:{formatMessage:n}}=this.props,g=c=>e(X,{style:{padding:"0px"},children:e(X.Item,{children:e(de,{title:"Are you sure delete this template?",onConfirm:async()=>l(c),okText:"Yes",cancelText:"No",children:n({id:"window.remove"})})},"remove")}),y=[{title:n({id:"TemplateMenu.ID"}),dataIndex:"id",key:"id",sorter:(c,r)=>c.id.length-r.id.length,render:c=>e("span",{children:e("strong",{children:` ${c}`})}),filterDropdown:o("div",{className:"custom-filter-dropdown",style:{padding:"5px"},children:[e(V,{ref:this.refSearchInput,placeholder:"Search id",value:a,onChange:this.onInputChange,onPressEnter:this.onSearch}),e(k,{type:"primary",onClick:this.onSearch,style:{marginTop:"5px"},children:n({id:"TemplateMenu.Search"})})]}),filterIcon:e(H,{style:{color:s?"#108ee9":"#aaa"}}),filterDropdownVisible:i,onFilterDropdownVisibleChange:c=>{this.setState({filterDropdownVisible:c},()=>this.searchInput&&this.searchInput.focus())}},{title:n({id:"TemplateMenu.Template"}),dataIndex:"name",key:"name",sorter:(c,r)=>c.name.length-r.name.length,render:c=>e("span",{children:e("strong",{children:` ${c}`})}),filterDropdown:o("div",{className:"custom-filter-dropdown",style:{padding:"5px"},children:[e(V,{ref:this.refSearchInput,placeholder:n({id:"TemplateMenu.SearchName"}),value:a,onChange:this.onInputChange,onPressEnter:this.onSearch}),e(k,{type:"primary",onClick:this.onSearch,style:{marginTop:"5px"},children:n({id:"TemplateMenu.Search"})})]}),filterIcon:e(H,{style:{color:s?"#108ee9":"#aaa"}}),filterDropdownVisible:i,onFilterDropdownVisibleChange:c=>{this.setState({filterDropdownVisible:c},()=>this.searchInput&&this.searchInput.focus())}},{title:n({id:"TemplateMenu.Count"}),dataIndex:"dishes",key:"dishes",render:c=>e("span",{children:`${c?c.length:"-"}`}),sorter:(c,r)=>c.dishes.length-r.dishes.length},{title:n({id:"TemplateMenu.Class"}),dataIndex:"class",key:"class",render:c=>e("span",{children:`${c||"-"}`}),sorter:(c,r)=>c.class.length-r.amount.length},{title:"---",dataIndex:"id",key:"actionEdit",render:(c,r)=>e("span",{children:e(ge.Button,{overlay:g(c),onClick:()=>h(r),children:n({id:"window.edit"})})})},{title:"---",dataIndex:"id",key:"actionDuplicate",render:(c,r)=>e("span",{children:e(k,{overlay:g(c),onClick:()=>u(r.id),children:n({id:"TemplateMenu.Duplicate"})})})}];return e(_,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:y,dataSource:t,pagination:{position:"bottom",total:t.length,showTotal:(c,r)=>`${r[0]}-${r[1]} of ${c} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:t.length<10},loading:this.state.loading,rowKey:()=>Math.random()})}})||j)||j);var ae,N;let ze=(ae=K(({user:p})=>({user:p})),re(N=ae(N=class extends A.Component{constructor(){super(...arguments);x(this,"state",{})}render(){const{techcard:t,visible:a,onClose:i}=this.props,s=[{title:e("strong",{children:e(m,{id:"erp.ingredient"})}),dataIndex:"name",key:"name",render:n=>e("span",{children:e("strong",{children:` ${n}`})})},{title:e("strong",{children:e(m,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:n=>e("span",{children:`${n}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:n=>e("span",{children:`${n||"-"}`})},{title:e("strong",{children:e(m,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(n,g,y)=>e("span",{children:`${t.ingredientsAmount[y]/((100-g.percent)/100)}`})},{title:e("strong",{children:e(m,{id:"erp.netto"})}),dataIndex:"ingredientsAmount",key:"netto",render:(n,g,y)=>e("span",{children:`${t.ingredientsAmount[y]}`})}],h=[{title:e("strong",{children:e(m,{id:"erp.semiproduct"})}),dataIndex:"title",key:"title",render:n=>e("span",{children:e("strong",{children:` ${n}`})})},{title:e("strong",{children:e(m,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:n=>e("span",{children:`${n?"ks":"kilogram"}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:n=>e("span",{children:`${n||"-"}`})},{title:e("strong",{children:e(m,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(n,g,y)=>e("span",{children:`${t.subTechcardsAmount[y]/((100-g.percent)/100)}`})},{title:e("strong",{children:e(m,{id:"erp.netto"})}),dataIndex:"subTechcardsAmount",key:"netto",render:(n,g,y)=>e("span",{children:`${t.subTechcardsAmount[y]}`})}],l={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},u={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return e(ne,{title:"CREATE NEW TEMPLATE",width:"100%",height:"100%",onClose:()=>i(),open:a,bodyStyle:{paddingBottom:80},children:o("div",{children:[t.id&&o(E,{gutter:16,children:[o(w,{sm:24,md:14,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(m,{id:"erp.ingredients"})})}),e(_,{columns:s,dataSource:t?t.ingredients:[],pagination:!1,bordered:!0,rowKey:()=>Math.random()}),e("div",{style:{paddingLeft:"10px",marginTop:"10px"},children:e("h4",{children:e(m,{id:"erp.semiproducts"})})}),e(_,{columns:h,dataSource:t?t.subTechcards:[],pagination:!1,bordered:!0,rowKey:()=>Math.random()}),o("div",{style:{float:"right",fontSize:18,marginTop:"10px"},children:[e("b",{children:"Total:"})," ",t.amount*1e3," gram"]})]}),o(w,{sm:24,md:10,children:[o("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.title})}),e("table",{style:u,children:o("tbody",{children:[o("tr",{children:[e("th",{style:l,children:"kCal"}),e("th",{style:l,children:e(m,{id:"erp.prot"})}),e("th",{style:l,children:e(m,{id:"erp.fat"})}),e("th",{style:l,children:e(m,{id:"erp.carb"})})]}),o("tr",{children:[e("td",{style:l,children:Math.round(t.nutrients.energy)}),e("td",{style:l,children:Math.round(t.nutrients.prot)}),e("td",{style:l,children:Math.round(t.nutrients.fat)}),e("td",{style:l,children:Math.round(t.nutrients.carb)})]},"kbzhu")]})}),o("div",{style:{marginTop:"10px"},children:[t.isSubTechcard&&e(W,{color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:e(m,{id:"erp.semiproduct"})})},Math.random()),t.tags.map(n=>e(W,{color:"blue",children:e("span",{style:{fontSize:"14px"},children:n.cz})},Math.random()))]})]}),e("center",{children:e("div",{style:{marginTop:"10px"},children:e("h4",{children:e(m,{id:"erp.technologyÐ¡ooking"})})})}),e("div",{className:"card",style:{border:"1px solid #e8e8e8"},children:e("div",{className:"card-body",children:t.description})})]})]}),!t.id&&e(G,{description:!1})]})})}})||N)||N);var ie,P;let je=(ie=K(({user:p})=>({user:p})),z(P=ie(P=class extends A.Component{constructor(){super(...arguments);x(this,"state",{testData:[],testVisible:!1,selectedTechcard:"",techcardVisible:!1,range:{min:0,max:0}});x(this,"showTechcard",t=>{le(t).then(async a=>{if(a.status===200){const i=await a.json();this.setState({selectedTechcard:i,techcardVisible:!0})}})});x(this,"onCloseTechcard",()=>{this.setState({techcardVisible:!1,selectedTechcard:""})})}UNSAFE_componentWillReceiveProps(){this.setState({testData:[],testVisible:!1})}async startTest(t){const{intl:{formatMessage:a}}=this.props;try{const s=await Ee({dayTemplate:t});if(s.status===200){const h=await s.json();v.success({message:a({id:"window.success"}),description:a({id:"TemplateDetail.TestFinished!"})}),this.setState({testData:h.dishes,range:h.range,testVisible:!0})}else v.error({message:a({id:"window.error"}),description:s.statusText,placement:"topLeft"})}catch(i){console.log("Failed:",i)}}render(){const{template:t,edit:a,removeTemplate:i,user:s,dublicateTemplate:h,intl:{formatMessage:l}}=this.props,{testVisible:u,testData:n,range:g,selectedTechcard:y,techcardVisible:c}=this.state,r=["Breakfast","1 Snack","Lunch","2 Snack","Dinner","2 Dinner","","","","","Salad"],L=[{title:e("strong",{children:"#"}),key:Math.random(),render:(d,S,I)=>e("span",{children:e("strong",{children:` ${I+1}`})})},{title:e("strong",{children:e(m,{id:"erp.dish"})}),dataIndex:"techcard",key:"name",render:(d,S)=>e("span",{children:e("strong",{children:e(k,{type:"link",onClick:()=>this.showTechcard(S.techcard.id),children:` ${d.title}`})})})},{title:e("strong",{children:e(m,{id:"erp.coefficient"})}),dataIndex:"amount",key:"amount",render:d=>e("span",{children:`${d}`}),sorter:(d,S)=>d.amount-S.amount},{title:e("strong",{children:e(m,{id:"erp.weightG"})}),dataIndex:"amount",key:"amount2",render:(d,S)=>{const I=Math.floor(d*S.techcard.amount*100)*10;return e("span",{children:`${I}`})}},{title:e("strong",{children:"kCal"}),dataIndex:"kcal",key:"kcal",render:d=>e("span",{children:`${d}`})},{title:e("strong",{children:"P"}),dataIndex:"prot",key:"prot",render:d=>e("span",{children:`${d}`})},{title:e("strong",{children:"F"}),dataIndex:"fat",key:"fat",render:d=>e("span",{children:`${d}`})},{title:e("strong",{children:"C"}),dataIndex:"carb",key:"carb",render:d=>e("span",{children:`${d}`})},{title:e("strong",{children:e(m,{id:"erp.meal"})}),dataIndex:"meal",key:"meal",render:d=>e("span",{children:`${r[d]}`}),sorter:(d,S)=>d.meal-S.meal},{title:e("strong",{children:e(m,{id:"erp.group"})}),dataIndex:"group",key:"group",render:d=>e("span",{children:`${d}`}),sorter:(d,S)=>d.group-S.group}],M={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},T={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",backgroundColor:"red"},D={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",backgroundColor:"green"},B={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",display:"inline-table"};return o("div",{children:[t.id&&o(ye,{children:[e(E,{gutter:16,children:e(w,{sm:24,md:24,children:o("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.name})}),o("div",{style:{display:"flex",marginTop:"10px",flexDirection:"row",justifyContent:"center"},children:[s.name!=="david"&&o("div",{style:{display:"flex"},children:[e(k,{type:"primary",onClick:()=>a(t),style:{margin:"0 5px 5px 0"},children:e(m,{id:"window.edit"})}),e(de,{title:l({id:"TemplateDetail.AreYouSureDeleteThisTemplate?"}),onConfirm:async()=>i(t.id),okText:l({id:"window.yes"}),cancelText:l({id:"window.no"}),children:e(k,{type:"primary",danger:!0,children:e(m,{id:"window.remove"})})}),e(k,{type:"primary",onClick:()=>h(t.id),style:{margin:"0 0px 0px 5px"},children:l({id:"TemplateDetail.Duplicate"})})]}),e("div",{style:{display:"flex",marginLeft:"5px",alignItems:"center",height:"37px"},children:e(W,{style:{margin:"0 5px 5px 0"},color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:t.class})},Math.random())}),e("div",{style:{display:"flex"},children:e(k,{type:"primary",onClick:()=>this.startTest(t.id),style:{margin:"0 5px 5px 0"},children:l({id:"TemplateDetail.kCalTest"})})}),o("div",{style:{display:"flex",alignItems:"center"},children:[u&&e("table",{style:B,children:o("tbody",{children:[o("tr",{children:[e("th",{style:M,children:e(m,{id:"erp.meal"})}),e("th",{style:M,children:l({id:"TemplateDetail.Option"})}),e("th",{style:M,children:l({id:"TemplateDetail.Min"})}),e("th",{style:M,children:l({id:"TemplateDetail.Max"})})]}),n.map(d=>o("tr",{children:[e("td",{style:M,children:r[d.meal]}),e("td",{style:M,children:e(Y,{checked:d.optional,disabled:!0})}),e("td",{style:d.min.total>=d.min.shouldBe&&d.min.total!==1e4?D:T,children:d.min.total!==1e4?d.min.total:"-"}),e("td",{style:d.max.total<=d.max.shouldBe&&d.max.total!==0?D:T,children:d.max.total!==0?d.max.total:"-"})]},Math.random()))]})}),u&&o("p",{style:{fontSize:"30px",marginLeft:"15px"},children:[e("br",{})," KCal range",e("br",{})," ",g.min," - ",g.max," "]})]})]})]})})}),e(E,{gutter:16,children:o(w,{sm:24,md:24,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(m,{id:"erp.positions"})})}),e(_,{columns:L,dataSource:t?t.dishes:[],pagination:!1,rowKey:()=>Math.random(),bordered:!0})]})})]}),!t.id&&e(G,{description:!1}),e(ze,{visible:c,techcard:y,onClose:this.onCloseTechcard})]})}})||P)||P);var se,F;const{Option:Ne}=$;let ot=(se=K(({user:p})=>({user:p})),z(F=re(F=se(F=class extends A.Component{constructor(t){super(t);x(this,"state",{data:[],createTemplateFormVisible:!1,forEdit:{},selected:{id:""}});x(this,"showDrawerCreateTemplateForm",()=>{this.setState({createTemplateFormVisible:!0})});x(this,"editTemplateModal",t=>{this.setState({forEdit:t,createTemplateFormVisible:!0})});x(this,"selectTemplate",t=>{const{data:a}=this.state,i=a.find(s=>s.id===t);i&&this.setState({selected:i})});x(this,"onCloseCreateTemplateForm",()=>{this.setState({createTemplateFormVisible:!1,forEdit:{}})});this.updateTemplates=this.updateTemplates.bind(this),this.removeTemplate=this.removeTemplate.bind(this),this.dublicateTemplate=this.dublicateTemplate.bind(this)}UNSAFE_componentWillMount(){q().then(async t=>{if(t.status===401){const{dispatch:a}=this.props;a({type:"user/SET_STATE",payload:{authorized:!1}});return}if(t.status===200){const a=await t.json();this.setState({data:a})}})}updateTemplates(){q().then(async t=>{if(t.status===401){const{dispatch:a}=this.props;a({type:"user/SET_STATE",payload:{authorized:!1}});return}if(t.status===200){const a=await t.json();let{selected:i}=this.state;if(i.id){const s=a.find(h=>h.id===i.id);i&&(i=s)}else i={};this.setState({data:a,forEdit:{},selected:i})}})}async removeTemplate(t){const{intl:{formatMessage:a}}=this.props,i=await xe(t);i.status===204?(v.success({message:a({id:"TemplateMenu.Deleted"}),description:a({id:"TemplateMenu.TemplateSuccessfullyDeleted!"}),placement:"topRight"}),this.updateTemplates(),this.setState({selected:{}})):v.error({message:a({id:"window.error"}),description:i.statusText,placement:"topRight"})}async dublicateTemplate(t){const{intl:{formatMessage:a}}=this.props,i=await we(t);if(i.status===200){v.success({message:a({id:"TemplateMenu.Duplicated"}),description:a({id:"TemplateMenu.TemplateSuccessfullyDuplicated!"}),placement:"topRight"}),this.updateTemplates();const s=await i.json();q().then(async h=>{if(h.status===200){const l=await h.json();this.setState({data:l});const u=O(this.state.data,{id:s.id});this.editTemplateModal(u)}})}else v.error({message:a({id:"window.error"}),description:i.statusText,placement:"topRight"})}render(){const{data:t,createTemplateFormVisible:a,forEdit:i,selected:s}=this.state,{intl:{formatMessage:h}}=this.props;return o(fe,{roles:["root","admin"],redirect:!0,to:"/main",children:[e(Te,{title:h({id:"TemplateMenu.DayTemplates"})}),o("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:h({id:"TemplateMenu.DayTemplates"})})})}),o("div",{className:"card-body",children:[e(k,{type:"primary",onClick:this.showDrawerCreateTemplateForm,style:{marginBottom:"15px"},children:h({id:"TemplateMenu.NewTemplate"})}),e(be,{defaultActiveKey:"1",type:"card",items:[{label:h({id:"TemplateMenu.Search/View"}),key:"1",children:o(Z,{spinning:!1,children:[e("center",{children:e($,{showSearch:!0,autoClearSearchValue:!1,showArrow:!1,placeholder:h({id:"TemplateMenu.SearchTemplate..."}),filterOption:(l,u)=>u.props.children.toString().toLowerCase().indexOf(l.toLowerCase())>=0,style:{width:"500px",marginBottom:"15px"},onChange:this.selectTemplate,children:t.map(l=>o(Ne,{value:l.id,children:[l.isCompleted?h({id:"TemplateMenu.[COMPLETED]"}):"",l.name]},l.id))})}),e(je,{template:s,edit:this.editTemplateModal,removeTemplate:this.removeTemplate,dublicateTemplate:this.dublicateTemplate})]})},{label:h({id:"TemplateMenu.SearchTemplate..."}),key:"2",children:e(Z,{spinning:!1,children:e(Ve,{data:t,edit:this.editTemplateModal,removeTemplate:this.removeTemplate,dublicateTemplate:this.dublicateTemplate})})}]})]})]}),e(Re,{visible:a,onClose:this.onCloseCreateTemplateForm,data:t,forEdit:i,create:Se,edit:Ce,update:this.updateTemplates})]})}})||F)||F)||F);export{ot as default};
