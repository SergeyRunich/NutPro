import{r as o,A as J,_ as O,a as j,b as H,aa as W,c2 as X,a3 as b,j as e,b4 as ee,c as h,I as u,a5 as D,a6 as Y,B as C,aW as re,bF as te,a8 as P,aJ as se,bg as ae,bf as F}from"./index-c20b5e8e.js";/* empty css              */import{P as ne}from"./index-67f4e7c4.js";import{T as ie}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{u as K,g as Z}from"./components-ada4a050.js";import{m as de,h as oe,n as le}from"./customer-fbff77ee.js";import{T as B,a as ce,c as R,d as z,f as $,g as q,e as me}from"./constants-480696f2.js";import{D as he}from"./index-1e692111.js";import{F as l}from"./index-a86cfb93.js";import{R as w,C as m}from"./row-58ed805b.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as ue}from"./index-2f7554ca.js";import{g as pe}from"./kitchen-60ac824b.js";import{E as ge}from"./EditOutlined-c424161b.js";import"./styleChecker-a7b568e2.js";import"./index-8e340a60.js";var fe={icon:function(n,y){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M923 283.6a260.04 260.04 0 00-56.9-82.8 264.4 264.4 0 00-84-55.5A265.34 265.34 0 00679.7 125c-49.3 0-97.4 13.5-139.2 39-10 6.1-19.5 12.8-28.5 20.1-9-7.3-18.5-14-28.5-20.1-41.8-25.5-89.9-39-139.2-39-35.5 0-69.9 6.8-102.4 20.3-31.4 13-59.7 31.7-84 55.5a258.44 258.44 0 00-56.9 82.8c-13.9 32.3-21 66.6-21 101.9 0 33.3 6.8 68 20.3 103.3 11.3 29.5 27.5 60.1 48.2 91 32.8 48.9 77.9 99.9 133.9 151.6 92.8 85.7 184.7 144.9 188.6 147.3l23.7 15.2c10.5 6.7 24 6.7 34.5 0l23.7-15.2c3.9-2.5 95.7-61.6 188.6-147.3 56-51.7 101.1-102.7 133.9-151.6 20.7-30.9 37-61.5 48.2-91 13.5-35.3 20.3-70 20.3-103.3.1-35.3-7-69.6-20.9-101.9zM512 814.8S156 586.7 156 385.5C156 283.6 240.3 201 344.3 201c73.1 0 136.5 40.8 167.7 100.4C543.2 241.8 606.6 201 679.7 201c104 0 188.3 82.6 188.3 184.5 0 201.2-356 429.3-356 429.3z",fill:n}},{tag:"path",attrs:{d:"M679.7 201c-73.1 0-136.5 40.8-167.7 100.4C480.8 241.8 417.4 201 344.3 201c-104 0-188.3 82.6-188.3 184.5 0 201.2 356 429.3 356 429.3s356-228.1 356-429.3C868 283.6 783.7 201 679.7 201z",fill:y}}]}},name:"heart",theme:"twotone"};const ye=fe;var G=function(n,y){return o.createElement(J,O(O({},n),{},{ref:y,icon:ye}))};G.displayName="HeartTwoTone";const we=o.forwardRef(G),{Option:L}=D,M={name:"",inBodyId:"",phone:"",email:"",password:"",kitchen:"",comment:"",demoOrder:!1,address:"",paymentAddress:"",isCompany:!1,zip:null,regNumber:null,vatNumber:"",birthday:null,language:"cs",country:"CZ"},V=()=>Math.random().toString(36).slice(-8),Q=({visible:S,create:n,update:y,onClose:N})=>{const[I]=l.useForm(),{formatMessage:a}=j(),[T,x]=o.useState(!1),[t,U]=o.useState({...M,password:V()}),[E,A]=o.useState([]),v=H(),g=K(Z(Q,"kitchens"),async()=>(await pe()).json(),{retry:!1,cacheTime:0,onError:r=>b.error({message:`Failed to obtain kitchens list: ${r.message}`})});o.useEffect(()=>{!g.data||t.kitchen||U(r=>({...r,kitchen:g.data[0].id}))},[g.data,t.kitchen]);const d=(r,c)=>{if(r===null)return;let f=r;r.target&&(r.target.type==="checkbox"?f=r.target.checked:f=r.target.value);const s={[c]:f};if(c==="phone"){let i=f.replace(/\s/g,"");i.length>9&&(i=i.substr(-9,9)),s.inBodyId=i}U(i=>({...i,...s}))},p=()=>{U({...M,kitchen:g.data[0].id,password:V()}),I.resetFields(),N()},_=async()=>{x(!0);try{await I.validateFields();const r={address:t.address,birthday:t.birthday,comment:t.comment,demoOrder:t.demoOrder,email:t.email,inBodyId:t.inBodyId,kitchen:t.kitchen,name:t.name,password:t.password,phone:t.phone,paymentData:{address:t.paymentAddress,isCompany:t.isCompany,regNumber:t.regNumber,vatNumber:t.vatNumber,zip:t.zip},language:t.language,country:t.country},c=await n(r);c.status===202?(p(),b.success({message:a({id:"Users.Created"}),description:a({id:"Users.User successfully created!"})}),y()):c.status===409?b.error({message:a({id:"Users.Error InBodyId"}),description:a({id:"Users.User with current InBodyId already exist!"}),placement:"topLeft"}):b.error({message:a({id:"window.error"}),description:c.statusText,placement:"topLeft"})}catch(r){console.error("Failed:",r)}finally{x(!1)}};if(o.useEffect(()=>{I.setFieldsValue({name:t.name,phone:t.phone,email:t.email,birthday:t.birthday?W(t.birthday):null,address:t.address,paymentAddress:t.paymentAddress,zip:t.zip,regNumber:t.regNumber,vatNumber:t.vatNumber})},[]),o.useEffect(()=>{X().then(async r=>{if(r.status===401){v({type:"user/SET_STATE",payload:{authorized:!1}});return}const c=await r.json();A(c.result)}).catch(()=>{b.error({message:a({id:"window.error"}),description:"Failed to fetch languages",placement:"topLeft"})})},[v]),o.useEffect(()=>{const r=E.find(({primaryLanguage:c})=>c===t.language);r&&U(c=>({...c,country:r.code}))},[E,t.language]),!g.isFetched||!g.data||!t.kitchen)return e("center",{children:e(ee,{spinning:!0})});let k=1080;return typeof window.innerWidth<"u"&&(k=window.innerWidth),e(he,{title:a({id:"Users.Create a new account"}),width:k<768?"100%":"auto",onClose:p,open:S,bodyStyle:{paddingBottom:80},children:h(l,{form:I,layout:"vertical",onFinish:_,children:[h(w,{gutter:16,children:[e(m,{md:12,sm:24,children:e(l.Item,{label:"Name",name:"name",rules:[{required:!0}],children:e(u,{placeholder:a({id:"Users.Please enter user name"}),onChange:r=>d(r,"name")})})}),e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.InBodyId"}),rules:[{required:!0}],children:e(u,{placeholder:a({id:"Users.Please enter inBodyId"}),value:t.inBodyId,onChange:r=>d(r,"inBodyId")})})})]}),h(w,{gutter:16,children:[e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"window.phone"}),name:"phone",rules:[{required:!0}],children:e(u,{placeholder:a({id:"Users.Please enter phone"}),onChange:r=>d(r,"phone")})})}),e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"window.email"}),name:"email",rules:[{type:"email"}],children:e(u,{placeholder:a({id:"Users.Please enter email"}),onChange:r=>d(r,"email")})})})]}),h(w,{gutter:16,children:[e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.Password"}),rules:[{required:!0}],children:e(u,{disabled:!0,placeholder:a({id:"Users.Please enter password"}),value:t.password,onChange:r=>d(r,"password")})})}),e(m,{md:12,sm:24,children:e(l.Item,{name:"kitchen",label:"Kitchen",rules:[{required:!0,message:a({id:"Users.Please choose the kitchen"})}],children:e(D,{style:{width:"115px"},placeholder:a({id:"Users.Please choose the kitchen"}),value:t.kitchen,onChange:r=>d(r,"kitchen"),children:g.data.map(r=>e(L,{value:r.id,children:r.name},r.id))})})})]}),h(w,{gutter:16,children:[e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.Date of birth"}),name:"birthday",rules:[{required:!1}],children:e(ue,{style:{width:"100%"},format:"DD.MM.YYYY",placeholder:a({id:"window.date"}),onChange:r=>d(r.toISOString(),"birthday")})})}),e(m,{md:12,sm:24,children:e(l.Item,{name:"language",label:"Language",children:e(D,{value:t.language,onChange:r=>d(r,"language"),children:E.map(({primaryLanguage:r})=>e(L,{value:r,children:r},r))})})})]}),e(w,{gutter:16,children:e(m,{md:24,sm:24,children:e(l.Item,{label:a({id:"window.address"}),name:"address",rules:[{required:!0}],children:e(u,{placeholder:a({id:"Users.Please enter address"}),onChange:r=>d(r,"address")})})})}),e(w,{gutter:16,children:e(m,{md:24,sm:24,children:e(l.Item,{label:a({id:"Users.Billing address"}),name:"paymentAddress",rules:[{required:!0}],children:e(u,{placeholder:a({id:"Users.Please enter address"}),onChange:r=>d(r,"paymentAddress")})})})}),h(w,{gutter:16,children:[e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.Is company"}),children:e(Y,{checked:t.isCompany,onChange:r=>d(r,"isCompany")})})}),t.isCompany&&e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.ZIP code"}),name:"zip",children:e(u,{placeholder:a({id:"Users.Please enter zip"}),onChange:r=>d(r,"zip")})})})]}),t.isCompany&&h(w,{gutter:16,children:[e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.IČO"}),name:"regNumber",children:e(u,{placeholder:a({id:"Users.Please enter IČO"}),onChange:r=>d(r,"regNumber")})})}),e(m,{md:12,sm:24,children:e(l.Item,{label:a({id:"Users.DIČ"}),name:"vatNumber",children:e(u,{placeholder:a({id:"Users.Please enter DIČ"}),onChange:r=>d(r,"vatNumber")})})})]}),e("div",{className:"form-actions",children:h(l.Item,{children:[e(C,{style:{width:150},type:"primary",htmlType:"submit",className:"mr-3",loading:T,children:a({id:"window.create"})}),e(C,{onClick:p,children:a({id:"window.cancel"})})]})})]})})},be=["10","20","50","100","200"],Ie=()=>{const S=H(),{formatMessage:n}=j(),[y,N]=o.useState([]),[I,a]=o.useState(!1),[T,x]=o.useState(""),[t,U]=o.useState(!1),[E,A]=o.useState(!1),[v,g]=o.useState(!1),d=o.useRef(),p=K(Z(Ie,"allUsers"),async()=>{const s=await le();if(s.status===401){S({type:"user/SET_STATE",payload:{authorized:!1}}),b.error({message:`Authentication is required: ${s.statusText}`});return}return s.json()},{retry:!1,cacheTime:0,onError:s=>{b.error({message:`Something went wrong while obtaining users list from server: ${s.message}`})}});o.useEffect(()=>{p.data&&N(p.data)},[p.data]),o.useEffect(()=>{d.target&&d.target.focus()},[I]);const _=()=>{a(!1),U(T!=="");const s=new RegExp(T,"gi");N(p.data.filter(i=>i.name.match(s)))},k=()=>{p.refetch()},r=async s=>{const i=await oe(s);i.status===204?(F.success(n({id:"Uers.User deleted!"})),k()):F.error(n({id:"Uers.Error: "}),i.statusText)},c=[{title:n({id:"Uers.ID"}),dataIndex:"inBodyId",key:"id",render:s=>e("span",{children:`${s}`}),sorter:(s,i)=>s.inBodyId-i.inBodyId},{title:n({id:"window.name"}),dataIndex:"name",key:"name",sorter:(s,i)=>s.name.length-i.name.length,render:(s,i)=>h("span",{children:[i.tag===B&&e(we,{twoToneColor:"#eb2f96"}),` ${i.name}`]}),filterDropdown:h("div",{className:"custom-filter-dropdown",children:[e(u,{ref:d,placeholder:n({id:"Uers.Search name"}),value:T,onChange:s=>x(s.target.value),onPressEnter:_}),e(C,{type:"primary",onClick:_,children:n({id:"Uers.Search"})})]}),filterIcon:e(re,{style:{color:t?"#108ee9":"#aaa"}}),onFilterDropdownVisibleChange:s=>{a(s)}},{title:n({id:"Uers.Created date"}),dataIndex:"id",key:"createdDate",render:s=>e("span",{children:`${W.unix(parseInt(s.substring(0,8),16)).format(ce)}`})},{title:n({id:"window.email"}),dataIndex:"email",key:"email",render:s=>e("span",{children:`${s||"-"}`})},{title:n({id:"window.address"}),dataIndex:"address",key:"address",render:s=>e("span",{children:`${s||"-"}`})},{title:n({id:"Uers.Action"}),dataIndex:"id",key:"action",render:s=>h("span",{children:[e(te,{to:`/users/${s}`,children:e(C,{icon:e(ge,{}),className:"mr-1",size:"small",children:n({id:"Uers.View"})})}),e(P,{roles:[R,z,$,q],children:e(ne,{title:n({id:"Uers.Are you sure delete this user?"}),onConfirm:()=>r(s),okText:n({id:"window.yes"}),cancelText:n({id:"window.no"}),children:e(C,{type:"primary",danger:!0,icon:e(se,{}),size:"small",children:n({id:"window.remove"})})})})]})}];let f=y;return v&&(f=y.filter(s=>s.tag===B)),e(P,{roles:[R,z,me,$,q],denied:["Dany","Vitaly"],redirect:!0,to:"/main",children:h("div",{children:[e(ae,{title:"Users"}),h("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:n({id:"Users.Customers"})})})}),h("div",{className:"card-body",children:[e(C,{type:"primary",onClick:()=>A(!0),style:{marginRight:"30px",marginBottom:"30px"},children:n({id:"Uers.New account"})}),e(Y,{style:{marginBottom:"30px"},checked:v,onClick:s=>g(s.target.checked),children:n({id:"Uers.VIP filter"})}),e(ie,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:c,dataSource:f,pagination:{position:"bottom",total:f.length,showTotal:(s,i)=>`${i[0]}-${i[1]} of ${s} items`,showSizeChanger:!0,pageSizeOptions:be,hideOnSinglePage:f.length<10},loading:p.isLoading,rowKey:()=>Math.random()})]})]}),e(Q,{visible:E,onClose:()=>A(!1),create:de,update:k})]})})};export{Ie as default};
