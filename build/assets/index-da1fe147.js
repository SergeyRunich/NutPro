import{a as L,j as t,aa as h,c as l,a4 as je,r as s,a3 as v,a8 as Ve,bg as Oe,a5 as f,bo as $e,a6 as B,B as T,I as He,aW as A,bL as F}from"./index-c20b5e8e.js";import{T as E}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{R as _}from"./index-f06d8a3b.js";import{S as z}from"./index-297358d3.js";import{S as Pe}from"./index-06104a82.js";import{D as G}from"./index-2f7554ca.js";import{g as K,a as We,b as Be,c as Ae,d as Fe,H as Ke}from"./rating-1af437bd.js";import{D as Ee}from"./index-1e692111.js";import{g as _e}from"./kitchen-60ac824b.js";import"./styleChecker-a7b568e2.js";import"./padStart-17be0050.js";import"./index-8e340a60.js";function Ge(i){const c=L(),r=()=>{i.onClose()},S=[{title:c.formatMessage({id:"Rating.Dish"}),dataIndex:"title",key:"title",render:o=>o},{title:c.formatMessage({id:"Rating.Score"}),dataIndex:"score",key:"score",render:o=>t("span",{children:`${o}`})},{title:c.formatMessage({id:"Rating.Day"}),dataIndex:"day",key:"day",render:o=>t("span",{children:`${h.unix(o).format("DD.MM.YYYY")}`})},{title:c.formatMessage({id:"Rating.Kitchen"}),dataIndex:"kitchen",key:"kitchen",render:o=>t("span",{children:o})},{title:c.formatMessage({id:"window.date"}),dataIndex:"date",key:"date",render:o=>t("span",{children:`${h(o).format("DD.MM.YYYY HH:mm")}`})},{title:c.formatMessage({id:"Rating.Review"}),dataIndex:"review",key:"review",render:o=>t("span",{children:`${o}`})}];return t("div",{children:l(Ee,{title:c.formatMessage({id:"Rating.Rating details"}),width:"100%",onClose:r,open:i.visible,bodyStyle:{paddingBottom:80},children:[i.data.name&&l("div",{children:[t("h1",{children:i.data.name}),l("div",{style:{float:"right",marginBottom:"5px"},children:[t(_,{style:{color:"#2fa037"},defaultValue:Number(i.data.scores.average),allowHalf:!0,disabled:!0}),l("span",{style:{marginLeft:"10px",fontWeight:"bold",fontSize:"18px"},children:[i.data.scores.average," (",i.data.scores.count,")"]})]})]}),t(E,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:S,dataSource:i.data,pagination:{defaultPageSize:100,position:"bottom",total:i.data.length,showTotal:(o,m)=>`${m[0]}-${m[1]} of ${o} items`,showSizeChanger:!0,pageSizeOptions:["100","200","300","400","500","1000"],hideOnSinglePage:i.data.length<=100},rowKey:()=>Math.random()}),i.data.length<=100&&l("strong",{style:{float:"right",marginTop:"20px"},children:[c.formatMessage({id:"STF.Total items:"})," ",i.data.length]})]})})}function Je(i){const c=L();return t(je,{open:i.visible,title:c.formatMessage({id:"Rating.Ignored list"}),okText:c.formatMessage({id:"Rating.OK"}),cancelText:c.formatMessage({id:"Rating.Close"}),onCancel:i.onCancel,onOk:i.onCancel,children:i.list.map(r=>t("p",{children:t("a",{href:`/#/users/${r.id}`,target:"_blank",rel:"noopener noreferrer",children:r.name})},Math.random()))})}h.updateLocale("en",{week:{dow:1}});const{Option:d}=f,{RangePicker:Qe}=G;function ht(){const[i,c]=s.useState(2),[r,S]=s.useState([h().startOf("month").format("DD-MM-YYYY"),h().endOf("month").format("DD-MM-YYYY")]),[o,m]=s.useState([]),[J,Q]=s.useState([]),[p,C]=s.useState({}),[U,j]=s.useState(!1),[V,R]=s.useState(!0),[Y,X]=s.useState(0),[D,Z]=s.useState(""),[I,q]=s.useState(""),[M,ee]=s.useState(!0),[b,te]=s.useState(!1),[ae,ne]=s.useState(!1),[ie,se]=s.useState([]),[le,oe]=s.useState([]),[w,re]=s.useState([]),[de,O]=s.useState(""),[ce,he]=s.useState(""),[u,ge]=s.useState([1,5]),[ue,me]=s.useState([]),[x,fe]=s.useState([]),[k,pe]=s.useState(!1),{formatMessage:n}=L();s.useEffect(()=>{_e().then(async e=>{const a=await e.json();oe(a)}),K("customer",r[0],r[1]).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),C(a.stats),R(!1)}else v.error({message:n({id:"window.error"}),description:e.statusText})}),We().then(async e=>{if(e.status===200){const a=await e.json();se(a.result)}else v.error({message:n({id:"window.error"}),description:e.statusText})}),Be().then(async e=>{if(e.status===200){const a=await e.json();me(a)}else v.error({message:n({id:"window.error"}),description:e.statusText})})},[r]);const ye=e=>{pe(e)},ve=()=>{ge(u)},Se=()=>{R(!0),Number(i)===1?Ae("customer",r[0],Y,D,I,M,w,b,u[0],u[1],x,k).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),C(a.stats),R(!1)}else v.error({message:n({id:"window.error"}),description:e.statusText})}):Number(i)===2?K("customer",r[0],r[1],Y,D,I,M,w,b,u[0],u[1],x,k).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),C(a.stats),R(!1)}else v.error({message:n({id:"window.error"}),description:e.statusText})}):Fe("customer",Y,D,I,M,w,b,u[0],u[1],x,k).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),C(a.stats),R(!1)}else v.error({message:n({id:"window.error"}),description:e.statusText})})},Re=e=>({filterDropdown:({setSelectedKeys:a,selectedKeys:g,confirm:y,clearFilters:Le})=>l("div",{style:{padding:8},children:[t(He,{ref:N,placeholder:`Search ${e}`,value:g[0],onChange:W=>a(W.target.value?[W.target.value]:[]),onPressEnter:()=>$(g,y,e),style:{width:188,marginBottom:8,display:"block"}}),t(T,{type:"primary",onClick:()=>$(g,y,e),icon:t(A,{}),size:"small",style:{width:90,marginRight:8},children:"Search"}),t(T,{onClick:()=>we(Le),size:"small",style:{width:90},children:"Reset"})]}),filterIcon:a=>t(A,{style:{color:a?"#1890ff":""}}),onFilter:(a,g)=>g[e].toString().toLowerCase().includes(a.toLowerCase()),onFilterDropdownVisibleChange:a=>{a&&setTimeout(()=>N.current.select())},render:(a,g)=>ce===e?t(F,{to:"#",onClick:y=>{H(g),y.preventDefault()},children:t(Ke,{highlightStyle:{backgroundColor:"#ffc069",padding:0,fontWeight:"bold",fontSize:"16px"},unhighlightStyle:{fontWeight:"bold",fontSize:"16px"},searchWords:[de],autoEscape:!0,textToHighlight:a.toString()})}):t(F,{to:"#",onClick:y=>{H(g),y.preventDefault()},children:t("span",{style:{fontWeight:"bold",fontSize:"16px"},children:a})})}),$=(e,a,g)=>{a(),O(e[0]),he(g)},we=e=>{e(),O("")},H=e=>{j(!0),Q(e.dishes)},xe=()=>j(!1),P=e=>ne(e),Ce=async e=>{let a=[null,null];e[0]!==void 0&&(a=[e[0].format("DD-MM-YYYY"),e[1]!==void 0?e[1].format("DD-MM-YYYY"):null]),S(a)},Ye=async e=>{let a=[null,null];e!=null&&(a=[e.format("DD-MM-YYYY"),e.format("DD-MM-YYYY")]),S(a)},De=async e=>{const a=e[1]?e[1].format("DD-MM-YYYY"):"";S([e[0].format("DD-MM-YYYY"),a])},Me=()=>c(i.key),be=()=>X(Y.key),ke=()=>Z(D.key),Ne=e=>q(e.key),Te=e=>ee(e.target.checked),Ie=e=>te(e.target.checked),ze=[{title:n({id:"Rating.Customer"}),dataIndex:"name",key:"name",...Re("name")},{title:n({id:"Rating.Rating"}),dataIndex:"scores",key:"score",render:e=>l("span",{children:[t(_,{defaultValue:Number(e.average),style:{color:"#2fa037"},allowHalf:!0,disabled:!0})," ",t("span",{style:{fontWeight:"bold",fontSize:"16px",marginLeft:"6px"},children:`${e.average}${e.isReview?"*":""}`})]}),sorter:(e,a)=>Number(e.scores.average)-Number(a.scores.average)},{title:n({id:"Rating.Scores"}),dataIndex:"scores",key:"scores",render:e=>t("span",{style:{fontWeight:"bold",fontSize:"16px"},children:`${e.count}`}),sorter:(e,a)=>Number(e.scores.count)-Number(a.scores.count)},{title:"%",dataIndex:"scores",key:"percent",render:e=>t("span",{style:{fontWeight:"bold",fontSize:"16px"},children:`${(e.count/p.totalScores*100).toFixed(2)}%`})}],N=s.useRef(null);return s.useEffect(()=>{N.current&&N.current.focus()},[]),l(Ve,{roles:["admin","root","production","finance","salesDirector","readonlySearch"],denied:["Alexandra","Kseniia"],redirect:!0,to:"/main",children:[t(Oe,{title:"Ratings of dishes"}),t("div",{className:"row",children:t("div",{className:"col-xl-12",children:t("div",{className:"card card--fullHeight",children:l("div",{className:"card-body",children:[l("div",{className:"col-xl-12",children:[l(f,{labelInValue:!0,value:{key:i},style:{marginBottom:"15px",marginRight:"10px",minWidth:"100px"},onChange:Me,children:[t(d,{value:0,children:n({id:"Rating.All time"})}),t(d,{value:1,children:n({id:"Rating.Day"})}),t(d,{value:2,children:n({id:"Rating.Range"})})]}),Number(i)===1&&t("span",{children:t(G,{format:"DD.MM.YYYY",style:{marginRight:"10px"},onChange:Ye,value:r[0]!==null?h(r[0],"DD-MM-YYYY"):null,onCalendarChange:De})}),Number(i)===2&&t("span",{children:t(Qe,{ranges:{"Previous Month":[h().subtract(1,"month").startOf("month"),h().subtract(1,"month").endOf("month")],"This Month":[h().startOf("month"),h().endOf("month")]},format:"DD.MM.YYYY",style:{marginRight:"10px"},onChange:Ce,value:[r[0]!==null?h(r[0],"DD-MM-YYYY"):null,r[0]!==null?h(r[1],"DD-MM-YYYY"):null]})}),t(f,{mode:"multiple",placeholder:"Select kitchens",value:w,style:{width:120,marginRight:"10px"},onChange:()=>re(w),children:le.map(e=>t(d,{value:e.id,children:e.name},e.id))}),l(f,{labelInValue:!0,defaultValue:{key:0},style:{marginBottom:"15px",marginRight:"10px",width:100},onChange:be,children:[t(d,{value:0,children:n({id:"Rating.Min votes"})}),[...Array(30).keys()].map(e=>e+1).map(e=>t(d,{children:e},e))]}),l(f,{labelInValue:!0,defaultValue:{key:""},style:{marginBottom:"15px",marginRight:"10px",width:100},onChange:ke,children:[t(d,{value:"",children:n({id:"Rating.Diet"})}),t(d,{value:"loose",children:n({id:"Rating.loose"})}),t(d,{value:"keep",children:n({id:"Rating.keep"})}),t(d,{value:"gain",children:n({id:"Rating.gain"})}),t(d,{value:"custom",children:n({id:"Rating.custom"})})]}),l(f,{labelInValue:!0,defaultValue:{key:""},style:{marginBottom:"15px",marginRight:"10px",width:100},onChange:Ne,children:[t(d,{value:"",children:'"Nation"'}),t(d,{value:"Czech",children:n({id:"Rating.Czech"})}),t(d,{value:"not_Czech",children:n({id:"Rating.not Czech"})})]}),l("div",{children:[t(f,{mode:"multiple",placeholder:"Select tags",value:x,style:{minWidth:150,marginRight:"10px"},onChange:()=>fe(x),children:ue.map(e=>t(d,{value:e.id,children:e.cz},e.id))}),l("span",{children:[n({id:"Rating.ignoreTags"}),t($e,{style:{marginLeft:"10px"},checked:k,onChange:ye})]})]})]}),t("div",{className:"col-xl-12",children:l("div",{style:{display:"flex",alignItems:"center"},className:"row",children:[l("div",{className:"col-xl-5 col-md-5  col-sm-12",children:[t(B,{checked:M,onChange:Te})," ",n({id:"Rating.Hide ignored customers "}),t(B,{checked:b,onChange:Ie})," ",n({id:"Rating.Only with review Score range"})]}),l("div",{className:"col-xl-4 col-md-4  col-sm-12",children:[t("span",{children:n({id:"Rating.Min & Max Score"})}),t(Pe,{range:!0,max:5,min:1,step:1,formatter:e=>`${e}⭐️`,defaultValue:u,style:{width:"200px"},onChange:ve})]}),t("div",{className:"col-xl-3 col-md-3  col-sm-12",children:t(T,{onClick:()=>P(!0),type:"default",size:"default",style:{float:"right"},children:n({id:"Rating.View ignored list"})})})]})}),t("div",{style:{float:"right"},children:t(T,{onClick:Se,type:"primary",size:"default",disabled:!r[0]&&i>0,style:{marginRight:"10px"},loading:V,children:n({id:"Rating.View"})})})]})})})}),t("div",{className:"row",children:t("div",{className:"col-lg-12",children:t("div",{className:"card card--fullHeight",children:t("div",{className:"card-body",children:l("div",{className:"d-flex justify-content-around align-items-center w-100",children:[t("div",{children:t(z,{style:{textAlign:"center"},title:n({id:"Rating.Total customers"}),value:p.totalCustomers})}),t("div",{children:t(z,{style:{textAlign:"center"},title:n({id:"Rating.Total scores"}),value:p.totalScores})}),t("div",{children:t(z,{style:{textAlign:"center"},title:n({id:"Rating.Scores per customer"}),value:p.totalCustomers!==0?(p.totalScores/p.totalCustomers).toFixed(2):0})})]})})})})}),t("div",{className:"row",children:t("div",{className:"col-lg-12",children:t("div",{className:"card card--fullHeight",children:l("div",{className:"card-body",children:[t(E,{tableLayout:"auto",scroll:{x:"100%"},columns:ze,dataSource:o,loading:V,pagination:{defaultPageSize:100,position:"bottom",total:o.length,showTotal:(e,a)=>`${a[0]}-${a[1]} of ${e} items`,showSizeChanger:!0,pageSizeOptions:["100","200","300","400","500","1000"],hideOnSinglePage:o.length<=100},rowKey:()=>Math.random()}),o.length<=100&&l("strong",{style:{float:"right",marginTop:"20px"},children:[n({id:"STF.Total items:"})," ",o.length]})]})})})}),t(Ge,{visible:U,onClose:xe,data:J}),t(Je,{visible:ae,onCancel:()=>P(!1),list:ie})]})}export{ht as default};
