import"./PickerPanel-72c5d64a.js";import{c as n,j as e,a as K,aa as c,bk as _e,r as o,u as ve,b as Te,a3 as w,a8 as W,B as be,a5 as y,a6 as Ce,bp as Fe,da as q}from"./index-c20b5e8e.js";/* empty css              */import{I as b}from"./index-86d1917a.js";import{D as xe}from"./index-98f1088d.js";import{R as V,C as h}from"./row-58ed805b.js";import{D as De}from"./index-2f7554ca.js";import{T as Me}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{T as v}from"./index-8e340a60.js";import{w as Ne}from"./order-d29e3517.js";import"./styleChecker-a7b568e2.js";const we="_item_12vfx_1",Pe="_large_12vfx_12",Ie="_name_12vfx_12",ke="_note_12vfx_15",Le="_actionData_12vfx_18",$e="_borderedBottom_12vfx_22",Ye="_description_12vfx_26",C={item:we,large:Pe,name:Ie,note:ke,actionData:Le,borderedBottom:$e,description:Ye},G=({value:r,label:f})=>n("div",{className:C.item,children:[e("div",{className:C.description,children:f&&e("h2",{className:C.name,children:f})}),r&&e("div",{className:C.actionData,children:(r==null?void 0:r.toLocaleString("en",{minimumFractionDigits:0,maximumFractionDigits:2}))||0})]}),Oe=({data:r,loading:f,currency:p})=>{const l=K(),_=t=>t.isVoucher?e(v,{color:"geekblue",children:t.code}):e(v,{color:"default",children:t.code}),T=(t,s)=>{const m=[t,s].filter(Boolean);return m.length?m.length===2?n("span",{children:[_(m[0]),_(m[1])]}):e("span",{children:_(m[0])}):""},x=[{title:l.formatMessage({id:"window.date"}),dataIndex:"date",key:"date",render:t=>e("span",{children:`${t}`}),sorter:(t,s)=>c(t.date).unix()-c(s.date).unix()},{title:l.formatMessage({id:"STF.Invoice"}),dataIndex:"invoice",key:"invoice",render:t=>t!=null&&t.invoiced?e("a",{href:t.url,target:"blank",children:t.number}):"none"},{title:l.formatMessage({id:"window.name"}),dataIndex:"name",key:"name",render:(t,s)=>e("a",{href:`/#/orders/${s.id}`,rel:"noopener noreferrer",target:"_blank",children:t})},{title:l.formatMessage({id:"STF.Source"}),dataIndex:"source",key:"source",render:t=>e("span",{children:`${t}`}),sorter:(t,s)=>t.source.length-s.source.length},{title:l.formatMessage({id:"STF.Type"}),dataIndex:"type",key:"type",render:t=>e("span",{children:`${t}`}),sorter:(t,s)=>t.type.length-s.type.length},{title:l.formatMessage({id:"STF.Days"}),dataIndex:"days",key:"days",render:t=>e("span",{children:t}),sorter:(t,s)=>t.days-s.days},{title:l.formatMessage({id:"STF.Program"}),dataIndex:"mealsPerDay",key:"meals",render:t=>e("span",{children:`${t==null?void 0:t.split("")[0]}`}),sorter:(t,s)=>t.mealsPerDay.split("")[0]-s.mealsPerDay.split("")[0]},{title:`${l.formatMessage({id:"STF.OriginalPrice"})} ${p}`,dataIndex:"acceptedPrice",key:"acceptedPrice",render:(t,s)=>e(v,{color:t===s.finalPrice?"green":"red",children:t==null?void 0:t.toLocaleString("en",{minimumFractionDigits:0})},Math.random()),sorter:(t,s)=>t.acceptedPrice-s.acceptedPrice},{title:`${l.formatMessage({id:"STF.FinalPrice"})} ${p}`,dataIndex:"finalPrice",key:"finalPrice",render:(t,s)=>n(v,{color:"green",children:[s.isCustomPrice===1&&"*",t==null?void 0:t.toLocaleString("en",{minimumFractionDigits:0})]},Math.random()),sorter:(t,s)=>t.finalPrice-s.finalPrice},{title:`${l.formatMessage({id:"STF.PerDay"})} ${p}`,dataIndex:"pricePerDay",key:"pricePerDay",render:(t,s)=>{const m=n("div",{children:[n("p",{children:["Accepted: ",t]}),n("p",{children:["Final: ",s.finalPerDay]})]});return e(_e,{content:m,title:l.formatMessage({id:"STF.PricePerDay"}),children:e(v,{color:"geekblue",children:t==null?void 0:t.toLocaleString("en",{minimumFractionDigits:0})},Math.random())})},sorter:(t,s)=>t.pricePerDay-s.pricePerDay},{title:`${l.formatMessage({id:"STF.COGS"})} ${p}`,dataIndex:"cogs",key:"cogs",render:t=>e("span",{children:t==null?void 0:t.toLocaleString("en",{minimumFractionDigits:0})}),sorter:(t,s)=>t.cogs-s.cogs},{title:`${l.formatMessage({id:"STF.Margin"})} ${p}`,dataIndex:"margin",key:"margin",render:t=>e("span",{children:t==null?void 0:t.toLocaleString("en",{minimumFractionDigits:0})}),sorter:(t,s)=>t.margin-s.margin},{title:l.formatMessage({id:"STF.Margin%"}),dataIndex:"marginPercent",key:"marginPercent",render:t=>e("span",{children:Number(t).toFixed(2)}),sorter:(t,s)=>t.marginPercent-s.marginPercent},{title:l.formatMessage({id:"STF.Promo"}),dataIndex:"promo",key:"promo",render:(t,s)=>T(t,s.promo2)}];return n("div",{children:[e(Me,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:x,dataSource:r,size:"small",rowKey:()=>Math.random().toString(),pagination:{defaultPageSize:100,position:"bottom",total:r.length,showTotal:(t,s)=>`${s[0]}-${s[1]} of ${t} items`,showSizeChanger:!0,pageSizeOptions:["100","200","300","400","500","1000"],hideOnSinglePage:r.length<=100},loading:f}),r.length<=100&&n("strong",{style:{float:"right",marginTop:"20px"},children:[l.formatMessage({id:"STF.Total items:"})," ",r.length]})]})},je="_crypto_1ua7y_2",ze="_table_1ua7y_13",Ae="_listMobile_1ua7y_20",Be="_list_1ua7y_20",Ee="_listTitle_1ua7y_39",Re="_listItem_1ua7y_44",We="_listPercents_1ua7y_58",qe="_listItemNegative_1ua7y_67",Ve="_listCurrency_1ua7y_76",Ge="_content_1ua7y_94",Ke="_warning_1ua7y_104",Ze="_order_1ua7y_110",He="_orderLeft_1ua7y_119",Je="_orderMiddle_1ua7y_123",Qe="_orderRight_1ua7y_135",Ue="_form_1ua7y_139",Xe="_formLabel_1ua7y_143",F={crypto:je,table:ze,listMobile:Ae,list:Be,listTitle:Ee,listItem:Re,listPercents:We,listItemNegative:qe,listCurrency:Ve,content:Ge,warning:Ke,order:Ze,orderLeft:He,orderMiddle:Je,orderRight:Qe,form:Ue,formLabel:Xe},{RangePicker:et}=De,{Option:d}=y;c.updateLocale("en",{week:{dow:1}});const ut=()=>{const{formatMessage:r}=K(),[f,p]=o.useState(c().startOf("month").unix()),[l,_]=o.useState(c().endOf("month").unix()),[T,x]=o.useState(["accepted"]),[t,s]=o.useState(["2","3","5"]),[m,Z]=o.useState(["new","prolong","return"]),[P,H]=o.useState(1),[I,J]=o.useState("all"),[D,Q]=o.useState(!0),[k,U]=o.useState(83),[L,X]=o.useState(47),[$,ee]=o.useState(40),[te,S]=o.useState(!1),[ae,Y]=o.useState([]),[g,O]=o.useState([]),[j,se]=o.useState([]),[z,ne]=o.useState(13),[A,re]=o.useState("all"),{currentBranch:M,currentCurrency:B}=ve(a=>a.settings),N=Te(),E=o.useCallback(async()=>{const a=await Ne();if(a.status!==401){const i=await a.json();se(i.result)}},[]),ie=a=>J(a),le=a=>x(a),oe=a=>re(a),ce=a=>s(a),de=a=>Z(a),he=a=>X(a),me=a=>ee(a),ue=a=>ne(a),ge=a=>U(a),fe=a=>H(a),pe=async a=>{p(a[0].unix()),_(a[1].unix())},Se=a=>Q(a.target.checked),ye=async()=>{S(!0);const a={statuses:T,mealPlans:t,isInvoiced:P,sales:I,without2days:D,mainDishPrice:k,snackDishPrice:L,deliveryCost:$,logisticCenterCost:z,types:m,source:A,branchId:M},i=await q(c.unix(Number(f)).format("DD-MM-YYYY"),c.unix(Number(l)).format("DD-MM-YYYY"),a);if(i.status===401){N({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const u=await i.json();Y(u.result),O(u.statistics),S(!1)}else S(!1),w.error({message:i.status,description:i.statusText})};return o.useEffect(()=>{document.title="Sales Target Fulfilment",(async()=>{S(!0);const i=await q(c().startOf("month").format("DD-MM-YYYY"),c().endOf("month").format("DD-MM-YYYY"),{statuses:["accepted"],mealPlans:["2","3","5"],isInvoiced:1,sales:"all",without2days:!0,mainDishPrice:83,snackDishPrice:47,deliveryCost:40,types:["new","prolong","return"],source:"all",logisticCenterCost:13,branchId:M});if(i.status===401){N({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const u=await i.json();Y(u.result),O(u.statistics),S(!1)}else S(!1),w.error({message:i.status,description:i.statusText})})().finally(()=>S(!1)),E().catch(i=>{w.error({message:i.status,description:i.statusText})})},[M,N,E]),n(W,{roles:["finance","root","salesDirector"],redirect:!0,to:"/404",children:[n("div",{className:"row",children:[e("div",{className:"col-lg-4",children:n("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title text-center",children:e("strong",{children:r({id:"STF.SalesTargetFulfilment"})})})}),n("div",{className:"card-body d-flex flex-column justify-content-center align-items-center",children:[e(et,{ranges:{"Previous Month":[c().subtract(1,"month").startOf("month"),c().subtract(1,"month").endOf("month")],"This Month":[c().startOf("month"),c().endOf("month")]},defaultValue:[c(f*1e3),c(l*1e3)],format:"DD.MM.YYYY",onChange:pe}),e(be,{style:{marginTop:"20px",width:"30%"},type:"primary",onClick:ye,size:"large",children:r({id:"window.show"})})]})]})}),e("div",{className:"col-lg-8",children:e("div",{className:"card",children:n("div",{className:"card-body",children:[n(V,{gutter:8,justify:"space-between",children:[n(h,{span:5,children:[e("small",{children:r({id:"STF.Invoice"})}),e("br",{}),n(y,{value:P,style:{width:"100%"},onChange:fe,children:[e(d,{value:-1,children:r({id:"STF.All"})}),e(d,{value:2,children:r({id:"STF.Invoiced&customPrice"})}),e(d,{value:1,children:r({id:"STF.Invoiced"})}),e(d,{value:0,children:r({id:"STF.NoneInvoiced"})})]})]}),n(h,{span:3,children:[e("small",{children:r({id:"STF.Sales"})}),e("br",{}),n(y,{value:I,style:{width:"100%"},onChange:ie,children:[e(d,{value:"all",children:r({id:"STF.All"})}),j&&j.map(a=>e(d,{value:a.id,children:a.name},a.id))]})]}),n(h,{span:5,children:[e("small",{children:"Statuses"}),e("br",{}),e(y,{placeholder:r({id:"STF.statuses"}),mode:"tags",style:{width:150},value:T,onChange:le,children:["accepted","canceled","waitingPayment"].map(a=>e(d,{value:a,children:a},a))})]}),n(h,{span:9,children:[e("small",{children:r({id:"STF.Program"})}),e("br",{}),e(y,{placeholder:r({id:"STF.Meals"}),mode:"tags",style:{width:265},value:t,onChange:ce,children:["2","3","5"].map(a=>e(d,{value:a,children:`${a} meals`},a))})]}),n(h,{span:2,children:[e("small",{children:r({id:"STF.WithoutTrial"})}),e("br",{}),e(Ce,{checked:D,onClick:Se,children:D?"Yes":"No"})]})]}),e(xe,{}),n(V,{gutter:8,children:[n(h,{span:8,children:[e("small",{children:r({id:"STF.Type"})}),e("br",{}),e(y,{placeholder:r({id:"STF.Meals"}),mode:"tags",style:{width:230},value:m,onChange:de,children:["new","prolong","return","trial"].map(a=>e(d,{value:a,children:a},a))})]}),n(W,{roles:["root","salesDirector"],children:[n(h,{span:3,children:[e("small",{children:r({id:"STF.Snack"})}),e("br",{}),e(b,{value:L,onChange:he})]}),n(h,{span:3,children:[e("small",{children:r({id:"STF.Delivery"})}),e("br",{}),e(b,{value:$,onChange:me})]}),n(h,{span:3,children:[e("small",{children:r({id:"STF.Main meal"})}),e("br",{}),e(b,{value:k,onChange:ge})]}),n(h,{span:4,children:[e("small",{children:r({id:"STF.Logistic Center Cost"})}),e("br",{}),e(b,{value:z,onChange:ue})]})]}),n(h,{span:3,children:[e("small",{children:r({id:"STF.Source"})}),e("br",{}),n(y,{style:{width:"100%"},value:A,onChange:oe,children:[e(d,{value:"all",children:r({id:"STF.All"})}),e(d,{value:"web",children:"Web"}),e(d,{value:"admin",children:"Admin"})]})]})]})]})})})]}),n("div",{className:"row",children:[e("div",{className:"col-lg-10",children:e("div",{className:"card",children:e("div",{className:"card-body",children:e(Oe,{data:ae,loading:te,currency:B})})})}),e("div",{className:"col-lg-2",children:n(Fe,{children:[n("div",{className:F.list,children:[e("div",{className:"utils__title utils__title--flat",children:e("strong",{children:r({id:"STF.Statistics"})})}),g==null?void 0:g.map((a,i)=>{var u,R;if(!(i>2))return n("div",{className:F.listItem,children:[e("span",{className:F.listCurrency,children:e("span",{children:a.label})}),n("span",{className:F.listPercents,children:[i<=1&&((u=a.value)==null?void 0:u.toLocaleString("cs-CZ",{minimumFractionDigits:0,maximumFractionDigits:2}))," ",i<=1&&B,i>1&&`${(R=a.value)==null?void 0:R.toFixed(a.digits)} %`]})]},a.label)})]}),n("div",{className:"card mb-3",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title utils__title--flat",children:e("strong",{className:"text-uppercase font-size-16",children:r({id:"STF.FinanceStats"})})})}),e("div",{className:"card-body",children:g==null?void 0:g.slice(0,g.length-12).map((a,i)=>{if(i<=2)return;const u=e("span",{style:{color:a.actionDataColor},children:a.actionData});return e(G,{label:a.label,value:a.value,actionData:u},a.label)})})]}),n("div",{className:"card mb-3",children:[e("div",{className:"card-header",children:n("div",{className:"utils__title utils__title--flat",children:[e("strong",{className:"text-uppercase font-size-16",children:r({id:"STF.ProductStats"})}),e("br",{}),e("small",{className:"text-lowercase font-size-12 text-muted",children:"* sold client-days"})]})}),e("div",{className:"card-body",children:g&&g.slice(-12).map(a=>e(G,{label:a.label,value:a.value},`${a.label}-${Math.random()}`))})]})]})})]})]})};export{ut as default};
