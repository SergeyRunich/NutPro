var ue=Object.defineProperty;var ge=(b,x,t)=>x in b?ue(b,x,{enumerable:!0,configurable:!0,writable:!0,value:t}):b[x]=t;var f=(b,x,t)=>(ge(b,typeof x!="symbol"?x+"":x,t),t);import{a1 as N,a2 as R,c as h,bp as ne,j as e,I as z,a5 as k,B as w,aY as ae,r as Te,a3 as I,bl as c,a6 as W,bd as O,be as U,aW as ye,aX as be,aZ as J,bq as fe,a8 as Se,bg as ve,b4 as G}from"./index-c20b5e8e.js";import{T as Ce}from"./index-83b0f9b6.js";import{R as C,C as m}from"./row-58ed805b.js";import{g as se,d as de,a as xe,b as H,c as we,e as ke,f as Ie}from"./techcard-66c5dea0.js";import{F as y}from"./index-a86cfb93.js";import{I as F}from"./index-86d1917a.js";import{D as De}from"./index-1e692111.js";import{D as _}from"./index-98f1088d.js";import{I as Fe,S as Ae}from"./index-b3a5ab18.js";import{L as X}from"./index-26b6fa13.js";import"./Pagination-e2a53e90.js";import{g as $e}from"./ingredient-16e26155.js";import{T as j}from"./Table-fe15f1b3.js";import{P as ce}from"./index-67f4e7c4.js";/* empty css              */import{T as V}from"./index-8e340a60.js";import"./styleChecker-a7b568e2.js";var Z;const{Option:B}=k;let Ee=N(Z=class extends R.Component{constructor(){super(...arguments);f(this,"state",{})}render(){const{proportions:t,onChangeDivision:i,deleteDivision:n,intl:{formatMessage:r}}=this.props;return h(ne,{children:[t.length&&e("div",{children:e(X,{bordered:!0,size:"small",dataSource:t,renderItem:(d,o)=>e(X.Item,{children:h(C,{style:{width:"100%"},gutter:16,children:[e(m,{md:12,sm:24,children:e(z,{placeholder:r({id:"Techcard.Title"}),value:t[o].title,style:{width:"100%"},onChange:p=>i(p,"title",o)})}),e(m,{md:4,sm:24,children:e(F,{value:t[o].amount,style:{width:"100%"},onChange:p=>i(p,"amount",o)})}),e(m,{md:4,sm:24,children:h(k,{value:t[o].unit,placeholder:r({id:"Techcard.SelectUnit"}),style:{width:"100%"},onChange:p=>i(p,"unit",o),children:[e(B,{value:"g",children:r({id:"Techcard.g"})},"g"),e(B,{value:"kg",children:r({id:"Techcard.Kg"})},"kg"),e(B,{value:"ml",children:r({id:"Techcard.Ml"})},"ml"),e(B,{value:"l",children:r({id:"Techcard.l"})},"l")]})}),e(m,{md:4,sm:24,children:e(w,{type:"primary",danger:!0,onClick:()=>n(o),children:r({id:"window.remove"})})})]})})})}),!t.length&&e(ae,{description:!1})]})}})||Z;var Q;const{Option:A}=k,L=[{type:"type1",title:"Dvoudílná 40mm"},{type:"type2",title:"Dvoudílná 50mm"},{type:"type3",title:"Dvoudílná 60mm"},{type:"type4",title:"Jednodílná 40mm"},{type:"type5",title:"Jednodílná 50mm"},{type:"type6",title:"Jednodílná 60mm"},{type:"type7",title:"Polevková zatavovací malá"},{type:"type8",title:"Polevková zatavovací velká"},{type:"type9",title:"Uzavírací krabička malá"},{type:"type10",title:"Uzavírací krabička velká"}];let Me=N(Q=class extends R.Component{constructor(t){super(t);f(this,"state",{title:"",marketingTitle:"",amount:0,unit:0,description:"",percent:0,isEdit:!1,customNutrients:!1,isSubTechcard:!1,ingredients:[],subTechcards:[],proportions:[],energy:0,prot:0,fat:0,carb:0,allIngredients:[],tags:[],boxes:{small:{type:"",title:""},medium:{type:"",title:""},big:{type:"",title:""}},allTags:[],isTechCardSaved:!1});f(this,"formRef",Te.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.deleteIngredient=this.deleteIngredient.bind(this),this.addIngredient=this.addIngredient.bind(this),this.onChangeIngredient=this.onChangeIngredient.bind(this),this.deleteSubTechcard=this.deleteSubTechcard.bind(this),this.deleteDivision=this.deleteDivision.bind(this),this.addSubTechcard=this.addSubTechcard.bind(this),this.addDivision=this.addDivision.bind(this),this.onChangeSubTechcard=this.onChangeSubTechcard.bind(this),this.onChangeDivision=this.onChangeDivision.bind(this)}componentDidMount(){$e().then(async t=>{if(t.status===200){const i=await t.json();this.setState({allIngredients:i})}}),se().then(async t=>{if(t.status===200){const i=await t.json();this.setState({allTags:i})}})}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}onChangeIngredient(t,i,n){const{ingredients:r}=this.state;let d=t;t.target&&(t.target.type==="checkbox"?d=t.target.checked:d=t.target.value),r[n][i]=d,this.setState({ingredients:r})}onChangeSubTechcard(t,i,n){const{subTechcards:r}=this.state;let d=t;t.target&&(t.target.type==="checkbox"?d=t.target.checked:d=t.target.value),r[n][i]=d,this.setState({subTechcards:r})}onChangeDivision(t,i,n){const{proportions:r}=this.state;let d=t;t.target&&(t.target.type==="checkbox"?d=t.target.checked:d=t.target.value),r[n][i]=d,this.setState({proportions:r})}onChangeBox(t,i){const{boxes:n}=this.state;let r=t;t.target&&(t.target.type==="checkbox"?r=t.target.checked:r=t.target.value);const d=L.find(o=>o.type===r);n[i].type=r,n[i].title=d.title,this.setState({boxes:n})}async onFinish(){const{isTechCardSaved:t}=this.state;if(!t){this.setState({isTechCardSaved:!0});try{const{create:i,edit:n,forEdit:r,update:d}=this.props;await this.formRef.current.validateFields();const{intl:{formatMessage:o}}=this.props,{title:p,amount:u,unit:g,description:T,percent:l,isSubTechcard:s,customNutrients:D,energy:S,prot:q,fat:a,carb:le,ingredients:P,subTechcards:K,tags:oe,marketingTitle:he,boxes:pe,proportions:me}=this.state,Y={title:p,marketingTitle:he,amount:u,unit:g,description:T,isSubTechcard:s,customNutrients:D,percent:l,nutrients:{energy:S,prot:q,fat:a,carb:le},ingredients:P.map(v=>v.id),ingredientsAmount:P.map(v=>v.amount),subTechcards:K.map(v=>v.id),subTechcardsAmount:K.map(v=>v.amount),tags:oe,boxes:pe,proportions:me};if(r.id){const v=await n(r.id,Y);v.status===200?(d(),setTimeout(()=>{this.closeDrawer()},500),I.success({message:o({id:"Techcard.Saved"}),description:o({id:"Techcard.TechcardSuccessfullySaved!"})}),this.setState({isTechCardSaved:!1})):I.error({message:o({id:"window.error"}),description:v.statusText,placement:"topLeft"})}else{this.setState({isTechCardSaved:!0});const v=await i(Y);v.status===201?(d(),this.closeDrawer(),I.success({message:o({id:"Techcard.Created"}),description:o({id:"Techcard.TechcardSuccessfullyCreated!"})}),this.setState({isTechCardSaved:!1})):I.error({message:o({id:"window.error"}),description:v.statusText,placement:"topLeft"})}}catch(i){console.log("Failed:",i),this.setState({isTechCardSaved:!1})}}}setEdit(){const{forEdit:t}=this.props;t&&this.setState({title:t.title,marketingTitle:t.marketingTitle,unit:t.unit,amount:t.amount,description:t.description,percent:t.percent,energy:t.nutrients.energy,prot:t.nutrients.prot,fat:t.nutrients.fat,carb:t.nutrients.carb,isSubTechcard:t.isSubTechcard,ingredients:t.ingredients.map((i,n)=>({id:i.id,amount:t.ingredientsAmount[n]})),subTechcards:t.subTechcards.map((i,n)=>({id:i._id,amount:t.subTechcardsAmount[n]})),proportions:t.proportions&&t.proportions.map(i=>({title:i.title,amount:i.amount,unit:i.unit})),isEdit:!0,tags:t.tags.map(i=>i.id),boxes:{small:{type:t.boxes.small.type,title:t.boxes.small.title},medium:{type:t.boxes.medium.type,title:t.boxes.medium.title},big:{type:t.boxes.big.type,title:t.boxes.big.title}}})}componentDidUpdate(t){var n,r,d,o,p;const{forEdit:i}=this.props;i&&t.forEdit!==i&&((p=this.formRef.current)==null||p.setFieldsValue({title:i.title,marketingTitle:i.marketingTitle,amount:i.amount,description:i.description,percent:i.percent,energy:(n=i.nutrients)==null?void 0:n.energy,prot:(r=i.nutrients)==null?void 0:r.prot,fat:(d=i.nutrients)==null?void 0:d.fat,carb:(o=i.nutrients)==null?void 0:o.carb,unit:i.unit}))}addIngredient(){const{ingredients:t}=this.state;t.push({id:null,amount:0}),this.setState({ingredients:t})}deleteIngredient(t){const{ingredients:i}=this.state;i.splice(t,1),this.setState({ingredients:i})}addSubTechcard(){const{subTechcards:t}=this.state;t.push({id:null,amount:0}),this.setState({subTechcards:t})}addDivision(){const{proportions:t}=this.state;t.push({id:null,amount:0}),this.setState({proportions:t})}deleteSubTechcard(t){const{subTechcards:i}=this.state;i.splice(t,1),this.setState({subTechcards:i})}deleteDivision(t){const{proportions:i}=this.state;i.splice(t,1),this.setState({proportions:i})}closeDrawer(){const{onClose:t}=this.props;this.formRef.current.resetFields(),t(),this.setState({title:"",marketingTitle:"",amount:0,unit:0,description:"",percent:0,isEdit:!1,isSubTechcard:!1,customNutrients:!1,ingredients:[],subTechcards:[],energy:0,prot:0,fat:0,carb:0,tags:[],isTechCardSaved:!1})}render(){const{visible:t,forEdit:i,data:n,intl:{formatMessage:r}}=this.props,{unit:d,isEdit:o,customNutrients:p,isSubTechcard:u,ingredients:g,subTechcards:T,allIngredients:l,tags:s,allTags:D,boxes:S,proportions:q}=this.state;return i.id&&!o&&this.setEdit(),e(De,{title:o?e(c,{id:"erp.title.editingTechcard"}):e(c,{id:"erp.title.createTechcard"}),width:"100%",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:e(y,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:h(C,{gutter:16,children:[h(m,{md:12,sm:24,children:[e(C,{gutter:16,children:e(m,{md:24,sm:24,children:e(y.Item,{label:e(c,{id:"erp.name"}),name:"title",rules:[{required:!0}],children:e(z,{onChange:a=>this.onChangeField(a,"title")})})})}),e(C,{gutter:16,children:e(m,{md:24,sm:24,children:e(y.Item,{label:e(c,{id:"erp.marketingTitle"}),name:"marketingTitle",rules:[{required:!0}],children:e(z,{onChange:a=>this.onChangeField(a,"marketingTitle")})})})}),e(C,{gutter:16,children:e(m,{md:24,sm:24,children:e(y.Item,{label:e(c,{id:"erp.technologyСooking"}),name:"description",rules:[{required:!0}],children:e(z.TextArea,{rows:5,onChange:a=>this.onChangeField(a,"description")})})})}),e(C,{gutter:16,children:e(m,{md:24,sm:24,children:e(y.Item,{label:"Tags",children:e(k,{placeholder:"Tags",mode:"tags",value:s,onChange:a=>this.onChangeField(a,"tags"),children:D.map(a=>e(A,{value:a.id,children:a.cz},a.id))})})})}),e("h5",{children:r({id:"Techcard.Boxes"})}),h(C,{gutter:16,children:[e(m,{md:8,sm:24,children:e(y.Item,{label:"Small",children:e(k,{placeholder:"Small",value:S.small.type,onChange:a=>this.onChangeBox(a,"small"),children:L.map(a=>e(A,{value:a.type,children:a.title},a.title))})})}),e(m,{md:8,sm:24,children:e(y.Item,{label:"Medium",children:e(k,{placeholder:"Medium",value:S.medium.type,onChange:a=>this.onChangeBox(a,"medium"),children:L.map(a=>e(A,{value:a.type,children:a.title},a.title))})})}),e(m,{md:8,sm:24,children:e(y.Item,{label:"Big",children:e(k,{placeholder:"Big",value:S.big.type,onChange:a=>this.onChangeBox(a,"big"),children:L.map(a=>e(A,{value:a.type,children:a.title},a.title))})})})]}),h(C,{gutter:16,children:[e(m,{md:8,sm:24,children:e(y.Item,{name:"unit",label:e(c,{id:"erp.unit"}),children:h(k,{value:d,onChange:a=>this.onChangeField(a,"unit"),children:[e(A,{value:0,children:r({id:"Techcard.Kilogram"})},0),e(A,{value:1,children:r({id:"Techcard.Kousky"})},1)]})})}),e(m,{md:8,sm:24,children:e(y.Item,{label:r({id:"Techcard.Amount"}),name:"amount",rules:[{required:!0}],children:e(F,{style:{width:"100%"},onChange:a=>this.onChangeField(a,"amount")})})}),e(m,{md:8,sm:24,children:e(y.Item,{label:"%",name:"percent",rules:[{required:!0}],children:e(F,{style:{width:"100%"},onChange:a=>this.onChangeField(a,"percent")})})})]}),h(C,{gutter:16,children:[e(m,{md:12,sm:24,children:e(y.Item,{name:"cstm",children:e(W,{checked:p,onChange:a=>this.onChangeField(a,"customNutrients"),children:r({id:"Techcard.CustomNutrients"})})})}),e(m,{md:12,sm:24,children:e(y.Item,{name:"smprdct",children:e(W,{checked:u,onChange:a=>this.onChangeField(a,"isSubTechcard"),children:e(c,{id:"erp.semiproduct"})})})})]}),h(C,{gutter:16,children:[e(m,{md:6,sm:24,children:e(y.Item,{label:"kCal",name:"energy",rules:[{required:p}],children:e(F,{disabled:!p,style:{width:"100%"},onChange:a=>this.onChangeField(a,"energy")})})}),e(m,{md:6,sm:24,children:e(y.Item,{label:e(c,{id:"erp.prot"}),name:"prot",rules:[{required:p}],children:e(F,{disabled:!p,style:{width:"100%"},onChange:a=>this.onChangeField(a,"prot")})})}),e(m,{md:6,sm:24,children:e(y.Item,{label:e(c,{id:"erp.fat"}),name:"fat",rules:[{required:p}],children:e(F,{disabled:!p,style:{width:"100%"},onChange:a=>this.onChangeField(a,"fat")})})}),e(m,{md:6,sm:24,children:e(y.Item,{label:e(c,{id:"erp.carb"}),name:"carb",rules:[{required:p}],children:e(F,{disabled:!p,style:{width:"100%"},onChange:a=>this.onChangeField(a,"carb")})})})]}),e(_,{}),e(C,{gutter:16,children:e(m,{md:12,sm:24,children:e(y.Item,{children:e(w,{size:"large",htmlType:"submit",children:e(c,{id:"main.save"})})})})})]}),h(m,{md:12,sm:24,children:[h(_,{orientation:"left",children:[e(c,{id:"erp.ingredients"})," ",e(w,{type:"primary",size:"small",onClick:this.addIngredient,children:e(c,{id:"main.add"})})]}),e(Fe,{ingredients:g,allIngredients:l,addIngredient:this.addIngredient,deleteIngredient:this.deleteIngredient,onChangeIngredient:this.onChangeIngredient}),h(_,{orientation:"left",children:[e(c,{id:"erp.semiproducts"})," ",e(w,{type:"primary",size:"small",onClick:this.addSubTechcard,children:e(c,{id:"main.add"})})]}),e(Ae,{subTechcards:T,allSubTechcards:n,deleteSubTechcard:this.deleteSubTechcard,onChangeSubTechcard:this.onChangeSubTechcard}),h(_,{orientation:"left",children:[e(c,{id:"erp.Division of dishes into proportions"})," ",e(w,{type:"primary",size:"small",onClick:this.addDivision,children:e(c,{id:"main.add"})})]}),e(Ee,{proportions:q,deleteDivision:this.deleteDivision,onChangeDivision:this.onChangeDivision})]})]})})})}})||Q;var ee,$;let ze=(ee=O(({user:b})=>({user:b})),N($=U($=ee($=class extends R.Component{constructor(t){super(t);f(this,"state",{tableData:[],data:[],filterDropdownVisible:!1,searchText:"",filtered:!1,loading:!0});f(this,"onInputChange",t=>{this.setState({searchText:t.target.value})});f(this,"onSearch",()=>{const{searchText:t,tableData:i}=this.state,n=new RegExp(t,"gi");this.setState({filterDropdownVisible:!1,filtered:!!t,data:i.map(r=>r.title.match(n)?{...r,title:r.title}:null).filter(r=>!!r)}),t===""&&this.setState({filtered:!1})});f(this,"refSearchInput",t=>{this.searchInput=t});this.update=this.update.bind(this)}UNSAFE_componentWillMount(){this.update()}UNSAFE_componentWillReceiveProps(){setTimeout(()=>{this.update()},300)}update(){const{data:t}=this.props;this.setState({tableData:t,data:t,loading:!1})}async removeTechcard(t){const{intl:{formatMessage:i}}=this.props,n=await de(t);n.status===204?(I.success(i({id:"Techcard.TechcardDeleted"})),this.update()):I.error({message:i({id:"window.error"}),description:n.statusText,placement:"topRight"})}render(){const{data:t,searchText:i,filterDropdownVisible:n,filtered:r}=this.state,{edit:d,removeTechcard:o,user:p,intl:{formatMessage:u}}=this.props,g=l=>e(J,{style:{padding:"0px"},children:e(J.Item,{children:e(ce,{title:u({id:"Techcard.AreYouSureDeleteThisTechcard?"}),onConfirm:async()=>o(l),okText:"Yes",cancelText:"No",children:u({id:"window.remove"})})},"rempve")}),T=[{title:u({id:"Techcard.Techcard"}),dataIndex:"title",key:"name",sorter:(l,s)=>l.title.length-s.title.length,render:l=>e("span",{children:e("strong",{children:` ${l}`})}),filterDropdown:h("div",{className:"custom-filter-dropdown",style:{padding:"5px"},children:[e(z,{ref:this.refSearchInput,placeholder:u({id:"Techcard.SearchName"}),value:i,onChange:this.onInputChange,onPressEnter:this.onSearch}),e(w,{type:"primary",onClick:this.onSearch,style:{marginTop:"5px"},children:u({id:"Techcard.Search"})})]}),filterIcon:e(ye,{style:{color:r?"#108ee9":"#aaa"}}),filterDropdownVisible:n,onFilterDropdownVisibleChange:l=>{this.setState({filterDropdownVisible:l},()=>this.searchInput&&this.searchInput.focus())}},{title:u({id:"Techcard.Tags"}),dataIndex:"group",key:"group",render:l=>e("span",{children:`${l?l.name:"-"}`})},{title:u({id:"Techcard.Amount"}),dataIndex:"amount",key:"amount",render:l=>e("span",{children:`${l||"-"}`}),sorter:(l,s)=>l.amount-s.amount},{title:u({id:"Techcard.Unit"}),dataIndex:"unit",key:"unit",render:l=>e("span",{children:`${l===0?"kg":"ks"}`}),sorter:(l,s)=>l.unit-s.unit},{title:u({id:"Techcard.Ingredients"}),dataIndex:"ingredients",key:"ingrth",render:l=>e("span",{children:`${l.length||"-"}`}),sorter:(l,s)=>l.ingredients.length-s.ingredients.length},{title:u({id:"Techcard.Semiproducts"}),dataIndex:"subTechcards",key:"subTC",render:l=>e("span",{children:`${l.length||"-"}`}),sorter:(l,s)=>l.subTechcards.length-s.subTechcards.length},{title:u({id:"Techcard.kCal"}),dataIndex:"nutrients",key:"kCal",render:l=>e("span",{children:`${l.energy.toFixed(0)||"-"}`})},{title:u({id:"Techcard.Semiproduct"}),dataIndex:"isSubTechcard",key:"isSub",render:l=>e("span",{children:`${l?"Yes":"No"}`}),sorter:(l,s)=>l.isSubTechcard-s.isSubTechcard},{title:u({id:"Techcard.Action"}),dataIndex:"id",key:"action",render:(l,s)=>e("span",{children:p.name!=="david"&&e(be.Button,{overlay:g(l),onClick:()=>d(s),children:u({id:"window.edit"})})})}];return e("div",{children:e(j,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:T,dataSource:t,pagination:{position:"bottom",total:t.length,showTotal:(l,s)=>`${s[0]}-${s[1]} of ${l} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:t.length<10},loading:this.state.loading,rowKey:()=>Math.random()})})}})||$)||$)||$);var te,E;let Ne=(te=O(({user:b})=>({user:b})),N(E=U(E=te(E=class extends R.Component{constructor(t){super(t);f(this,"state",{cf:1});this.downloadTC=this.downloadTC.bind(this),this.changeCF=this.changeCF.bind(this)}changeCF(t){this.setState({cf:t})}async downloadTC(){const{techcard:t}=this.props,{cf:i}=this.state,n=await xe(t.id,i),r=await n.blob(),d=n.headers.get("Filename");fe.saveAs(r,`${d}`)}render(){const{techcard:t,edit:i,removeTechcard:n,user:r,intl:{formatMessage:d}}=this.props,{cf:o}=this.state,p=[{title:e("strong",{children:e(c,{id:"erp.ingredient"})}),dataIndex:"name",key:"name",render:s=>e("span",{children:e("strong",{children:` ${s}`})})},{title:e("strong",{children:e(c,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:s=>e("span",{children:`${s}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:s=>e("span",{children:`${s||"-"}`})},{title:e("strong",{children:e(c,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(s,D,S)=>e("span",{children:`${t.ingredientsAmount[S]/((100-D.percent)/100)}`})},{title:e("strong",{children:e(c,{id:"erp.netto"})}),dataIndex:"ingredientsAmount",key:"netto",render:(s,D,S)=>e("span",{children:`${t.ingredientsAmount[S]}`})}],u=[{title:e("strong",{children:e(c,{id:"erp.semiproduct"})}),dataIndex:"title",key:"title",render:s=>e("span",{children:e("strong",{children:` ${s}`})})},{title:e("strong",{children:e(c,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:s=>e("span",{children:`${s?"ks":"kilogram"}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:s=>e("span",{children:`${s||"-"}`})},{title:e("strong",{children:e(c,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(s,D,S)=>e("span",{children:`${t.subTechcardsAmount[S]/((100-D.percent)/100)}`})},{title:e("strong",{children:e(c,{id:"erp.netto"})}),dataIndex:"subTechcardsAmount",key:"netto",render:(s,D,S)=>e("span",{children:`${t.subTechcardsAmount[S]}`})}],g=[{title:e("strong",{children:e(c,{id:"erp.Title"})}),dataIndex:"title",key:"title",render:s=>e("span",{children:e("strong",{children:` ${s}`})})},{title:e("strong",{children:e(c,{id:"erp.Amount"})}),dataIndex:"amount",key:"amount",render:s=>e("span",{children:e("strong",{children:` ${s}`})})},{title:e("strong",{children:e(c,{id:"erp.Unit"})}),dataIndex:"unit",key:"unit",render:s=>e("span",{children:e("strong",{children:` ${s}`})})}],T={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},l={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return h("div",{children:[t.id&&h(C,{gutter:16,children:[h(m,{sm:24,md:14,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(c,{id:"erp.ingredients"})})}),e(j,{columns:p,dataSource:t?t.ingredients:[],pagination:!1,rowKey:()=>Math.random(),bordered:!0}),e("div",{style:{paddingLeft:"10px",marginTop:"10px"},children:e("h4",{children:e(c,{id:"erp.semiproducts"})})}),e(j,{columns:u,dataSource:t?t.subTechcards:[],pagination:!1,rowKey:()=>Math.random(),bordered:!0}),t&&t.proportions&&h(ne,{children:[e("div",{style:{paddingLeft:"10px",marginTop:"10px"},children:e("h4",{children:e(c,{id:"erp.Proportions"})})}),e(j,{columns:g,dataSource:t?t.proportions:[],pagination:!1,rowKey:()=>Math.random(),bordered:!0})]}),h("div",{style:{float:"right",fontSize:18,marginTop:"10px"},children:[e("b",{children:"Total:"})," ",t.amount*1e3," gram"]})]}),h(m,{sm:24,md:10,children:[h("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.title})}),r.name!=="david"&&h("div",{style:{marginTop:"10px"},children:[e(w,{type:"primary",onClick:()=>i(t),style:{margin:"0 5px 5px 0"},children:e(c,{id:"window.edit"})}),e(ce,{title:d({id:"Techcard.AreYouSureDeleteThisTechcard?"}),onConfirm:async()=>n(t.id),okText:d({id:"window.yes"}),cancelText:d({id:"window.no"}),children:e(w,{type:"primary",danger:!0,children:e(c,{id:"window.delete"})})})]}),e("table",{style:l,children:h("tbody",{children:[h("tr",{children:[e("th",{style:T,children:"kCal"}),e("th",{style:T,children:e(c,{id:"erp.prot"})}),e("th",{style:T,children:e(c,{id:"erp.fat"})}),e("th",{style:T,children:e(c,{id:"erp.carb"})}),e("th",{style:T,children:e(c,{id:"erp.weightG"})})]}),h("tr",{children:[e("td",{style:T,children:Math.round(t.nutrients.energy)}),e("td",{style:T,children:Math.round(t.nutrients.prot)}),e("td",{style:T,children:Math.round(t.nutrients.fat)}),e("td",{style:T,children:Math.round(t.nutrients.carb)}),e("td",{style:T,children:t.amount*1e3})]},"kbzhu")]})}),h("div",{style:{marginTop:"10px"},children:[t.isSubTechcard&&e(V,{color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:e(c,{id:"erp.semiproduct"})})},Math.random()),t.tags.map(s=>e(V,{color:"blue",children:e("span",{style:{fontSize:"14px"},children:s.cz})},Math.random()))]}),e("div",{style:{marginTop:"10px"},children:t.tagsByIngredients.map(s=>e(V,{color:"orange",children:e("span",{style:{fontSize:"14px"},children:s})},Math.random()))})]}),e("center",{children:e("div",{style:{marginTop:"10px"},children:e("h4",{children:e(c,{id:"erp.technologyСooking"})})})}),e("div",{className:"card",style:{border:"1px solid #e8e8e8"},children:e("div",{className:"card-body",children:t.description})}),e("center",{children:e("div",{style:{marginTop:"10px"},children:e("h4",{children:d({id:"Techcard.DownloadTechcard"})})})}),e("div",{className:"card",style:{border:"1px solid #e8e8e8"},children:e("center",{children:h("div",{className:"card-body",children:[e(F,{value:o,onChange:this.changeCF})," ",e(w,{onClick:this.downloadTC,children:d({id:"Techcard.Download"})})]})})})]})]}),!t.id&&e(ae,{description:!1})]})}})||E)||E)||E);var ie,M;const{Option:re}=k;let rt=(ie=O(({user:b})=>({user:b})),N(M=U(M=ie(M=class extends R.Component{constructor(t){super(t);f(this,"state",{data:[],createTechcardFormVisible:!1,forEdit:{},selected:{id:""},tag:[],allTags:[],activeTab:"1"});f(this,"showDrawerCreateTechcardForm",()=>{this.setState({createTechcardFormVisible:!0})});f(this,"editTechcardModal",t=>{this.setState({forEdit:t,createTechcardFormVisible:!0})});f(this,"selectTechcard",t=>{const{data:i}=this.state,n=i.find(r=>r.id===t);n&&this.setState({selected:n})});f(this,"changeTab",t=>{this.setState({activeTab:t})});f(this,"onCloseCreateTechcardForm",()=>{this.setState({createTechcardFormVisible:!1,forEdit:{}})});this.updateTechcards=this.updateTechcards.bind(this),this.removeTechcard=this.removeTechcard.bind(this),this.clearSearch=this.clearSearch.bind(this)}UNSAFE_componentWillMount(){H().then(async t=>{if(t.status===401){const{dispatch:i}=this.props;i({type:"user/SET_STATE",payload:{authorized:!1}});return}if(t.status===200){const i=await t.json();this.setState({data:i})}}),se().then(async t=>{if(t.status===200){const i=await t.json();this.setState({allTags:i})}})}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}updateTechcards(){const{tag:t}=this.state;t||H().then(async i=>{if(i.status===401){const{dispatch:n}=this.props;n({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const n=await i.json();let{selected:r}=this.state;if(r.id){const d=n.find(o=>o.id===r.id);r&&(console.log(d),r=d)}else r={};this.setState({data:n,forEdit:{},selected:r})}}),t&&we(t.toString()).then(async i=>{if(i.status===401){const{dispatch:n}=this.props;n({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const{intl:{formatMessage:n}}=this.props;let r=await i.json();Array.isArray(r)||(r=[r]);let{selected:d}=this.state;if(d.id){const o=r.find(p=>p.id===d.id);d&&(console.log(o),d=o)}else d={};this.setState({data:r,forEdit:{},selected:d}),I.success({message:n({id:"window.success"}),description:n({id:"Techcard.TechcardListUpdated!"}),placement:"topRight"})}})}async removeTechcard(t){const{intl:{formatMessage:i}}=this.props,n=await de(t);n.status===204?(I.success({message:i({id:"Techcard.Removed"}),description:i({id:"Techcard.TechcardSuccessfullyRemoved!"}),placement:"topRight"}),this.updateTechcards(),this.setState({selected:{}})):I.error({message:"Error",description:n.statusText,placement:"topRight"})}clearSearch(){const{intl:{formatMessage:t}}=this.props;this.setState({tag:[]}),setTimeout(()=>{this.updateTechcards(),I.success({message:t({id:"window.success"}),description:t({id:"Techcard.TechcardListUpdated!"}),placement:"topRight"})},100)}render(){const{data:t,createTechcardFormVisible:i,forEdit:n,selected:r,allTags:d,tag:o}=this.state,{user:p,intl:{formatMessage:u}}=this.props;return h(Se,{roles:["root","admin"],redirect:!0,to:"/main",children:[e(ve,{title:"ERP: Techcards"}),h("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:e(c,{id:"erp.techcards"})})})}),h("div",{className:"card-body",children:[h(C,{gutter:16,children:[e(m,{md:6,sm:24,children:p.name!=="david"&&e(w,{type:"primary",onClick:this.showDrawerCreateTechcardForm,style:{marginBottom:"15px"},children:e(c,{id:"erp.newTechcard"})})}),e(m,{md:6,sm:24,children:e(k,{placeholder:"Select tag",value:o,onChange:g=>this.onChangeField(g,"tag"),style:{width:"100%"},mode:"tags",children:d.map(g=>e(re,{value:g.id,children:g.cz},g.id))})}),h(m,{md:6,sm:24,children:[e(w,{type:"primary",onClick:this.updateTechcards,disabled:o.length===0,style:{margin:"0 15px 15px 0"},children:u({id:"Techcard.SearchByTags"})}),e(w,{type:"danger",disabled:o.length===0,onClick:this.clearSearch,style:{marginBottom:"15px"},children:u({id:"Techcard.ResetFilter"})})]})]}),e(Ce,{defaultActiveKey:"1",onChange:this.changeTab,items:[{label:e(c,{id:"erp.searchView"}),key:"1",children:h(G,{spinning:!1,children:[e("center",{children:e(k,{showSearch:!0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:u({id:"Techcard.Search..."}),filterOption:(g,T)=>T.props.children.toLowerCase().indexOf(g.toLowerCase())>=0,style:{width:"500px",marginBottom:"15px"},onChange:this.selectTechcard,children:t.map(g=>e(re,{value:g.id,children:g.title},g.id))})}),e(Ne,{techcard:r,edit:this.editTechcardModal,removeTechcard:this.removeTechcard})]})},{label:e(c,{id:"erp.allTechcards"}),key:"2",children:e(G,{spinning:!1,children:e(ze,{data:t,edit:this.editTechcardModal,removeTechcard:this.removeTechcard})})}]})]})]}),e(Me,{visible:i,onClose:this.onCloseCreateTechcardForm,data:t,forEdit:n,create:ke,edit:Ie,update:this.updateTechcards})]})}})||M)||M)||M);export{rt as default};
