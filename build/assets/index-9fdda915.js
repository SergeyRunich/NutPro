var D=Object.defineProperty;var _=(g,l,t)=>l in g?D(g,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):g[l]=t;var h=(g,l,t)=>(_(g,typeof l!="symbol"?l+"":l,t),t);import{a1 as k,a2 as A,r as O,a3 as T,j as e,a4 as R,bl as n,c as u,I as M,a5 as F,bo as j,bd as z,be as N,a8 as V,bg as G,B as S}from"./index-c20b5e8e.js";import{T as q}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as $}from"./index-67f4e7c4.js";import{g as b,d as B,c as P,e as U}from"./ingredientTags-97eb43e3.js";import{g as H}from"./ingredientGroup-69636766.js";import{g as K}from"./ingredient-16e26155.js";import{F as f}from"./index-a86cfb93.js";import{R as C,C as w}from"./row-58ed805b.js";import"./styleChecker-a7b568e2.js";var E;const{Option:x}=F;let W=k(E=class extends A.Component{constructor(t){super(t);h(this,"state",{title:"",groups:[],isEdit:!1,ingredients:[],active:!0});h(this,"formRef",O.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this)}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}async onFinish(){try{const{create:t,edit:i,forEdit:s,update:r,intl:{formatMessage:o}}=this.props;await this.formRef.current.validateFields();const{title:c,groups:p,ingredients:I,active:a}=this.state,d={title:c,groups:p,ingredients:I,active:a};if(s.id){const{showOnlyActive:y}=this.props,v=await i(s.id,d);v.status===200?(this.closeDrawer(),T.success({message:o({id:"IngrTag.Saved"}),description:o({id:"IngrTag.IngredienttagSuccessfullySaved!"})}),await r(y)):T.error({message:o({id:"window.error"}),description:v.statusText,placement:"topLeft"})}else{const y=await t(d),{showOnlyActive:v}=this.props;y.status===201?(this.closeDrawer(),T.success({message:o({id:"IngrTag.Created"}),description:o({id:"IngrTag.IngredienttagSuccessfullyCreated!"})}),r(v)):T.error({message:o({id:"window.error"}),description:y.statusText,placement:"topLeft"})}}catch(t){console.log("Failed:",t)}}setEdit(){const{forEdit:t}=this.props,i=[],s=[];t.groups.map(r=>(i.push(r.id),i)),t.ingredients.map(r=>(s.push(r.id),s)),t&&this.setState({title:t.title,groups:i,isEdit:!0,ingredients:s,active:!0})}componentDidUpdate(t){var s,r,o;const{forEdit:i}=this.props;i&&t.forEdit!==i&&((o=this.formRef.current)==null||o.setFieldsValue({title:i.title,groups:(s=i.groups)==null?void 0:s.map(c=>c.id),ingredients:(r=i.ingredients)==null?void 0:r.map(c=>c.id)}))}closeDrawer(){const{onClose:t}=this.props;this.setState({isEdit:!1,title:"",groups:[],ingredients:[],active:!0}),this.formRef.current.resetFields(),t()}render(){const{visible:t,forEdit:i,ingredientList:s,groupList:r}=this.props,{groups:o,isEdit:c,ingredients:p,active:I}=this.state;return i.id&&!c&&this.setEdit(),e(R,{title:i.id?e(n,{id:"IngrTag.editingIngredienttag"}):e(n,{id:"IngrTag.creatingIngredienttag"}),open:t,onOk:this.onSend,okText:e(n,{id:"main.save"}),onCancel:this.closeDrawer,children:u(f,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[e(C,{gutter:16,children:e(w,{md:24,sm:24,children:e(f.Item,{label:e(n,{id:"IngrTag.Title"}),name:"title",rules:[{required:!0}],children:e(M,{onChange:a=>this.onChangeField(a,"title")})})})}),e(C,{gutter:16,children:e(w,{md:24,sm:24,children:e(f.Item,{name:"groups",label:e(n,{id:"IngrTag.Groups"}),children:e(F,{placeholder:"Groups",mode:"multiple",value:o,onChange:a=>this.onChangeField(a,"groups"),children:r.map(a=>e(x,{value:a.id,children:a.name},a.id))})})})}),e(C,{gutter:16,children:u(w,{md:24,sm:24,children:[e(f.Item,{name:"ingredients",label:e(n,{id:"IngrTag.Ingredients"}),children:e(F,{placeholder:"Ingredients",mode:"multiple",value:p,onChange:a=>this.onChangeField(a,"ingredients"),children:s.map(a=>e(x,{value:a.id,children:a.name},a.id))})}),i.id&&e(f.Item,{name:"ingredients",label:e(n,{id:"IngrTag.Active"}),children:e(j,{checked:I,onChange:a=>this.onChangeField(a,"active")})})]})})]})})}})||E;var L,m;let oe=(L=z(({user:g})=>({user:g})),k(m=N(m=L(m=class extends A.Component{constructor(t){super(t);h(this,"state",{ingredientList:[],data:[],loading:!0,createIngredientTagFormVisible:!1,groupList:[],forEdit:{},tagsList:[],showOnlyActive:!0});h(this,"showDrawerCreateIngredientTagForm",()=>{this.setState({createIngredientTagFormVisible:!0})});h(this,"editIngredientTagModal",t=>{this.setState({forEdit:t,createIngredientTagFormVisible:!0})});h(this,"onCloseCreateIngredientTagForm",()=>{this.setState({forEdit:{},createIngredientTagFormVisible:!1})});h(this,"refSearchInput",t=>{this.searchInput=t});this.updateIngredientTag=this.updateIngredientTag.bind(this)}UNSAFE_componentWillMount(){const{showOnlyActive:t}=this.state;b(t).then(async i=>{if(i.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const s=await i.json();this.setState({tagsList:s.result})}}),K().then(async i=>{if(i.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const s=await i.json();this.setState({ingredientList:s,loading:!1})}}),H().then(async i=>{if(i.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const s=await i.json();this.setState({groupList:s})}})}onChangeField(t,i){t.target?t.target.type==="checkbox"?this.setState({[i]:t.target.checked}):this.setState({[i]:t.target.value}):this.setState({[i]:t})}updateIngredientTag(t){b(t).then(async i=>{if(i.status===401){const{dispatch:s}=this.props;s({type:"user/SET_STATE",payload:{authorized:!1}});return}if(i.status===200){const s=await i.json();this.setState({tagsList:s.result,loading:!1,forEdit:{}})}})}async removeIngredientTag(t){const{intl:{formatMessage:i}}=this.props,{showOnlyActive:s}=this.state,r=await B(t);r.status===205?(T.success({message:i({id:"IngrTag.Removed"}),description:i({id:"IngrTag.IngredienttagDeleted!"})}),this.updateIngredientTag(s)):T.error({message:i({id:"window.error"}),description:r.statusText,placement:"topRight"})}render(){const{data:t,createIngredientTagFormVisible:i,groupList:s,ingredientList:r,forEdit:o,tagsList:c,showOnlyActive:p}=this.state,I=[{title:e(n,{id:"IngrTag.ID"}),dataIndex:"id",key:"id",render:a=>e("span",{children:a})},{title:e(n,{id:"IngrTag.Tag"}),dataIndex:"title",key:"title",render:a=>e("span",{children:a})},{title:e(n,{id:"IngrTag.Ingredients"}),dataIndex:"ingredients",key:"ingredients",render:a=>e("span",{children:a.map(d=>d.name).join()})},{title:e(n,{id:"IngrTag.Groups"}),dataIndex:"groups",key:"groups",render:a=>e("span",{children:a.map(d=>d.name).join()})},{title:e(n,{id:"IngrTag.Actions"}),dataIndex:"id",key:"editorremove",render:(a,d)=>u("span",{children:[e(S,{type:"primary",onClick:()=>this.editIngredientTagModal(d),children:e(n,{id:"IngrTag.Edit"})}),e($,{title:"Are you sure delete this tag?",onConfirm:()=>this.removeIngredientTag(a),okText:"Yes",cancelText:"No",children:e(S,{style:{marginLeft:"30px"},type:"danger",children:e(n,{id:"IngrTag.Delete"})})})]})}];return u(V,{roles:["root","admin"],redirect:!0,to:"/main",children:[e(G,{title:"Ingredient Tags"}),u("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:e(n,{id:"IngrTag.ingredientTags"})})})}),u("div",{className:"card-body",children:[u("div",{style:{marginBottom:"20px",display:"flex",alignItems:"center"},children:[e("span",{children:e(n,{id:"IngrTag.showOnlyActiveTags"})}),e(j,{style:{marginLeft:"15px"},checked:p,onChange:a=>this.onChangeField(a,"showOnlyActive")}),e(S,{style:{marginLeft:"20px"},type:"primary",onClick:()=>{this.updateIngredientTag(p)},children:e(n,{id:"IngrTag.Update"})}),e(S,{style:{marginLeft:"auto"},type:"primary",onClick:this.showDrawerCreateIngredientTagForm,children:e(n,{id:"IngrTag.newIngredientTag"})})]}),e(q,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:I,dataSource:c,pagination:{position:"bottom",total:t.length,showTotal:(a,d)=>`${d[0]}-${d[1]} of ${a} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:t.length<10},loading:this.state.loading,rowKey:()=>Math.random()})]})]}),e(W,{visible:i,onClose:this.onCloseCreateIngredientTagForm,groupList:s,ingredientList:r,forEdit:o,create:P,edit:U,update:this.updateIngredientTag,showOnlyActive:p})]})}})||m)||m)||m);export{oe as default};
