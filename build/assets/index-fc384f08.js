var ae=Object.defineProperty;var ne=(p,b,t)=>b in p?ae(p,b,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[b]=t;var f=(p,b,t)=>(ne(p,typeof b!="symbol"?b+"":b,t),t);import{bd as z,be as te,a2 as F,j as e,c as a,bl as h,aY as N,a1 as V,a3 as S,B as v,a6 as re,a5 as _,r as de,I as q,bL as G,aa as se,a8 as le,bg as oe}from"./index-c20b5e8e.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as ce}from"./index-2f7554ca.js";import{e as he,g as pe}from"./template-0cdd19f6.js";import{g as me}from"./calendar-94c10bb8.js";import{b as O}from"./techcard-66c5dea0.js";import{T as j}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{R as A,C as T}from"./row-58ed805b.js";import{D as B}from"./index-1e692111.js";import{T as P}from"./index-8e340a60.js";import{s as ge}from"./testSettings-9d6c3207.js";import{F as L}from"./index-a86cfb93.js";import{D as ue}from"./index-98f1088d.js";import{I as K}from"./index-86d1917a.js";import{D as ye,C as be,P as fe}from"./react-beautiful-dnd.esm-d864c540.js";import{S as xe}from"./StarOutlined-01cf381d.js";import"./styleChecker-a7b568e2.js";var H,$;let ie=(H=z(({user:p})=>({user:p})),te($=H($=class extends F.Component{constructor(){super(...arguments);f(this,"state",{})}render(){const{techcard:t,visible:r,onClose:s}=this.props,n=[{title:e("strong",{children:e(h,{id:"erp.ingredient"})}),dataIndex:"name",key:"name",render:o=>e("span",{children:e("strong",{children:` ${o}`})})},{title:e("strong",{children:e(h,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:o=>e("span",{children:`${o}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:o=>e("span",{children:`${o||"-"}`})},{title:e("strong",{children:e(h,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(o,c,l)=>e("span",{children:`${t.ingredientsAmount[l]/((100-c.percent)/100)}`})},{title:e("strong",{children:e(h,{id:"erp.netto"})}),dataIndex:"ingredientsAmount",key:"netto",render:(o,c,l)=>e("span",{children:`${t.ingredientsAmount[l]}`})}],d=[{title:e("strong",{children:e(h,{id:"erp.semiproduct"})}),dataIndex:"title",key:"title",render:o=>e("span",{children:e("strong",{children:` ${o}`})})},{title:e("strong",{children:e(h,{id:"erp.unit"})}),dataIndex:"unit",key:"unit",render:o=>e("span",{children:`${o?"ks":"kilogram"}`})},{title:e("strong",{children:"%"}),dataIndex:"percent",key:"percent",render:o=>e("span",{children:`${o||"-"}`})},{title:e("strong",{children:e(h,{id:"erp.brutto"})}),dataIndex:"brutto",key:"brutto",render:(o,c,l)=>e("span",{children:`${t.subTechcardsAmount[l]/((100-c.percent)/100)}`})},{title:e("strong",{children:e(h,{id:"erp.netto"})}),dataIndex:"subTechcardsAmount",key:"netto",render:(o,c,l)=>e("span",{children:`${t.subTechcardsAmount[l]}`})}],m={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},x={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return e(B,{title:`Techcard: ${t.title}`,width:"100%",height:"100%",onClose:()=>s(),open:r,bodyStyle:{paddingBottom:80},children:a("div",{children:[t.id&&a(A,{gutter:16,children:[a(T,{sm:24,md:14,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(h,{id:"erp.ingredients"})})}),e(j,{columns:n,dataSource:t?t.ingredients:[],pagination:!1,bordered:!0,rowKey:()=>Math.random()}),e("div",{style:{paddingLeft:"10px",marginTop:"10px"},children:e("h4",{children:e(h,{id:"erp.semiproducts"})})}),e(j,{columns:d,dataSource:t?t.subTechcards:[],pagination:!1,bordered:!0,rowKey:()=>Math.random()}),a("div",{style:{float:"right",fontSize:18,marginTop:"10px"},children:[e("b",{children:e(h,{id:"erp.Total:"})})," ",t.amount*1e3," gram"]})]}),a(T,{sm:24,md:10,children:[a("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.title})}),e("table",{style:x,children:a("tbody",{children:[a("tr",{children:[e("th",{style:m,children:"kCal"}),e("th",{style:m,children:e(h,{id:"erp.prot"})}),e("th",{style:m,children:e(h,{id:"erp.fat"})}),e("th",{style:m,children:e(h,{id:"erp.carb"})})]}),a("tr",{children:[e("td",{style:m,children:Math.round(t.nutrients.energy)}),e("td",{style:m,children:Math.round(t.nutrients.prot)}),e("td",{style:m,children:Math.round(t.nutrients.fat)}),e("td",{style:m,children:Math.round(t.nutrients.carb)})]},"kbzhu")]})}),a("div",{style:{marginTop:"10px"},children:[t.isSubTechcard&&e(P,{color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:e(h,{id:"erp.semiproduct"})})},Math.random()),t.tags.map(o=>e(P,{color:"blue",children:e("span",{style:{fontSize:"14px"},children:o.cz})},Math.random()))]})]}),e("center",{children:e("div",{style:{marginTop:"10px"},children:e("h4",{children:e(h,{id:"erp.technologyÐ¡ooking"})})})}),e("div",{className:"card",style:{border:"1px solid #e8e8e8"},children:e("div",{className:"card-body",children:t.description})})]})]}),!t.id&&e(N,{description:!1})]})})}})||$)||$);var U,R;let Te=(U=z(({user:p})=>({user:p})),V(R=U(R=class extends F.Component{constructor(){super(...arguments);f(this,"state",{testData:[],testVisible:!1,selectedTechcard:"",techcardVisible:!1,range:{min:0,max:0}});f(this,"showTechcard",t=>{O(t).then(async r=>{if(r.status===200){const s=await r.json();this.setState({selectedTechcard:s,techcardVisible:!0})}})});f(this,"onCloseTechcard",()=>{this.setState({techcardVisible:!1,selectedTechcard:""})})}UNSAFE_componentWillReceiveProps(){this.setState({testData:[],testVisible:!1})}async startTest(t){const{intl:{formatMessage:r}}=this.props;try{const n=await ge({dayTemplate:t});if(n.status===200){const d=await n.json();S.success({message:r({id:"window.success"}),description:r({id:"TemplateDetail.TestFinished!"})}),this.setState({testData:d.dishes,range:d.range,testVisible:!0})}else S.error({message:r({id:"window.error"}),description:n.statusText,placement:"topLeft"})}catch(s){console.log("Failed:",s)}}render(){const{template:t,edit:r,user:s,visible:n,onClose:d,intl:{formatMessage:m}}=this.props,{testVisible:x,testData:o,range:c,selectedTechcard:l,techcardVisible:D}=this.state,M=["Breakfast","1 Snack","Lunch","2 Snack","Dinner"],C=[{title:e("strong",{children:"#"}),key:"dfdfdfdf",render:(i,w,W)=>e("span",{children:e("strong",{children:` ${W+1}`})})},{title:e("strong",{children:e(h,{id:"erp.dish"})}),dataIndex:"techcard",key:"name",render:(i,w)=>e("span",{children:e("strong",{children:e(v,{type:"link",onClick:()=>this.showTechcard(w.techcard.id),children:` ${i.title}`})})})},{title:e("strong",{children:e(h,{id:"erp.coefficient"})}),dataIndex:"amount",key:"amount",render:i=>e("span",{children:`${i}`}),sorter:(i,w)=>i.amount-w.amount},{title:e("strong",{children:e(h,{id:"erp.weightG"})}),dataIndex:"amount",key:"amountfdfdf",render:(i,w)=>{const W=Math.floor(i*w.techcard.amount*100)*10;return e("span",{children:`${W}`})}},{title:e("strong",{children:"kCal"}),dataIndex:"kcal",key:"kcal",render:i=>e("span",{children:`${i}`})},{title:e("strong",{children:"P"}),dataIndex:"prot",key:"prot",render:i=>e("span",{children:`${i}`})},{title:e("strong",{children:"F"}),dataIndex:"fat",key:"fat",render:i=>e("span",{children:`${i}`})},{title:e("strong",{children:"C"}),dataIndex:"carb",key:"carb",render:i=>e("span",{children:`${i}`})},{title:e("strong",{children:e(h,{id:"erp.meal"})}),dataIndex:"meal",key:"meal",render:i=>e("span",{children:`${M[i]}`}),sorter:(i,w)=>i.meal-w.meal},{title:e("strong",{children:e(h,{id:"erp.group"})}),dataIndex:"group",key:"group",render:i=>e("span",{children:`${i}`}),sorter:(i,w)=>i.group-w.group}],g={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},k={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",backgroundColor:"red"},y={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",backgroundColor:"green"},u={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return e(B,{title:m({id:"TemplateDetail.DayTemplate:SPACE"})+t.name,width:"100%",height:"100%",onClose:()=>d(),open:n,bodyStyle:{paddingBottom:80},children:a("div",{children:[t.id&&a(A,{gutter:16,children:[a(T,{sm:24,md:14,children:[e("div",{style:{paddingLeft:"10px"},children:e("h4",{children:e(h,{id:"erp.positions"})})}),e(j,{columns:C,dataSource:t?t.dishes:[],pagination:!1,bordered:!0,rowKey:()=>Math.random()})]}),e(T,{sm:24,md:10,children:a("center",{children:[e("div",{style:{marginTop:"10px"},children:e("h3",{children:t.name})}),s.name!=="david"&&e("div",{style:{marginTop:"10px"},children:e(v,{type:"primary",onClick:()=>r(t),style:{margin:"0 5px 5px 0"},children:e(h,{id:"window.edit"})})}),e("div",{style:{marginTop:"10px"},children:e(P,{color:"#87d068",children:e("span",{style:{fontSize:"14px"},children:t.class})},Math.random())}),a("div",{style:{marginTop:"10px"},children:[e(v,{type:"primary",onClick:()=>this.startTest(t.id),style:{margin:"0 5px 5px 0"},children:m({id:"TemplateDetail.kCalTest"})}),e("br",{}),x&&e("table",{style:u,children:a("tbody",{children:[a("tr",{children:[e("th",{style:g,children:e(h,{id:"erp.meal"})}),e("th",{style:g,children:m({id:"TemplateDetail.Option"})}),e("th",{style:g,children:m({id:"TemplateDetail.Min"})}),e("th",{style:g,children:m({id:"TemplateDetail.Max"})})]}),o.map(i=>a("tr",{children:[e("td",{style:g,children:M[i.meal]}),e("td",{style:g,children:e(re,{checked:i.optional,disabled:!0})}),e("td",{style:i.min.total>=i.min.shouldBe&&i.min.total!==1e4?y:k,children:i.min.total!==1e4?i.min.total:"-"}),e("td",{style:i.max.total<=i.max.shouldBe&&i.max.total!==0?y:k,children:i.max.total!==0?i.max.total:"-"})]},Math.random()))]})}),x&&a("p",{style:{fontSize:"30px"},children:[e("br",{})," ",m({id:"TemplateDetail.kCalRange"}),e("br",{})," ",c.min," - ",c.max," "]})]})]})})]}),!t.id&&e(N,{description:!1}),e(ie,{visible:D,techcard:l,onClose:this.onCloseTechcard})]})})}})||R)||R);var J;const{Option:I}=_;let Ce=V(J=class extends F.Component{constructor(){super(...arguments);f(this,"state",{})}render(){const{dishes:t,techcards:r,onChangeDish:s,deleteDish:n,getItemStyle:d,getListStyle:m,onChangeAlways:x,onDragEnd:o,always:c,intl:{formatMessage:l}}=this.props;return a("div",{children:[t.length!==0&&e("div",{children:e(ye,{onDragEnd:o,children:e(A,{gutter:16,children:e(T,{md:24,sm:24,children:e(be,{droppableId:"droppable",children:(D,M)=>a("div",{...D.droppableProps,ref:D.innerRef,style:m(M.isDraggingOver),children:[t.map((C,g)=>e(fe,{draggableId:C.key,index:g,children:(k,y)=>e("div",{ref:k.innerRef,...k.draggableProps,...k.dragHandleProps,style:d(y.isDragging,k.draggableProps.style),children:a(A,{style:{width:"100%"},gutter:16,children:[e(T,{md:8,sm:24,children:e(_,{showSearch:!0,value:t[g].techcard||void 0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:l({id:"DishList.SelectTechcard..."}),filterOption:(u,i)=>i.props.children.toLowerCase().indexOf(u.toLowerCase())>=0,style:{width:"100%"},onChange:u=>s(u,"techcard",g),children:r.map(u=>e(I,{value:u.id,children:u.title},u.id))})}),e(T,{md:4,sm:24,children:e(K,{placeholder:l({id:"DishList.Coeff"}),value:C.amount,style:{width:"100%"},onChange:u=>s(u,"amount",g)})}),e(T,{md:4,sm:24,children:a(_,{value:C.meal,placeholder:l({id:"DishList.Meal"}),style:{width:"100%"},onChange:u=>s(u,"meal",g),children:[e(I,{value:0,children:l({id:"DishList.Breakfast"})},0),e(I,{value:1,children:l({id:"DishList.1Snack"})},1),e(I,{value:2,children:l({id:"DishList.Lunch"})},2),e(I,{value:3,children:l({id:"DishList.2Snack"})},3),e(I,{value:4,children:l({id:"DishList.Dinner"})},4)]})}),e(T,{md:4,sm:24,children:e(K,{placeholder:l({id:"DishList.Group"}),value:C.group,style:{width:"100%"},onChange:u=>s(u,"group",g)})}),e(T,{md:2,sm:24,children:e(re,{disabled:c.length>=2&&c.indexOf(C.group)===-1,value:c.indexOf(C.group)!==-1,checked:c.indexOf(C.group)!==-1,onChange:u=>x(u,C.group,g),children:l({id:"DishList.Always"})})}),e(T,{md:2,sm:24,children:e(v,{type:"primary",danger:!0,onClick:()=>n(g),children:l({id:"window.remove"})})})]})})},C.key)),D.placeholder]})})})})})}),t.length===0&&e(N,{description:!1})]})}})||J;var Q;const ke=(p,b,t)=>{const r=Array.from(p),[s]=r.splice(b,1);return r.splice(t,0,s),r},Y=8,we=(p,b)=>({userSelect:"none",padding:Y,margin:`0 0 ${Y}px 0`,borderRadius:"5px",background:p?"lightgreen":"",...b}),Se=()=>({padding:Y,borderRadius:"5px"});let De=V(Q=class extends F.Component{constructor(t){super(t);f(this,"state",{name:"",always:[],isEdit:!1,dishes:[{techcard:null,amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}]});f(this,"formRef",de.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.deleteDish=this.deleteDish.bind(this),this.addDish=this.addDish.bind(this),this.onChangeDish=this.onChangeDish.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onChangeAlways=this.onChangeAlways.bind(this)}componentDidMount(){var s;const{name:t,always:r}=this.state;O().then(async n=>{if(n.status===200){const d=await n.json();this.setState({techcards:d})}}),(s=this.formRef.current)==null||s.setFieldsValue({name:t,always:r})}onDragEnd(t){if(!t.destination)return;const{dishes:r}=this.state,s=ke(r,t.source.index,t.destination.index);this.setState({dishes:s})}onChangeField(t,r){t.target?t.target.type==="checkbox"?this.setState({[r]:t.target.checked}):this.setState({[r]:t.target.value}):this.setState({[r]:t})}onChangeDish(t,r,s){const{dishes:n}=this.state;let d=t;t.target&&(t.target.type==="checkbox"?d=t.target.checked:d=t.target.value),n[s][r]=d,this.setState({dishes:n})}onChangeAlways(t,r){const{always:s}=this.state;let n=t;t.target&&(t.target.type==="checkbox"?n=t.target.checked:n=t.target.value);const d=s.indexOf(r);n?s.push(r):!n&&d!==-1&&s.splice(d,1),this.setState({always:s})}async onFinish(){try{const{create:t,edit:r,forEdit:s,update:n,intl:{formatMessage:d}}=this.props;await this.formRef.current.validateFields();const{name:m,always:x,dishes:o}=this.state;x.length<2&&x.push(x[0]);const c={name:m,always:x,dishes:o};if(s.id){const l=await r(s.id,c);l.status===200?(this.closeDrawer(),S.success({message:d({id:"CreateTemplate.Saved"}),description:d({id:"CreateTemplate.TemplateSuccessfullySaved!"})}),n()):S.error({message:d({id:"window.error"}),description:l.statusText,placement:"topLeft"})}else{const l=await t(c);l.status===201?(this.closeDrawer(),S.success({message:d({id:"CreateTemplate.Created"}),description:d({id:"CreateTemplate.TemplateSuccessfullyCreated!"})}),n()):S.error({message:d({id:"window.error"}),description:l.statusText,placement:"topLeft"})}}catch(t){console.log("Failed:",t)}}setEdit(){const{forEdit:t}=this.props;t&&this.setState({name:t.name,always:t.always,dishes:t.dishes.map(r=>({techcard:r.techcard.id,amount:r.amount,meal:r.meal,group:r.group,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)})),isEdit:!0})}addDish(){const{dishes:t}=this.state;t.push({techcard:"",amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}),this.setState({dishes:t})}deleteDish(t){const{dishes:r}=this.state;r.splice(t,1),this.setState({dishes:r})}closeDrawer(){const{onClose:t}=this.props;t(),this.setState({name:"",always:[],dishes:[{techcard:"",amount:1,meal:0,group:0,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}],isEdit:!1}),this.formRef.current.resetFields()}render(){const{visible:t,forEdit:r,intl:{formatMessage:s}}=this.props,{name:n,isEdit:d,techcards:m,dishes:x,always:o}=this.state;return r.id&&!d&&this.setEdit(),e("div",{children:e(B,{title:s(d?{id:"CreateTemplate.EDITTEMPLATE"}:{id:"CreateTemplate.CREATENEWTEMPLATE"}),width:"100%",height:"100%",onClose:this.closeDrawer,open:t,bodyStyle:{paddingBottom:80},children:a(L,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[a(A,{gutter:16,children:[e(T,{md:16,sm:24,children:e(L.Item,{label:s({id:"window.name"}),name:"name",rules:[{required:!0}],children:e(q,{onChange:c=>this.onChangeField(c,"name")})})}),e(T,{md:4,sm:24,children:e(L.Item,{label:s({id:"CreateTemplate.AlwaysPortions"}),name:"always",rules:[{required:!0}],children:e(q,{disabled:!0,onChange:c=>this.onChangeField(c,"always")})})}),e(T,{md:4,sm:24,children:e(L.Item,{children:e(v,{size:"large",htmlType:"submit",children:s({id:"window.save"})})})})]}),e(A,{gutter:16,children:a(T,{md:24,sm:24,children:[a(ue,{orientation:"left",children:[s({id:"CreateTemplate.Positions"})," ",e(v,{type:"primary",size:"small",onClick:this.addDish,children:s({id:"CreateTemplate.Add"})})]}),e(Ce,{techcards:m,addDish:this.addDish,deleteDish:this.deleteDish,onChangeDish:this.onChangeDish,onChangeAlways:this.onChangeAlways,onDragEnd:this.onDragEnd,getItemStyle:we,getListStyle:Se,dishes:x,always:o})]})})]})})})}})||Q;var X,Z;let ve=(X=z(({user:p})=>({user:p})),X(Z=class extends F.Component{constructor(){super(...arguments);f(this,"state",{selectedTechcard:"",techcardVisible:!1,selectedTemplate:"",templateVisible:!1,editTemplateFormVisible:!1,forEdit:{}});f(this,"showTechcard",t=>{O(t).then(async r=>{if(r.status===200){const s=await r.json();this.setState({selectedTechcard:s,techcardVisible:!0})}})});f(this,"onCloseTechcard",()=>{this.setState({techcardVisible:!1,selectedTechcard:""})});f(this,"showTemplate",t=>{this.setState({selectedTemplate:t,templateVisible:!0})});f(this,"onCloseTemplate",()=>{this.setState({templateVisible:!1,selectedTemplate:""})});f(this,"editTemplateModal",t=>{this.setState({forEdit:t,editTemplateFormVisible:!0})});f(this,"onCloseEditTemplateForm",()=>{this.setState({editTemplateFormVisible:!1,forEdit:{}})})}render(){const{week:t}=this.props,{selectedTechcard:r,techcardVisible:s,selectedTemplate:n,templateVisible:d,editTemplateFormVisible:m,forEdit:x}=this.state,o=["Breakfast","1 Snack","Lunch","2 Snack","Dinner"],c={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"10px",padding:"0.5em",textAlign:"center",textSize:"10px"},l={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",background:"linear-gradient(90deg, rgba(251,0,0,0.23573179271708689) 0%, rgba(255,0,0,0.5018382352941176) 50%, rgba(255,0,0,0.24) 100%)"},D={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",background:"linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(232,255,0,0.3113620448179272) 50%, rgba(255,255,255,1) 100%)"},M={border:"1px solid #e8e8e8",borderCollapse:"collapse",padding:"0.5em",textAlign:"center",textSize:"10px",background:"linear-gradient(90deg, rgba(22,251,0,0.23573179271708689) 0%, rgba(0,255,12,0.41780462184873945) 50%, rgba(22,251,0,0.24) 100%)"},C={border:"1px solid #e8e8e8",borderCollapse:"collapse",borderRadius:"5px",padding:"0.5em",marginTop:"15px",display:"inline-table"};return a("div",{children:[Boolean(t.id)&&a("div",{style:{minWidth:"100%",maxWidth:"100%"},children:[e("br",{}),e("center",{children:e("h3",{children:t.title})}),e("center",{children:e("table",{style:C,width:"100%",children:a("tbody",{children:[a("tr",{children:[e("th",{style:c,children:e(h,{id:"erp.meal"})}),[0,1,2,3,4,5].map(g=>e("th",{style:c,children:e(G,{to:"#",onClick:k=>{this.showTemplate(t.days[g].template),k.preventDefault()},style:{textDecoration:"underline"},children:` ${t.days[g].template.name}`})},g))]}),[0,1,2,3,4].map(g=>a("tr",{children:[e("td",{style:c,children:o[g]}),[0,1,2,3,4,5].map(k=>{const y=t.days[k].dishes.find(i=>i.meal===g);let u=y!==void 0&&y.score>=4.2?M:D;return y!==void 0&&y.score<3.7&&(u=l),(y===void 0||Number(y.score)===0)&&(u=c),e("td",{style:u,children:y!==void 0?a("span",{children:[e(G,{to:"#",onClick:i=>{this.showTechcard(y.id),i.preventDefault()},children:y.title}),Number(y.score)!==0&&" ",Number(y.score)!==0&&e(xe,{}),Number(y.score)!==0&&y.score]}):"-"},k)})]},g))]})})})]}),e(ie,{visible:s,techcard:r,onClose:this.onCloseTechcard}),e(Te,{template:n,visible:d,onClose:this.onCloseTemplate,edit:this.editTemplateModal,removeTemplate:this.removeTemplate}),e(De,{visible:m,onClose:this.onCloseEditTemplateForm,forEdit:x,edit:he})]})}})||Z);var ee,E;se.updateLocale("en",{week:{dow:1}});const{WeekPicker:Me}=ce;let Ze=(ee=z(({user:p})=>({user:p})),V(E=te(E=ee(E=class extends F.Component{constructor(){super(...arguments);f(this,"state",{data:[],createTemplateFormVisible:!1,forEdit:{},selected:{id:""},weeks:[]});f(this,"selectWeek",t=>{if(t){const r=se.utc(t.startOf("isoWeek").format("DD.MM.YYYY"),"DD.MM.YYYY").unix();this.setState({weekDate:r})}})}UNSAFE_componentWillMount(){pe().then(async t=>{if(t.status===401){const{dispatch:r}=this.props;r({type:"user/SET_STATE",payload:{authorized:!1}});return}if(t.status===200){const r=await t.json();this.setState({data:r})}})}async onDownloadMenu(){const{weekDate:t}=this.state,{intl:{formatMessage:r}}=this.props,s=await me(t);if(s.status===401){const{dispatch:n}=this.props;n({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();this.setState({weeks:n}),S.success({message:r({id:"window.success"}),description:r({id:"TemplateMenu.WeeksLoaded!"})})}s.status===404&&S.warning({message:r({id:"TemplateMenu.TheCalendarIsNotFilledIn"}),description:r({id:"TemplateMenu.TheCalendarForTheSelectedWeeksIsNotFilledIn"})})}render(){const{weeks:t}=this.state,{intl:{formatMessage:r}}=this.props;return a(le,{roles:["root","admin"],redirect:!0,to:"/main",children:[e(oe,{title:"Weekly calendar"}),a("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:r({id:"TemplateMenu.WeeklyCalendar"})})})}),a("div",{className:"card-body",children:[e(Me,{format:"w \\w\\e\\e\\k - YYYY",placeholder:r({id:"TemplateMenu.SelectFirstWeek(anyDayInWeek)"}),onChange:this.selectWeek,style:{width:250}}),e(v,{type:"primary",style:{marginLeft:"15px"},onClick:async()=>this.onDownloadMenu(),children:r({id:"TemplateMenu.Load"})}),t.map((s,n)=>e(ve,{week:t[n]},n))]})]})]})}})||E)||E)||E);export{Ze as default};
