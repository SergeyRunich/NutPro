var P=Object.defineProperty;var V=(o,d,e)=>d in o?P(o,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[d]=e;var g=(o,d,e)=>(V(o,typeof d!="symbol"?d+"":d,e),e);import{a1 as x,a2 as I,c as l,j as t,a5 as N,B as F,aY as $,aa as f,r as B,a3 as b,I as _,bd as H,be as q,aX as W,a8 as L,bg as U,aZ as w,bF as K}from"./index-c20b5e8e.js";import{T as X}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{e as Z,c as G,g as M,d as J,a as Q}from"./order-d29e3517.js";import{F as S}from"./index-a86cfb93.js";import{R as E,C as c}from"./row-58ed805b.js";import{D as ee}from"./index-1e692111.js";import{D as te}from"./index-98f1088d.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as se}from"./index-2f7554ca.js";import{I as T}from"./index-86d1917a.js";import{D as ie,C as ae,P as re}from"./react-beautiful-dnd.esm-d864c540.js";import{b as ne}from"./techcard-66c5dea0.js";import"./styleChecker-a7b568e2.js";import"./index-8e340a60.js";var R;const{Option:oe}=N;let de=x(R=class extends I.Component{constructor(){super(...arguments);g(this,"state",{})}render(){const{dishes:e,techcards:s,onChangeDish:a,deleteDish:r,getItemStyle:h,getListStyle:p,onDragEnd:u,intl:{formatMessage:i}}=this.props;return l("div",{children:[e.length!==0&&l("div",{children:[l(E,{style:{width:"100%"},gutter:16,children:[t(c,{md:12,sm:24,children:t("strong",{style:{marginLeft:"20px"},children:i({id:"DishList.Dish"})})}),t(c,{md:4,sm:24,children:t("strong",{style:{marginLeft:"20px"},children:i({id:"DishList.Cf"})})}),t(c,{md:4,sm:24,children:t("strong",{style:{marginLeft:"20px"},children:i({id:"DishList.Count"})})}),t(c,{md:4,sm:24,children:t("strong",{style:{marginLeft:"20px"},children:i({id:"DishList.Action"})})})]}),t(ie,{onDragEnd:u,children:t(E,{gutter:16,children:t(c,{md:24,sm:24,children:t(ae,{droppableId:"droppable",children:(n,j)=>l("div",{...n.droppableProps,ref:n.innerRef,style:p(j.isDraggingOver),children:[e.map((y,D)=>t(re,{draggableId:y.key,index:D,children:(C,z)=>t("div",{ref:C.innerRef,...C.draggableProps,...C.dragHandleProps,style:h(z.isDragging,C.draggableProps.style),children:l(E,{style:{width:"100%"},gutter:16,children:[t(c,{md:12,sm:24,children:t(N,{showSearch:!0,value:e[D].techcard||void 0,defaultActiveFirstOption:!1,showArrow:!1,placeholder:i({id:"DishList.SelectTechcard..."}),filterOption:(m,O)=>O.props.children.toLowerCase().indexOf(m.toLowerCase())>=0,style:{width:"100%"},onChange:m=>a(m,"techcard",D),children:s.map(m=>t(oe,{value:m.id,children:m.title},m.id))})}),t(c,{md:4,sm:24,children:t(T,{placeholder:i({id:"DishList.Coeff"}),value:y.amount,style:{width:"100%"},onChange:m=>a(m,"amount",D)})}),t(c,{md:4,sm:24,children:t(T,{placeholder:i({id:"DishList.Count"}),value:y.count,style:{width:"100%"},onChange:m=>a(m,"count",D)})}),t(c,{md:4,sm:24,children:t(F,{type:"primary",danger:!0,onClick:()=>r(D),children:i({id:"window.remove"})})})]})})},y.key)),n.placeholder]})})})})})]}),e.length===0&&t($,{description:!1})]})}})||R;var A;const ce=(o,d,e)=>{const s=Array.from(o),[a]=s.splice(d,1);return s.splice(e,0,a),s},k=8,le=(o,d)=>({userSelect:"none",padding:k,margin:`0 0 ${k}px 0`,borderRadius:"5px",background:o?"lightgreen":"",...d});f.updateLocale("en",{week:{dow:1}});const he=()=>({padding:k,borderRadius:"5px"});let me=x(A=class extends I.Component{constructor(e){super(e);g(this,"state",{description:"",isEdit:!1,timestamp:f().unix(),dishes:[{techcard:null,amount:1,count:1,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}]});g(this,"formRef",B.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.deleteDish=this.deleteDish.bind(this),this.addDish=this.addDish.bind(this),this.onChangeDish=this.onChangeDish.bind(this),this.onDragEnd=this.onDragEnd.bind(this)}componentDidMount(){ne().then(async e=>{if(e.status===200){const s=await e.json();this.setState({techcards:s})}})}onDragEnd(e){if(!e.destination)return;const{dishes:s}=this.state,a=ce(s,e.source.index,e.destination.index);this.setState({dishes:a})}onChangeField(e,s){e.target?e.target.type==="checkbox"?this.setState({[s]:e.target.checked}):this.setState({[s]:e.target.value}):this.setState({[s]:e})}onChangeDate(e){e!==null&&this.setState({timestamp:e.utc().unix()})}onChangeDish(e,s,a){const{dishes:r}=this.state;let h=e;e.target&&(e.target.type==="checkbox"?h=e.target.checked:h=e.target.value),r[a][s]=h,this.setState({dishes:r})}async onFinish(){try{const{forEdit:e,update:s,intl:{formatMessage:a}}=this.props;await this.formRef.current.validateFields();const{description:r,timestamp:h,dishes:p}=this.state,u={description:r,timestamp:h,dishes:p};if(e.id){const i=await Z(e.id,u);i.ok?(this.closeDrawer(),b.success({message:a({id:"CreateEventForm.Saved"}),description:a({id:"CreateEventForm.EventSuccessfullySaved!"})}),s()):b.error({message:a({id:"window.error"}),description:i.statusText,placement:"topLeft"})}else{const i=await G(u);i.ok?(this.closeDrawer(),b.success({message:a({id:"CreateEventForm.Created"}),description:a({id:"CreateEventForm.EventSuccessfullyCreated!"})}),s()):b.error({message:a({id:"window.error"}),description:i.statusText,placement:"topLeft"})}}catch(e){console.log("Failed:",e)}}setEdit(){const{forEdit:e}=this.props;e&&this.setState({description:e.kitchenDescription,timestamp:e.timestamp,dishes:e.eventMenu.data.map(s=>({techcard:s.techcard,amount:s.amount,count:s.count,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)})),isEdit:!0})}componentDidUpdate(e){var a;const{forEdit:s}=this.props;s&&e.forEdit!==s&&((a=this.formRef.current)==null||a.setFieldsValue({description:s.kitchenDescription,date:s.timestamp?f.unix(s.timestamp):f()}))}addDish(){const{dishes:e}=this.state;e.push({techcard:"",amount:1,count:1,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}),this.setState({dishes:e})}deleteDish(e){const{dishes:s}=this.state;s.splice(e,1),this.setState({dishes:s})}closeDrawer(){const{onClose:e}=this.props;e(),this.setState({description:"",timestamp:f.utc(),dishes:[{techcard:"",amount:1,count:1,key:Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}],isEdit:!1}),this.formRef.current.resetFields()}render(){const{visible:e,forEdit:s,intl:{formatMessage:a}}=this.props,{isEdit:r,techcards:h,dishes:p,timestamp:u}=this.state;return s.id&&!r&&this.setEdit(),t(ee,{title:a(r?{id:"CreateEventForm.EDITEVENT"}:{id:"CreateEventForm.CREATENEWEVENT"}),width:"50%",height:"100%",onClose:this.closeDrawer,open:e,bodyStyle:{paddingBottom:80},children:l(S,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[l(E,{gutter:16,children:[t(c,{md:14,sm:24,children:t(S.Item,{label:"Description",name:"description",rules:[{required:!0}],children:t(_,{onChange:i=>this.onChangeField(i,"description")})})}),t(c,{md:6,sm:24,children:t(S.Item,{label:"Date",name:"date",children:t(se,{format:"DD.MM.YYYY",placeholder:"Date",value:f.unix(u),onChange:i=>this.onChangeDate(i)})})}),t(c,{md:4,sm:24,children:t(S.Item,{children:t(F,{size:"large",htmlType:"submit",children:a({id:"window.save"})})})})]}),t(E,{gutter:16,children:l(c,{md:24,sm:24,children:[l(te,{orientation:"left",children:[a({id:"CreateEventForm.Positions"})," ",t(F,{type:"primary",size:"small",onClick:this.addDish,children:a({id:"CreateEventForm.Add"})})]}),t(de,{techcards:h,addDish:this.addDish,deleteDish:this.deleteDish,onChangeDish:this.onChangeDish,onDragEnd:this.onDragEnd,getItemStyle:le,getListStyle:he,dishes:p})]})})]})})}})||A;var Y,v;let Re=(Y=H(({user:o})=>({user:o})),x(v=q(v=Y(v=class extends I.Component{constructor(e){super(e);g(this,"state",{data:[],loading:!0,createTemplateFormVisible:!1,forEdit:{}});g(this,"createEventForm",()=>{this.setState({createTemplateFormVisible:!0})});g(this,"editEventForm",e=>{this.setState({forEdit:e,createTemplateFormVisible:!0})});g(this,"closeEditForm",()=>{this.setState({createTemplateFormVisible:!1,forEdit:{}})});this.update=this.update.bind(this)}UNSAFE_componentWillMount(){M().then(async e=>{if(e.ok){const s=await e.json();this.setState({data:s,loading:!1})}})}update(){this.setState({loading:!0}),M().then(async e=>{if(e.ok){const s=await e.json();this.setState({data:s,loading:!1})}}).finally(()=>{this.setState({loading:!1})})}render(){const{data:e,createTemplateFormVisible:s,forEdit:a}=this.state,{intl:{formatMessage:r}}=this.props,h=(i,n)=>l(w,{style:{padding:"0px"},children:[t(w.Item,{children:t(K,{to:`/orders/${i}`,children:r({id:"Events.View"})})},"view"),t(w.Item,{onClick:async()=>{await J(i),this.update()},children:r({id:"Events.Delete"})},"view"),!n&&t(w.Item,{onClick:async()=>{await Q(i),this.update()},children:t(L,{roles:["root","salesDirector"],children:r({id:"Events.Approve"})})},"view")]}),p={accepted:"success",rejected:"danger",new:"primary",waitingPayment:"info",fromWeb:"info",incomplete:"warning"},u=[{title:r({id:"Events.CreatedDate"}),dataIndex:"id",key:"createdDate",render:i=>t("span",{children:`${f.unix(parseInt(i.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`}),sorter:(i,n)=>parseInt(i.id.substring(0,8),16)-parseInt(n.id.substring(0,8),16)},{title:r({id:"Events.Description"}),dataIndex:"kitchenDescription",key:"desc",render:i=>t("span",{children:i})},{title:r({id:"window.date"}),dataIndex:"timestamp",key:"startDate",render:i=>t("span",{children:f.unix(i).format("DD.MM.YYYY")}),sorter:(i,n)=>i.timestamp-n.timestamp},{title:r({id:"Events.Status"}),dataIndex:"eventMenu",key:"status",render:i=>t("span",{className:`font-size-12 badge badge-${i.isActive?p.accepted:p.new}`,children:i.isActive?r({id:"Events.Approved"}):r({id:"Events.New"})})},{title:r({id:"Events.Action"}),dataIndex:"id",key:"action",render:(i,n)=>t("span",{children:t(W.Button,{overlay:h(i,n.eventMenu.isActive),onClick:()=>this.editEventForm(n),children:r({id:"window.edit"})})})}];return l(L,{roles:["root","admin","production","salesDirector"],redirect:!0,to:"/main",children:[t(U,{title:"Events"}),l("div",{className:"card",children:[t("div",{className:"card-header",children:t("div",{className:"utils__title",children:t("strong",{children:r({id:"Events.Events"})})})}),l("div",{className:"card-body",children:[t(F,{type:"primary",onClick:this.createEventForm,style:{marginBottom:"15px"},children:r({id:"Events.NewEvent"})}),t(X,{tableLayout:"auto",scroll:{x:"100%"},columns:u,dataSource:e,pagination:{position:"bottom",total:e.length,showTotal:(i,n)=>`${n[0]}-${n[1]} of ${i} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:e.length<10},loading:this.state.loading,rowKey:()=>Math.random()})]})]}),t(me,{visible:s,onClose:this.closeEditForm,data:e,forEdit:a,update:this.update})]})}})||v)||v)||v);export{Re as default};
