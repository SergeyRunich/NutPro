import{a as L,j as t,bF as J,aa as g,c as l,a4 as He,r as n,a3 as v,a8 as Ae,bg as Pe,a5 as y,bo as Be,a6 as K,B as R,I as Fe,aW as _,bL as E}from"./index-c20b5e8e.js";import{T as Q}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{R as U}from"./index-f06d8a3b.js";import{R as We,C as Ke}from"./row-58ed805b.js";import{S}from"./index-297358d3.js";import{S as _e}from"./index-06104a82.js";import{D as X}from"./index-2f7554ca.js";import{g as G,a as Ee,b as Ge,c as Je,d as Qe,H as Ue}from"./rating-1af437bd.js";import{D as Xe}from"./index-1e692111.js";import{g as Ze}from"./kitchen-60ac824b.js";import"./styleChecker-a7b568e2.js";import"./padStart-17be0050.js";import"./index-8e340a60.js";function qe(s){const c=L(),r=()=>{s.onClose()},C=[{title:c.formatMessage({id:"Rating.Client"}),dataIndex:"name",key:"name",render:(o,m)=>t(J,{to:`/users/${m.id}`,children:` ${o}`})},{title:c.formatMessage({id:"Rating.Score"}),dataIndex:"score",key:"score",render:o=>t("span",{children:`${o}`})},{title:c.formatMessage({id:"Rating.Day"}),dataIndex:"day",key:"day",render:o=>t("span",{children:`${g.unix(o).format("DD.MM.YYYY")}`})},{title:c.formatMessage({id:"Rating.Kitchen"}),dataIndex:"kitchen",key:"kitchen",render:o=>t("span",{children:o})},{title:c.formatMessage({id:"window.date"}),dataIndex:"date",key:"date",render:o=>t("span",{children:`${g(o).format("DD.MM.YYYY HH:mm")}`})},{title:c.formatMessage({id:"Rating.Review"}),dataIndex:"review",key:"review",render:o=>t("span",{children:`${o}`})}];return t("div",{children:l(Xe,{title:"Rating details",width:"100%",onClose:r,open:s.visible,bodyStyle:{paddingBottom:80},children:[s.data.dish&&l("div",{children:[t("h1",{children:s.data.dish.title}),l("div",{style:{float:"right",marginBottom:"5px"},children:[t(U,{style:{color:"#2fa037"},defaultValue:Number(s.data.scores.average),allowHalf:!0,disabled:!0}),l("span",{style:{marginLeft:"10px",fontWeight:"bold",fontSize:"18px"},children:[s.data.scores.average," (",s.data.scores.count,")"]})]})]}),t(Q,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:C,dataSource:s.data,pagination:{defaultPageSize:100,position:"bottom",total:s.data.length,showTotal:(o,m)=>`${m[0]}-${m[1]} of ${o} items`,showSizeChanger:!0,pageSizeOptions:["100","200","300","400","500","1000"],hideOnSinglePage:s.data.length<=100},rowKey:()=>Math.random()}),s.data.length<=100&&l("strong",{style:{float:"right",marginTop:"20px"},children:[c.formatMessage({id:"STF.Total items:"})," ",s.data.length]})]})})}function et(s){const c=L();return t(He,{open:s.visible,title:c.formatMessage({id:"Rating.Ignored list"}),okText:c.formatMessage({id:"Rating.OK"}),cancelText:c.formatMessage({id:"Rating.Close"}),onCancel:s.onCancel,onOk:s.onCancel,children:s.list.map(r=>t("p",{children:t("a",{href:`/#/users/${r.id}`,target:"_blank",rel:"noopener noreferrer",children:r.name})},Math.random()))})}g.updateLocale("en",{week:{dow:1}});const{Option:d}=y,{RangePicker:tt}=X;function vt(){const[s,c]=n.useState(2),[r,C]=n.useState([g().startOf("month").format("DD-MM-YYYY"),g().endOf("month").format("DD-MM-YYYY")]),[o,m]=n.useState([]),[Z,q]=n.useState([]),[h,w]=n.useState({}),[ee,V]=n.useState(!1),[j,x]=n.useState(!0),[I,te]=n.useState(0),[T,ae]=n.useState(""),[z,ie]=n.useState(""),[b,ne]=n.useState(!0),[Y,se]=n.useState(!1),[le,oe]=n.useState(!1),[re,de]=n.useState([]),[ce,he]=n.useState([]),[D,ge]=n.useState([]),[ue,$]=n.useState(""),[me,fe]=n.useState(""),[O,H]=n.useState(""),[f,ye]=n.useState([1,5]),[pe,ve]=n.useState([]),[M,Re]=n.useState([]),[k,Ce]=n.useState(!1),{formatMessage:i}=L();n.useEffect(()=>{Ze().then(async e=>{const a=await e.json();he(a)}),G("rating",r[0],r[1]).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),w(a.stats),x(!1)}else v.error({message:i({id:"window.error"}),description:e.statusText})}),Ee().then(async e=>{if(e.status===200){const a=await e.json();de(a.result)}else v.error({message:i({id:"window.error"}),description:e.statusText})}),Ge().then(async e=>{if(e.status===200){const a=await e.json();ve(a)}else v.error({message:i({id:"window.error"}),description:e.statusText})})},[r]);const xe=e=>{Ce(e)},Se=()=>{ye(f)},we=()=>{x(!0),Number(s)===1?Je("rating",r[0],I,T,z,b,D,Y,f[0],f[1],M,k).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),w(a.stats),x(!1)}else v.error({message:i({id:"window.error"}),description:e.statusText})}):Number(s)===2?G("rating",r[0],r[1],I,T,z,b,D,Y,f[0],f[1],M,k).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),w(a.stats),x(!1)}else v.error({message:i({id:"window.error"}),description:e.statusText})}):Qe("rating",I,T,z,b,D,Y,f[0],f[1],M,k).then(async e=>{if(e.status===200){const a=await e.json();m(a.dishes),w(a.stats),x(!1)}else v.error({message:i({id:"window.error"}),description:e.statusText})})},N=n.useRef(null);n.useEffect(()=>{N.current&&N.current.focus()},[]);const be=e=>({filterDropdown:({setSelectedKeys:a,selectedKeys:u,confirm:p,clearFilters:Oe})=>l("div",{style:{padding:8},children:[t(Fe,{ref:N,placeholder:`Search ${e}`,value:u[0],onChange:W=>a(W.target.value?[W.target.value]:[]),onPressEnter:()=>A(u,p,e),style:{width:188,marginBottom:8,display:"block"}}),t(R,{type:"primary",onClick:()=>A(u,p,e),icon:t(_,{}),size:"small",style:{width:90,marginRight:8},children:"Search"}),t(R,{onClick:()=>P(Oe),size:"small",style:{width:90},children:"Reset"})]}),filterIcon:a=>t(_,{style:{color:a?"#1890ff":""}}),onFilter:(a,u)=>u[e].title.toString().toLowerCase().includes(a.toLowerCase()),filteredValue:O||"",onFilterDropdownVisibleChange:a=>{a&&setTimeout(()=>N.select())},render:(a,u)=>me===e?t(E,{to:"#",onClick:p=>{B(u),p.preventDefault()},children:t(Ue,{highlightStyle:{backgroundColor:"#ffc069",padding:0,fontWeight:"bold",fontSize:"16px"},unhighlightStyle:{fontWeight:"bold",fontSize:"16px"},searchWords:[ue],autoEscape:!0,textToHighlight:a.title.toString()})}):t(E,{to:"#",onClick:p=>{B(u),p.preventDefault()},children:t("span",{style:{fontWeight:"bold",fontSize:"16px"},children:a.title||a})})}),A=(e,a,u)=>{a(),$(e[0]),fe(u)},P=(e,a)=>{a===void 0&&e(),$(""),H("")},Ye=(e,a)=>{H(a.dish)},B=e=>{q(e.users),V(!0)},De=()=>{V(!1)},F=e=>{oe(e)},Me=async e=>{let a=[null,null];e[0]!==void 0&&(a=[e[0].format("DD-MM-YYYY"),e[1]!==void 0?e[1].format("DD-MM-YYYY"):null]),C(a)},ke=async e=>{let a=[null,null];e!=null&&(a=[e.format("DD-MM-YYYY"),e.format("DD-MM-YYYY")]),C(a)},Ne=async e=>{c(e.key)},Ie=async e=>{te(e.key)},Te=async e=>{ae(e.key)},ze=async e=>{ie(e.key)},Le=async e=>{ne(e.target.checked)},Ve=async e=>{se(e.target.checked)},je=async e=>{const a=e[1]?e[1].format("DD-MM-YYYY"):"";C([e[0].format("DD-MM-YYYY"),a])},$e=[{title:i({id:"Rating.Dish"}),dataIndex:"dish",key:"dish",...be("dish")},{title:i({id:"Rating.Rating"}),dataIndex:"scores",key:"score",render:e=>l("span",{children:[t(U,{defaultValue:Number(e.average),style:{color:"#2fa037"},allowHalf:!0,disabled:!0})," ",t("span",{style:{fontWeight:"bold",fontSize:"16px",marginLeft:"6px"},children:`${e.average}${e.isReview?"*":""}`})]}),sorter:(e,a)=>Number(e.scores.average)-Number(a.scores.average)},{title:i({id:"Rating.Scores"}),dataIndex:"scores",key:"scores",render:e=>t("span",{style:{fontWeight:"bold",fontSize:"16px"},children:`${e.count}`}),sorter:(e,a)=>Number(e.scores.count)-Number(a.scores.count)}];return l(Ae,{roles:["admin","root","production","finance","salesDirector","readonlySearch"],denied:["Alexandra","Kseniia"],redirect:!0,to:"/main",children:[t(Pe,{title:"Ratings of dishes"}),t("div",{className:"row",children:t("div",{className:"col-xl-12",children:t("div",{className:"card card--fullHeight",children:l("div",{className:"card-body",children:[l("div",{className:"col-xl-12",children:[l(y,{labelInValue:!0,value:{key:s},style:{marginBottom:"15px",marginRight:"10px",minWidth:"100px"},onChange:Ne,children:[t(d,{value:0,children:i({id:"Rating.All time"})}),t(d,{value:1,children:i({id:"Rating.Day"})}),t(d,{value:2,children:i({id:"Rating.Range"})})]}),Number(s)===1&&t("span",{children:t(X,{format:"DD.MM.YYYY",style:{marginRight:"10px"},onChange:ke,value:r[0]!==null?g(r[0],"DD-MM-YYYY"):null,onCalendarChange:je})}),Number(s)===2&&t("span",{children:t(tt,{ranges:{"Previous Month":[g().subtract(1,"month").startOf("month"),g().subtract(1,"month").endOf("month")],"This Month":[g().startOf("month"),g().endOf("month")]},format:"DD.MM.YYYY",style:{marginRight:"10px"},onChange:Me,value:[r[0]!==null?g(r[0],"DD-MM-YYYY"):null,r[0]!==null?g(r[1],"DD-MM-YYYY"):null]})}),t(y,{mode:"multiple",placeholder:"Select kitchens",value:D,style:{width:120,marginRight:"10px"},onChange:e=>ge(e),children:ce.map(e=>t(d,{value:e.id,children:e.name},e.id))}),l(y,{labelInValue:!0,defaultValue:{key:0},style:{marginBottom:"15px",marginRight:"10px",width:100},onChange:Ie,children:[t(d,{value:0,children:i({id:"Rating.Min votes"})}),[...Array(30).keys()].map(e=>e+1).map(e=>t(d,{children:e},e))]}),l(y,{labelInValue:!0,defaultValue:{key:""},style:{marginBottom:"15px",marginRight:"10px",width:100},onChange:Te,children:[t(d,{value:"",children:i({id:"Rating.Diet"})}),t(d,{value:"loose",children:i({id:"Rating.loose"})}),t(d,{value:"keep",children:i({id:"Rating.keep"})}),t(d,{value:"gain",children:i({id:"Rating.gain"})}),t(d,{value:"custom",children:i({id:"Rating.custom"})})]}),l(y,{labelInValue:!0,defaultValue:{key:""},style:{marginBottom:"15px",marginRight:"10px",width:100},onChange:ze,children:[t(d,{value:"",children:'"Nation"'}),t(d,{value:"Czech",children:i({id:"Rating.Czech"})}),t(d,{value:"not_Czech",children:i({id:"Rating.not Czech"})})]}),l("div",{children:[t(y,{mode:"multiple",placeholder:"Select tags",value:M,style:{minWidth:150,marginRight:"10px"},onChange:e=>Re(e),children:pe.map(e=>t(d,{value:e.id,children:e.cz},e.id))}),l("span",{children:[i({id:"Rating.ignoreTags"}),t(Be,{style:{marginLeft:"10px"},checked:k,onChange:xe})]})]})]}),t("div",{className:"col-xl-12",children:l("div",{style:{display:"flex",alignItems:"center"},className:"row",children:[l("div",{className:"col-xl-5 col-md-5  col-sm-12",children:[t(K,{checked:b,onChange:Le})," ",i({id:"Rating.Hide ignored customers "}),t(K,{checked:Y,onChange:Ve})," ",i({id:"Rating.Only with review Score range"})]}),l("div",{className:"col-xl-4 col-md-4  col-sm-12",children:[t("span",{children:i({id:"Rating.Min & Max Score"})}),t(_e,{range:!0,max:5,min:1,step:1,formatter:e=>`${e}⭐️`,defaultValue:f,style:{width:"200px"},onChange:Se})]}),l("div",{className:"col-xl-3 col-md-3  col-sm-12",children:[t(R,{onClick:()=>F(!0),type:"default",size:"default",style:{float:"right"},children:i({id:"Rating.View ignored list"})}),t(R,{type:"default",size:"default",style:{float:"right",marginRight:"10px"},children:t(J,{to:"/feedback",target:"_blank",children:i({id:"Rating.Feedbacks"})})})]})]})}),t("div",{style:{float:"right"},children:t(R,{onClick:we,type:"primary",size:"default",disabled:!r[0]&&s>0,style:{marginRight:"10px"},loading:j,children:i({id:"Rating.View"})})})]})})})}),t("div",{className:"row",children:t("div",{className:"col-lg-12",children:t("div",{className:"card card--fullHeight",children:t("div",{className:"card-body",children:l("div",{style:{width:"100%",display:"flex",justifyContent:"space-around",alignItems:"center"},children:[t("div",{children:t(S,{style:{textAlign:"center"},title:i({id:"Rating.Number of ratings"}),value:h.rateCount})}),t("div",{children:t(S,{style:{textAlign:"center"},title:i({id:"Rating.Average rating"}),value:h.rateCount!==0?(h.rateSum/h.rateCount).toFixed(2):0})}),t("div",{children:t(S,{style:{textAlign:"center"},title:i({id:"Rating.Number of dishes"}),value:h.dishCount})}),t("div",{children:t(S,{style:{textAlign:"center"},title:i({id:"Rating.Average number of ratings per dish"}),value:h.dishCount!==0?((h==null?void 0:h.rateCount)/h.dishCount).toFixed(2):0})}),t("div",{children:t(S,{style:{textAlign:"center"},title:i({id:"Rating.Average rating per dish"}),value:h.dishCount!==0?(h.dishRates/h.dishCount).toFixed(2):0})})]})})})})}),t("div",{className:"row",children:t("div",{className:"col-lg-12",children:t("div",{className:"card card--fullHeight",children:l("div",{className:"card-body",children:[t(We,{style:{marginTop:"15px"},children:t(Ke,{sm:24,lg:4,children:O&&t(R,{onClick:()=>P(!1,!0),type:"primary",size:"default",style:{marginRight:"10px",marginBottom:"5px"},children:i({id:"Rating.Reset search"})})})}),t(Q,{tableLayout:"auto",scroll:{x:"100%"},columns:$e,dataSource:o,loading:j,pagination:{defaultPageSize:100,position:"bottom",total:o.length,showTotal:(e,a)=>`${a[0]}-${a[1]} of ${e} items`,showSizeChanger:!0,pageSizeOptions:["100","200","300","400","500","1000"],hideOnSinglePage:o.length<=100},onChange:Ye,rowKey:()=>Math.random()}),o.length<=100&&l("strong",{style:{float:"right",marginTop:"20px"},children:[i({id:"STF.Total items:"})," ",o.length]})]})})})}),t(qe,{visible:ee,onClose:De,data:Z}),t(et,{visible:le,onCancel:()=>F(!1),list:re})]})}export{vt as default};
