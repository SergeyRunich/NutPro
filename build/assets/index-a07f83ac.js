import{a1 as Y,a2 as T,aa as y,j as e,B as V,r as l,a as j,a8 as O,c as n,a5 as D,a3 as x}from"./index-c20b5e8e.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{R as w,C as c}from"./row-58ed805b.js";import{I as R}from"./index-86d1917a.js";import{D as z}from"./index-2f7554ca.js";import{T as N}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{g as F}from"./kitchen-60ac824b.js";import{a as b,p as U,g as G}from"./productionBuffer-89e10f0c.js";import"./index-8e340a60.js";import"./styleChecker-a7b568e2.js";var v;let J=Y(v=class extends T.Component{render(){const{loading:u,data:d,loadHistory:m,intl:{formatMessage:r}}=this.props,f=[{title:r({id:"window.date"}),dataIndex:"timestamp",key:"code",render:i=>y.unix(i).format("DD.MM.YYYY")},{title:r({id:"ProductBufferList.Kitchen"}),dataIndex:"kitchen",key:"kitchen",render:i=>i.name},{title:r({id:"ProductBufferList.Initial"}),dataIndex:"initialValue",key:"initialValue",render:i=>i},{title:r({id:"ProductBufferList.Buffer"}),dataIndex:"buffer",key:"buffer",render:i=>i},{title:r({id:"ProductBufferList.Goal"}),dataIndex:"maxValue",key:"maxValue",render:i=>i},{title:"---",dataIndex:"id",key:"id",render:(i,g,p)=>e(V,{onClick:()=>m(p),children:r({id:"ProductBufferList.History"})})}];return e(N,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:f,dataSource:d,pagination:{position:"bottom",total:d.length,showTotal:(i,g)=>`${g[0]}-${g[1]} of ${i} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:d.length<10},loading:u,rowKey:()=>Math.random()})}})||v;var C;let Q=Y(C=class extends T.Component{render(){const{data:u,intl:{formatMessage:d}}=this.props,m=[{title:d({id:"window.date"}),dataIndex:"date",key:"date",render:r=>y(r).format("DD.MM.YYYY")},{title:d({id:"ProdBufferHistory.Action"}),dataIndex:"action",key:"action",render:r=>r},{title:d({id:"ProdBufferHistory.User"}),dataIndex:"user",key:"user",render:r=>r},{title:d({id:"ProdBufferHistory.MaxValue"}),dataIndex:"maxValue",key:"maxValue",render:r=>`Before: ${r.before===-1?"-":r.before} | After: ${r.after}`}];return e(N,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:m,dataSource:u,pagination:{position:"bottom",total:u.length,showTotal:(r,f)=>`${f[0]}-${f[1]} of ${r} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:u.length<10},rowKey:()=>Math.random()})}})||C;const{Option:X}=D;y.updateLocale("en",{week:{dow:1}});function fe(){const[h,u]=l.useState(""),[d,m]=l.useState([]),[r,f]=l.useState(y().add(1,"days")),[i,g]=l.useState(5),[p,k]=l.useState([]),[S,L]=l.useState(0),[s,B]=l.useState({status:!1,currentValue:0,maxValue:0,currentBuffer:0}),[P,I]=l.useState(!0),{formatMessage:a}=j(),M=async t=>{f(t),B({status:!1,currentValue:0,maxValue:0,currentBuffer:0})},H=async t=>{g(t)},W=async t=>{L(t)},$=async t=>{u(t.key),B({status:!1,currentValue:0,maxValue:0,currentBuffer:0})},_=async()=>{if(s.status){const t={date:r.format("DD-MM-YYYY"),kitchen:h,buffer:i};await U(t).then(async o=>{o.ok?(B({status:!1,currentValue:0,maxValue:0,currentBuffer:0}),b().then(async E=>{const K=await E.json();k(K.result||[]),I(!1)}),x.success({message:a({id:"BufferWidget.Created"}),description:o.statusText})):x.error({message:a({id:"window.error"}),description:o.statusText})})}else x.error({message:a({id:"BufferWidget.ItIsNotPossibleToCreateABufferForThisDay"}),description:a({id:"BufferWidget.TheBufferIsAlreadyCreatedOrYouDidntCheckIt"})})},A=async()=>{await G(r.format("DD-MM-YYYY"),h).then(async t=>{if(t.ok){const o=await t.json();B(o.result)}else x.error({message:a({id:"window.error"}),description:t.statusText})})};return l.useEffect(()=>{F().then(async t=>{const o=await t.json();m(o),u(o[0].id)}),b().then(async t=>{const o=await t.json();k(o.result||[]),I(!1)})},[]),e(O,{roles:["root","admin","salesDirector","sales"],children:n(w,{gutter:16,children:[e(c,{span:10,children:n("div",{className:"card card--fullHeight",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:a({id:"BufferWidget.BuffersList"})})})}),e("div",{className:"card-body",children:e(J,{data:p,loadHistory:W,loading:P})})]})}),e(c,{span:8,children:n("div",{className:"card card--fullHeight",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:a({id:"BufferWidget.History"})})})}),e("div",{className:"card-body",children:e(Q,{data:p.length>0?p[S].history:[]})})]})}),e(c,{span:6,children:n("div",{className:"card card--fullHeight",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title",children:e("strong",{children:a({id:"BufferWidget.NewBuffer"})})})}),n("div",{className:"card-body",children:[n(w,{gutter:16,children:[n(c,{md:24,xl:12,children:[e("h4",{children:a({id:"BufferWidget.Kitchen"})}),e("div",{style:{marginTop:"10px",marginBottom:"15px"},children:e(D,{labelInValue:!0,style:{width:"115px"},onChange:$,value:{key:h},placeholder:a({id:"BufferWidget.Select"}),children:d.map(t=>e(X,{value:t.id,children:t.name},t.id))})})]}),n(c,{md:24,xl:12,children:[e("h4",{children:a({id:"window.date"})}),e("div",{style:{marginTop:"10px",marginBottom:"5px"},children:e(z,{value:r,format:"DD.MM.YYYY",onChange:M,style:{width:"100%"},disabledDate:t=>t<y()||t.day()!==1&&t.day()!==3&&t.day()!==5})})]})]}),n(w,{gutter:16,children:[n(c,{md:24,xl:12,children:[e("h4",{children:a({id:"BufferWidget.Days"})}),e("div",{style:{marginTop:"10px",marginBottom:"5px"},children:e(R,{value:i,onChange:H,min:0,style:{width:"100%"}})})]}),n(c,{md:24,xl:12,children:[e("h4",{children:a({id:"BufferWidget.Info"})}),n("div",{style:{marginTop:"10px",marginBottom:"5px"},children:[s.currentValue===0&&"Check it!",s.currentValue!==0&&s.maxValue!==0&&`Orders: ${s.currentValue}/${s.maxValue} | Buffer: ${s.currentBuffer}`,s.currentValue!==0&&s.maxValue===0&&`Orders: ${s.currentValue} | Buffer: none`]})]})]}),!s.status&&e(V,{type:"default",onClick:A,style:{width:"100%"},children:a({id:"BufferWidget.CHECKDATE"})}),s.status&&e(V,{type:"primary",onClick:_,style:{width:"100%"},disabled:s.maxValue!==0,children:s.maxValue===0?a({id:"BufferWidget.CREATEBUFFER"}):a({id:"BufferWidget.UPDATEBUFFER"})})]})]})})]})})}export{fe as default};
