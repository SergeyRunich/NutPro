var N=Object.defineProperty;var R=(d,l,e)=>l in d?N(d,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[l]=e;var n=(d,l,e)=>(R(d,typeof l!="symbol"?l+"":l,e),e);import{a1 as x,a2 as v,r as _,a3 as f,j as r,a4 as M,c as g,I as D,a5 as T,bd as k,be as V,bf as O,B as I,aW as j,aX as $,a8 as A,bg as P,aZ as b}from"./index-c20b5e8e.js";import{T as z}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as q}from"./index-67f4e7c4.js";/* empty css              */import{g as w,d as B,c as U,e as L}from"./ingredientGroup-69636766.js";import{F as C}from"./index-a86cfb93.js";import{R as S,C as y}from"./row-58ed805b.js";import"./styleChecker-a7b568e2.js";var E;const{Option:W}=T;let H=x(E=class extends v.Component{constructor(e){super(e);n(this,"state",{name:"",mainGroup:"",isEdit:!1});n(this,"formRef",_.createRef());this.onFinish=this.onFinish.bind(this),this.closeDrawer=this.closeDrawer.bind(this)}onChangeField(e,t){e.target?e.target.type==="checkbox"?this.setState({[t]:e.target.checked}):this.setState({[t]:e.target.value}):this.setState({[t]:e})}async onFinish(){const{intl:{formatMessage:e}}=this.props;try{const{create:t,edit:i,forEdit:o,update:u}=this.props;await this.formRef.current.validateFields();const{name:c,mainGroup:a}=this.state,G={name:c,mainGroup:a};if(o.id){const h=await i(o.id,G);h.status===202?(this.closeDrawer(),f.success({message:e({id:"CreateGroupIng.Edited"}),description:e({id:"CreateGroupIng.GroupSuccessfullyEdited"})}),u()):f.error({message:e({id:"window.error"}),description:h.statusText,placement:"topLeft"})}else{const h=await t(G);h.status===201?(this.closeDrawer(),f.success({message:e({id:"CreateGroupIng.Created"}),description:e({id:"CreateGroupIng.GroupSuccessfullyCreated!"})}),u()):f.error({message:e({id:"window.error"}),description:h.statusText,placement:"topLeft"})}}catch(t){console.log("Failed:",t)}}setEdit(){const{forEdit:e}=this.props;e&&this.setState({name:e.name,mainGroup:e.mainGroup?e.mainGroup._id:void 0,isEdit:!0})}componentDidUpdate(e){var i;const{forEdit:t}=this.props;t&&e.forEdit!==t&&((i=this.formRef.current)==null||i.setFieldsValue({name:t.name,mainGroup:t.mainGroup?t.mainGroup._id:void 0}))}closeDrawer(){const{onClose:e}=this.props;this.setState({name:"",mainGroup:"",isEdit:!1}),this.formRef.current.resetFields(),e()}render(){const{visible:e,groups:t,forEdit:i,intl:{formatMessage:o}}=this.props,{mainGroup:u,isEdit:c}=this.state;return i.id&&!c&&this.setEdit(),r("div",{children:r(M,{title:c?"EDIT GROUP":o({id:"CreateGroupIng.CREATENEWGROUP"}),open:e,onOk:this.onFinish,okText:c?"Save":"Create",onCancel:this.closeDrawer,children:g(C,{ref:this.formRef,layout:"vertical",onFinish:this.onFinish,children:[r(S,{gutter:16,children:r(y,{md:24,sm:24,children:r(C.Item,{label:"Name",name:"name",rules:[{required:!0}],children:r(D,{onChange:a=>this.onChangeField(a,"name")})})})}),r(S,{gutter:16,children:r(y,{md:24,sm:24,children:r(C.Item,{name:"maingroup",label:o({id:"CreateGroupIng.MainGroup"}),children:r(T,{value:u,onChange:a=>this.onChangeField(a,"mainGroup"),children:t.map(a=>r(W,{value:a.id,children:a.name},a.id))})})})})]})})})}})||E;var F,m;let ie=(F=k(({user:d})=>({user:d})),x(m=V(m=F(m=class extends v.Component{constructor(e){super(e);n(this,"state",{tableData:[],data:[],filterDropdownVisible:!1,searchText:"",filtered:!1,loading:!0,createGroupFormVisible:!1,forEdit:{}});n(this,"onInputChange",e=>{this.setState({searchText:e.target.value})});n(this,"showDrawerCreateGroupForm",()=>{this.setState({createGroupFormVisible:!0})});n(this,"editGroupModal",e=>{this.setState({forEdit:e,createGroupFormVisible:!0})});n(this,"onCloseCreateGroupForm",()=>{this.setState({createGroupFormVisible:!1,forEdit:{}})});n(this,"onSearch",()=>{const{searchText:e,tableData:t}=this.state,i=new RegExp(e,"gi");this.setState({filterDropdownVisible:!1,filtered:!!e,data:t.map(o=>o.name.match(i)?{...o,name:o.name}:null).filter(o=>!!o)}),e===""&&this.setState({filtered:!1})});n(this,"refSearchInput",e=>{this.searchInput=e});this.updateGroups=this.updateGroups.bind(this)}UNSAFE_componentWillMount(){w().then(async e=>{if(e.status===401){const{dispatch:t}=this.props;t({type:"user/SET_STATE",payload:{authorized:!1}});return}if(e.status===200){const t=await e.json();this.setState({tableData:t,data:t,loading:!1})}})}updateGroups(){w().then(async e=>{if(e.status===401){const{dispatch:t}=this.props;t({type:"user/SET_STATE",payload:{authorized:!1}});return}if(e.status===200){const t=await e.json();this.setState({tableData:t,data:t,loading:!1,forEdit:{}})}})}async deleteGroupIngredient(e){const{intl:{formatMessage:t}}=this.props,i=await B(e);i.status===204?(O.success(t({id:"CreateGroupIng.GroupDeleted"})),this.updateGroups()):f.error({message:t({id:"window.error"}),description:i.statusText,placement:"topRight"})}render(){const{data:e,searchText:t,filterDropdownVisible:i,filtered:o,createGroupFormVisible:u,forEdit:c}=this.state,{intl:{formatMessage:a}}=this.props,G=s=>r(b,{style:{padding:"0px"},children:r(b.Item,{children:r(q,{title:"Are you sure delete this group?",onConfirm:()=>this.deleteGroupIngredient(s),okText:"Yes",cancelText:"No",children:a({id:"window.remove"})})},"rempve")}),h=[{title:a({id:"window.name"}),dataIndex:"name",key:"name",sorter:(s,p)=>s.name.length-p.name.length,render:(s,p)=>r("span",{children:` ${p.name}`}),filterDropdown:g("div",{className:"custom-filter-dropdown",style:{padding:"5px"},children:[r(D,{ref:this.refSearchInput,placeholder:a({id:"CreateGroupIng.SearchName"}),value:t,onChange:this.onInputChange,onPressEnter:this.onSearch}),r(I,{type:"primary",onClick:this.onSearch,style:{marginTop:"5px"},children:a({id:"CreateGroupIng.Search"})})]}),filterIcon:r(j,{style:{color:o?"#108ee9":"#aaa"}}),filterDropdownVisible:i,onFilterDropdownVisibleChange:s=>{this.setState({filterDropdownVisible:s},()=>this.searchInput&&this.searchInput.focus())}},{title:a({id:"CreateGroupIng.MainGroup"}),dataIndex:"mainGroup",key:"mainGroup",render:s=>r("span",{children:`${s?s.name:"-"}`})},{title:a({id:"CreateGroupIng.NumberOfIngredients"}),dataIndex:"numberIngredients",key:"numberIngredients",render:s=>r("span",{children:`${s||"-"}`})},{title:a({id:"CreateGroupIng.NumberOfSubGroups"}),dataIndex:"numberSubGroups",key:"numberSubGroups",render:s=>r("span",{children:`${s||"-"}`})},{title:a({id:"CreateGroupIng.Action"}),dataIndex:"id",key:"action",render:(s,p)=>r("span",{children:r($.Button,{onClick:()=>this.editGroupModal({id:s,name:p.name,mainGroup:p.mainGroup}),overlay:G(s),children:a({id:"window.edit"})})})}];return g(A,{roles:["root","admin"],redirect:!0,to:"/main",children:[r(P,{title:"Groups ingredients"}),g("div",{className:"card",children:[r("div",{className:"card-header",children:r("div",{className:"utils__title",children:r("strong",{children:a({id:"CreateGroupIng.GroupIngredients"})})})}),g("div",{className:"card-body",children:[r(I,{style:{marginBottom:"20px"},type:"primary",onClick:this.showDrawerCreateGroupForm,children:a({id:"CreateGroupIng.NewGroup"})}),r(z,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:h,dataSource:e,pagination:{position:"bottom",total:e.length,showTotal:(s,p)=>`${p[0]}-${p[1]} of ${s} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:e.length<10},loading:this.state.loading,rowKey:()=>Math.random()})]})]}),r(H,{visible:u,onClose:this.onCloseCreateGroupForm,groups:e,forEdit:c,create:U,edit:L,update:this.updateGroups})]})}})||m)||m)||m);export{ie as default};
