import{r as n,u as Z,a as R,j as e,a4 as Q,c as u,I as z,B as M,a3 as U,aa as m,bF as he,aW as Pe,aX as ge,a8 as ye,bg as fe,aZ as G}from"./index-c20b5e8e.js";import{T as E}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{F as v}from"./index-a86cfb93.js";import{R as T,C as x}from"./row-58ed805b.js";import{I as ke}from"./index-86d1917a.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as we}from"./index-2f7554ca.js";import{g as H,c as Ce,u as J,a as X}from"./pickupPoint-b7474fa9.js";import"./styleChecker-a7b568e2.js";import"./index-8e340a60.js";const De=({forEdit:i,create:d,visible:w,update:P,onClose:o,change:c})=>{const[Y,C]=n.useState(""),[L,g]=n.useState(""),[j,p]=n.useState(0),[O,D]=n.useState(!0),[I,b]=n.useState(!1),{currentBranch:A}=Z(l=>l.settings),{formatMessage:r}=R(),[y]=v.useForm(),F=n.useCallback(()=>{i.id&&(b(!0),C(i.name),g(i.address),D(i.isActive),p(i.orderCapacity))},[i.id,i.name,i.address,i.isActive,i.orderCapacity]);n.useEffect(()=>{i.id&&!I&&(F(),y.setFieldsValue({name:i.name,address:i.address,orderCapacity:i.orderCapacity}))},[i.id,I,F]);const V=async()=>{try{await y.validateFields();const l={name:Y,address:L,isActive:O,orderCapacity:j,branchId:A};if(i.id){const f=await c(i.id,l);f.status===200?(S(),C(""),g(""),p(0),D(!0),b(!1),U.success({message:r({id:"PickUpPoint.Changed"}),description:r({id:"PickUpPoint.Pick-up point successfully changed!"})}),P()):U.error({message:r({id:"window.error"}),description:f.statusText,placement:"topLeft"})}else{const f=await d(l);f.status===201?(S(),C(""),g(""),p(0),D(!0),b(!1),U.success({message:r({id:"PickUpPoint.Created"}),description:r({id:"PickUpPoint.Pick-up point successfully created!"})}),P()):U.error({message:r({id:"window.error"}),description:f.statusText,placement:"topLeft"})}}catch(l){console.log("Failed:",l)}},S=()=>{C(""),g(""),p(0),D(!0),b(!1),y.resetFields(),o()};return e(Q,{title:r(I?{id:"PickUpPoint.Edit Pick-up point"}:{id:"PickUpPoint.Create a new Pick-up point"}),onCancel:S,open:w,bodyStyle:{paddingBottom:80},okButtonProps:{hidden:!0},cancelButtonProps:{hidden:!0},footer:"",children:u(v,{form:y,layout:"vertical",onFinish:V,children:[e(T,{gutter:16,children:e(x,{md:24,sm:24,children:e(v.Item,{label:r({id:"window.name"}),name:"name",rules:[{required:!0}],children:e(z,{placeholder:r({id:"window.name"}),onChange:l=>C(l.target.value)})})})}),u(T,{gutter:16,children:[e(x,{md:24,sm:24,children:e(v.Item,{label:r({id:"window.address"}),name:"address",rules:[{required:!0}],children:e(z,{placeholder:r({id:"window.address"}),onChange:l=>g(l.target.value)})})}),e(x,{md:24,sm:24,children:e(v.Item,{label:r({id:"PickUpPoint.orderCapacity"}),name:"orderCapacity",rules:[{required:!0}],children:e(ke,{min:0,setFieldsValue:j,onChange:l=>p(l)})})})]}),e(v.Item,{children:u("div",{className:"form-actions",children:[e(M,{style:{width:150},type:"primary",htmlType:"submit",className:"mr-3",children:r(I?{id:"window.edit"}:{id:"window.create"})}),e(M,{onClick:S,children:r({id:"window.cancel"})})]})})]})})};function be(i){const d=R(),w=m().endOf("day").add(-1,"days"),P=[{title:d.formatMessage({id:"window.name"}),dataIndex:"user",key:"user",render:(o,c)=>e("span",{children:c.user.name})},{title:d.formatMessage({id:"PickUpPoint.StartDate"}),dataIndex:"timestamp",key:"timestamp",render:(o,c)=>e("span",{children:m.unix(c.timestamp).format("YYYY-MM-DD")})},{title:d.formatMessage({id:"PickUpPoint.Length"}),dataIndex:"orderDays",key:"orderDays",render:(o,c)=>e("span",{children:c.orderDays.length})},{title:d.formatMessage({id:"PickUpPoint.Action"}),dataIndex:"id",key:"id",render:(o,c)=>e(M,{children:e(he,{target:"_blank",to:`/orders/${c.id}`,children:d.formatMessage({id:"PickUpPoint.Open"})})})}];return e("div",{children:u(Q,{title:d.formatMessage({id:"PickUpPoint.Pick-up point macro"}),onCancel:()=>{i.onClose()},open:i.visible,bodyStyle:{paddingBottom:80},okButtonProps:{hidden:!0},cancelButtonProps:{hidden:!0},footer:"",children:[u(T,{style:{display:"flex",justifyContent:"center"},gutter:24,children:[e(x,{style:{display:"flex",alignItems:"center",justifyContent:"center"},span:8,children:e(we,{disabledDate:o=>o&&o<w,style:{width:"100%"},value:m(i.start),format:"YYYY-MM-DD",onChange:o=>{i.handleChangeDate(o)}})}),e(x,{style:{display:"flex",alignItems:"center",justifyContent:"center"},span:4,children:e(M,{loading:i.loading,type:"primary",onClick:()=>{i.showPickupPointNewDate()},children:d.formatMessage({id:"window.show"})})}),e(x,{style:{display:"flex",alignItems:"center",justifyContent:"center"},span:12,children:u("strong",{children:[d.formatMessage({id:"PickUpPoint.Available"}),e("span",{style:{marginLeft:"10px",marginRight:"10px"},children:i.currentPpCapacity-i.orders.length}),d.formatMessage({id:"PickUpPoint.from"}),e("span",{style:{marginLeft:"10px",marginRight:"10px"},children:i.currentPpCapacity})]})})]}),e("hr",{}),e(T,{style:{display:"flex",justifyContent:"center"},gutter:24,children:e(x,{span:24,children:e(E,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:P,dataSource:i.orders,pagination:{position:"bottom",total:i.orders.length,showTotal:(o,c)=>`${c[0]}-${c[1]} of ${o} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:i.orders.length<10},loading:i.loading,rowKey:()=>Math.random()})})})]})})}function Te(){const[i,d]=n.useState([]),[w,P]=n.useState([]),[o,c]=n.useState(!1),[Y,C]=n.useState(""),[L,g]=n.useState(!1),[j,p]=n.useState(!0),[O,D]=n.useState(!1),[I,b]=n.useState({}),[A,r]=n.useState(m().format("YYYY-MM-DD")),[y,F]=n.useState(m().format("YYYY-MM-DD")),[V,S]=n.useState(!1),[l,f]=n.useState([]),[ee,te]=n.useState(0),[ae,ie]=n.useState(""),[ne,B]=n.useState(!0),{currentBranch:N}=Z(t=>t.settings),{formatMessage:s}=R();n.useEffect(()=>{N&&H({branchId:N}).then(async t=>{const a=await t.json();d(a.result),P(a.result),p(!1)})},[N]);const se=t=>{C(t.target.value)},$=()=>{const t=new RegExp(Y,"gi");c(!1),g(!!Y),P(i.map(a=>{const h=a.name.match(t);return h?{...a,name:e("span",{children:a.name.split(t).map((k,me)=>me>0?[e("span",{className:"highlight",children:h[0]},k),k]:k)})}:null}).filter(a=>!!a)),Y===""&&g(!1)},_=(t,a)=>{b({name:t.name,address:t.address,isActive:t.isActive,orderCapacity:t.orderCapacity,id:a}),D(!0)},re=async(t,a)=>{S(!0),te(a.orderCapacity),ie(a.id),B(!0);const h=await X(t,A,y),k=await h.json();h.status===200&&(f(k.result[0].orders),B(!1))},oe=t=>{r(m(t).format("YYYY-MM-DD")),F(m(t).format("YYYY-MM-DD"))},ce=async()=>{B(!0);const t=await X(ae,A,y),a=await t.json();t.status===200&&(f(a.result[0].orders),B(!1))},de=()=>{S(!1),r(m().format("YYYY-MM-DD")),F(m().format("YYYY-MM-DD"))},le=()=>{b({}),D(!1)},q=n.useRef(null),K=()=>{p(!0),H({branchId:N}).then(async t=>{const a=await t.json();d(a.result),P(a.result),p(!1)}).finally(()=>{p(!1)})},ue=async(t,a)=>{const h={isActive:!a.isActive,name:a.name,address:a.address,orderCapacity:a.orderCapacity},k=await J(t,h);k.status===200?(U.success({message:s({id:"window.success"}),description:s({id:"PickUpPoint.Pick-up point successfully changed!"})}),K()):U.error({message:s({id:"window.error"}),description:k.statusText})};n.useEffect(()=>{q.current&&q.current.focus()},[o]);const W=(t,a=!1,h)=>e(G,{style:{padding:"0px"},children:e(G.Item,{onClick:()=>ue(t,h),style:{backgroundColor:a?"LightCoral":"LimeGreen",color:"AliceBlue",fontWeight:"bolder"},children:s(a?{id:"PickUpPoint.Disable"}:{id:"PickUpPoint.Enable"})},"accept")}),pe=[{title:s({id:"window.name"}),dataIndex:"name",key:"name",render:t=>e("span",{children:t}),filterDropdown:u("div",{className:"custom-filter-dropdown",children:[e(z,{ref:q,placeholder:s({id:"PickUpPoint.Search name"}),value:Y,onChange:se,onPressEnter:$}),e(M,{type:"primary",onClick:$,style:{marginTop:"5px"},children:s({id:"PickUpPoint.Search"})})]}),filterIcon:e(Pe,{style:{color:L?"#108ee9":"#aaa"}}),filterDropdownVisible:o,onFilterDropdownVisibleChange:t=>{c(t)}},{title:s({id:"window.address"}),dataIndex:"address",key:"address",render:t=>e("span",{children:t})},{title:s({id:"PickUpPoint.Creation"}),dataIndex:"creationDate",key:"creationDate",render:t=>e("span",{children:m(t).format("DD.MM.YYYY")})},{title:s({id:"PickUpPoint.Status"}),dataIndex:"isActive",key:"isActive",render:t=>e("span",{className:t?"font-size-12 badge badge-success":"font-size-12 badge badge-danger",children:s(t?{id:"PickUpPoint.Active"}:{id:"PickUpPoint.Inactive"})}),sorter:(t,a)=>t.isActive-a.isActive},{title:s({id:"PickUpPoint.orderCapacity"}),dataIndex:"orderCapacity",key:"orderCapacity",render:t=>e("span",{children:t})},{title:s({id:"PickUpPoint.Action"}),dataIndex:"id",key:"action",render:(t,a)=>u("span",{children:[e(M,{style:{marginRight:"15px"},overlay:W(t,a.isActive,a.deleted),onClick:()=>re(t,a),children:s({id:"PickUpPoint.View"})}),e(ge.Button,{overlay:W(t,a.isActive,a),onClick:()=>_(a,t),children:s({id:"window.edit"})})]})}];return u(ye,{roles:["root","admin","salesDirector"],denied:["Dany","Jan"],redirect:!0,to:"/main",children:[e(fe,{title:s({id:"PickUpPoint.Pick-up points"})}),u("div",{className:"card",children:[u("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between"},children:[e("div",{className:"utils__title",children:e("strong",{children:s({id:"PickUpPoint.Pick-up points"})})}),e(M,{type:"primary",onClick:_,children:s({id:"PickUpPoint.Create new Pick-up point"})})]}),e("div",{className:"card-body",children:e(E,{tableLayout:"auto",scroll:{x:"100%"},columns:pe,dataSource:w,pagination:{position:"bottom",total:w.length,showTotal:(t,a)=>`${a[0]}-${a[1]} of ${t} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:w.length<10},loading:j,rowKey:()=>Math.random().toString()})})]}),e(De,{visible:O,create:Ce,change:J,onClose:le,update:K,forEdit:I}),e(be,{visible:V,onClose:de,orders:l,currentPpCapacity:ee,showPickupPointNewDate:ce,start:A,end:y,handleChangeDate:oe,loading:ne})]})}export{Te as default};
