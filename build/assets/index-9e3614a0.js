import{be as Q,a1 as X,r,j as e,c as h,B as y,bl as R,aa as o,a3 as m,a as Z,u as q,b4 as re,bp as T,c3 as H,a2 as oe,bF as P,a4 as le,b as ce,bL as U,a8 as W,bg as de,c4 as ue}from"./index-c20b5e8e.js";import{T as $}from"./Table-fe15f1b3.js";import"./Pagination-e2a53e90.js";import{P as V}from"./index-67f4e7c4.js";import"./PickerPanel-72c5d64a.js";/* empty css              */import{D as me}from"./index-2f7554ca.js";import{d as G}from"./kitchen-60ac824b.js";import{R as x,C as M}from"./row-58ed805b.js";import{S as v}from"./index-297358d3.js";import{D as k}from"./index-98f1088d.js";import{o as he,q as fe}from"./customer-fbff77ee.js";import{f as J,h as Y}from"./order-d29e3517.js";import"./styleChecker-a7b568e2.js";import"./index-8e340a60.js";import"./padStart-17be0050.js";const{WeekPicker:pe}=me;function ye({intl:i}){const[D,c]=r.useState(0),w=d=>{if(d){const f=o.utc(d.startOf("isoWeek").format("DD.MM.YYYY"),"DD.MM.YYYY").unix();c(f)}},N=async()=>{const{formatMessage:d}=i;(await G(D)).status===200&&m.success({message:d({id:"window.success"}),description:d({id:"KitchenWidget.MenuSent!"})})},u=async()=>{const{formatMessage:d}=i;(await G(D,!0)).status===200&&m.success({message:d({id:"window.success"}),description:d({id:"KitchenWidget.MenuSent!"})})};return e("div",{className:"row",children:h("div",{className:"col-xl-12",children:[e("div",{className:"h-20 d-flex flex-column justify-content-center",children:e(pe,{format:"w \\w\\e\\e\\k - YYYY",placeholder:"Select week (any day)",onChange:w})}),e("br",{}),e("div",{className:"h-15 d-flex flex-column justify-content-center",children:e(y,{type:"primary",onClick:async()=>N(),children:e(R,{id:"KitchenWidget.SendMenu"})})}),e("br",{}),e("div",{className:"h-15 d-flex flex-column justify-content-center",children:e(y,{type:"primary",onClick:async()=>u(),children:e(R,{id:"KitchenWidget.SendB2BMenu"})})})]})})}const ge=Q(X(ye));function ke(){const[i,D]=r.useState([]),[c,w]=r.useState([]),[N,u]=r.useState(!1),[d,f]=r.useState(!1),[g,j]=r.useState(!1),[B,C]=r.useState(!1),[_,L]=r.useState(!1),{formatMessage:p}=Z(),{currentBranch:S}=q(t=>t.settings),z=()=>{u(!0),H("",S).then(async t=>{if(t.status===200){const O=await t.json();D(O.result.future),u(!1),L(!0)}else u(!1),m.error({message:p({id:"window.error"}),description:t.statusText})})},A=()=>{u(!0),H("past",S).then(async t=>{if(t.status===200){const O=await t.json();w(O.result.past),u(!1),f(!0)}else u(!1),m.error({message:p({id:"window.error"}),description:t.statusText})})},K=(t="future")=>{t==="past"?C(!0):j(!0)};return e("div",{className:"row",children:h("div",{className:"col-xl-12",children:[e("center",{children:e(k,{style:{marginBottom:"30px"},children:e(y,{loading:N,onClick:z,children:p(_?{id:"NumberOfOrders.Refresh"}:{id:"NumberOfOrders.Load"})})})}),_&&h(re,{spinning:N,children:[!d&&e("center",{children:e(y,{onClick:A,children:p({id:"NumberOfOrders.LoadPastDays"})})}),d&&e(k,{children:p({id:"NumberOfOrders.AllKitchens"})}),e(x,{gutter:16,children:d&&c.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.users,valueStyle:{color:"grey"}},t.key)},Math.random()))}),d&&!B&&e("center",{children:e(y,{onClick:()=>K("past"),children:p({id:"NumberOfOrders.LoadByKitchen"})})}),B&&h(T,{children:[e(k,{children:c.length>0?c[0].kitchens[0].name:""}),e(x,{gutter:16,children:c.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[0].total:0},Math.random())},Math.random()))}),e(k,{children:c.length>0?c[0].kitchens[1].name:""}),e(x,{gutter:16,children:c.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[1].total:0},Math.random())},Math.random()))})]}),e(k,{children:p({id:"NumberOfOrders.AllKitchens"})}),e(x,{gutter:16,children:i.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.users},t.key)},Math.random()))}),!g&&e("center",{children:e(y,{onClick:K,children:p({id:"NumberOfOrders.LoadByKitchen"})})}),g&&h(T,{children:[e(k,{children:i.length>0?i[0].kitchens[0].name:""}),e(x,{gutter:16,children:i.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[0].total:0},Math.random())},Math.random()))}),e(k,{children:i.length>0?i[0].kitchens[1].name:""}),e(x,{gutter:16,children:i.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[1].total:0},Math.random())},Math.random()))}),i[0].kitchens.length>2&&h(T,{children:[e(k,{children:i.length>0?i[0].kitchens[2].name:""}),e(x,{gutter:16,children:i.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[2].total:0},Math.random())},Math.random()))})]}),i[0].kitchens.length>3&&h(T,{children:[e(k,{children:i.length>0?i[0].kitchens[3].name:""}),e(x,{gutter:16,children:i.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[3].total:0},Math.random())},Math.random()))})]}),i[0].kitchens.length>4&&h(T,{children:[e(k,{children:i.length>0?i[0].kitchens[4].name:""}),e(x,{gutter:16,children:i.filter(t=>o(t.isoDate).isoWeekday()!==7).map(t=>e(M,{md:2,sm:12,children:e(v,{title:o(t.isoDate).format("DD.MM.YY"),value:t.kitchens?t.kitchens[4].total:0},Math.random())},Math.random()))})]})]})]})]})})}var E;let we=X(E=Q(E=class extends oe.Component{render(){const{visible:D,onCancel:c,list:w,type:N,intl:{formatMessage:u}}=this.props,d=[{title:u({id:"window.name"}),dataIndex:"user",key:"name",render:(f,g)=>e(P,{to:`/orders/${g.id}`,children:e("span",{className:"mr-1",children:g.user.name})})},{title:u({id:"WebOrdersList.Created"}),dataIndex:"id",key:"createdDate",render:f=>e("span",{children:`${o.unix(parseInt(f.substring(0,8),16)).format("DD.MM.YYYY HH:mm")}`})},{title:u({id:"window.email"}),dataIndex:"email",key:"email",render:f=>e("span",{children:`${f||"-"}`})}];return e(le,{open:D,title:u(N?{id:"WebOrdersList.UnpaidOrders"}:{id:"WebOrdersList.WebOrders"}),okText:"OK",cancelText:"Close",onCancel:c,onOk:c,children:e($,{className:"utils__scrollTable",tableLayout:"auto",scroll:{x:"100%"},columns:d,dataSource:w,pagination:{position:"bottom",total:w.length,showTotal:(f,g)=>`${g[0]}-${g[1]} of ${f} items`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100","200"],hideOnSinglePage:w.length<10},rowKey:()=>Math.random()})})}})||E)||E;const Ke=()=>{const[i,D]=r.useState(0),[c,w]=r.useState({waiting:0,active:0,pause:0,b2b:0,total:0}),[,N]=r.useState(0),[u,d]=r.useState(!1),[f,g]=r.useState([]),[j,B]=r.useState([]),[C,_]=r.useState([]),[L,p]=r.useState([]),[S,z]=r.useState([]),[A,K]=r.useState([]),[t,O]=r.useState([]),[F,ee]=r.useState([]),{role:te}=q(l=>l.user),b=ce(),{formatMessage:a}=Z();r.useEffect(()=>{if(te==="readonlySearch")return;(async()=>{ue().then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();D(n.totalUsers),w(n.activeUsers),N(n.withoutDataset)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),J().then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();O(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),J("active").then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();ee(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),Y("active","fromWeb").then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();B(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),Y("active","waitingPayment").then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();_(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),Y("overdue","fromWeb").then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();p(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),Y("overdue","waitingPayment").then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();z(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})}),Y("canceled","canceled").then(async s=>{if(s.status===401){b({type:"user/SET_STATE",payload:{authorized:!1}});return}if(s.status===200){const n=await s.json();K(n)}else m.error({message:a({id:"window.error"}),description:s.statusText})})})()},[b]);const I=(l,s)=>{d(l),g(l?s:[])},se=[{title:a({id:"Main.Type"}),dataIndex:"type",key:"type"},{title:a({id:"Main.Amount"}),key:"amount",dataIndex:"amount",align:"center",render:(l,s)=>(s.key==="6"||s.key==="7")&&l>0?e(U,{className:"text-danger font-weight-bold",to:"#",onClick:n=>{I(!0,s.list),n.preventDefault()},children:l}):e("span",{className:"text-primary font-weight-bold",children:l})}],ae=[{title:a({id:"Main.WebOrders"}),dataIndex:"type",key:"type"},{title:a({id:"Main.Amount"}),key:"amount",dataIndex:"amount",align:"center",render:(l,s)=>(s.key==="3"||s.key==="4")&&l>0?e(U,{className:"text-danger font-weight-bold",to:"#",onClick:n=>{I(!0,s.list),n.preventDefault()},children:l}):e(U,{className:"text-primary font-weight-bold",to:"#",onClick:n=>{I(!0,s.list),n.preventDefault()},children:l})}],ie=async()=>{const l=await he();l.status===200?m.success({message:"Success",description:"Bitrix compare completed successfully"}):m.error({message:a({id:"window.error"}),description:l.statusText})},ne=async()=>{const l=await fe();l.status===200?m.success({message:a({id:"window.success"}),description:a({id:"Main.BitrixSync.SuccessfullyStarted!"})}):m.error({message:a({id:"window.error"}),description:l.statusText})};return h(W,{roles:["root","admin","sales","finance","salesDirector","readonlySearch"],denied:["Ksenia","Daniel"],redirect:!0,to:"/dashboard/stf",children:[e(de,{title:a({id:"Main.DashboardMine"})}),h("div",{className:"row",children:[e("div",{className:"col-lg-9",children:e(W,{roles:["root","admin","sales","finance","salesDirector"],denied:["Dany","Yan"],children:h("div",{className:"card card--fullHeight",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title utils__title--flat",children:e("strong",{className:"text-uppercase font-size-16",children:a({id:"Main.Customers&Orders"})})})}),e("div",{className:"card-body",children:h("div",{className:"row",children:[e("div",{className:"col-xl-6",children:e("div",{className:"mb-3",children:e($,{className:"utils__scrollTable",scroll:{x:"100%"},rowKey:()=>Math.random(),dataSource:[{key:"1",type:"Active customers",amount:c.total},{key:"2",type:"Waiting",amount:c.waiting},{key:"3",type:"Active",amount:c.active},{key:"4",type:"Pause",amount:c.pause},{key:"5",type:"B2B",amount:c.b2b},{key:"6",type:"Active Unpaid",amount:F.length,list:F},{key:"7",type:"Total Unpaid",amount:t.length,list:t},{key:"8",type:"Total customers",amount:i}],columns:se,pagination:!1})})}),h("div",{className:"col-xl-6",children:[e("div",{className:" d-flex flex-column justify-content-center",style:{marginBottom:"5px"},children:e($,{className:"utils__scrollTable",scroll:{x:"100%"},rowKey:()=>Math.random(),dataSource:[{key:"1",type:"New",amount:j.length,list:j},{key:"2",type:"Waiting for payment",amount:C.length,list:C},{key:"3",type:"Acceptance is overdue",amount:L.length,list:L},{key:"4",type:"Payment is overdue",amount:S.length,list:S},{key:"5",type:"Canceled",amount:A.length,list:A}],columns:ae,pagination:!1})}),e("div",{className:" d-flex flex-column justify-content-center",style:{marginBottom:"5px"},children:e(V,{title:"Are you sure?",onConfirm:ie,okText:"Yes",cancelText:"No",children:e(y,{type:"default",children:a({id:"Main.BitrixCompareID"})})})}),e("div",{className:"h-20 d-flex flex-column justify-content-center",style:{marginBottom:"5px"},children:e(V,{title:a({id:"Main.AreYouSure?"}),onConfirm:ne,okText:"Yes",cancelText:"No",children:e(y,{type:"default",children:a({id:"Main.BitrixSync"})})})}),e(P,{to:"/logs/order/",children:e("div",{className:"h-20 d-flex flex-column justify-content-center",style:{marginBottom:"5px"},children:e(y,{type:"dashed",children:a({id:"Main.OrdersLog"})})})}),e(P,{to:"/dashboard/ranges/macro",children:e("div",{className:"h-20 d-flex flex-column justify-content-center",style:{marginBottom:"5px"},children:e(y,{type:"dashed",children:a({id:"Main.MacroRanges"})})})})]})]})})]})})}),e(we,{visible:u,onCancel:()=>d(!1),list:f}),h("div",{className:"col-lg-3",children:[e(W,{roles:["root","admin","sales","finance","salesDirector"],children:h("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title utils__title--flat",children:e("strong",{className:"text-uppercase font-size-16",children:a({id:"Main.WeekMenu"})})})}),e("div",{className:"card-body",children:e(ge,{})})]})}),e(W,{roles:["root","admin","sales","salesDirector"],children:e("div",{className:"card",children:e("div",{className:"card-body",children:e("div",{className:"h-15 d-flex flex-column justify-content-center",children:e(P,{target:"_blank",to:"/dashboard/production-buffer",children:e(y,{style:{width:"100%"},type:"primary",children:a({id:"KitchenWidget.ProductionBuffer"})})})})})})})]})]}),e(W,{roles:["root","admin","sales","finance","salesDirector"],denied:["Dany","Yan"],children:h("div",{className:"card card",children:[e("div",{className:"card-header",children:e("div",{className:"utils__title utils__title--flat",children:e("strong",{className:"text-uppercase font-size-16",children:a({id:"Main.NumberOfOrders"})})})}),e("div",{className:"card-body",children:e("div",{className:"row",children:e("div",{className:"col-lg-12",children:e(ke,{})})})})]})})]})};export{Ke as default};
